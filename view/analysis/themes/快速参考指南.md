# 🚀 DSL Schema 转换快速参考指南

## 📋 概述

本文档提供DSL Schema转换的快速参考，包括常用工具、转换路径、代码示例和最佳实践。

---

## 🔧 常用工具速查

### API转换工具

| 工具 | 功能 | 命令示例 | 文档位置 |
|------|------|----------|----------|
| **AsyncAPI Generator** | OpenAPI→AsyncAPI | `asyncapi-generator generate` | [03文档](./03-DSL转换方案与技术分析.md) |
| **OpenAPI Generator** | OpenAPI→代码 | `openapi-generator-cli generate` | [03文档](./03-DSL转换方案与技术分析.md) |
| **APISIX-MCP** | OpenAPI→MCP | 配置驱动 | [01文档](./01-领域语言转换与AI时代适配方案.md) |

### 配置转换工具

| 工具 | 功能 | 命令示例 | 文档位置 |
|------|------|----------|----------|
| **yq** | YAML↔JSON | `yq -o=json file.yaml` | [03文档](./03-DSL转换方案与技术分析.md) |
| **kompose** | Docker→K8s | `kompose convert` | [03文档](./03-DSL转换方案与技术分析.md) |
| **kubecfg** | K8s YAML↔HCL | `kubecfg show` | [03文档](./03-DSL转换方案与技术分析.md) |

### 数据库转换工具

| 工具 | 功能 | 语言 | 文档位置 |
|------|------|------|----------|
| **Prisma** | Schema→ORM | TypeScript/JavaScript | [03文档](./03-DSL转换方案与技术分析.md) |
| **SQLAlchemy** | SQL→ORM | Python | [03文档](./03-DSL转换方案与技术分析.md) |
| **TypeORM** | SQL→ORM | TypeScript | [03文档](./03-DSL转换方案与技术分析.md) |

### 代码生成工具

| 工具 | 功能 | 语言支持 | 文档位置 |
|------|------|----------|----------|
| **GitHub Copilot** | 自然语言→代码 | 30+语言 | [03文档](./03-DSL转换方案与技术分析.md) |
| **Cursor** | 自然语言→代码 | 30+语言 | [03文档](./03-DSL转换方案与技术分析.md) |
| **OpenAPI Generator** | OpenAPI→代码 | 40+语言 | [03文档](./03-DSL转换方案与技术分析.md) |

---

## 🔄 常用转换路径

### API规范转换

```mermaid
graph LR
    A[OpenAPI 3.1] -->|AsyncAPI Generator| B[AsyncAPI 3.0]
    A -->|APISIX-MCP| C[MCP Protocol]
    A -->|OpenAPI Generator| D[多语言代码]

    style A fill:#e1f5ff
    style B fill:#e8f5e9
    style C fill:#fff4e1
```

**快速命令**：

```bash
# OpenAPI → AsyncAPI
asyncapi-generator generate -i openapi.yaml -g asyncapi

# OpenAPI → 代码
openapi-generator-cli generate -i openapi.yaml -g python-fastapi
```

### 配置格式转换

```bash
# YAML → JSON
yq -o=json config.yaml > config.json

# JSON → YAML
yq -P config.json > config.yaml

# Docker Compose → Kubernetes
kompose convert -f docker-compose.yml
```

### 数据库转换

```bash
# Prisma Schema → 代码
npx prisma generate

# SQL → Prisma Schema
npx prisma db pull

# SQLAlchemy 模型生成
sqlacodegen postgresql://user:pass@localhost/db > models.py
```

---

## 💻 代码示例速查

### OpenAPI → Python (FastAPI)

```python
# 使用 openapi-generator 生成
# 命令: openapi-generator-cli generate -i openapi.yaml -g python-fastapi

from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class User(BaseModel):
    id: int
    name: str
    email: str

@app.get("/users/{user_id}")
async def get_user(user_id: int):
    return User(id=user_id, name="John", email="john@example.com")
```

### OpenAPI → TypeScript

```typescript
// 使用 openapi-generator 生成
// 命令: openapi-generator-cli generate -i openapi.yaml -g typescript-fetch

interface User {
  id: number;
  name: string;
  email: string;
}

async function getUser(userId: number): Promise<User> {
  const response = await fetch(`/users/${userId}`);
  return response.json();
}
```

### MQTT 数据转换

```javascript
// MQTT → JSON → SQL
const mqtt = require('mqtt');
const client = mqtt.connect('mqtt://broker.example.com');

client.on('message', (topic, message) => {
  const data = JSON.parse(message.toString());

  // 转换为SQL插入
  const sql = `INSERT INTO iot_data (device_id, temperature, timestamp)
               VALUES (?, ?, ?)`;
  db.query(sql, [data.device_id, data.temperature, data.timestamp]);
});
```

### YAML ↔ JSON 转换

```bash
# 使用 yq
yq -o=json config.yaml > config.json
yq -P config.json > config.yaml

# 使用 Python
python -c "import yaml, json; print(json.dumps(yaml.safe_load(open('config.yaml'))))"
```

---

## 📊 协议选择指南

### IoT协议选择

| 场景 | 推荐协议 | 原因 | 文档位置 |
|------|----------|------|----------|
| 传感器数据 | MQTT | 低功耗、轻量级 | [04文档](./04-IOT-Schema深度分析.md) |
| 受限设备 | CoAP | 极低功耗 | [04文档](./04-IOT-Schema深度分析.md) |
| 长距离传输 | LoRaWAN | 低功耗、长距离 | [04文档](./04-IOT-Schema深度分析.md) |
| 实时通信 | WebSocket | 低延迟 | [04文档](./04-IOT-Schema深度分析.md) |

### API协议选择

| 场景 | 推荐协议 | 原因 | 文档位置 |
|------|----------|------|----------|
| RESTful API | OpenAPI | 标准化、工具支持好 | [01文档](./01-领域语言转换与AI时代适配方案.md) |
| 异步消息 | AsyncAPI | 事件驱动架构 | [01文档](./01-领域语言转换与AI时代适配方案.md) |
| 微服务 | gRPC | 高性能、强类型 | [02文档](./02-DSL分类与典型示例.md) |
| 实时查询 | GraphQL | 按需获取数据 | [02文档](./02-DSL分类与典型示例.md) |

---

## 🎯 最佳实践

### 1. API转换最佳实践

- ✅ **使用标准工具**：优先使用 OpenAPI Generator、AsyncAPI Generator
- ✅ **版本控制**：保持 OpenAPI/AsyncAPI 规范的版本一致性
- ✅ **验证转换**：转换后验证生成的代码和文档
- ✅ **自动化**：集成到 CI/CD 流程中

**参考文档**：[01-领域语言转换与AI时代适配方案](./01-领域语言转换与AI时代适配方案.md)

### 2. 数据库转换最佳实践

- ✅ **数据迁移**：使用专业工具（如 Prisma、TypeORM）
- ✅ **类型映射**：确保类型系统正确映射
- ✅ **性能测试**：转换后测试查询性能
- ✅ **备份数据**：转换前备份原始数据

**参考文档**：[03-DSL转换方案与技术分析](./03-DSL转换方案与技术分析.md)

### 3. IoT Schema 最佳实践

- ✅ **主题设计**：使用层次化主题结构
- ✅ **QoS选择**：根据数据重要性选择QoS等级
- ✅ **数据验证**：使用 IoT Schema Validator 验证数据
- ✅ **协议绑定**：明确协议绑定规则

**参考文档**：[04-IOT-Schema深度分析](./04-IOT-Schema深度分析.md)

### 4. 类型系统最佳实践

- ✅ **类型安全**：使用强类型语言（TypeScript、Rust）
- ✅ **代码生成**：使用工具自动生成类型定义
- ✅ **运行时验证**：动态语言使用 Pydantic 等库验证
- ✅ **IDE支持**：利用类型提示提升开发体验

**参考文档**：[07-编程语言类型系统与控制逻辑](./07-编程语言类型系统与控制逻辑.md)

---

## 🔍 故障排查

### 常见问题

#### 1. OpenAPI 转换失败

**问题**：OpenAPI Generator 转换失败

**解决方案**：

- 检查 OpenAPI 规范版本兼容性
- 验证 JSON Schema 格式
- 查看错误日志定位问题

**参考**：[03文档 - API规范转换](./03-DSL转换方案与技术分析.md#二api-规范转换)

#### 2. MQTT 数据丢失

**问题**：MQTT 消息丢失

**解决方案**：

- 检查 QoS 等级设置
- 验证 Broker 连接状态
- 使用 QoS 1 或 2 保证可靠性

**参考**：[04文档 - MQTT协议绑定](./04-IOT-Schema深度分析.md#mqtt-协议绑定)

#### 3. 数据库转换性能问题

**问题**：SQL 到 NoSQL 转换后性能下降

**解决方案**：

- 优化数据模型设计
- 使用适当的索引
- 考虑数据分片

**参考**：[03文档 - 数据库转换](./03-DSL转换方案与技术分析.md#四数据库查询语言转换)

---

## 📚 相关文档

### 核心主题文档

- **[01-领域语言转换与AI时代适配方案](./01-领域语言转换与AI时代适配方案.md)** - API转换和AI工具集成
- **[03-DSL转换方案与技术分析](./03-DSL转换方案与技术分析.md)** - 转换工具和技术方案
- **[04-IOT-Schema深度分析](./04-IOT-Schema深度分析.md)** - IoT协议和数据转换
- **[07-编程语言类型系统与控制逻辑](./07-编程语言类型系统与控制逻辑.md)** - 类型系统和代码生成

### 导航文档

- **[总体导航](./总体导航.md)** - 完整的文档导航
- **[增强内容索引](./增强内容索引.md)** - 对比矩阵和图表索引
- **[文档总索引](./文档总索引.md)** - 所有文档清单

---

**最后更新**: 2025年
**快速参考**: 本文档提供常用工具、命令和最佳实践的快速查找
