# VS Codeæ’ä»¶æ¶æ„è®¾è®¡

## ğŸ“‘ ç›®å½•

- [VS Codeæ’ä»¶æ¶æ„è®¾è®¡](#vs-codeæ’ä»¶æ¶æ„è®¾è®¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
    - [1.1 æ’ä»¶ç›®æ ‡](#11-æ’ä»¶ç›®æ ‡)
    - [1.2 æ¶æ„è®¾è®¡åŸåˆ™](#12-æ¶æ„è®¾è®¡åŸåˆ™)
  - [2. æ’ä»¶æ¶æ„](#2-æ’ä»¶æ¶æ„)
    - [2.1 æ•´ä½“æ¶æ„](#21-æ•´ä½“æ¶æ„)
    - [2.2 æ ¸å¿ƒæ¨¡å—](#22-æ ¸å¿ƒæ¨¡å—)
    - [2.3 æ¨¡å—é—´é€šä¿¡](#23-æ¨¡å—é—´é€šä¿¡)
  - [3. Schemaç¼–è¾‘å™¨](#3-schemaç¼–è¾‘å™¨)
    - [3.1 ç¼–è¾‘å™¨åŠŸèƒ½](#31-ç¼–è¾‘å™¨åŠŸèƒ½)
    - [3.2 è¯­æ³•é«˜äº®](#32-è¯­æ³•é«˜äº®)
    - [3.3 è‡ªåŠ¨è¡¥å…¨](#33-è‡ªåŠ¨è¡¥å…¨)
    - [3.4 é”™è¯¯æ£€æŸ¥](#34-é”™è¯¯æ£€æŸ¥)
  - [4. è½¬æ¢åŠŸèƒ½](#4-è½¬æ¢åŠŸèƒ½)
    - [4.1 è½¬æ¢å·¥å…·é›†æˆ](#41-è½¬æ¢å·¥å…·é›†æˆ)
    - [4.2 è½¬æ¢é¢„è§ˆ](#42-è½¬æ¢é¢„è§ˆ)
    - [4.3 è½¬æ¢æ‰§è¡Œ](#43-è½¬æ¢æ‰§è¡Œ)
  - [5. ç”¨æˆ·ç•Œé¢](#5-ç”¨æˆ·ç•Œé¢)
    - [5.1 å‘½ä»¤é¢æ¿](#51-å‘½ä»¤é¢æ¿)
    - [5.2 çŠ¶æ€æ ](#52-çŠ¶æ€æ )
    - [5.3 ä¾§è¾¹æ ](#53-ä¾§è¾¹æ )
  - [6. æ‰©å±•æ€§è®¾è®¡](#6-æ‰©å±•æ€§è®¾è®¡)
    - [6.1 æ’ä»¶æ‰©å±•ç‚¹](#61-æ’ä»¶æ‰©å±•ç‚¹)
    - [6.2 è‡ªå®šä¹‰è½¬æ¢å™¨](#62-è‡ªå®šä¹‰è½¬æ¢å™¨)
    - [6.3 ä¸»é¢˜å®šåˆ¶](#63-ä¸»é¢˜å®šåˆ¶)
  - [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
    - [7.1 å»¶è¿ŸåŠ è½½](#71-å»¶è¿ŸåŠ è½½)
    - [7.2 ç¼“å­˜æœºåˆ¶](#72-ç¼“å­˜æœºåˆ¶)
    - [7.3 å¼‚æ­¥å¤„ç†](#73-å¼‚æ­¥å¤„ç†)
  - [8. æµ‹è¯•ä¸å‘å¸ƒ](#8-æµ‹è¯•ä¸å‘å¸ƒ)
    - [8.1 å•å…ƒæµ‹è¯•](#81-å•å…ƒæµ‹è¯•)
    - [8.2 é›†æˆæµ‹è¯•](#82-é›†æˆæµ‹è¯•)
    - [8.3 å‘å¸ƒæµç¨‹](#83-å‘å¸ƒæµç¨‹)

---

## 1. æ¶æ„æ¦‚è¿°

### 1.1 æ’ä»¶ç›®æ ‡

**æ’ä»¶åŠŸèƒ½**ï¼š

1. **Schemaç¼–è¾‘**ï¼šæä¾›Schemaç¼–è¾‘åŠŸèƒ½
2. **è¯­æ³•æ”¯æŒ**ï¼šè¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ã€é”™è¯¯æ£€æŸ¥
3. **è½¬æ¢åŠŸèƒ½**ï¼šSchemaè½¬æ¢å’Œé¢„è§ˆ
4. **éªŒè¯åŠŸèƒ½**ï¼šSchemaéªŒè¯å’Œé”™è¯¯æç¤º

### 1.2 æ¶æ„è®¾è®¡åŸåˆ™

**è®¾è®¡åŸåˆ™**ï¼š

1. **æ¨¡å—åŒ–**ï¼šæ¸…æ™°çš„æ¨¡å—åˆ’åˆ†
2. **å¯æ‰©å±•**ï¼šæ”¯æŒæ’ä»¶æ‰©å±•
3. **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–æ€§èƒ½ï¼Œå‡å°‘å»¶è¿Ÿ
4. **ç”¨æˆ·å‹å¥½**ï¼šç›´è§‚çš„ç”¨æˆ·ç•Œé¢

---

## 2. æ’ä»¶æ¶æ„

### 2.1 æ•´ä½“æ¶æ„

**æ¶æ„å›¾**ï¼š

```text
VS Code Extension Host
    â†“
Extension Main (extension.ts)
    â”œâ”€â”€ Schema Editor
    â”‚   â”œâ”€â”€ Language Server
    â”‚   â”œâ”€â”€ Syntax Highlighter
    â”‚   â””â”€â”€ Auto Completion
    â”œâ”€â”€ Transformation Engine
    â”‚   â”œâ”€â”€ Converter Registry
    â”‚   â”œâ”€â”€ Preview Manager
    â”‚   â””â”€â”€ Execution Engine
    â”œâ”€â”€ Validation Service
    â”‚   â”œâ”€â”€ Validator
    â”‚   â””â”€â”€ Error Reporter
    â””â”€â”€ UI Components
        â”œâ”€â”€ Command Palette
        â”œâ”€â”€ Status Bar
        â””â”€â”€ Sidebar
```

### 2.2 æ ¸å¿ƒæ¨¡å—

**æ¨¡å—åˆ’åˆ†**ï¼š

1. **Schema Editoræ¨¡å—**ï¼š
   - è¯­è¨€æœåŠ¡å™¨
   - è¯­æ³•é«˜äº®
   - è‡ªåŠ¨è¡¥å…¨
   - é”™è¯¯æ£€æŸ¥

2. **Transformation Engineæ¨¡å—**ï¼š
   - è½¬æ¢å™¨æ³¨å†Œ
   - è½¬æ¢é¢„è§ˆ
   - è½¬æ¢æ‰§è¡Œ

3. **Validation Serviceæ¨¡å—**ï¼š
   - SchemaéªŒè¯
   - é”™è¯¯æŠ¥å‘Š
   - ä¿®å¤å»ºè®®

4. **UI Componentsæ¨¡å—**ï¼š
   - å‘½ä»¤é¢æ¿
   - çŠ¶æ€æ 
   - ä¾§è¾¹æ 

### 2.3 æ¨¡å—é—´é€šä¿¡

**é€šä¿¡æœºåˆ¶**ï¼š

- **äº‹ä»¶æ€»çº¿**ï¼šæ¨¡å—é—´äº‹ä»¶é€šä¿¡
- **APIæ¥å£**ï¼šæ¨¡å—é—´APIè°ƒç”¨
- **æ¶ˆæ¯ä¼ é€’**ï¼šå¼‚æ­¥æ¶ˆæ¯ä¼ é€’

---

## 3. Schemaç¼–è¾‘å™¨

### 3.1 ç¼–è¾‘å™¨åŠŸèƒ½

**åŠŸèƒ½åˆ—è¡¨**ï¼š

1. **è¯­æ³•é«˜äº®**ï¼šDSLè¯­æ³•é«˜äº®
2. **è‡ªåŠ¨è¡¥å…¨**ï¼šæ™ºèƒ½ä»£ç è¡¥å…¨
3. **é”™è¯¯æ£€æŸ¥**ï¼šå®æ—¶é”™è¯¯æ£€æŸ¥
4. **ä»£ç æ ¼å¼åŒ–**ï¼šè‡ªåŠ¨ä»£ç æ ¼å¼åŒ–
5. **ä»£ç æŠ˜å **ï¼šä»£ç å—æŠ˜å 
6. **ç¬¦å·å¯¼èˆª**ï¼šå¿«é€Ÿç¬¦å·å¯¼èˆª

### 3.2 è¯­æ³•é«˜äº®

**å®ç°æ–¹å¼**ï¼š

```json
// package.json
{
  "contributes": {
    "languages": [{
      "id": "dsl-schema",
      "aliases": ["DSL Schema", "dsl"],
      "extensions": [".dsl", ".schema"]
    }],
    "grammars": [{
      "language": "dsl-schema",
      "scopeName": "source.dsl",
      "path": "./syntaxes/dsl.tmLanguage.json"
    }]
  }
}
```

### 3.3 è‡ªåŠ¨è¡¥å…¨

**è¡¥å…¨å®ç°**ï¼š

```typescript
// src/completion.ts
import * as vscode from 'vscode';

export function provideCompletionItems(
  document: vscode.TextDocument,
  position: vscode.Position
): vscode.CompletionItem[] {
  const completions: vscode.CompletionItem[] = [];

  // Schemaå…³é”®å­—è¡¥å…¨
  completions.push({
    label: 'schema',
    kind: vscode.CompletionItemKind.Keyword,
    detail: 'Schema definition',
    documentation: 'Define a new schema'
  });

  // ç±»å‹è¡¥å…¨
  completions.push({
    label: 'String',
    kind: vscode.CompletionItemKind.TypeParameter,
    detail: 'String type',
    documentation: 'String data type'
  });

  return completions;
}
```

### 3.4 é”™è¯¯æ£€æŸ¥

**é”™è¯¯æ£€æŸ¥å®ç°**ï¼š

```typescript
// src/diagnostics.ts
import * as vscode from 'vscode';

export function validateDocument(
  document: vscode.TextDocument
): vscode.Diagnostic[] {
  const diagnostics: vscode.Diagnostic[] = [];
  const text = document.getText();

  // è§£æSchema
  try {
    const schema = parseSchema(text);

    // éªŒè¯Schema
    const errors = validateSchema(schema);

    errors.forEach(error => {
      diagnostics.push({
        range: new vscode.Range(
          error.line,
          error.column,
          error.line,
          error.column + error.length
        ),
        message: error.message,
        severity: vscode.DiagnosticSeverity.Error,
        source: 'dsl-schema'
      });
    });
  } catch (error) {
    // è§£æé”™è¯¯
    diagnostics.push({
      range: new vscode.Range(0, 0, 0, 0),
      message: error.message,
      severity: vscode.DiagnosticSeverity.Error,
      source: 'dsl-schema'
    });
  }

  return diagnostics;
}
```

---

## 4. è½¬æ¢åŠŸèƒ½

### 4.1 è½¬æ¢å·¥å…·é›†æˆ

**è½¬æ¢å™¨æ³¨å†Œ**ï¼š

```typescript
// src/transformers/registry.ts
export class TransformerRegistry {
  private transformers: Map<string, Transformer> = new Map();

  register(name: string, transformer: Transformer): void {
    this.transformers.set(name, transformer);
  }

  get(name: string): Transformer | undefined {
    return this.transformers.get(name);
  }

  list(): string[] {
    return Array.from(this.transformers.keys());
  }
}

// æ³¨å†Œè½¬æ¢å™¨
const registry = new TransformerRegistry();
registry.register('openapi', new OpenAPITransformer());
registry.register('json-schema', new JSONSchemaTransformer());
registry.register('asyncapi', new AsyncAPITransformer());
```

### 4.2 è½¬æ¢é¢„è§ˆ

**é¢„è§ˆå®ç°**ï¼š

```typescript
// src/preview.ts
import * as vscode from 'vscode';

export class PreviewManager {
  private previewPanels: Map<string, vscode.WebviewPanel> = new Map();

  async showPreview(
    document: vscode.TextDocument,
    targetFormat: string
  ): Promise<void> {
    const schema = parseSchema(document.getText());
    const transformer = registry.get(targetFormat);

    if (!transformer) {
      vscode.window.showErrorMessage(`Unknown format: ${targetFormat}`);
      return;
    }

    const transformed = await transformer.transform(schema);

    // åˆ›å»ºé¢„è§ˆé¢æ¿
    const panel = vscode.window.createWebviewPanel(
      'schemaPreview',
      `Preview: ${targetFormat}`,
      vscode.ViewColumn.Beside,
      { enableScripts: true }
    );

    panel.webview.html = this.generatePreviewHTML(transformed);
    this.previewPanels.set(document.uri.toString(), panel);
  }
}
```

### 4.3 è½¬æ¢æ‰§è¡Œ

**æ‰§è¡Œå®ç°**ï¼š

```typescript
// src/commands/transform.ts
import * as vscode from 'vscode';

export async function transformCommand(
  context: vscode.ExtensionContext
): Promise<void> {
  const editor = vscode.window.activeTextEditor;
  if (!editor) {
    vscode.window.showErrorMessage('No active editor');
    return;
  }

  // é€‰æ‹©ç›®æ ‡æ ¼å¼
  const formats = registry.list();
  const selected = await vscode.window.showQuickPick(formats, {
    placeHolder: 'Select target format'
  });

  if (!selected) return;

  // æ‰§è¡Œè½¬æ¢
  const schema = parseSchema(editor.document.getText());
  const transformer = registry.get(selected);

  if (!transformer) return;

  try {
    const result = await transformer.transform(schema);

    // åˆ›å»ºæ–°æ–‡æ¡£æ˜¾ç¤ºç»“æœ
    const doc = await vscode.workspace.openTextDocument({
      content: JSON.stringify(result, null, 2),
      language: 'json'
    });

    await vscode.window.showTextDocument(doc);
  } catch (error) {
    vscode.window.showErrorMessage(`Transformation failed: ${error.message}`);
  }
}
```

---

## 5. ç”¨æˆ·ç•Œé¢

### 5.1 å‘½ä»¤é¢æ¿

**å‘½ä»¤æ³¨å†Œ**ï¼š

```json
// package.json
{
  "contributes": {
    "commands": [
      {
        "command": "dsl-schema.transform",
        "title": "Transform Schema",
        "category": "DSL Schema"
      },
      {
        "command": "dsl-schema.validate",
        "title": "Validate Schema",
        "category": "DSL Schema"
      },
      {
        "command": "dsl-schema.preview",
        "title": "Preview Transformation",
        "category": "DSL Schema"
      }
    ]
  }
}
```

### 5.2 çŠ¶æ€æ 

**çŠ¶æ€æ å®ç°**ï¼š

```typescript
// src/statusbar.ts
import * as vscode from 'vscode';

export class StatusBar {
  private statusBarItem: vscode.StatusBarItem;

  constructor() {
    this.statusBarItem = vscode.window.createStatusBarItem(
      vscode.StatusBarAlignment.Right,
      100
    );
    this.statusBarItem.command = 'dsl-schema.showStatus';
    this.statusBarItem.show();
  }

  updateStatus(schema: Schema): void {
    const status = this.getSchemaStatus(schema);
    this.statusBarItem.text = `$(check) Schema: ${status}`;
    this.statusBarItem.tooltip = `Schema validation status: ${status}`;
  }

  private getSchemaStatus(schema: Schema): string {
    // è®¡ç®—SchemaçŠ¶æ€
    return 'Valid';
  }
}
```

### 5.3 ä¾§è¾¹æ 

**ä¾§è¾¹æ å®ç°**ï¼š

```typescript
// src/sidebar.ts
import * as vscode from 'vscode';

export class SchemaExplorerProvider
  implements vscode.TreeDataProvider<SchemaNode> {

  getTreeItem(element: SchemaNode): vscode.TreeItem {
    return element;
  }

  getChildren(element?: SchemaNode): Thenable<SchemaNode[]> {
    if (!element) {
      // æ ¹èŠ‚ç‚¹
      return Promise.resolve(this.getRootNodes());
    }
    return Promise.resolve(this.getChildNodes(element));
  }

  private getRootNodes(): SchemaNode[] {
    // è¿”å›æ ¹èŠ‚ç‚¹åˆ—è¡¨
    return [];
  }

  private getChildNodes(node: SchemaNode): SchemaNode[] {
    // è¿”å›å­èŠ‚ç‚¹åˆ—è¡¨
    return [];
  }
}
```

---

## 6. æ‰©å±•æ€§è®¾è®¡

### 6.1 æ’ä»¶æ‰©å±•ç‚¹

**æ‰©å±•ç‚¹å®šä¹‰**ï¼š

```json
// package.json
{
  "contributes": {
    "extensionPoints": {
      "transformers": {
        "description": "Register custom transformers"
      },
      "validators": {
        "description": "Register custom validators"
      }
    }
  }
}
```

### 6.2 è‡ªå®šä¹‰è½¬æ¢å™¨

**è½¬æ¢å™¨æ¥å£**ï¼š

```typescript
// src/api/transformer.ts
export interface Transformer {
  name: string;
  transform(schema: Schema): Promise<TransformationResult>;
  validate(schema: Schema): ValidationResult;
}

// è‡ªå®šä¹‰è½¬æ¢å™¨ç¤ºä¾‹
export class CustomTransformer implements Transformer {
  name = 'custom-format';

  async transform(schema: Schema): Promise<TransformationResult> {
    // è‡ªå®šä¹‰è½¬æ¢é€»è¾‘
    return {};
  }

  validate(schema: Schema): ValidationResult {
    // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
    return { valid: true, errors: [] };
  }
}
```

### 6.3 ä¸»é¢˜å®šåˆ¶

**ä¸»é¢˜é…ç½®**ï¼š

```json
// package.json
{
  "contributes": {
    "themes": [{
      "label": "DSL Schema Theme",
      "uiTheme": "vs-dark",
      "path": "./themes/dsl-schema-color-theme.json"
    }]
  }
}
```

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 å»¶è¿ŸåŠ è½½

**å»¶è¿ŸåŠ è½½å®ç°**ï¼š

```typescript
// src/extension.ts
export function activate(context: vscode.ExtensionContext) {
  // å»¶è¿ŸåŠ è½½è½¬æ¢å™¨
  const transformerLoader = new LazyLoader(() => {
    return import('./transformers/registry');
  });

  // å»¶è¿ŸåŠ è½½éªŒè¯å™¨
  const validatorLoader = new LazyLoader(() => {
    return import('./validators/registry');
  });
}
```

### 7.2 ç¼“å­˜æœºåˆ¶

**ç¼“å­˜å®ç°**ï¼š

```typescript
// src/cache.ts
export class TransformationCache {
  private cache: Map<string, TransformationResult> = new Map();

  get(key: string): TransformationResult | null {
    return this.cache.get(key) || null;
  }

  set(key: string, result: TransformationResult): void {
    this.cache.set(key, result);
  }

  invalidate(pattern: string): void {
    for (const key of this.cache.keys()) {
      if (key.includes(pattern)) {
        this.cache.delete(key);
      }
    }
  }
}
```

### 7.3 å¼‚æ­¥å¤„ç†

**å¼‚æ­¥å¤„ç†**ï¼š

- ä½¿ç”¨Web Workerså¤„ç†å¤§å‹è½¬æ¢
- å¼‚æ­¥åŠ è½½èµ„æº
- éé˜»å¡UIæ“ä½œ

---

## 8. æµ‹è¯•ä¸å‘å¸ƒ

### 8.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•ç¤ºä¾‹**ï¼š

```typescript
// src/test/completion.test.ts
import * as assert from 'assert';
import { provideCompletionItems } from '../completion';

suite('Completion Tests', () => {
  test('should provide schema keyword completion', () => {
    const completions = provideCompletionItems(mockDocument, mockPosition);
    assert.ok(completions.some(c => c.label === 'schema'));
  });
});
```

### 8.2 é›†æˆæµ‹è¯•

**é›†æˆæµ‹è¯•**ï¼š

```typescript
// src/test/integration.test.ts
import * as vscode from 'vscode';

suite('Integration Tests', () => {
  test('should transform schema', async () => {
    const result = await transformCommand(mockContext);
    assert.ok(result);
  });
});
```

### 8.3 å‘å¸ƒæµç¨‹

**å‘å¸ƒæ­¥éª¤**ï¼š

1. **æ„å»º**ï¼š`npm run build`
2. **æ‰“åŒ…**ï¼š`vsce package`
3. **æµ‹è¯•**ï¼šæœ¬åœ°æµ‹è¯•
4. **å‘å¸ƒ**ï¼š`vsce publish`

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `tools/vscode-extension/` - VS Codeæ’ä»¶ä»£ç å®ç°
- `tools/vscode-extension/README.md` - æ’ä»¶ä½¿ç”¨æ–‡æ¡£

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
