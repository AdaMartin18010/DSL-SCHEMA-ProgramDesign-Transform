# å¢é‡è½¬æ¢ç®—æ³•åˆ†æ

## ğŸ“‘ ç›®å½•

- [å¢é‡è½¬æ¢ç®—æ³•åˆ†æ](#å¢é‡è½¬æ¢ç®—æ³•åˆ†æ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. ç®—æ³•æ¦‚è¿°](#1-ç®—æ³•æ¦‚è¿°)
    - [1.1 å¢é‡è½¬æ¢å®šä¹‰](#11-å¢é‡è½¬æ¢å®šä¹‰)
    - [1.2 ç®—æ³•ç›®æ ‡](#12-ç®—æ³•ç›®æ ‡)
  - [2. å˜æ›´æ£€æµ‹æœºåˆ¶](#2-å˜æ›´æ£€æµ‹æœºåˆ¶)
    - [2.1 å˜æ›´æ£€æµ‹ç­–ç•¥](#21-å˜æ›´æ£€æµ‹ç­–ç•¥)
    - [2.2 å˜æ›´ç±»å‹è¯†åˆ«](#22-å˜æ›´ç±»å‹è¯†åˆ«)
    - [2.3 å˜æ›´å½±å“åˆ†æ](#23-å˜æ›´å½±å“åˆ†æ)
  - [3. å¢é‡æ›´æ–°ç­–ç•¥](#3-å¢é‡æ›´æ–°ç­–ç•¥)
    - [3.1 æ›´æ–°ç­–ç•¥é€‰æ‹©](#31-æ›´æ–°ç­–ç•¥é€‰æ‹©)
    - [3.2 å¢é‡æ›´æ–°ç®—æ³•](#32-å¢é‡æ›´æ–°ç®—æ³•)
    - [3.3 æ›´æ–°å†²çªå¤„ç†](#33-æ›´æ–°å†²çªå¤„ç†)
  - [4. ä¾èµ–å…³ç³»åˆ†æ](#4-ä¾èµ–å…³ç³»åˆ†æ)
    - [4.1 ä¾èµ–å›¾æ„å»º](#41-ä¾èµ–å›¾æ„å»º)
    - [4.2 ä¾èµ–ä¼ æ’­ç®—æ³•](#42-ä¾èµ–ä¼ æ’­ç®—æ³•)
    - [4.3 ä¾èµ–ä¼˜åŒ–](#43-ä¾èµ–ä¼˜åŒ–)
  - [5. ç®—æ³•å¤æ‚åº¦åˆ†æ](#5-ç®—æ³•å¤æ‚åº¦åˆ†æ)
    - [5.1 æ—¶é—´å¤æ‚åº¦](#51-æ—¶é—´å¤æ‚åº¦)
    - [5.2 ç©ºé—´å¤æ‚åº¦](#52-ç©ºé—´å¤æ‚åº¦)
    - [5.3 ä¼˜åŒ–ç­–ç•¥](#53-ä¼˜åŒ–ç­–ç•¥)
  - [6. ç®—æ³•å®ç°](#6-ç®—æ³•å®ç°)
    - [6.1 æ ¸å¿ƒæ•°æ®ç»“æ„](#61-æ ¸å¿ƒæ•°æ®ç»“æ„)
    - [6.2 ç®—æ³•æµç¨‹](#62-ç®—æ³•æµç¨‹)
    - [6.3 ä»£ç ç¤ºä¾‹](#63-ä»£ç ç¤ºä¾‹)
  - [7. æµ‹è¯•ä¸éªŒè¯](#7-æµ‹è¯•ä¸éªŒè¯)
    - [7.1 æ­£ç¡®æ€§éªŒè¯](#71-æ­£ç¡®æ€§éªŒè¯)
    - [7.2 æ€§èƒ½æµ‹è¯•](#72-æ€§èƒ½æµ‹è¯•)
    - [7.3 è¾¹ç•Œæƒ…å†µæµ‹è¯•](#73-è¾¹ç•Œæƒ…å†µæµ‹è¯•)

---

## 1. ç®—æ³•æ¦‚è¿°

### 1.1 å¢é‡è½¬æ¢å®šä¹‰

**å¢é‡è½¬æ¢**æ˜¯æŒ‡åªè½¬æ¢Schemaä¸­å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯é‡æ–°è½¬æ¢æ•´ä¸ªSchemaã€‚

**ä¼˜åŠ¿**ï¼š

1. **æ€§èƒ½æå‡**ï¼šåªå¤„ç†å˜æ›´éƒ¨åˆ†ï¼Œå‡å°‘è®¡ç®—é‡
2. **èµ„æºèŠ‚çº¦**ï¼šå‡å°‘CPUå’Œå†…å­˜ä½¿ç”¨
3. **å®æ—¶æ€§**ï¼šæ”¯æŒå®æ—¶å¢é‡æ›´æ–°
4. **å¯æ‰©å±•æ€§**ï¼šé€‚åˆå¤§è§„æ¨¡Schemaè½¬æ¢

### 1.2 ç®—æ³•ç›®æ ‡

**ç®—æ³•ç›®æ ‡**ï¼š

1. **å˜æ›´æ£€æµ‹å‡†ç¡®ç‡**ï¼šâ‰¥ 95%
2. **å¢é‡æ›´æ–°æ•ˆç‡**ï¼šæå‡70%ä»¥ä¸Š
3. **ä¾èµ–åˆ†æå®Œæ•´æ€§**ï¼š100%
4. **å†²çªå¤„ç†æ­£ç¡®æ€§**ï¼š100%

---

## 2. å˜æ›´æ£€æµ‹æœºåˆ¶

### 2.1 å˜æ›´æ£€æµ‹ç­–ç•¥

**å˜æ›´æ£€æµ‹æ–¹æ³•**ï¼š

1. **å“ˆå¸Œæ¯”è¾ƒ**ï¼š
   - è®¡ç®—Schemaçš„å“ˆå¸Œå€¼
   - æ¯”è¾ƒæ–°æ—§å“ˆå¸Œå€¼
   - å¿«é€Ÿæ£€æµ‹æ˜¯å¦æœ‰å˜æ›´

2. **ç‰ˆæœ¬å·æ¯”è¾ƒ**ï¼š
   - ç»´æŠ¤Schemaç‰ˆæœ¬å·
   - æ¯”è¾ƒç‰ˆæœ¬å·åˆ¤æ–­å˜æ›´
   - æ”¯æŒç‰ˆæœ¬å†å²è¿½è¸ª

3. **å·®å¼‚ç®—æ³•**ï¼š
   - ä½¿ç”¨å·®å¼‚ç®—æ³•ï¼ˆå¦‚Myersç®—æ³•ï¼‰
   - ç²¾ç¡®è¯†åˆ«å˜æ›´å†…å®¹
   - æ”¯æŒç»†ç²’åº¦å˜æ›´æ£€æµ‹

4. **äº‹ä»¶é©±åŠ¨**ï¼š
   - ç›‘å¬Schemaå˜æ›´äº‹ä»¶
   - å®æ—¶æ•è·å˜æ›´
   - æ”¯æŒä¸»åŠ¨æ¨é€

### 2.2 å˜æ›´ç±»å‹è¯†åˆ«

**å˜æ›´ç±»å‹**ï¼š

1. **æ·»åŠ ï¼ˆAddï¼‰**ï¼š
   - æ–°å¢å­—æ®µã€ç±»å‹ã€æ“ä½œç­‰
   - å½±å“ï¼šéœ€è¦æ–°å¢è½¬æ¢é€»è¾‘

2. **åˆ é™¤ï¼ˆDeleteï¼‰**ï¼š
   - åˆ é™¤å­—æ®µã€ç±»å‹ã€æ“ä½œç­‰
   - å½±å“ï¼šéœ€è¦æ¸…ç†ç›¸å…³è½¬æ¢ç»“æœ

3. **ä¿®æ”¹ï¼ˆModifyï¼‰**ï¼š
   - ä¿®æ”¹å­—æ®µç±»å‹ã€çº¦æŸç­‰
   - å½±å“ï¼šéœ€è¦æ›´æ–°è½¬æ¢é€»è¾‘å’Œç»“æœ

4. **ç§»åŠ¨ï¼ˆMoveï¼‰**ï¼š
   - ç§»åŠ¨å­—æ®µä½ç½®ã€é‡ç»„ç»“æ„
   - å½±å“ï¼šéœ€è¦æ›´æ–°è·¯å¾„æ˜ å°„

### 2.3 å˜æ›´å½±å“åˆ†æ

**å½±å“åˆ†æ**ï¼š

```typescript
interface Change {
  type: 'add' | 'delete' | 'modify' | 'move';
  path: string[];
  oldValue?: any;
  newValue?: any;
  impact: ImpactAnalysis;
}

interface ImpactAnalysis {
  affectedPaths: string[];
  dependentSchemas: string[];
  requiresRevalidation: boolean;
  requiresRetransform: boolean;
}
```

---

## 3. å¢é‡æ›´æ–°ç­–ç•¥

### 3.1 æ›´æ–°ç­–ç•¥é€‰æ‹©

**æ›´æ–°ç­–ç•¥**ï¼š

1. **ç«‹å³æ›´æ–°**ï¼š
   - æ£€æµ‹åˆ°å˜æ›´ç«‹å³æ›´æ–°
   - å®æ—¶æ€§å¼º
   - å¯èƒ½å½±å“æ€§èƒ½

2. **æ‰¹é‡æ›´æ–°**ï¼š
   - æ”¶é›†ä¸€æ®µæ—¶é—´å†…çš„å˜æ›´
   - æ‰¹é‡å¤„ç†æ›´æ–°
   - æ€§èƒ½ä¼˜åŒ–

3. **å»¶è¿Ÿæ›´æ–°**ï¼š
   - å»¶è¿Ÿåˆ°ç‰¹å®šæ—¶æœºæ›´æ–°
   - å‡å°‘æ›´æ–°é¢‘ç‡
   - é€‚åˆéå®æ—¶åœºæ™¯

4. **æ™ºèƒ½æ›´æ–°**ï¼š
   - æ ¹æ®å˜æ›´ç±»å‹å’Œå½±å“é€‰æ‹©ç­–ç•¥
   - å¹³è¡¡å®æ—¶æ€§å’Œæ€§èƒ½
   - è‡ªé€‚åº”è°ƒæ•´

### 3.2 å¢é‡æ›´æ–°ç®—æ³•

**ç®—æ³•æµç¨‹**ï¼š

```text
1. å˜æ›´æ£€æµ‹
   â†“
2. å˜æ›´åˆ†ç±»
   â†“
3. å½±å“åˆ†æ
   â†“
4. ä¾èµ–åˆ†æ
   â†“
5. å¢é‡è½¬æ¢
   â†“
6. ç»“æœåˆå¹¶
   â†“
7. éªŒè¯æ£€æŸ¥
```

**ç®—æ³•å®ç°**ï¼š

```typescript
class IncrementalTransformer {
  async transformIncremental(
    oldSchema: Schema,
    newSchema: Schema
  ): Promise<TransformationResult> {
    // 1. æ£€æµ‹å˜æ›´
    const changes = this.detectChanges(oldSchema, newSchema);

    // 2. åˆ†æå½±å“
    const impacts = this.analyzeImpacts(changes);

    // 3. åˆ†æä¾èµ–
    const dependencies = this.analyzeDependencies(impacts);

    // 4. å¢é‡è½¬æ¢
    const results = await this.transformIncremental(changes, dependencies);

    // 5. åˆå¹¶ç»“æœ
    const mergedResult = this.mergeResults(results);

    // 6. éªŒè¯
    this.validate(mergedResult);

    return mergedResult;
  }
}
```

### 3.3 æ›´æ–°å†²çªå¤„ç†

**å†²çªç±»å‹**ï¼š

1. **å¹¶å‘ä¿®æ”¹å†²çª**ï¼š
   - å¤šä¸ªå˜æ›´åŒæ—¶ä¿®æ”¹åŒä¸€éƒ¨åˆ†
   - è§£å†³ï¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶æˆ–é”æœºåˆ¶

2. **ä¾èµ–å†²çª**ï¼š
   - ä¾èµ–å…³ç³»å†²çª
   - è§£å†³ï¼šä¾èµ–è§£æå’Œæ’åº

3. **è½¬æ¢å†²çª**ï¼š
   - è½¬æ¢ç»“æœå†²çª
   - è§£å†³ï¼šå†²çªæ£€æµ‹å’Œåˆå¹¶ç­–ç•¥

---

## 4. ä¾èµ–å…³ç³»åˆ†æ

### 4.1 ä¾èµ–å›¾æ„å»º

**ä¾èµ–å›¾ç»“æ„**ï¼š

```typescript
interface DependencyGraph {
  nodes: Map<string, SchemaNode>;
  edges: Map<string, DependencyEdge[]>;
}

interface SchemaNode {
  id: string;
  schema: Schema;
  dependencies: string[];
  dependents: string[];
}

interface DependencyEdge {
  from: string;
  to: string;
  type: 'direct' | 'transitive';
  weight: number;
}
```

**æ„å»ºç®—æ³•**ï¼š

```typescript
class DependencyGraphBuilder {
  buildGraph(schemas: Schema[]): DependencyGraph {
    const graph: DependencyGraph = {
      nodes: new Map(),
      edges: new Map(),
    };

    // æ„å»ºèŠ‚ç‚¹
    schemas.forEach(schema => {
      graph.nodes.set(schema.id, {
        id: schema.id,
        schema,
        dependencies: [],
        dependents: [],
      });
    });

    // æ„å»ºè¾¹
    schemas.forEach(schema => {
      const dependencies = this.extractDependencies(schema);
      dependencies.forEach(depId => {
        this.addEdge(graph, schema.id, depId);
      });
    });

    return graph;
  }
}
```

### 4.2 ä¾èµ–ä¼ æ’­ç®—æ³•

**ä¼ æ’­ç®—æ³•**ï¼š

```typescript
class DependencyPropagator {
  propagate(
    graph: DependencyGraph,
    changedNode: string
  ): string[] {
    const affected: Set<string> = new Set();
    const queue: string[] = [changedNode];

    while (queue.length > 0) {
      const nodeId = queue.shift()!;
      if (affected.has(nodeId)) continue;

      affected.add(nodeId);
      const node = graph.nodes.get(nodeId);

      if (node) {
        // ä¼ æ’­åˆ°ä¾èµ–èŠ‚ç‚¹
        node.dependents.forEach(dependentId => {
          if (!affected.has(dependentId)) {
            queue.push(dependentId);
          }
        });
      }
    }

    return Array.from(affected);
  }
}
```

### 4.3 ä¾èµ–ä¼˜åŒ–

**ä¼˜åŒ–ç­–ç•¥**ï¼š

1. **ä¾èµ–ç¼“å­˜**ï¼šç¼“å­˜ä¾èµ–å…³ç³»ï¼Œé¿å…é‡å¤è®¡ç®—
2. **ä¾èµ–å‹ç¼©**ï¼šå‹ç¼©ä¼ é€’ä¾èµ–ï¼Œå‡å°‘è®¡ç®—é‡
3. **å¹¶è¡Œå¤„ç†**ï¼šå¹¶è¡Œå¤„ç†æ— ä¾èµ–çš„è½¬æ¢ä»»åŠ¡

---

## 5. ç®—æ³•å¤æ‚åº¦åˆ†æ

### 5.1 æ—¶é—´å¤æ‚åº¦

**å¤æ‚åº¦åˆ†æ**ï¼š

- **å˜æ›´æ£€æµ‹**ï¼šO(n)ï¼Œnä¸ºSchemaèŠ‚ç‚¹æ•°
- **å½±å“åˆ†æ**ï¼šO(m)ï¼Œmä¸ºå˜æ›´æ•°é‡
- **ä¾èµ–åˆ†æ**ï¼šO(v + e)ï¼Œvä¸ºèŠ‚ç‚¹æ•°ï¼Œeä¸ºè¾¹æ•°
- **å¢é‡è½¬æ¢**ï¼šO(k)ï¼Œkä¸ºå—å½±å“èŠ‚ç‚¹æ•°
- **æ€»ä½“å¤æ‚åº¦**ï¼šO(n + m + v + e + k)

**ä¼˜åŒ–å**ï¼š

- ä½¿ç”¨ç¼“å­˜ï¼šO(1) å˜æ›´æ£€æµ‹
- å¹¶è¡Œå¤„ç†ï¼šO(k/p)ï¼Œpä¸ºå¹¶è¡Œåº¦
- æ€»ä½“ä¼˜åŒ–ï¼šO(log n + k/p)

### 5.2 ç©ºé—´å¤æ‚åº¦

**ç©ºé—´å¤æ‚åº¦**ï¼š

- **ä¾èµ–å›¾**ï¼šO(v + e)
- **å˜æ›´è®°å½•**ï¼šO(m)
- **ç¼“å­˜**ï¼šO(c)
- **æ€»ä½“å¤æ‚åº¦**ï¼šO(v + e + m + c)

### 5.3 ä¼˜åŒ–ç­–ç•¥

**ä¼˜åŒ–æ–¹æ³•**ï¼š

1. **å¢é‡è®¡ç®—**ï¼šåªè®¡ç®—å˜æ›´éƒ¨åˆ†
2. **ç¼“å­˜ä¼˜åŒ–**ï¼šç¼“å­˜ä¸­é—´ç»“æœ
3. **å¹¶è¡Œå¤„ç†**ï¼šå¹¶è¡Œå¤„ç†ç‹¬ç«‹ä»»åŠ¡
4. **å»¶è¿Ÿè®¡ç®—**ï¼šå»¶è¿Ÿè®¡ç®—éå…³é”®è·¯å¾„

---

## 6. ç®—æ³•å®ç°

### 6.1 æ ¸å¿ƒæ•°æ®ç»“æ„

**æ•°æ®ç»“æ„**ï¼š

```typescript
interface IncrementalTransformState {
  oldSchema: Schema;
  newSchema: Schema;
  changes: Change[];
  dependencyGraph: DependencyGraph;
  transformationCache: Map<string, any>;
  affectedNodes: Set<string>;
}
```

### 6.2 ç®—æ³•æµç¨‹

**å®Œæ•´æµç¨‹**ï¼š

```typescript
class IncrementalTransformer {
  async transform(
    oldSchema: Schema,
    newSchema: Schema
  ): Promise<TransformationResult> {
    // åˆå§‹åŒ–çŠ¶æ€
    const state: IncrementalTransformState = {
      oldSchema,
      newSchema,
      changes: [],
      dependencyGraph: this.buildDependencyGraph(newSchema),
      transformationCache: new Map(),
      affectedNodes: new Set(),
    };

    // 1. å˜æ›´æ£€æµ‹
    state.changes = this.detectChanges(oldSchema, newSchema);

    // 2. å½±å“åˆ†æ
    state.affectedNodes = this.analyzeImpacts(
      state.changes,
      state.dependencyGraph
    );

    // 3. å¢é‡è½¬æ¢
    const results = await this.transformIncremental(state);

    // 4. ç»“æœåˆå¹¶
    return this.mergeResults(results);
  }
}
```

### 6.3 ä»£ç ç¤ºä¾‹

**å®Œæ•´ç¤ºä¾‹**ï¼š

```typescript
// ä½¿ç”¨ç¤ºä¾‹
const transformer = new IncrementalTransformer();

const oldSchema = loadSchema('schema-v1.json');
const newSchema = loadSchema('schema-v2.json');

const result = await transformer.transform(oldSchema, newSchema);
console.log(`è½¬æ¢äº† ${result.changedCount} ä¸ªèŠ‚ç‚¹`);
console.log(`èŠ‚çœäº† ${result.savedTime}ms`);
```

---

## 7. æµ‹è¯•ä¸éªŒè¯

### 7.1 æ­£ç¡®æ€§éªŒè¯

**éªŒè¯æ–¹æ³•**ï¼š

1. **ç­‰ä»·æ€§éªŒè¯**ï¼šå¢é‡è½¬æ¢ç»“æœä¸å…¨é‡è½¬æ¢ç»“æœç­‰ä»·
2. **ä¸€è‡´æ€§éªŒè¯**ï¼šå¤šæ¬¡å¢é‡è½¬æ¢ç»“æœä¸€è‡´
3. **å®Œæ•´æ€§éªŒè¯**ï¼šæ‰€æœ‰å˜æ›´éƒ½è¢«æ­£ç¡®å¤„ç†

### 7.2 æ€§èƒ½æµ‹è¯•

**æ€§èƒ½æŒ‡æ ‡**ï¼š

- å˜æ›´æ£€æµ‹æ—¶é—´
- å¢é‡è½¬æ¢æ—¶é—´
- å†…å­˜ä½¿ç”¨é‡
- CPUä½¿ç”¨ç‡

### 7.3 è¾¹ç•Œæƒ…å†µæµ‹è¯•

**è¾¹ç•Œæƒ…å†µ**ï¼š

- ç©ºSchemaå˜æ›´
- å¤§è§„æ¨¡Schemaå˜æ›´
- å¾ªç¯ä¾èµ–å¤„ç†
- å¹¶å‘å˜æ›´å¤„ç†

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `practices/15_Incremental_Transformation_Guide.md` - å¢é‡è½¬æ¢å®æ–½æŒ‡å—
- `src/transformers/incremental/` - å¢é‡è½¬æ¢ç®—æ³•å®ç°

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
