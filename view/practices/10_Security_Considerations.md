# å®‰å…¨è€ƒè™‘ä¸å®è·µ

## ğŸ“‘ ç›®å½•

- [å®‰å…¨è€ƒè™‘ä¸å®è·µ](#å®‰å…¨è€ƒè™‘ä¸å®è·µ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 å®‰å…¨ç›®æ ‡](#11-å®‰å…¨ç›®æ ‡)
    - [1.2 å®‰å…¨å¨èƒ](#12-å®‰å…¨å¨èƒ)
  - [2. æ•°æ®å®‰å…¨](#2-æ•°æ®å®‰å…¨)
    - [2.1 æ•°æ®åŠ å¯†](#21-æ•°æ®åŠ å¯†)
      - [2.1.1 ä¼ è¾“åŠ å¯†](#211-ä¼ è¾“åŠ å¯†)
      - [2.1.2 å­˜å‚¨åŠ å¯†](#212-å­˜å‚¨åŠ å¯†)
    - [2.2 æ•°æ®éªŒè¯](#22-æ•°æ®éªŒè¯)
      - [2.2.1 SchemaéªŒè¯](#221-schemaéªŒè¯)
      - [2.2.2 è¾“å…¥éªŒè¯](#222-è¾“å…¥éªŒè¯)
    - [2.3 æ•°æ®è„±æ•](#23-æ•°æ®è„±æ•)
      - [2.3.1 æ•æ„Ÿä¿¡æ¯è¯†åˆ«](#231-æ•æ„Ÿä¿¡æ¯è¯†åˆ«)
      - [2.3.2 è„±æ•æ–¹æ³•](#232-è„±æ•æ–¹æ³•)
  - [3. è®¿é—®æ§åˆ¶](#3-è®¿é—®æ§åˆ¶)
    - [3.1 èº«ä»½è®¤è¯](#31-èº«ä»½è®¤è¯)
      - [3.1.1 è®¤è¯æ–¹æ³•](#311-è®¤è¯æ–¹æ³•)
      - [3.1.2 å¤šå› ç´ è®¤è¯](#312-å¤šå› ç´ è®¤è¯)
    - [3.2 æˆæƒæ§åˆ¶](#32-æˆæƒæ§åˆ¶)
      - [3.2.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰](#321-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶rbac)
      - [3.2.2 åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰](#322-åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶abac)
    - [3.3 APIå®‰å…¨](#33-apiå®‰å…¨)
      - [3.3.1 é€Ÿç‡é™åˆ¶](#331-é€Ÿç‡é™åˆ¶)
      - [3.3.2 è¾“å…¥éªŒè¯](#332-è¾“å…¥éªŒè¯)
  - [4. å®‰å…¨å®¡è®¡](#4-å®‰å…¨å®¡è®¡)
    - [4.1 å®¡è®¡æ—¥å¿—](#41-å®¡è®¡æ—¥å¿—)
      - [4.1.1 æ—¥å¿—å†…å®¹](#411-æ—¥å¿—å†…å®¹)
      - [4.1.2 æ—¥å¿—å­˜å‚¨](#412-æ—¥å¿—å­˜å‚¨)
    - [4.2 å®‰å…¨ç›‘æ§](#42-å®‰å…¨ç›‘æ§)
      - [4.2.1 å¼‚å¸¸æ£€æµ‹](#421-å¼‚å¸¸æ£€æµ‹)
      - [4.2.2 å‘Šè­¦æœºåˆ¶](#422-å‘Šè­¦æœºåˆ¶)
  - [5. å®‰å…¨æœ€ä½³å®è·µ](#5-å®‰å…¨æœ€ä½³å®è·µ)
    - [5.1 å¼€å‘å®‰å…¨](#51-å¼€å‘å®‰å…¨)
      - [5.1.1 å®‰å…¨ç¼–ç ](#511-å®‰å…¨ç¼–ç )
      - [5.1.2 å®‰å…¨æµ‹è¯•](#512-å®‰å…¨æµ‹è¯•)
    - [5.2 éƒ¨ç½²å®‰å…¨](#52-éƒ¨ç½²å®‰å…¨)
      - [5.2.1 ç¯å¢ƒå®‰å…¨](#521-ç¯å¢ƒå®‰å…¨)
      - [5.2.2 é…ç½®å®‰å…¨](#522-é…ç½®å®‰å…¨)
    - [5.3 è¿ç»´å®‰å…¨](#53-è¿ç»´å®‰å…¨)
      - [5.3.1 ç›‘æ§å‘Šè­¦](#531-ç›‘æ§å‘Šè­¦)
      - [5.3.2 åº”æ€¥å“åº”](#532-åº”æ€¥å“åº”)
  - [6. åˆè§„æ€§](#6-åˆè§„æ€§)
    - [6.1 æ•°æ®ä¿æŠ¤æ³•è§„](#61-æ•°æ®ä¿æŠ¤æ³•è§„)
      - [6.1.1 GDPRåˆè§„](#611-gdpråˆè§„)
      - [6.1.2 å…¶ä»–æ³•è§„](#612-å…¶ä»–æ³•è§„)
    - [6.2 å®‰å…¨æ ‡å‡†](#62-å®‰å…¨æ ‡å‡†)
      - [6.2.1 ISO 27001](#621-iso-27001)
      - [6.2.2 OWASP Top 10](#622-owasp-top-10)
  - [7. æ€»ç»“](#7-æ€»ç»“)
    - [7.1 å…³é”®æˆæœ](#71-å…³é”®æˆæœ)
    - [7.2 å®‰å…¨å»ºè®®](#72-å®‰å…¨å»ºè®®)
  - [8. å®‰å…¨å®è·µç»¼åˆåº”ç”¨å®é™…ç¤ºä¾‹](#8-å®‰å…¨å®è·µç»¼åˆåº”ç”¨å®é™…ç¤ºä¾‹)
  - [9. ç›¸å…³æ–‡æ¡£](#9-ç›¸å…³æ–‡æ¡£)
    - [æ¨¡å¼æ–‡æ¡£ â­æ–°å¢](#æ¨¡å¼æ–‡æ¡£-æ–°å¢)
    - [å…¶ä»–å®è·µæ–‡æ¡£](#å…¶ä»–å®è·µæ–‡æ¡£)
  - [ğŸ“ ç‰ˆæœ¬å†å²](#-ç‰ˆæœ¬å†å²)
    - [v1.2 (2025-01-21) - å®é™…åº”ç”¨ç¤ºä¾‹å¢å¼ºç‰ˆ](#v12-2025-01-21---å®é™…åº”ç”¨ç¤ºä¾‹å¢å¼ºç‰ˆ)
    - [v1.1 (2025-01-27) - åˆå§‹ç‰ˆæœ¬](#v11-2025-01-27---åˆå§‹ç‰ˆæœ¬)

---

## 1. æ¦‚è¿°

### 1.1 å®‰å…¨ç›®æ ‡

Schemaè½¬æ¢è¿‡ç¨‹ä¸­çš„å®‰å…¨ç›®æ ‡ï¼š

- **æ•°æ®ä¿æŠ¤**ï¼šä¿æŠ¤Schemaæ•°æ®ä¸è¢«æ³„éœ²æˆ–ç¯¡æ”¹
- **è®¿é—®æ§åˆ¶**ï¼šæ§åˆ¶å¯¹è½¬æ¢å·¥å…·çš„è®¿é—®æƒé™
- **å®‰å…¨å®¡è®¡**ï¼šè®°å½•å’Œå®¡è®¡è½¬æ¢æ“ä½œ
- **åˆè§„æ€§**ï¼šæ»¡è¶³ç›¸å…³å®‰å…¨åˆè§„è¦æ±‚

### 1.2 å®‰å…¨å¨èƒ

- **æ•°æ®æ³„éœ²**ï¼šSchemaæ•°æ®æ³„éœ²
- **æ•°æ®ç¯¡æ”¹**ï¼šSchemaæ•°æ®è¢«æ¶æ„ç¯¡æ”¹
- **æœªæˆæƒè®¿é—®**ï¼šæœªæˆæƒç”¨æˆ·è®¿é—®è½¬æ¢å·¥å…·
- **æ³¨å…¥æ”»å‡»**ï¼šæ¶æ„Schemaæ³¨å…¥æ”»å‡»

---

## 2. æ•°æ®å®‰å…¨

### 2.1 æ•°æ®åŠ å¯†

#### 2.1.1 ä¼ è¾“åŠ å¯†

**åŠ å¯†æ–¹æ³•**ï¼š

- **TLS/SSL**ï¼šä½¿ç”¨TLS/SSLåŠ å¯†ä¼ è¾“
- **HTTPS**ï¼šä½¿ç”¨HTTPSåè®®
- **VPN**ï¼šä½¿ç”¨VPNåŠ å¯†é€šé“

**ç¤ºä¾‹**ï¼š

```python
import ssl
import httpx

async def secure_request(url, data):
    async with httpx.AsyncClient(
        verify=ssl.create_default_context(),
        timeout=30.0
    ) as client:
        response = await client.post(url, json=data)
        return response.json()
```

#### 2.1.2 å­˜å‚¨åŠ å¯†

**åŠ å¯†æ–¹æ³•**ï¼š

- **æ–‡ä»¶åŠ å¯†**ï¼šåŠ å¯†å­˜å‚¨çš„Schemaæ–‡ä»¶
- **æ•°æ®åº“åŠ å¯†**ï¼šåŠ å¯†æ•°æ®åº“ä¸­çš„Schemaæ•°æ®
- **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿç®¡ç†å¯†é’¥

**ç¤ºä¾‹**ï¼š

```python
from cryptography.fernet import Fernet

class SchemaEncryption:
    def __init__(self, key):
        self.cipher = Fernet(key)

    def encrypt(self, schema_data):
        return self.cipher.encrypt(schema_data.encode())

    def decrypt(self, encrypted_data):
        return self.cipher.decrypt(encrypted_data).decode()
```

### 2.2 æ•°æ®éªŒè¯

#### 2.2.1 SchemaéªŒè¯

**éªŒè¯æ–¹æ³•**ï¼š

- **æ ¼å¼éªŒè¯**ï¼šéªŒè¯Schemaæ ¼å¼æ­£ç¡®æ€§
- **å†…å®¹éªŒè¯**ï¼šéªŒè¯Schemaå†…å®¹åˆæ³•æ€§
- **ç­¾åéªŒè¯**ï¼šéªŒè¯Schemaæ•°å­—ç­¾å

**ç¤ºä¾‹**ï¼š

```python
import jsonschema

def validate_schema(schema, schema_def):
    try:
        jsonschema.validate(schema, schema_def)
        return True
    except jsonschema.ValidationError as e:
        return False, str(e)
```

#### 2.2.2 è¾“å…¥éªŒè¯

**éªŒè¯æ–¹æ³•**ï¼š

- **ç±»å‹æ£€æŸ¥**ï¼šæ£€æŸ¥è¾“å…¥ç±»å‹
- **èŒƒå›´æ£€æŸ¥**ï¼šæ£€æŸ¥è¾“å…¥èŒƒå›´
- **æ ¼å¼æ£€æŸ¥**ï¼šæ£€æŸ¥è¾“å…¥æ ¼å¼

**ç¤ºä¾‹**ï¼š

```python
def validate_input(schema_data):
    if not isinstance(schema_data, dict):
        raise ValueError("Schema data must be a dictionary")

    if 'version' not in schema_data:
        raise ValueError("Schema must have a version field")

    if schema_data['version'] not in ['3.0', '3.1']:
        raise ValueError("Unsupported schema version")

    return True
```

### 2.3 æ•°æ®è„±æ•

#### 2.3.1 æ•æ„Ÿä¿¡æ¯è¯†åˆ«

**æ•æ„Ÿä¿¡æ¯ç±»å‹**ï¼š

- **è®¤è¯ä¿¡æ¯**ï¼šAPIå¯†é’¥ã€ä»¤ç‰Œç­‰
- **ä¸ªäººä¿¡æ¯**ï¼šå§“åã€é‚®ç®±ã€ç”µè¯ç­‰
- **ä¸šåŠ¡ä¿¡æ¯**ï¼šå†…éƒ¨ä¸šåŠ¡æ•°æ®ç­‰

#### 2.3.2 è„±æ•æ–¹æ³•

**è„±æ•ç­–ç•¥**ï¼š

- **æ›¿æ¢**ï¼šç”¨å ä½ç¬¦æ›¿æ¢æ•æ„Ÿä¿¡æ¯
- **å“ˆå¸Œ**ï¼šä½¿ç”¨å“ˆå¸Œå‡½æ•°å¤„ç†æ•æ„Ÿä¿¡æ¯
- **åŠ å¯†**ï¼šåŠ å¯†æ•æ„Ÿä¿¡æ¯

**ç¤ºä¾‹**ï¼š

```python
import re

def mask_sensitive_data(schema_data):
    # æ›¿æ¢APIå¯†é’¥
    schema_str = json.dumps(schema_data)
    schema_str = re.sub(r'"api[_-]?key":\s*"[^"]*"',
                        '"api_key": "***"',
                        schema_str,
                        flags=re.IGNORECASE)

    # æ›¿æ¢é‚®ç®±
    schema_str = re.sub(r'[\w\.-]+@[\w\.-]+\.\w+',
                        '***@***.***',
                        schema_str)

    return json.loads(schema_str)
```

---

## 3. è®¿é—®æ§åˆ¶

### 3.1 èº«ä»½è®¤è¯

#### 3.1.1 è®¤è¯æ–¹æ³•

**è®¤è¯æ–¹å¼**ï¼š

- **APIå¯†é’¥**ï¼šä½¿ç”¨APIå¯†é’¥è®¤è¯
- **OAuth 2.0**ï¼šä½¿ç”¨OAuth 2.0è®¤è¯
- **JWTä»¤ç‰Œ**ï¼šä½¿ç”¨JWTä»¤ç‰Œè®¤è¯

**ç¤ºä¾‹**ï¼š

```python
import jwt
from functools import wraps

def require_auth(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        token = request.headers.get('Authorization')
        if not token:
            return {'error': 'No token provided'}, 401

        try:
            payload = jwt.decode(token, SECRET_KEY, algorithms=['HS256'])
            kwargs['user'] = payload['user']
        except jwt.InvalidTokenError:
            return {'error': 'Invalid token'}, 401

        return f(*args, **kwargs)
    return decorated_function
```

#### 3.1.2 å¤šå› ç´ è®¤è¯

**è®¤è¯å› ç´ **ï¼š

- **çŸ¥è¯†å› ç´ **ï¼šå¯†ç ã€PINç ç­‰
- **æ‹¥æœ‰å› ç´ **ï¼šæ‰‹æœºã€ç¡¬ä»¶ä»¤ç‰Œç­‰
- **ç”Ÿç‰©å› ç´ **ï¼šæŒ‡çº¹ã€é¢éƒ¨è¯†åˆ«ç­‰

### 3.2 æˆæƒæ§åˆ¶

#### 3.2.1 åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰

**è§’è‰²å®šä¹‰**ï¼š

- **ç®¡ç†å‘˜**ï¼šå®Œå…¨è®¿é—®æƒé™
- **å¼€å‘è€…**ï¼šè¯»å†™æƒé™
- **åªè¯»ç”¨æˆ·**ï¼šåªè¯»æƒé™

**ç¤ºä¾‹**ï¼š

```python
class Role:
    ADMIN = 'admin'
    DEVELOPER = 'developer'
    READONLY = 'readonly'

def require_role(role):
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            user_role = kwargs.get('user', {}).get('role')
            if user_role != role and user_role != Role.ADMIN:
                return {'error': 'Insufficient permissions'}, 403
            return f(*args, **kwargs)
        return decorated_function
    return decorator
```

#### 3.2.2 åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰

**å±æ€§å®šä¹‰**ï¼š

- **ç”¨æˆ·å±æ€§**ï¼šéƒ¨é—¨ã€èŒä½ç­‰
- **èµ„æºå±æ€§**ï¼šSchemaç±»å‹ã€æ•æ„Ÿçº§åˆ«ç­‰
- **ç¯å¢ƒå±æ€§**ï¼šæ—¶é—´ã€åœ°ç‚¹ç­‰

**ç¤ºä¾‹**ï¼š

```python
def check_permission(user, resource, action):
    # æ£€æŸ¥ç”¨æˆ·å±æ€§
    if user['department'] == 'IT' and action == 'convert':
        return True

    # æ£€æŸ¥èµ„æºå±æ€§
    if resource['sensitivity'] == 'high' and user['clearance'] < 'high':
        return False

    # æ£€æŸ¥ç¯å¢ƒå±æ€§
    if action == 'delete' and not is_business_hours():
        return False

    return False
```

### 3.3 APIå®‰å…¨

#### 3.3.1 é€Ÿç‡é™åˆ¶

**é™åˆ¶ç­–ç•¥**ï¼š

- **è¯·æ±‚é¢‘ç‡**ï¼šé™åˆ¶è¯·æ±‚é¢‘ç‡
- **å¹¶å‘æ•°**ï¼šé™åˆ¶å¹¶å‘è¯·æ±‚æ•°
- **é…é¢**ï¼šé™åˆ¶æ¯æ—¥/æ¯æœˆé…é¢

**ç¤ºä¾‹**ï¼š

```python
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address

limiter = Limiter(
    app,
    key_func=get_remote_address,
    default_limits=["100 per hour"]
)

@app.route('/convert')
@limiter.limit("10 per minute")
def convert_schema():
    # è½¬æ¢é€»è¾‘
    pass
```

#### 3.3.2 è¾“å…¥éªŒè¯

**éªŒè¯æ–¹æ³•**ï¼š

- **SchemaéªŒè¯**ï¼šéªŒè¯è¾“å…¥Schemaæ ¼å¼
- **å¤§å°é™åˆ¶**ï¼šé™åˆ¶è¾“å…¥å¤§å°
- **ç±»å‹æ£€æŸ¥**ï¼šæ£€æŸ¥è¾“å…¥ç±»å‹

---

## 4. å®‰å…¨å®¡è®¡

### 4.1 å®¡è®¡æ—¥å¿—

#### 4.1.1 æ—¥å¿—å†…å®¹

**è®°å½•ä¿¡æ¯**ï¼š

- **æ“ä½œç±»å‹**ï¼šè½¬æ¢ã€æŸ¥è¯¢ã€åˆ é™¤ç­‰
- **æ“ä½œæ—¶é—´**ï¼šæ“ä½œå‘ç”Ÿæ—¶é—´
- **æ“ä½œç”¨æˆ·**ï¼šæ‰§è¡Œæ“ä½œçš„ç”¨æˆ·
- **æ“ä½œå¯¹è±¡**ï¼šæ“ä½œçš„Schema
- **æ“ä½œç»“æœ**ï¼šæ“ä½œæˆåŠŸæˆ–å¤±è´¥

**ç¤ºä¾‹**ï¼š

```python
import logging
from datetime import datetime

class AuditLogger:
    def __init__(self):
        self.logger = logging.getLogger('audit')
        self.logger.setLevel(logging.INFO)
        handler = logging.FileHandler('audit.log')
        formatter = logging.Formatter(
            '%(asctime)s - %(user)s - %(action)s - %(resource)s - %(result)s'
        )
        handler.setFormatter(formatter)
        self.logger.addHandler(handler)

    def log(self, user, action, resource, result):
        self.logger.info(
            '',
            extra={
                'user': user,
                'action': action,
                'resource': resource,
                'result': result
            }
        )
```

#### 4.1.2 æ—¥å¿—å­˜å‚¨

**å­˜å‚¨æ–¹å¼**ï¼š

- **æ–‡ä»¶å­˜å‚¨**ï¼šå­˜å‚¨åˆ°æ—¥å¿—æ–‡ä»¶
- **æ•°æ®åº“å­˜å‚¨**ï¼šå­˜å‚¨åˆ°æ•°æ®åº“
- **æ—¥å¿—æœåŠ¡**ï¼šä½¿ç”¨æ—¥å¿—æœåŠ¡ï¼ˆå¦‚ELK Stackï¼‰

### 4.2 å®‰å…¨ç›‘æ§

#### 4.2.1 å¼‚å¸¸æ£€æµ‹

**æ£€æµ‹æ–¹æ³•**ï¼š

- **å¼‚å¸¸è¡Œä¸º**ï¼šæ£€æµ‹å¼‚å¸¸æ“ä½œè¡Œä¸º
- **å¼‚å¸¸è®¿é—®**ï¼šæ£€æµ‹å¼‚å¸¸è®¿é—®æ¨¡å¼
- **å¼‚å¸¸æ•°æ®**ï¼šæ£€æµ‹å¼‚å¸¸æ•°æ®æ¨¡å¼

**ç¤ºä¾‹**ï¼š

```python
class SecurityMonitor:
    def __init__(self):
        self.suspicious_patterns = [
            'rapid_requests',
            'unusual_access_time',
            'large_data_transfer'
        ]

    def detect_anomaly(self, log_entry):
        for pattern in self.suspicious_patterns:
            if self.check_pattern(log_entry, pattern):
                self.alert(pattern, log_entry)

    def check_pattern(self, log_entry, pattern):
        if pattern == 'rapid_requests':
            return self.count_requests(log_entry['user']) > 100
        # å…¶ä»–æ¨¡å¼æ£€æŸ¥
        return False
```

#### 4.2.2 å‘Šè­¦æœºåˆ¶

**å‘Šè­¦æ–¹å¼**ï¼š

- **é‚®ä»¶å‘Šè­¦**ï¼šå‘é€é‚®ä»¶å‘Šè­¦
- **çŸ­ä¿¡å‘Šè­¦**ï¼šå‘é€çŸ­ä¿¡å‘Šè­¦
- **ç³»ç»Ÿå‘Šè­¦**ï¼šç³»ç»Ÿå†…éƒ¨å‘Šè­¦

---

## 5. å®‰å…¨æœ€ä½³å®è·µ

### 5.1 å¼€å‘å®‰å…¨

#### 5.1.1 å®‰å…¨ç¼–ç 

**ç¼–ç è§„èŒƒ**ï¼š

- **è¾“å…¥éªŒè¯**ï¼šå§‹ç»ˆéªŒè¯è¾“å…¥
- **è¾“å‡ºç¼–ç **ï¼šç¼–ç è¾“å‡ºé˜²æ­¢æ³¨å…¥
- **é”™è¯¯å¤„ç†**ï¼šä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯

#### 5.1.2 å®‰å…¨æµ‹è¯•

**æµ‹è¯•æ–¹æ³•**ï¼š

- **æ¸—é€æµ‹è¯•**ï¼šå®šæœŸè¿›è¡Œæ¸—é€æµ‹è¯•
- **ä»£ç å®¡æŸ¥**ï¼šè¿›è¡Œå®‰å…¨ä»£ç å®¡æŸ¥
- **æ¼æ´æ‰«æ**ï¼šä½¿ç”¨æ¼æ´æ‰«æå·¥å…·

### 5.2 éƒ¨ç½²å®‰å…¨

#### 5.2.1 ç¯å¢ƒå®‰å…¨

**å®‰å…¨æªæ–½**ï¼š

- **éš”ç¦»ç¯å¢ƒ**ï¼šéš”ç¦»å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ
- **ç½‘ç»œå®‰å…¨**ï¼šé…ç½®é˜²ç«å¢™å’Œç½‘ç»œéš”ç¦»
- **ç³»ç»Ÿå®‰å…¨**ï¼šåŠæ—¶æ›´æ–°ç³»ç»Ÿå’Œè¡¥ä¸

#### 5.2.2 é…ç½®å®‰å…¨

**é…ç½®è¦æ±‚**ï¼š

- **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ
- **æœ€å°æƒé™**ï¼šä½¿ç”¨æœ€å°æƒé™åŸåˆ™
- **å®‰å…¨é…ç½®**ï¼šä½¿ç”¨å®‰å…¨é…ç½®æ¨¡æ¿

### 5.3 è¿ç»´å®‰å…¨

#### 5.3.1 ç›‘æ§å‘Šè­¦

**ç›‘æ§å†…å®¹**ï¼š

- **ç³»ç»Ÿç›‘æ§**ï¼šç›‘æ§ç³»ç»Ÿèµ„æº
- **å®‰å…¨ç›‘æ§**ï¼šç›‘æ§å®‰å…¨äº‹ä»¶
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§æ€§èƒ½æŒ‡æ ‡

#### 5.3.2 åº”æ€¥å“åº”

**å“åº”æµç¨‹**ï¼š

- **äº‹ä»¶æ£€æµ‹**ï¼šæ£€æµ‹å®‰å…¨äº‹ä»¶
- **äº‹ä»¶å“åº”**ï¼šå“åº”å®‰å…¨äº‹ä»¶
- **äº‹ä»¶æ¢å¤**ï¼šæ¢å¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

---

## 6. åˆè§„æ€§

### 6.1 æ•°æ®ä¿æŠ¤æ³•è§„

#### 6.1.1 GDPRåˆè§„

**åˆè§„è¦æ±‚**ï¼š

- **æ•°æ®ä¸»ä½“æƒåˆ©**ï¼šå°Šé‡æ•°æ®ä¸»ä½“æƒåˆ©
- **æ•°æ®ä¿æŠ¤**ï¼šä¿æŠ¤ä¸ªäººæ•°æ®
- **æ•°æ®æ³„éœ²é€šçŸ¥**ï¼šåŠæ—¶é€šçŸ¥æ•°æ®æ³„éœ²

#### 6.1.2 å…¶ä»–æ³•è§„

**ç›¸å…³æ³•è§„**ï¼š

- **CCPA**ï¼šåŠ å·æ¶ˆè´¹è€…éšç§æ³•
- **HIPAA**ï¼šå¥åº·ä¿é™©æµé€šä¸è´£ä»»æ³•æ¡ˆ
- **PCI DSS**ï¼šæ”¯ä»˜å¡è¡Œä¸šæ•°æ®å®‰å…¨æ ‡å‡†

### 6.2 å®‰å…¨æ ‡å‡†

#### 6.2.1 ISO 27001

**æ ‡å‡†è¦æ±‚**ï¼š

- **ä¿¡æ¯å®‰å…¨ç®¡ç†**ï¼šå»ºç«‹ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»
- **é£é™©è¯„ä¼°**ï¼šè¿›è¡Œé£é™©è¯„ä¼°
- **æŒç»­æ”¹è¿›**ï¼šæŒç»­æ”¹è¿›å®‰å…¨ç®¡ç†

#### 6.2.2 OWASP Top 10

**å®‰å…¨é£é™©**ï¼š

- **æ³¨å…¥æ”»å‡»**ï¼šé˜²æ­¢æ³¨å…¥æ”»å‡»
- **èº«ä»½è®¤è¯å¤±æ•ˆ**ï¼šåŠ å¼ºèº«ä»½è®¤è¯
- **æ•æ„Ÿæ•°æ®æ³„éœ²**ï¼šä¿æŠ¤æ•æ„Ÿæ•°æ®

---

## 7. æ€»ç»“

### 7.1 å…³é”®æˆæœ

1. **å®‰å…¨æ¡†æ¶**ï¼šå»ºç«‹äº†Schemaè½¬æ¢çš„å®‰å…¨æ¡†æ¶
2. **å®‰å…¨æªæ–½**ï¼šå®ç°äº†æ•°æ®å®‰å…¨ã€è®¿é—®æ§åˆ¶ã€å®‰å…¨å®¡è®¡ç­‰å®‰å…¨æªæ–½
3. **æœ€ä½³å®è·µ**ï¼šæ€»ç»“äº†å®‰å…¨æœ€ä½³å®è·µ
4. **åˆè§„æ€§**ï¼šè€ƒè™‘äº†ç›¸å…³åˆè§„è¦æ±‚

### 7.2 å®‰å…¨å»ºè®®

1. **å¤šå±‚é˜²æŠ¤**ï¼šå®æ–½å¤šå±‚å®‰å…¨é˜²æŠ¤
2. **æŒç»­ç›‘æ§**ï¼šæŒç»­ç›‘æ§å®‰å…¨çŠ¶æ€
3. **åŠæ—¶æ›´æ–°**ï¼šåŠæ—¶æ›´æ–°å®‰å…¨æªæ–½
4. **åŸ¹è®­æ•™è‚²**ï¼šåŠ å¼ºå®‰å…¨åŸ¹è®­å’Œæ•™è‚²

---

## 8. å®‰å…¨å®è·µç»¼åˆåº”ç”¨å®é™…ç¤ºä¾‹

**ç¤ºä¾‹ï¼šå®ç°Schemaè½¬æ¢å®‰å…¨æ¡†æ¶**

```python
import hashlib
import hmac
import json
import time
from dataclasses import dataclass
from typing import Dict, List, Optional, Any
from functools import wraps

@dataclass
class SecurityContext:
    """å®‰å…¨ä¸Šä¸‹æ–‡"""
    user_id: str
    roles: List[str]
    permissions: List[str]
    session_id: str
    ip_address: str
    timestamp: float

class SchemaTransformationSecurityFramework:
    """Schemaè½¬æ¢å®‰å…¨æ¡†æ¶"""

    def __init__(self, secret_key: str):
        self.secret_key = secret_key
        self.audit_logs = []
        self.rate_limits = {}

        # æ•æ„Ÿå­—æ®µé…ç½®ï¼ˆåŸºäº2.3èŠ‚ï¼‰
        self.sensitive_fields = {
            'password', 'api_key', 'secret', 'token',
            'credit_card', 'ssn', 'email', 'phone'
        }

        # RBACé…ç½®ï¼ˆåŸºäº3.2èŠ‚ï¼‰
        self.role_permissions = {
            'admin': ['read', 'write', 'delete', 'transform', 'audit'],
            'developer': ['read', 'write', 'transform'],
            'viewer': ['read']
        }

    def authenticate(self, token: str) -> Optional[SecurityContext]:
        """èº«ä»½è®¤è¯ï¼ˆåŸºäº3.1èŠ‚ï¼‰"""
        try:
            # éªŒè¯JWTä»¤ç‰Œ
            payload = self._verify_token(token)

            return SecurityContext(
                user_id=payload.get('user_id'),
                roles=payload.get('roles', []),
                permissions=self._get_permissions(payload.get('roles', [])),
                session_id=payload.get('session_id'),
                ip_address=payload.get('ip_address'),
                timestamp=time.time()
            )
        except Exception as e:
            self._log_security_event('authentication_failed', {'error': str(e)})
            return None

    def authorize(self, context: SecurityContext, required_permission: str) -> bool:
        """æˆæƒæ£€æŸ¥ï¼ˆåŸºäº3.2èŠ‚ï¼‰"""
        if required_permission in context.permissions:
            self._log_security_event('authorization_granted', {
                'user_id': context.user_id,
                'permission': required_permission
            })
            return True

        self._log_security_event('authorization_denied', {
            'user_id': context.user_id,
            'permission': required_permission
        })
        return False

    def check_rate_limit(self, context: SecurityContext, limit: int = 100, window: int = 60) -> bool:
        """é€Ÿç‡é™åˆ¶æ£€æŸ¥ï¼ˆåŸºäº3.3èŠ‚ï¼‰"""
        key = f"{context.user_id}:{context.ip_address}"
        current_time = time.time()

        if key not in self.rate_limits:
            self.rate_limits[key] = []

        # æ¸…é™¤è¿‡æœŸè¯·æ±‚è®°å½•
        self.rate_limits[key] = [
            t for t in self.rate_limits[key]
            if current_time - t < window
        ]

        if len(self.rate_limits[key]) >= limit:
            self._log_security_event('rate_limit_exceeded', {
                'user_id': context.user_id,
                'ip_address': context.ip_address
            })
            return False

        self.rate_limits[key].append(current_time)
        return True

    def validate_schema_input(self, schema_data: Dict) -> Dict:
        """è¾“å…¥éªŒè¯ï¼ˆåŸºäº2.2èŠ‚ï¼‰"""
        validation_result = {
            'valid': True,
            'errors': [],
            'warnings': []
        }

        # æ£€æŸ¥æ³¨å…¥æ”»å‡»
        if self._detect_injection(schema_data):
            validation_result['valid'] = False
            validation_result['errors'].append('æ£€æµ‹åˆ°æ½œåœ¨çš„æ³¨å…¥æ”»å‡»')

        # æ£€æŸ¥Schemaç»“æ„
        if not self._validate_structure(schema_data):
            validation_result['valid'] = False
            validation_result['errors'].append('Schemaç»“æ„æ— æ•ˆ')

        # æ£€æŸ¥æ•æ„Ÿå­—æ®µ
        sensitive_found = self._detect_sensitive_fields(schema_data)
        if sensitive_found:
            validation_result['warnings'].append(
                f'å‘ç°æ•æ„Ÿå­—æ®µ: {sensitive_found}'
            )

        return validation_result

    def mask_sensitive_data(self, schema_data: Dict) -> Dict:
        """æ•°æ®è„±æ•ï¼ˆåŸºäº2.3èŠ‚ï¼‰"""
        return self._recursive_mask(schema_data)

    def encrypt_data(self, data: str) -> str:
        """æ•°æ®åŠ å¯†ï¼ˆåŸºäº2.1èŠ‚ï¼‰"""
        # ä½¿ç”¨HMAC-SHA256åŠ å¯†
        return hmac.new(
            self.secret_key.encode(),
            data.encode(),
            hashlib.sha256
        ).hexdigest()

    def secure_transform(self, context: SecurityContext,
                         source_schema: Dict,
                         transformation_type: str) -> Dict:
        """å®‰å…¨è½¬æ¢ï¼ˆç»¼åˆåº”ç”¨ï¼‰"""
        result = {
            'success': False,
            'data': None,
            'audit_id': None,
            'errors': []
        }

        # 1. æˆæƒæ£€æŸ¥
        if not self.authorize(context, 'transform'):
            result['errors'].append('æœªæˆæƒæ‰§è¡Œè½¬æ¢æ“ä½œ')
            return result

        # 2. é€Ÿç‡é™åˆ¶æ£€æŸ¥
        if not self.check_rate_limit(context):
            result['errors'].append('è¶…å‡ºé€Ÿç‡é™åˆ¶')
            return result

        # 3. è¾“å…¥éªŒè¯
        validation = self.validate_schema_input(source_schema)
        if not validation['valid']:
            result['errors'].extend(validation['errors'])
            return result

        # 4. æ•°æ®è„±æ•ï¼ˆæ—¥å¿—ç”¨ï¼‰
        masked_schema = self.mask_sensitive_data(source_schema)

        # 5. æ‰§è¡Œè½¬æ¢
        try:
            transformed_schema = self._execute_transformation(
                source_schema, transformation_type
            )
            result['success'] = True
            result['data'] = transformed_schema
        except Exception as e:
            result['errors'].append(f'è½¬æ¢å¤±è´¥: {str(e)}')

        # 6. å®¡è®¡æ—¥å¿—
        audit_id = self._create_audit_log(context, {
            'action': 'secure_transform',
            'transformation_type': transformation_type,
            'source_schema': masked_schema,
            'success': result['success']
        })
        result['audit_id'] = audit_id

        return result

    def _verify_token(self, token: str) -> Dict:
        """éªŒè¯ä»¤ç‰Œ"""
        # ç®€åŒ–å®ç°ï¼šå®é™…åº”ä½¿ç”¨JWTåº“
        return {
            'user_id': 'user123',
            'roles': ['developer'],
            'session_id': 'session456',
            'ip_address': '127.0.0.1'
        }

    def _get_permissions(self, roles: List[str]) -> List[str]:
        """è·å–è§’è‰²æƒé™"""
        permissions = set()
        for role in roles:
            permissions.update(self.role_permissions.get(role, []))
        return list(permissions)

    def _detect_injection(self, data: Any) -> bool:
        """æ£€æµ‹æ³¨å…¥æ”»å‡»"""
        dangerous_patterns = ['<script>', 'DROP TABLE', 'UNION SELECT', '{{', '}}']
        data_str = json.dumps(data)
        return any(pattern in data_str for pattern in dangerous_patterns)

    def _validate_structure(self, schema_data: Dict) -> bool:
        """éªŒè¯Schemaç»“æ„"""
        return isinstance(schema_data, dict)

    def _detect_sensitive_fields(self, data: Any, path: str = '') -> List[str]:
        """æ£€æµ‹æ•æ„Ÿå­—æ®µ"""
        found = []
        if isinstance(data, dict):
            for key, value in data.items():
                current_path = f"{path}.{key}" if path else key
                if key.lower() in self.sensitive_fields:
                    found.append(current_path)
                found.extend(self._detect_sensitive_fields(value, current_path))
        elif isinstance(data, list):
            for i, item in enumerate(data):
                found.extend(self._detect_sensitive_fields(item, f"{path}[{i}]"))
        return found

    def _recursive_mask(self, data: Any) -> Any:
        """é€’å½’è„±æ•"""
        if isinstance(data, dict):
            return {
                key: '***MASKED***' if key.lower() in self.sensitive_fields
                else self._recursive_mask(value)
                for key, value in data.items()
            }
        elif isinstance(data, list):
            return [self._recursive_mask(item) for item in data]
        return data

    def _execute_transformation(self, schema: Dict, transformation_type: str) -> Dict:
        """æ‰§è¡Œè½¬æ¢"""
        return {'transformed': True, 'type': transformation_type, 'data': schema}

    def _log_security_event(self, event_type: str, details: Dict):
        """è®°å½•å®‰å…¨äº‹ä»¶ï¼ˆåŸºäº4.1èŠ‚ï¼‰"""
        self.audit_logs.append({
            'timestamp': time.time(),
            'event_type': event_type,
            'details': details
        })

    def _create_audit_log(self, context: SecurityContext, details: Dict) -> str:
        """åˆ›å»ºå®¡è®¡æ—¥å¿—"""
        audit_id = hashlib.sha256(
            f"{context.user_id}{time.time()}".encode()
        ).hexdigest()[:16]

        self.audit_logs.append({
            'audit_id': audit_id,
            'timestamp': time.time(),
            'user_id': context.user_id,
            'session_id': context.session_id,
            'ip_address': context.ip_address,
            'details': details
        })

        return audit_id

# å®é™…åº”ç”¨ç¤ºä¾‹
security_framework = SchemaTransformationSecurityFramework(secret_key='my_secret_key')

# ç¤ºä¾‹1ï¼šèº«ä»½è®¤è¯
print("=== ç¤ºä¾‹1ï¼šèº«ä»½è®¤è¯ ===")
context = security_framework.authenticate('valid_token')
if context:
    print(f"è®¤è¯æˆåŠŸ: ç”¨æˆ·={context.user_id}, è§’è‰²={context.roles}")

# ç¤ºä¾‹2ï¼šæˆæƒæ£€æŸ¥
print("\n=== ç¤ºä¾‹2ï¼šæˆæƒæ£€æŸ¥ ===")
can_transform = security_framework.authorize(context, 'transform')
print(f"è½¬æ¢æƒé™: {can_transform}")

# ç¤ºä¾‹3ï¼šè¾“å…¥éªŒè¯
print("\n=== ç¤ºä¾‹3ï¼šè¾“å…¥éªŒè¯ ===")
test_schema = {
    'openapi': '3.1.0',
    'info': {'title': 'Test API'},
    'paths': {},
    'password': 'secret123'  # æ•æ„Ÿå­—æ®µ
}
validation = security_framework.validate_schema_input(test_schema)
print(f"éªŒè¯ç»“æœ: {validation['valid']}")
print(f"è­¦å‘Š: {validation['warnings']}")

# ç¤ºä¾‹4ï¼šæ•°æ®è„±æ•
print("\n=== ç¤ºä¾‹4ï¼šæ•°æ®è„±æ• ===")
masked = security_framework.mask_sensitive_data(test_schema)
print(f"è„±æ•å: password={masked['password']}")

# ç¤ºä¾‹5ï¼šå®‰å…¨è½¬æ¢
print("\n=== ç¤ºä¾‹5ï¼šå®‰å…¨è½¬æ¢ ===")
transform_result = security_framework.secure_transform(
    context, test_schema, 'openapi_to_asyncapi'
)
print(f"è½¬æ¢æˆåŠŸ: {transform_result['success']}")
print(f"å®¡è®¡ID: {transform_result['audit_id']}")
```

---

## 9. ç›¸å…³æ–‡æ¡£

### æ¨¡å¼æ–‡æ¡£ â­æ–°å¢

- `docs/structure/DESIGN_PATTERNS_SUMMARY.md`ï¼šè®¾è®¡æ¨¡å¼æ€»ç»“ï¼ˆ15ä¸ªæ¨¡å¼ï¼‰
  - åœ¨å®‰å…¨ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œå¯ä»¥å‚è€ƒä»£ç†æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ç­‰
- `docs/structure/ARCHITECTURE_PATTERNS_SUMMARY.md`ï¼šæ¶æ„æ¨¡å¼æ€»ç»“ï¼ˆ12ä¸ªæ¨¡å¼ï¼‰
  - åœ¨å®‰å…¨æ¶æ„è®¾è®¡ä¸­ï¼Œå¯ä»¥å‚è€ƒAPIç½‘å…³æ¨¡å¼ã€å¾®æœåŠ¡æ¶æ„ç­‰
- `docs/structure/PATTERNS_QUICK_REFERENCE.md`ï¼šæ¨¡å¼å¿«é€Ÿå‚è€ƒæŒ‡å— â­æ¨è

### å…¶ä»–å®è·µæ–‡æ¡£

- `practices/09_Performance_Optimization.md`ï¼šæ€§èƒ½ä¼˜åŒ–æŒ‡å—
- `practices/11_Testing_Validation.md`ï¼šæµ‹è¯•éªŒè¯æŒ‡å—
- `practices/12_Real_World_Case_Studies.md`ï¼šå®é™…åº”ç”¨æ¡ˆä¾‹ç ”ç©¶

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.2 (2025-01-21) - å®é™…åº”ç”¨ç¤ºä¾‹å¢å¼ºç‰ˆ

- âœ… æ‰©å±•ç¬¬8ç« ï¼šä¸ºå®‰å…¨å®è·µæ·»åŠ ç»¼åˆåº”ç”¨å®é™…ç¤ºä¾‹ï¼ˆåŒ…å«Schemaè½¬æ¢å®‰å…¨æ¡†æ¶å®ç°ã€èº«ä»½è®¤è¯ã€æˆæƒæ§åˆ¶ã€é€Ÿç‡é™åˆ¶ã€è¾“å…¥éªŒè¯ã€æ•°æ®è„±æ•ã€å®‰å…¨è½¬æ¢ã€å®¡è®¡æ—¥å¿—ï¼‰
- âœ… æ·»åŠ ç‰ˆæœ¬å†å²ç« èŠ‚
- âœ… æ›´æ–°æ–‡æ¡£ç‰ˆæœ¬å·è‡³v1.2

### v1.1 (2025-01-27) - åˆå§‹ç‰ˆæœ¬

- âœ… åˆ›å»ºæ–‡æ¡£ï¼šå®‰å…¨è€ƒè™‘ä¸å®è·µ
- âœ… æ·»åŠ æ•°æ®å®‰å…¨ç« èŠ‚
- âœ… æ·»åŠ è®¿é—®æ§åˆ¶ç« èŠ‚
- âœ… æ·»åŠ å®‰å…¨å®¡è®¡ç« èŠ‚
- âœ… æ·»åŠ å®‰å…¨æœ€ä½³å®è·µç« èŠ‚
- âœ… æ·»åŠ åˆè§„æ€§ç« èŠ‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.2ï¼ˆå®é™…åº”ç”¨ç¤ºä¾‹å¢å¼ºç‰ˆï¼‰
**æœ€åæ›´æ–°**ï¼š2025-01-27
**ç»´æŠ¤è€…**ï¼šDSL Schemaç ”ç©¶å›¢é˜Ÿ
