# VS Codeæ’ä»¶å®æ–½æŒ‡å—

## ğŸ“‘ ç›®å½•

- [VS Codeæ’ä»¶å®æ–½æŒ‡å—](#vs-codeæ’ä»¶å®æ–½æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. å®æ–½æ¦‚è¿°](#1-å®æ–½æ¦‚è¿°)
    - [1.1 å®æ–½ç›®æ ‡](#11-å®æ–½ç›®æ ‡)
    - [1.2 å®æ–½æ­¥éª¤](#12-å®æ–½æ­¥éª¤)
  - [2. é¡¹ç›®åˆå§‹åŒ–](#2-é¡¹ç›®åˆå§‹åŒ–)
    - [2.1 é¡¹ç›®ç»“æ„](#21-é¡¹ç›®ç»“æ„)
    - [2.2 ä¾èµ–å®‰è£…](#22-ä¾èµ–å®‰è£…)
    - [2.3 é…ç½®è®¾ç½®](#23-é…ç½®è®¾ç½®)
  - [3. æ ¸å¿ƒåŠŸèƒ½å®ç°](#3-æ ¸å¿ƒåŠŸèƒ½å®ç°)
    - [3.1 Schemaç¼–è¾‘å™¨å®ç°](#31-schemaç¼–è¾‘å™¨å®ç°)
    - [3.2 è½¬æ¢åŠŸèƒ½å®ç°](#32-è½¬æ¢åŠŸèƒ½å®ç°)
    - [3.3 éªŒè¯åŠŸèƒ½å®ç°](#33-éªŒè¯åŠŸèƒ½å®ç°)
  - [4. ç”¨æˆ·ç•Œé¢å®ç°](#4-ç”¨æˆ·ç•Œé¢å®ç°)
    - [4.1 å‘½ä»¤é¢æ¿å®ç°](#41-å‘½ä»¤é¢æ¿å®ç°)
    - [4.2 çŠ¶æ€æ å®ç°](#42-çŠ¶æ€æ å®ç°)
    - [4.3 ä¾§è¾¹æ å®ç°](#43-ä¾§è¾¹æ å®ç°)
  - [5. æµ‹è¯•å®ç°](#5-æµ‹è¯•å®ç°)
    - [5.1 å•å…ƒæµ‹è¯•](#51-å•å…ƒæµ‹è¯•)
    - [5.2 é›†æˆæµ‹è¯•](#52-é›†æˆæµ‹è¯•)
    - [5.3 ç«¯åˆ°ç«¯æµ‹è¯•](#53-ç«¯åˆ°ç«¯æµ‹è¯•)
  - [6. æ‰“åŒ…ä¸å‘å¸ƒ](#6-æ‰“åŒ…ä¸å‘å¸ƒ)
    - [6.1 æ‰“åŒ…é…ç½®](#61-æ‰“åŒ…é…ç½®)
    - [6.2 å‘å¸ƒå‡†å¤‡](#62-å‘å¸ƒå‡†å¤‡)
    - [6.3 å‘å¸ƒæµç¨‹](#63-å‘å¸ƒæµç¨‹)
  - [7. ç»´æŠ¤ä¸æ›´æ–°](#7-ç»´æŠ¤ä¸æ›´æ–°)
    - [7.1 ç‰ˆæœ¬ç®¡ç†](#71-ç‰ˆæœ¬ç®¡ç†)
    - [7.2 æ›´æ–°ç­–ç•¥](#72-æ›´æ–°ç­–ç•¥)
    - [7.3 ç”¨æˆ·åé¦ˆ](#73-ç”¨æˆ·åé¦ˆ)

---

## 1. å®æ–½æ¦‚è¿°

### 1.1 å®æ–½ç›®æ ‡

**å®æ–½ç›®æ ‡**ï¼š

1. **åŠŸèƒ½å®Œæ•´**ï¼šå®ç°æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå“åº”é€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨ä½
3. **ç”¨æˆ·ä½“éªŒ**ï¼šç•Œé¢å‹å¥½ï¼Œæ“ä½œç›´è§‚
4. **ç¨³å®šæ€§**ï¼šç¨³å®šå¯é ï¼Œé”™è¯¯å¤„ç†å®Œå–„

### 1.2 å®æ–½æ­¥éª¤

**å®æ–½é˜¶æ®µ**ï¼š

1. **é˜¶æ®µ1**ï¼šé¡¹ç›®åˆå§‹åŒ–ï¼ˆWeek 1ï¼‰
2. **é˜¶æ®µ2**ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆWeek 1-2ï¼‰
3. **é˜¶æ®µ3**ï¼šç”¨æˆ·ç•Œé¢å®ç°ï¼ˆWeek 2ï¼‰
4. **é˜¶æ®µ4**ï¼šæµ‹è¯•å®ç°ï¼ˆWeek 2-3ï¼‰
5. **é˜¶æ®µ5**ï¼šæ‰“åŒ…å‘å¸ƒï¼ˆWeek 3ï¼‰
6. **é˜¶æ®µ6**ï¼šç»´æŠ¤æ›´æ–°ï¼ˆæŒç»­ï¼‰

---

## 2. é¡¹ç›®åˆå§‹åŒ–

### 2.1 é¡¹ç›®ç»“æ„

**ç›®å½•ç»“æ„**ï¼š

```text
tools/vscode-extension/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts          # æ’ä»¶å…¥å£
â”‚   â”œâ”€â”€ completion.ts         # è‡ªåŠ¨è¡¥å…¨
â”‚   â”œâ”€â”€ diagnostics.ts        # é”™è¯¯æ£€æŸ¥
â”‚   â”œâ”€â”€ commands/             # å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ transformers/         # è½¬æ¢å™¨
â”‚   â”œâ”€â”€ validators/           # éªŒè¯å™¨
â”‚   â””â”€â”€ ui/                   # UIç»„ä»¶
â”œâ”€â”€ syntaxes/
â”‚   â””â”€â”€ dsl.tmLanguage.json   # è¯­æ³•å®šä¹‰
â”œâ”€â”€ themes/
â”‚   â””â”€â”€ dsl-schema-color-theme.json
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ suite/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### 2.2 ä¾èµ–å®‰è£…

**package.json**ï¼š

```json
{
  "name": "dsl-schema-transformer",
  "displayName": "DSL Schema Transformer",
  "version": "1.0.0",
  "engines": {
    "vscode": "^1.80.0"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0"
  },
  "devDependencies": {
    "@types/vscode": "^1.80.0",
    "@types/node": "^18.0.0",
    "typescript": "^5.0.0",
    "@vscode/test-electron": "^2.0.0"
  }
}
```

### 2.3 é…ç½®è®¾ç½®

**tsconfig.json**ï¼š

```json
{
  "compilerOptions": {
    "module": "commonjs",
    "target": "ES2020",
    "outDir": "out",
    "lib": ["ES2020"],
    "sourceMap": true,
    "rootDir": "src",
    "strict": true
  },
  "exclude": ["node_modules", ".vscode-test"]
}
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 3.1 Schemaç¼–è¾‘å™¨å®ç°

**ç¼–è¾‘å™¨æ¿€æ´»**ï¼š

```typescript
// src/extension.ts
import * as vscode from 'vscode';
import { provideCompletionItems } from './completion';
import { validateDocument } from './diagnostics';

export function activate(context: vscode.ExtensionContext) {
  // æ³¨å†Œè‡ªåŠ¨è¡¥å…¨
  context.subscriptions.push(
    vscode.languages.registerCompletionItemProvider(
      'dsl-schema',
      { provideCompletionItems },
      '.'
    )
  );

  // æ³¨å†Œé”™è¯¯æ£€æŸ¥
  const diagnosticCollection = vscode.languages.createDiagnosticCollection('dsl-schema');
  context.subscriptions.push(diagnosticCollection);

  vscode.workspace.onDidChangeTextDocument(e => {
    if (e.document.languageId === 'dsl-schema') {
      const diagnostics = validateDocument(e.document);
      diagnosticCollection.set(e.document.uri, diagnostics);
    }
  });
}
```

### 3.2 è½¬æ¢åŠŸèƒ½å®ç°

**è½¬æ¢å‘½ä»¤æ³¨å†Œ**ï¼š

```typescript
// src/commands/transform.ts
import * as vscode from 'vscode';
import { TransformerRegistry } from '../transformers/registry';

export function registerTransformCommand(
  context: vscode.ExtensionContext
): void {
  const command = vscode.commands.registerCommand(
    'dsl-schema.transform',
    async () => {
      const editor = vscode.window.activeTextEditor;
      if (!editor) {
        vscode.window.showErrorMessage('No active editor');
        return;
      }

      const formats = ['openapi', 'json-schema', 'asyncapi'];
      const selected = await vscode.window.showQuickPick(formats, {
        placeHolder: 'Select target format'
      });

      if (!selected) return;

      try {
        const schema = parseSchema(editor.document.getText());
        const transformer = TransformerRegistry.get(selected);
        const result = await transformer.transform(schema);

        const doc = await vscode.workspace.openTextDocument({
          content: JSON.stringify(result, null, 2),
          language: 'json'
        });

        await vscode.window.showTextDocument(doc);
      } catch (error) {
        vscode.window.showErrorMessage(`Transformation failed: ${error.message}`);
      }
    }
  );

  context.subscriptions.push(command);
}
```

### 3.3 éªŒè¯åŠŸèƒ½å®ç°

**éªŒè¯å®ç°**ï¼š

```typescript
// src/validators/schema-validator.ts
export class SchemaValidator {
  validate(schema: Schema): ValidationResult {
    const errors: ValidationError[] = [];

    // éªŒè¯Schemaç»“æ„
    if (!schema.name) {
      errors.push({
        message: 'Schema name is required',
        severity: 'error'
      });
    }

    // éªŒè¯ç±»å‹å®šä¹‰
    schema.types?.forEach(type => {
      const typeErrors = this.validateType(type);
      errors.push(...typeErrors);
    });

    return {
      valid: errors.length === 0,
      errors
    };
  }
}
```

---

## 4. ç”¨æˆ·ç•Œé¢å®ç°

### 4.1 å‘½ä»¤é¢æ¿å®ç°

**å‘½ä»¤æ³¨å†Œ**ï¼š

```json
// package.json
{
  "contributes": {
    "commands": [
      {
        "command": "dsl-schema.transform",
        "title": "Transform Schema",
        "category": "DSL Schema"
      },
      {
        "command": "dsl-schema.validate",
        "title": "Validate Schema",
        "category": "DSL Schema"
      },
      {
        "command": "dsl-schema.preview",
        "title": "Preview Transformation",
        "category": "DSL Schema"
      }
    ],
    "menus": {
      "commandPalette": [
        {
          "command": "dsl-schema.transform",
          "when": "editorLangId == dsl-schema"
        }
      ]
    }
  }
}
```

### 4.2 çŠ¶æ€æ å®ç°

**çŠ¶æ€æ ä»£ç **ï¼š

```typescript
// src/ui/statusbar.ts
export class StatusBar {
  private statusBarItem: vscode.StatusBarItem;

  constructor() {
    this.statusBarItem = vscode.window.createStatusBarItem(
      vscode.StatusBarAlignment.Right,
      100
    );
    this.statusBarItem.command = 'dsl-schema.showStatus';
  }

  update(schema: Schema): void {
    const status = this.getStatus(schema);
    this.statusBarItem.text = `$(check) ${status}`;
    this.statusBarItem.show();
  }
}
```

### 4.3 ä¾§è¾¹æ å®ç°

**ä¾§è¾¹æ ä»£ç **ï¼š

```typescript
// src/ui/sidebar.ts
export class SchemaExplorerProvider
  implements vscode.TreeDataProvider<SchemaNode> {

  private _onDidChangeTreeData = new vscode.EventEmitter<SchemaNode | undefined>();
  readonly onDidChangeTreeData = this._onDidChangeTreeData.event;

  refresh(): void {
    this._onDidChangeTreeData.fire(undefined);
  }

  getTreeItem(element: SchemaNode): vscode.TreeItem {
    return element;
  }

  getChildren(element?: SchemaNode): Thenable<SchemaNode[]> {
    // å®ç°æ ‘èŠ‚ç‚¹è·å–é€»è¾‘
    return Promise.resolve([]);
  }
}
```

---

## 5. æµ‹è¯•å®ç°

### 5.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•ç¤ºä¾‹**ï¼š

```typescript
// src/test/completion.test.ts
import * as assert from 'assert';
import * as vscode from 'vscode';
import { provideCompletionItems } from '../completion';

suite('Completion Provider Tests', () => {
  test('should provide schema keyword', () => {
    const document = createMockDocument('sc');
    const position = new vscode.Position(0, 2);

    const completions = provideCompletionItems(document, position);

    assert.ok(completions.some(c => c.label === 'schema'));
  });
});
```

### 5.2 é›†æˆæµ‹è¯•

**é›†æˆæµ‹è¯•**ï¼š

```typescript
// src/test/integration.test.ts
import * as assert from 'assert';
import * as vscode from 'vscode';

suite('Extension Integration Tests', () => {
  test('should activate extension', async () => {
    const extension = vscode.extensions.getExtension('your-extension-id');
    assert.ok(extension);
    await extension.activate();
    assert.ok(extension.isActive);
  });
});
```

### 5.3 ç«¯åˆ°ç«¯æµ‹è¯•

**E2Eæµ‹è¯•**ï¼š

```typescript
// src/test/e2e.test.ts
import * as assert from 'assert';
import * as vscode from 'vscode';

suite('E2E Tests', () => {
  test('should transform schema end-to-end', async () => {
    // æ‰“å¼€Schemaæ–‡ä»¶
    const doc = await vscode.workspace.openTextDocument('test.dsl');
    await vscode.window.showTextDocument(doc);

    // æ‰§è¡Œè½¬æ¢å‘½ä»¤
    await vscode.commands.executeCommand('dsl-schema.transform');

    // éªŒè¯ç»“æœ
    // ...
  });
});
```

---

## 6. æ‰“åŒ…ä¸å‘å¸ƒ

### 6.1 æ‰“åŒ…é…ç½®

**æ‰“åŒ…è„šæœ¬**ï¼š

```json
// package.json
{
  "scripts": {
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "package": "vsce package",
    "publish": "vsce publish"
  }
}
```

### 6.2 å‘å¸ƒå‡†å¤‡

**å‘å¸ƒæ£€æŸ¥æ¸…å•**ï¼š

- [ ] ä»£ç ç¼–è¯‘é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] ç‰ˆæœ¬å·æ›´æ–°
- [ ] CHANGELOGæ›´æ–°

### 6.3 å‘å¸ƒæµç¨‹

**å‘å¸ƒæ­¥éª¤**ï¼š

1. **æ„å»º**ï¼š`npm run compile`
2. **æµ‹è¯•**ï¼šè¿è¡Œæ‰€æœ‰æµ‹è¯•
3. **æ‰“åŒ…**ï¼š`npm run package`
4. **éªŒè¯**ï¼šæœ¬åœ°å®‰è£…æµ‹è¯•
5. **å‘å¸ƒ**ï¼š`npm run publish`

---

## 7. ç»´æŠ¤ä¸æ›´æ–°

### 7.1 ç‰ˆæœ¬ç®¡ç†

**ç‰ˆæœ¬ç­–ç•¥**ï¼š

- **ä¸»ç‰ˆæœ¬å·**ï¼šä¸å…¼å®¹çš„APIä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·**ï¼šå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **ä¿®è®¢å·**ï¼šå‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

### 7.2 æ›´æ–°ç­–ç•¥

**æ›´æ–°æœºåˆ¶**ï¼š

- è‡ªåŠ¨æ›´æ–°æ£€æŸ¥
- ç”¨æˆ·é€šçŸ¥
- æ›´æ–°æ—¥å¿—

### 7.3 ç”¨æˆ·åé¦ˆ

**åé¦ˆæ¸ é“**ï¼š

- GitHub Issues
- ç”¨æˆ·è¯„ä»·
- åŠŸèƒ½è¯·æ±‚

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `analysis/13_VSCode_Extension_Architecture.md` - æ’ä»¶æ¶æ„è®¾è®¡
- `tools/vscode-extension/` - æ’ä»¶ä»£ç å®ç°

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
