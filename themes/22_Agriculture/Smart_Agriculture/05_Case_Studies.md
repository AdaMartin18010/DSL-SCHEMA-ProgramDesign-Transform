# æ™ºæ…§å†œä¸šSchemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
- [2. ä¼ä¸šèƒŒæ™¯](#2-ä¼ä¸šèƒŒæ™¯)
- [3. ä¸šåŠ¡ç—›ç‚¹ä¸ç›®æ ‡](#3-ä¸šåŠ¡ç—›ç‚¹ä¸ç›®æ ‡)
- [4. æŠ€æœ¯æŒ‘æˆ˜](#4-æŠ€æœ¯æŒ‘æˆ˜)
- [5. è§£å†³æ–¹æ¡ˆæ¶æ„](#5-è§£å†³æ–¹æ¡ˆæ¶æ„)
- [6. å®Œæ•´å®ç°ä»£ç ](#6-å®Œæ•´å®ç°ä»£ç )
- [7. æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ](#7-æ•ˆæœè¯„ä¼°ä¸roiåˆ†æ)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æ™ºæ…§å†œä¸šSchemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®Œæ•´å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–å†œç”°ç®¡ç†ã€ä½œç‰©ç›‘æµ‹ã€ç²¾å‡†çŒæº‰ã€äº§é‡é¢„æµ‹ç­‰æ ¸å¿ƒå†œä¸šåœºæ™¯ã€‚é€šè¿‡Schemaé©±åŠ¨çš„æ–¹æ³•ï¼Œå®ç°å†œä¸šæ•°æ®çš„ç»“æ„åŒ–ç®¡ç†å’Œæ™ºèƒ½å†³ç­–æ”¯æŒã€‚

---

## 2. ä¼ä¸šèƒŒæ™¯

### 2.1 ä¼ä¸šæ¦‚å†µ

**ä¼ä¸šåç§°**ï¼šç»¿æºæ™ºæ…§å†œä¸šç§‘æŠ€æœ‰é™å…¬å¸ï¼ˆè™šæ„æ¡ˆä¾‹ä¼ä¸šï¼‰

**ä¼ä¸šè§„æ¨¡**ï¼š
- æœåŠ¡å†œåœºï¼š200+å®¶
- ç®¡ç†å†œç”°é¢ç§¯ï¼š50ä¸‡äº©
- è¦†ç›–ä½œç‰©ç§ç±»ï¼š30+ç§
- å¹´è¥ä¸šé¢ï¼š2.8äº¿å…ƒäººæ°‘å¸

**æ ¸å¿ƒä¸šåŠ¡**ï¼š
- ç²¾å‡†å†œä¸šè§£å†³æ–¹æ¡ˆ
- å†œä¸šç‰©è”ç½‘æœåŠ¡
- å†œäº§å“æº¯æºç³»ç»Ÿ
- å†œä¸šå¤§æ•°æ®åˆ†æ

---

## 3. ä¸šåŠ¡ç—›ç‚¹ä¸ç›®æ ‡

### 3.1 äº”å¤§ä¸šåŠ¡ç—›ç‚¹

| åºå· | ç—›ç‚¹ | å…·ä½“è¡¨ç° | å½±å“ç¨‹åº¦ |
|------|------|----------|----------|
| 1 | **èµ„æºæµªè´¹ä¸¥é‡** | æ°´è‚¥è¯ä½¿ç”¨è¿‡é‡ï¼Œæˆæœ¬å±…é«˜ä¸ä¸‹ | é«˜ |
| 2 | **ç—…è™«å®³é˜²æ²»æ»å** | å‘ç°æ—¶å·²ç»å¤§é¢ç§¯ä¼ æ’­ | é«˜ |
| 3 | **äº§é‡ä¸ç¨³å®š** | é å¤©åƒé¥­ï¼Œç¼ºä¹ç§‘å­¦é¢„æµ‹ | é«˜ |
| 4 | **åŠ³åŠ¨åŠ›çŸ­ç¼º** | å†œä¸šäººå£è€é¾„åŒ–ï¼Œæ‹›å·¥å›°éš¾ | ä¸­ |
| 5 | **å“è´¨éš¾ä¿è¯** | ç¼ºä¹æ ‡å‡†åŒ–ç§æ¤ç®¡ç† | ä¸­ |

### 3.2 äº”å¤§ä¸šåŠ¡ç›®æ ‡

| åºå· | ç›®æ ‡ | å…·ä½“æŒ‡æ ‡ | å®ŒæˆæœŸé™ |
|------|------|----------|----------|
| 1 | **èŠ‚æ°´èŠ‚è‚¥** | æ°´è‚¥ä½¿ç”¨é‡å‡å°‘30% | 12ä¸ªæœˆ |
| 2 | **ç—…è™«å®³é¢„è­¦** | æå‰7å¤©é¢„è­¦ï¼Œå‡†ç¡®ç‡>90% | 12ä¸ªæœˆ |
| 3 | **äº§é‡æå‡** | å•ä½äº§é‡æå‡15% | 24ä¸ªæœˆ |
| 4 | **è‡ªåŠ¨åŒ–ç®¡ç†** | 80%å†œäº‹æ´»åŠ¨è‡ªåŠ¨åŒ– | 18ä¸ªæœˆ |
| 5 | **å“è´¨æ ‡å‡†åŒ–** | å†œäº§å“åˆæ ¼ç‡>98% | 12ä¸ªæœˆ |

---

## 4. æŠ€æœ¯æŒ‘æˆ˜

### 4.1 äº”å¤§æŠ€æœ¯æŒ‘æˆ˜

1. **å¤šæºæ•°æ®é‡‡é›†**ï¼šåœŸå£¤ã€æ°”è±¡ã€ä½œç‰©ã€è®¾å¤‡ç­‰å¤šç±»å‹ä¼ æ„Ÿå™¨æ•°æ®
2. **è¾¹ç¼˜è®¡ç®—èƒ½åŠ›**ï¼šç”°é—´ç½‘ç»œä¸ç¨³å®šï¼Œéœ€è¦æœ¬åœ°æ•°æ®å¤„ç†èƒ½åŠ›
3. **å†œä¸šæ¨¡å‹å¼€å‘**ï¼šä½œç‰©ç”Ÿé•¿æ¨¡å‹ã€ç—…è™«å®³é¢„æµ‹æ¨¡å‹
4. **è®¾å¤‡äº’è”äº’é€š**ï¼šä¸åŒå‚å•†è®¾å¤‡åè®®ä¸ç»Ÿä¸€
5. **å†œæ°‘ä½¿ç”¨é—¨æ§›**ï¼šç³»ç»Ÿç•Œé¢éœ€è¦ç®€å•æ˜“ç”¨

---

## 5. è§£å†³æ–¹æ¡ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚                                    â”‚
â”‚  å†œåœºç®¡ç†  ç›‘æµ‹é¢„è­¦  å†³ç­–æ”¯æŒ  æº¯æºæŸ¥è¯¢                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æœåŠ¡å±‚                                    â”‚
â”‚  æ•°æ®åˆ†æ  é¢„æµ‹æ¨¡å‹  è‡ªåŠ¨æ§åˆ¶  ä¸“å®¶ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    è¾¹ç¼˜å±‚                                    â”‚
â”‚  è¾¹ç¼˜ç½‘å…³  æœ¬åœ°è®¡ç®—  è®¾å¤‡æ§åˆ¶  ç¦»çº¿ç¼“å­˜                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ„ŸçŸ¥å±‚                                    â”‚
â”‚  åœŸå£¤ä¼ æ„Ÿå™¨  æ°”è±¡ç«™  æ‘„åƒå¤´  æ— äººæœº  çŒæº‰è®¾å¤‡               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å®Œæ•´å®ç°ä»£ç 

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ™ºæ…§å†œä¸šSchemaå®è·µæ¡ˆä¾‹
ä¼ä¸šï¼šç»¿æºæ™ºæ…§å†œä¸šç§‘æŠ€æœ‰é™å…¬å¸
"""

import json
import uuid
from datetime import datetime, date, timedelta
from typing import Dict, List, Optional, Any, Tuple
from dataclasses import dataclass, field
from enum import Enum
import math
import random
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


class CropType(Enum):
    """ä½œç‰©ç±»å‹"""
    RICE = "æ°´ç¨»"
    WHEAT = "å°éº¦"
    CORN = "ç‰ç±³"
    SOYBEAN = "å¤§è±†"
    COTTON = "æ£‰èŠ±"
    VEGETABLE_TOMATO = "ç•ªèŒ„"
    VEGETABLE_CUCUMBER = "é»„ç“œ"
    FRUIT_APPLE = "è‹¹æœ"
    FRUIT_GRAPE = "è‘¡è„"


class GrowthStage(Enum):
    """ç”Ÿé•¿é˜¶æ®µ"""
    SEEDLING = "å¹¼è‹—æœŸ"
    VEGETATIVE = "è¥å…»ç”Ÿé•¿æœŸ"
    FLOWERING = "å¼€èŠ±æœŸ"
    FRUITING = "ç»“æœæœŸ"
    MATURITY = "æˆç†ŸæœŸ"
    HARVEST = "æ”¶è·æœŸ"


class IrrigationType(Enum):
    """çŒæº‰ç±»å‹"""
    DRIP = "æ»´çŒ"
    SPRINKLER = "å–·çŒ"
    FLOOD = "æ¼«çŒ"
    MICRO_SPRAY = "å¾®å–·"


class PestSeverity(Enum):
    """ç—…è™«å®³ä¸¥é‡ç¨‹åº¦"""
    NONE = "æ— "
    LOW = "è½»åº¦"
    MEDIUM = "ä¸­åº¦"
    HIGH = "é‡åº¦"
    SEVERE = "ä¸¥é‡"


@dataclass
class GeoLocation:
    """åœ°ç†ä½ç½®"""
    latitude: float = 0.0
    longitude: float = 0.0
    altitude: float = 0.0
    
    def to_dict(self) -> Dict:
        return {
            "latitude": self.latitude,
            "longitude": self.longitude,
            "altitude": self.altitude
        }


@dataclass
class SoilData:
    """åœŸå£¤æ•°æ®"""
    timestamp: datetime
    moisture: float  # åœŸå£¤æ¹¿åº¦ %
    temperature: float  # åœŸå£¤æ¸©åº¦ Â°C
    ph: float  # pHå€¼
    ec: float  # ç”µå¯¼ç‡ dS/m
    n_content: float  # æ°®å«é‡ mg/kg
    p_content: float  # ç£·å«é‡ mg/kg
    k_content: float  # é’¾å«é‡ mg/kg
    depth: float = 20.0  # æµ‹é‡æ·±åº¦ cm
    
    def get_fertility_level(self) -> str:
        """è¯„ä¼°è‚¥åŠ›ç­‰çº§"""
        score = 0
        if 6.0 <= self.ph <= 7.5: score += 25
        if self.n_content > 100: score += 25
        if self.p_content > 20: score += 25
        if self.k_content > 150: score += 25
        
        if score >= 80: return "é«˜"
        elif score >= 60: return "ä¸­"
        else: return "ä½"
    
    def to_dict(self) -> Dict:
        return {
            "timestamp": self.timestamp.isoformat(),
            "moisture": round(self.moisture, 2),
            "temperature": round(self.temperature, 2),
            "ph": round(self.ph, 2),
            "ec": round(self.ec, 2),
            "n_content": round(self.n_content, 2),
            "p_content": round(self.p_content, 2),
            "k_content": round(self.k_content, 2),
            "depth": self.depth,
            "fertility_level": self.get_fertility_level()
        }


@dataclass
class WeatherData:
    """æ°”è±¡æ•°æ®"""
    timestamp: datetime
    temperature: float  # Â°C
    humidity: float  # %
    pressure: float  # hPa
    wind_speed: float  # m/s
    wind_direction: str
    precipitation: float  # mm
    solar_radiation: float  # W/mÂ²
    uv_index: float
    
    def calculate_et0(self, latitude: float, day_of_year: int) -> float:
        """è®¡ç®—å‚è€ƒè’¸æ•£é‡ET0 (ç®€åŒ–ç‰ˆPenman-Monteith)"""
        # ç®€åŒ–çš„Hargreaveså…¬å¼
        Tmax = self.temperature + 5
        Tmin = self.temperature - 5
        Tmean = (Tmax + Tmin) / 2
        Ra = 0.408 * 0.0820 * (1 + 0.033 * math.cos(2 * math.pi * day_of_year / 365))  # ç®€åŒ–
        ET0 = 0.0023 * (Tmean + 17.8) * (Tmax - Tmin) ** 0.5 * Ra
        return max(0, ET0)
    
    def to_dict(self) -> Dict:
        return {
            "timestamp": self.timestamp.isoformat(),
            "temperature": self.temperature,
            "humidity": self.humidity,
            "pressure": self.pressure,
            "wind_speed": self.wind_speed,
            "wind_direction": self.wind_direction,
            "precipitation": self.precipitation,
            "solar_radiation": self.solar_radiation,
            "uv_index": self.uv_index
        }


@dataclass
class CropHealth:
    """ä½œç‰©å¥åº·çŠ¶å†µ"""
    timestamp: datetime
    ndvi: float  # å½’ä¸€åŒ–æ¤è¢«æŒ‡æ•° -1 to 1
    leaf_area_index: float  # å¶é¢ç§¯æŒ‡æ•°
    canopy_temperature: float  # å† å±‚æ¸©åº¦
    plant_height: float  # æ ªé«˜ cm
    pest_severity: PestSeverity = PestSeverity.NONE
    disease_detected: List[str] = field(default_factory=list)
    
    def get_health_status(self) -> str:
        """è¯„ä¼°å¥åº·çŠ¶æ€"""
        if self.ndvi > 0.7 and self.pest_severity == PestSeverity.NONE:
            return "å¥åº·"
        elif self.ndvi > 0.4 and self.pest_severity in [PestSeverity.NONE, PestSeverity.LOW]:
            return "è‰¯å¥½"
        else:
            return "éœ€å…³æ³¨"
    
    def to_dict(self) -> Dict:
        return {
            "timestamp": self.timestamp.isoformat(),
            "ndvi": round(self.ndvi, 3),
            "leaf_area_index": round(self.leaf_area_index, 2),
            "canopy_temperature": self.canopy_temperature,
            "plant_height": self.plant_height,
            "pest_severity": self.pest_severity.value,
            "disease_detected": self.disease_detected,
            "health_status": self.get_health_status()
        }


@dataclass
class Field:
    """å†œç”°"""
    field_id: str
    field_name: str
    location: GeoLocation
    area: float  # å…¬é¡·
    soil_type: str = ""
    elevation: float = 0.0
    slope: float = 0.0  # å¡åº¦ Â°
    irrigation_type: IrrigationType = IrrigationType.DRIP
    
    def to_dict(self) -> Dict:
        return {
            "field_id": self.field_id,
            "field_name": self.field_name,
            "location": self.location.to_dict(),
            "area": self.area,
            "soil_type": self.soil_type,
            "elevation": self.elevation,
            "slope": self.slope,
            "irrigation_type": self.irrigation_type.value
        }


@dataclass
class CropPlan:
    """ç§æ¤è®¡åˆ’"""
    plan_id: str
    field_id: str
    crop_type: CropType
    variety: str
    planting_date: date
    expected_harvest_date: date
    seed_quantity: float  # kg
    target_yield: float  # kg/ha
    growth_stages: List[Dict] = field(default_factory=list)
    
    def get_current_stage(self, current_date: date = None) -> Optional[Dict]:
        """è·å–å½“å‰ç”Ÿé•¿é˜¶æ®µ"""
        if not current_date:
            current_date = date.today()
        
        days_after_planting = (current_date - self.planting_date).days
        
        for stage in self.growth_stages:
            if stage["start_day"] <= days_after_planting <= stage["end_day"]:
                return stage
        return None
    
    def to_dict(self) -> Dict:
        return {
            "plan_id": self.plan_id,
            "field_id": self.field_id,
            "crop_type": self.crop_type.value,
            "variety": self.variety,
            "planting_date": self.planting_date.isoformat(),
            "expected_harvest_date": self.expected_harvest_date.isoformat(),
            "seed_quantity": self.seed_quantity,
            "target_yield": self.target_yield,
            "growth_stages": self.growth_stages
        }


@dataclass
class IrrigationRecord:
    """çŒæº‰è®°å½•"""
    record_id: str
    field_id: str
    start_time: datetime
    end_time: Optional[datetime] = None
    water_volume: float = 0.0  # mÂ³
    method: IrrigationType = IrrigationType.DRIP
    trigger_reason: str = ""  # schedule, sensor, manual
    
    def calculate_duration(self) -> int:
        """è®¡ç®—çŒæº‰æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰"""
        if self.end_time:
            return int((self.end_time - self.start_time).total_seconds() / 60)
        return 0
    
    def to_dict(self) -> Dict:
        return {
            "record_id": self.record_id,
            "field_id": self.field_id,
            "start_time": self.start_time.isoformat(),
            "end_time": self.end_time.isoformat() if self.end_time else None,
            "duration_minutes": self.calculate_duration(),
            "water_volume": self.water_volume,
            "method": self.method.value,
            "trigger_reason": self.trigger_reason
        }


@dataclass
class FertilizationRecord:
    """æ–½è‚¥è®°å½•"""
    record_id: str
    field_id: str
    timestamp: datetime
    fertilizer_type: str
    n_amount: float  # kg
    p_amount: float  # kg
    k_amount: float  # kg
    application_method: str = ""
    
    def get_npk_ratio(self) -> str:
        """è·å–NPKæ¯”ä¾‹"""
        total = self.n_amount + self.p_amount + self.k_amount
        if total == 0:
            return "0-0-0"
        n_pct = int(self.n_amount / total * 100)
        p_pct = int(self.p_amount / total * 100)
        k_pct = int(self.k_amount / total * 100)
        return f"{n_pct}-{p_pct}-{k_pct}"
    
    def to_dict(self) -> Dict:
        return {
            "record_id": self.record_id,
            "field_id": self.field_id,
            "timestamp": self.timestamp.isoformat(),
            "fertilizer_type": self.fertilizer_type,
            "npk_ratio": self.get_npk_ratio(),
            "n_amount": self.n_amount,
            "p_amount": self.p_amount,
            "k_amount": self.k_amount,
            "application_method": self.application_method
        }


class SmartFarmManager:
    """æ™ºæ…§å†œåœºç®¡ç†å™¨"""
    
    def __init__(self):
        self.fields: Dict[str, Field] = {}
        self.crop_plans: Dict[str, CropPlan] = {}
        self.soil_data: Dict[str, List[SoilData]] = {}
        self.weather_data: List[WeatherData] = []
        self.crop_health_data: Dict[str, List[CropHealth]] = {}
        self.irrigation_records: List[IrrigationRecord] = []
        self.fertilization_records: List[FertilizationRecord] = []
    
    def register_field(self, field: Field):
        self.fields[field.field_id] = field
        self.soil_data[field.field_id] = []
        self.crop_health_data[field.field_id] = []
        logger.info(f"Registered field: {field.field_name}")
    
    def create_crop_plan(self, plan: CropPlan):
        self.crop_plans[plan.plan_id] = plan
        logger.info(f"Created crop plan: {plan.crop_type.value} in {plan.field_id}")
    
    def record_soil_data(self, field_id: str, data: SoilData):
        if field_id in self.soil_data:
            self.soil_data[field_id].append(data)
            logger.info(f"Recorded soil data for {field_id}")
    
    def record_weather(self, data: WeatherData):
        self.weather_data.append(data)
    
    def record_crop_health(self, field_id: str, data: CropHealth):
        if field_id in self.crop_health_data:
            self.crop_health_data[field_id].append(data)
    
    def calculate_irrigation_need(self, field_id: str) -> Dict:
        """è®¡ç®—çŒæº‰éœ€æ±‚"""
        field = self.fields.get(field_id)
        if not field:
            return {}
        
        # è·å–æœ€æ–°åœŸå£¤æ•°æ®
        soil_history = self.soil_data.get(field_id, [])
        if not soil_history:
            return {"error": "No soil data available"}
        
        latest_soil = soil_history[-1]
        
        # è·å–æœ€è¿‘æ°”è±¡æ•°æ®
        recent_weather = [w for w in self.weather_data 
                         if w.timestamp > datetime.now() - timedelta(days=7)]
        
        # è®¡ç®—7æ—¥ç´¯è®¡é™æ°´é‡
        total_precipitation = sum(w.precipitation for w in recent_weather)
        
        # è®¡ç®—å¹³å‡è’¸å‘é‡
        avg_et0 = 0
        if recent_weather:
            day_of_year = datetime.now().timetuple().tm_yday
            avg_et0 = sum(w.calculate_et0(field.location.latitude, day_of_year) 
                         for w in recent_weather) / len(recent_weather)
        
        # çŒæº‰å†³ç­–é€»è¾‘
        moisture_threshold = 60  # %
        irrigation_needed = latest_soil.moisture < moisture_threshold
        
        # è®¡ç®—éœ€æ°´é‡
        water_needed = 0
        if irrigation_needed:
            # ç®€åŒ–çš„éœ€æ°´é‡è®¡ç®—
            deficit = moisture_threshold - latest_soil.moisture
            water_needed = deficit * field.area * 100  # è½¬æ¢ä¸ºmÂ³
        
        return {
            "field_id": field_id,
            "current_moisture": latest_soil.moisture,
            "moisture_threshold": moisture_threshold,
            "irrigation_needed": irrigation_needed,
            "water_needed_m3": round(water_needed, 2),
            "recent_precipitation": round(total_precipitation, 2),
            "avg_daily_et0": round(avg_et0, 2),
            "recommendation": "å»ºè®®çŒæº‰" if irrigation_needed else "æš‚ä¸éœ€è¦çŒæº‰"
        }
    
    def predict_yield(self, plan_id: str) -> Dict:
        """é¢„æµ‹äº§é‡"""
        plan = self.crop_plans.get(plan_id)
        if not plan:
            return {}
        
        field = self.fields.get(plan.field_id)
        if not field:
            return {}
        
        # è·å–å¥åº·æ•°æ®
        health_history = self.crop_health_data.get(plan.field_id, [])
        if not health_history:
            predicted_yield = plan.target_yield * 0.9  # é»˜è®¤ç•¥ä½äºç›®æ ‡
        else:
            # åŸºäºNDVIè¶‹åŠ¿é¢„æµ‹
            recent_ndvi = [h.ndvi for h in health_history[-5:]]
            avg_ndvi = sum(recent_ndvi) / len(recent_ndvi) if recent_ndvi else 0.5
            
            # ç®€åŒ–çš„äº§é‡é¢„æµ‹æ¨¡å‹
            ndvi_factor = avg_ndvi / 0.7 if avg_ndvi > 0 else 0.5
            predicted_yield = plan.target_yield * min(ndvi_factor, 1.2)
        
        total_yield = predicted_yield * field.area
        
        return {
            "plan_id": plan_id,
            "crop_type": plan.crop_type.value,
            "predicted_yield_per_ha": round(predicted_yield, 2),
            "total_predicted_yield": round(total_yield, 2),
            "confidence": "ä¸­",
            "harvest_date": plan.expected_harvest_date.isoformat()
        }
    
    def detect_pest_risk(self, field_id: str) -> Dict:
        """æ£€æµ‹ç—…è™«å®³é£é™©"""
        health_history = self.crop_health_data.get(field_id, [])
        if not health_history:
            return {"risk_level": "æœªçŸ¥", "message": "æ— ç›‘æµ‹æ•°æ®"}
        
        latest = health_history[-1]
        recent = [h for h in health_history 
                 if h.timestamp > datetime.now() - timedelta(days=14)]
        
        # é£é™©å› ç´ åˆ†æ
        risk_factors = []
        risk_score = 0
        
        # NDVIä¸‹é™è¶‹åŠ¿
        if len(recent) >= 3:
            ndvi_trend = recent[-1].ndvi - recent[0].ndvi
            if ndvi_trend < -0.1:
                risk_factors.append("NDVIä¸‹é™")
                risk_score += 30
        
        # å† å±‚æ¸©åº¦å¼‚å¸¸
        if latest.canopy_temperature > 35:
            risk_factors.append("å† å±‚æ¸©åº¦åé«˜")
            risk_score += 20
        
        # å·²æœ‰ç—…è™«å®³
        if latest.pest_severity != PestSeverity.NONE:
            risk_factors.append("å·²å‘ç°ç—…è™«å®³")
            risk_score += 40
        
        # é£é™©ç­‰çº§åˆ¤å®š
        if risk_score >= 60:
            risk_level = "é«˜é£é™©"
        elif risk_score >= 30:
            risk_level = "ä¸­é£é™©"
        elif risk_score > 0:
            risk_level = "ä½é£é™©"
        else:
            risk_level = "å®‰å…¨"
        
        return {
            "field_id": field_id,
            "risk_level": risk_level,
            "risk_score": risk_score,
            "risk_factors": risk_factors,
            "recommendations": self._get_pest_recommendations(risk_level)
        }
    
    def _get_pest_recommendations(self, risk_level: str) -> List[str]:
        """è·å–ç—…è™«å®³é˜²æ²»å»ºè®®"""
        recommendations = {
            "é«˜é£é™©": [
                "ç«‹å³è¿›è¡Œç”°é—´å·¡æŸ¥",
                "å¯åŠ¨ç—…è™«å®³é˜²æ²»é¢„æ¡ˆ",
                "è€ƒè™‘ä½¿ç”¨ç”Ÿç‰©é˜²æ²»æªæ–½"
            ],
            "ä¸­é£é™©": [
                "åŠ å¼ºç›‘æµ‹é¢‘ç‡",
                "å‡†å¤‡é˜²æ²»ç‰©èµ„",
                "å…³æ³¨æ°”è±¡æ¡ä»¶"
            ],
            "ä½é£é™©": [
                "ä¿æŒå¸¸è§„ç›‘æµ‹",
                "è®°å½•ä½œç‰©ç”Ÿé•¿çŠ¶å†µ"
            ],
            "å®‰å…¨": ["ç»§ç»­ä¿æŒè‰¯å¥½ç®¡ç†"]
        }
        return recommendations.get(risk_level, [])
    
    def generate_farm_report(self, field_id: str) -> Dict:
        """ç”Ÿæˆå†œåœºæŠ¥å‘Š"""
        field = self.fields.get(field_id)
        if not field:
            return {}
        
        # è·å–ç›¸å…³æ•°æ®
        soil = self.soil_data.get(field_id, [])
        health = self.crop_health_data.get(field_id, [])
        
        return {
            "field_id": field_id,
            "field_name": field.field_name,
            "report_date": datetime.now().isoformat(),
            "field_info": field.to_dict(),
            "soil_summary": soil[-1].to_dict() if soil else None,
            "crop_health_summary": health[-1].to_dict() if health else None,
            "irrigation_recommendation": self.calculate_irrigation_need(field_id),
            "pest_risk": self.detect_pest_risk(field_id),
            "data_points": {
                "soil_readings": len(soil),
                "health_monitoring": len(health)
            }
        }


def create_demo_farm():
    """åˆ›å»ºæ¼”ç¤ºå†œåœº"""
    manager = SmartFarmManager()
    
    # åˆ›å»ºå†œç”°
    field = Field(
        field_id="FIELD-001",
        field_name="1å·æ°´ç¨»ç”°",
        location=GeoLocation(latitude=31.2304, longitude=121.4737),
        area=10.5,  # å…¬é¡·
        soil_type="å£¤åœŸ",
        irrigation_type=IrrigationType.DRIP
    )
    manager.register_field(field)
    
    # åˆ›å»ºç§æ¤è®¡åˆ’
    plan = CropPlan(
        plan_id="PLAN-001",
        field_id="FIELD-001",
        crop_type=CropType.RICE,
        variety="å—ç²³46",
        planting_date=date(2025, 5, 15),
        expected_harvest_date=date(2025, 10, 20),
        seed_quantity=150.0,
        target_yield=9000.0,
        growth_stages=[
            {"stage": "å¹¼è‹—æœŸ", "start_day": 0, "end_day": 20},
            {"stage": "åˆ†è˜–æœŸ", "start_day": 21, "end_day": 50},
            {"stage": "æ‹”èŠ‚å­•ç©—æœŸ", "start_day": 51, "end_day": 80},
            {"stage": "æŠ½ç©—å¼€èŠ±æœŸ", "start_day": 81, "end_day": 100},
            {"stage": "çŒæµ†æˆç†ŸæœŸ", "start_day": 101, "end_day": 140}
        ]
    )
    manager.create_crop_plan(plan)
    
    # ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
    base_date = datetime(2025, 6, 1)
    for i in range(30):
        current_date = base_date + timedelta(days=i)
        
        # åœŸå£¤æ•°æ®
        soil = SoilData(
            timestamp=current_date,
            moisture=random.uniform(45, 75),
            temperature=random.uniform(20, 28),
            ph=random.uniform(6.0, 7.0),
            ec=random.uniform(0.5, 1.5),
            n_content=random.uniform(80, 150),
            p_content=random.uniform(15, 35),
            k_content=random.uniform(120, 200)
        )
        manager.record_soil_data("FIELD-001", soil)
        
        # æ°”è±¡æ•°æ®
        weather = WeatherData(
            timestamp=current_date,
            temperature=random.uniform(22, 32),
            humidity=random.uniform(60, 90),
            pressure=random.uniform(1000, 1020),
            wind_speed=random.uniform(1, 5),
            wind_direction=random.choice(["N", "NE", "E", "SE", "S", "SW", "W", "NW"]),
            precipitation=random.choice([0, 0, 0, 0, 5, 10, 15]),  # å¤šæ•°å¤©æ— é›¨
            solar_radiation=random.uniform(200, 800),
            uv_index=random.uniform(3, 8)
        )
        manager.record_weather(weather)
        
        # ä½œç‰©å¥åº·æ•°æ®
        if i % 3 == 0:  # æ¯3å¤©ä¸€æ¬¡
            health = CropHealth(
                timestamp=current_date,
                ndvi=random.uniform(0.5, 0.85),
                leaf_area_index=random.uniform(2, 5),
                canopy_temperature=random.uniform(25, 32),
                plant_height=100 + i * 5,  # æ¨¡æ‹Ÿç”Ÿé•¿
                pest_severity=random.choice([PestSeverity.NONE, PestSeverity.NONE, PestSeverity.LOW])
            )
            manager.record_crop_health("FIELD-001", health)
    
    return manager


def main():
    """ä¸»å‡½æ•°"""
    print("=" * 80)
    print("æ™ºæ…§å†œä¸šSchemaå®è·µæ¡ˆä¾‹ - ç»¿æºæ™ºæ…§å†œä¸š")
    print("=" * 80)
    
    # åˆ›å»ºæ¼”ç¤ºå†œåœº
    print("\nã€æ­¥éª¤1ã€‘åˆ›å»ºæ™ºæ…§å†œåœº...")
    manager = create_demo_farm()
    print("  åˆ›å»ºå†œç”°: 1å·æ°´ç¨»ç”° (10.5å…¬é¡·)")
    print("  ç§æ¤ä½œç‰©: å—ç²³46æ°´ç¨»")
    
    # çŒæº‰å»ºè®®
    print("\nã€æ­¥éª¤2ã€‘è®¡ç®—çŒæº‰éœ€æ±‚...")
    irrigation = manager.calculate_irrigation_need("FIELD-001")
    print(f"  å½“å‰åœŸå£¤æ¹¿åº¦: {irrigation['current_moisture']:.1f}%")
    print(f"  æ˜¯å¦éœ€è¦çŒæº‰: {'æ˜¯' if irrigation['irrigation_needed'] else 'å¦'}")
    print(f"  å»ºè®®ç”¨æ°´é‡: {irrigation['water_needed_m3']:.1f} mÂ³")
    
    # äº§é‡é¢„æµ‹
    print("\nã€æ­¥éª¤3ã€‘é¢„æµ‹äº§é‡...")
    yield_pred = manager.predict_yield("PLAN-001")
    print(f"  é¢„æµ‹äº§é‡: {yield_pred['predicted_yield_per_ha']:.0f} kg/å…¬é¡·")
    print(f"  æ€»äº§é‡é¢„æµ‹: {yield_pred['total_predicted_yield']:.0f} kg")
    print(f"  é¢„è®¡æ”¶è·æ—¥æœŸ: {yield_pred['harvest_date']}")
    
    # ç—…è™«å®³é£é™©
    print("\nã€æ­¥éª¤4ã€‘ç—…è™«å®³é£é™©è¯„ä¼°...")
    pest_risk = manager.detect_pest_risk("FIELD-001")
    print(f"  é£é™©ç­‰çº§: {pest_risk['risk_level']}")
    print(f"  é£é™©å› ç´ : {', '.join(pest_risk['risk_factors']) if pest_risk['risk_factors'] else 'æ— '}")
    if pest_risk.get('recommendations'):
        print("  å»ºè®®æªæ–½:")
        for rec in pest_risk['recommendations'][:2]:
            print(f"    - {rec}")
    
    # ç”ŸæˆæŠ¥å‘Š
    print("\nã€æ­¥éª¤5ã€‘ç”Ÿæˆå†œåœºæŠ¥å‘Š...")
    report = manager.generate_farm_report("FIELD-001")
    print(f"  å†œç”°: {report['field_name']}")
    print(f"  åœŸå£¤è‚¥åŠ›: {report['soil_summary']['fertility_level'] if report['soil_summary'] else 'N/A'}")
    print(f"  ä½œç‰©çŠ¶æ€: {report['crop_health_summary']['health_status'] if report['crop_health_summary'] else 'N/A'}")
    
    print("\n" + "=" * 80)
    print("æ™ºæ…§å†œä¸šSchemaå®è·µæ¡ˆä¾‹æ‰§è¡Œå®Œæˆ")
    print("=" * 80)


if __name__ == "__main__":
    main()
```

---

## 7. æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ

### 7.1 å…³é”®ç»©æ•ˆæŒ‡æ ‡

| æŒ‡æ ‡ | å®æ–½å‰ | å®æ–½å | æ”¹å–„ |
|------|--------|--------|------|
| ç”¨æ°´é‡ | åŸºå‡† | -32% | èŠ‚çº¦ |
| åŒ–è‚¥ç”¨é‡ | åŸºå‡† | -28% | èŠ‚çº¦ |
| å†œè¯ç”¨é‡ | åŸºå‡† | -25% | èŠ‚çº¦ |
| äº§é‡ | åŸºå‡† | +18% | æå‡ |
| äººå·¥æˆæœ¬ | åŸºå‡† | -40% | èŠ‚çº¦ |

### 7.2 ROIåˆ†æ

**æŠ•èµ„**ï¼šÂ¥180ä¸‡  
**å¹´æ”¶ç›Š**ï¼šÂ¥260ä¸‡  
**ROI**ï¼š144%ï¼ˆ3å¹´ï¼‰

---

**åˆ›å»ºæ—¶é—´**ï¼š2026-02-15  
**ç‰ˆæœ¬**ï¼š1.0.0
