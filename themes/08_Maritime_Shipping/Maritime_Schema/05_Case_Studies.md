# æµ·è¿ä¸èˆªè¿Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [æµ·è¿ä¸èˆªè¿Schemaå®è·µæ¡ˆä¾‹](#æµ·è¿ä¸èˆªè¿schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šèˆ¹èˆ¶ä¿¡æ¯ç®¡ç†å’Œä½ç½®è¿½è¸ª](#2-æ¡ˆä¾‹1èˆ¹èˆ¶ä¿¡æ¯ç®¡ç†å’Œä½ç½®è¿½è¸ª)
    - [2.1 åœºæ™¯æè¿°](#21-åœºæ™¯æè¿°)
    - [2.2 Schemaå®šä¹‰](#22-schemaå®šä¹‰)
    - [2.3 å®ç°ä»£ç ](#23-å®ç°ä»£ç )
  - [3. æ¡ˆä¾‹2ï¼šè´§ç‰©å…¨ç¨‹è¿½è¸ªç³»ç»Ÿ](#3-æ¡ˆä¾‹2è´§ç‰©å…¨ç¨‹è¿½è¸ªç³»ç»Ÿ)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
    - [3.3 å®ç°ä»£ç ](#33-å®ç°ä»£ç )
  - [4. æ¡ˆä¾‹3ï¼šèˆªçº¿è§„åˆ’å’Œæ€§èƒ½åˆ†æ](#4-æ¡ˆä¾‹3èˆªçº¿è§„åˆ’å’Œæ€§èƒ½åˆ†æ)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
    - [4.3 å®ç°ä»£ç ](#43-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šEDIFACTæ¶ˆæ¯å¤„ç†å’Œè½¬æ¢](#5-æ¡ˆä¾‹4edifactæ¶ˆæ¯å¤„ç†å’Œè½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šæµ·è¿èˆªè¿æ•°æ®åˆ†æå’ŒæŠ¥è¡¨](#6-æ¡ˆä¾‹5æµ·è¿èˆªè¿æ•°æ®åˆ†æå’ŒæŠ¥è¡¨)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )
    - [6.3 æ•°æ®åˆ†æç¤ºä¾‹](#63-æ•°æ®åˆ†æç¤ºä¾‹)
  - [7. æ¡ˆä¾‹6ï¼šèˆ¹èˆ¶å®æ—¶è¿½è¸ªï¼ˆAISé›†æˆï¼‰](#7-æ¡ˆä¾‹6èˆ¹èˆ¶å®æ—¶è¿½è¸ªaisé›†æˆ)
    - [7.1 åœºæ™¯æè¿°](#71-åœºæ™¯æè¿°)
    - [7.2 Schemaå®šä¹‰](#72-schemaå®šä¹‰)
    - [7.3 å®ç°ä»£ç ](#73-å®ç°ä»£ç )
  - [8. æ¡ˆä¾‹7ï¼šè´§ç‰©å…¨ç¨‹è¿½è¸ªï¼ˆEDIFACTï¼‰](#8-æ¡ˆä¾‹7è´§ç‰©å…¨ç¨‹è¿½è¸ªedifact)
    - [8.1 åœºæ™¯æè¿°](#81-åœºæ™¯æè¿°)
    - [8.2 Schemaå®šä¹‰](#82-schemaå®šä¹‰)
    - [8.3 å®ç°ä»£ç ](#83-å®ç°ä»£ç )
  - [9. æ¡ˆä¾‹8ï¼šèˆªçº¿ä¼˜åŒ–ï¼ˆæˆæœ¬+æ—¶é—´ï¼‰](#9-æ¡ˆä¾‹8èˆªçº¿ä¼˜åŒ–æˆæœ¬æ—¶é—´)
    - [9.1 åœºæ™¯æè¿°](#91-åœºæ™¯æè¿°)
    - [9.2 Schemaå®šä¹‰](#92-schemaå®šä¹‰)
    - [9.3 å®ç°ä»£ç ](#93-å®ç°ä»£ç )
  - [10. æ¡ˆä¾‹9ï¼šæ¸¯å£æ•ˆç‡åˆ†æ](#10-æ¡ˆä¾‹9æ¸¯å£æ•ˆç‡åˆ†æ)
    - [10.1 åœºæ™¯æè¿°](#101-åœºæ™¯æè¿°)
    - [10.2 å®ç°ä»£ç ](#102-å®ç°ä»£ç )
  - [11. æ¡ˆä¾‹10ï¼šå¼‚å¸¸äº‹ä»¶å¤„ç†](#11-æ¡ˆä¾‹10å¼‚å¸¸äº‹ä»¶å¤„ç†)
    - [11.1 åœºæ™¯æè¿°](#111-åœºæ™¯æè¿°)
    - [11.2 Schemaå®šä¹‰](#112-schemaå®šä¹‰)
    - [11.3 å®ç°ä»£ç ](#113-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æµ·è¿ä¸èˆªè¿Schemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šèˆ¹èˆ¶ä¿¡æ¯ç®¡ç†å’Œä½ç½®è¿½è¸ª

### 2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦ç®¡ç†èˆ¹èˆ¶ä¿¡æ¯ï¼Œå®æ—¶è¿½è¸ªèˆ¹èˆ¶ä½ç½®ï¼Œç›‘æ§èˆ¹èˆ¶çŠ¶æ€ï¼Œ
å¹¶é¢„æµ‹åˆ°è¾¾æ—¶é—´ï¼Œä¼˜åŒ–èˆªçº¿è§„åˆ’ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®æ—¶æ¥æ”¶AISä½ç½®æ•°æ®
- éœ€è¦è®¡ç®—èˆ¹èˆ¶é€Ÿåº¦å’Œèˆªå‘
- éœ€è¦é¢„æµ‹åˆ°è¾¾æ—¶é—´
- éœ€è¦å­˜å‚¨å¤§é‡ä½ç½®æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨VesselPositionTrackerå®ç°èˆ¹èˆ¶ä½ç½®è¿½è¸ªï¼Œé›†æˆAISæ•°æ®æºï¼Œ
å®æ—¶æ›´æ–°èˆ¹èˆ¶ä½ç½®å¹¶è®¡ç®—èˆªè¡Œå‚æ•°ã€‚

### 2.2 Schemaå®šä¹‰

è¯¦è§ç¬¬2.2èŠ‚åŸå§‹å®šä¹‰ã€‚

### 2.3 å®ç°ä»£ç 

**å®Œæ•´çš„èˆ¹èˆ¶ç®¡ç†å’Œä½ç½®è¿½è¸ªå®ç°**ï¼š

```python
from maritime_storage import MaritimeStorage
from vessel_position_tracker import VesselPositionTracker
from datetime import datetime, timedelta

# åˆå§‹åŒ–å­˜å‚¨å’Œè¿½è¸ªå™¨
storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")
tracker = VesselPositionTracker(storage)

# æ³¨å†Œèˆ¹èˆ¶
vessel_data = {
    "vessel_id": "VESSEL001",
    "imo_number": "1234567",
    "vessel_name": "MV OCEAN STAR",
    "vessel_type": "ContainerShip",
    "flag_state": "SG",
    "call_sign": "9V1234",
    "mmsi": "563123456",
    "gross_tonnage": 50000.00,
    "net_tonnage": 30000.00,
    "deadweight_tonnage": 40000.00,
    "length_overall": 300.00,
    "breadth": 40.00,
    "draft": 12.50,
    "year_built": 2020,
    "builder": "Shipyard Co."
}

vessel_id = storage.store_vessel(vessel_data)
print(f"Registered vessel: {vessel_id}")

# æ›´æ–°èˆ¹èˆ¶ä½ç½®ï¼ˆæ¨¡æ‹ŸAISæ•°æ®ï¼‰
positions = [
    {"latitude": 1.234567, "longitude": 103.456789, "course": 45.5, "speed": 18.5, "heading": 45.0},
    {"latitude": 1.245678, "longitude": 103.467890, "course": 46.0, "speed": 19.0, "heading": 46.0},
    {"latitude": 1.256789, "longitude": 103.478901, "course": 45.8, "speed": 18.8, "heading": 45.8}
]

for i, pos in enumerate(positions):
    position_data = {
        **pos,
        "position_time": datetime.now() + timedelta(hours=i)
    }
    tracker.update_position("VESSEL001", position_data)
    print(f"Updated position {i+1}: {pos['latitude']}, {pos['longitude']}")

# è·å–å½“å‰ä½ç½®
current_pos = tracker.get_current_position("VESSEL001")
if current_pos:
    print(f"\nCurrent position:")
    print(f"  Latitude: {current_pos['latitude']}")
    print(f"  Longitude: {current_pos['longitude']}")
    print(f"  Speed: {current_pos['speed']} knots")
    print(f"  Course: {current_pos['course']}Â°")

# ä¼°ç®—åˆ°è¾¾æ—¶é—´ï¼ˆæ–°åŠ å¡æ¸¯ï¼‰
singapore_lat = 1.2897
singapore_lon = 103.8501
eta = tracker.estimate_arrival_time("VESSEL001", singapore_lat, singapore_lon)
if eta:
    print(f"\nEstimated arrival time: {eta}")

# è·å–èˆ¹èˆ¶è½¨è¿¹
track = tracker.get_vessel_track("VESSEL001", hours=24)
print(f"\nVessel track (24h): {len(track)} positions")

# æŸ¥è¯¢ä½ç½®ç»Ÿè®¡
stats = storage.get_vessel_position_statistics(
    "VESSEL001",
    datetime.now() - timedelta(days=1)
)
print(f"\nPosition statistics:")
print(f"  Position count: {stats['position_count']}")
print(f"  Avg speed: {stats['avg_speed']:.2f} knots")
print(f"  Max speed: {stats['max_speed']:.2f} knots")
```

---

## 3. æ¡ˆä¾‹2ï¼šè´§ç‰©å…¨ç¨‹è¿½è¸ªç³»ç»Ÿ

### 3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
è´§ä¸»å’Œæ”¶è´§äººéœ€è¦å®æ—¶è¿½è¸ªè´§ç‰©çŠ¶æ€ï¼Œä»é¢„è®¢ã€è£…èˆ¹ã€è¿è¾“åˆ°å¸èˆ¹çš„
å…¨ç¨‹è¿½è¸ªï¼Œç¡®ä¿è´§ç‰©å®‰å…¨å’ŒåŠæ—¶äº¤ä»˜ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®æ—¶æ›´æ–°è´§ç‰©çŠ¶æ€
- éœ€è¦è®°å½•æ‰€æœ‰è¿½è¸ªäº‹ä»¶
- éœ€è¦æ”¯æŒå¤šè´§ç‰©æ‰¹é‡è¿½è¸ª
- éœ€è¦ç”Ÿæˆè¿½è¸ªæŠ¥å‘Š

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨CargoTrackingSystemå®ç°è´§ç‰©è¿½è¸ªï¼Œé›†æˆEDIFACTæ¶ˆæ¯å¤„ç†ï¼Œ
è‡ªåŠ¨æ›´æ–°è´§ç‰©çŠ¶æ€å¹¶è®°å½•è¿½è¸ªäº‹ä»¶ã€‚

### 3.2 Schemaå®šä¹‰

è¯¦è§ç¬¬3.2èŠ‚åŸå§‹å®šä¹‰ã€‚

### 3.3 å®ç°ä»£ç 

**å®Œæ•´çš„è´§ç‰©è¿½è¸ªç³»ç»Ÿå®ç°**ï¼š

```python
from maritime_storage import MaritimeStorage
from cargo_tracking_system import CargoTrackingSystem
from datetime import datetime

# åˆå§‹åŒ–å­˜å‚¨å’Œè¿½è¸ªç³»ç»Ÿ
storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")
tracking_system = CargoTrackingSystem(storage)

# åˆ›å»ºè´§ç‰©
cargo_data = {
    "cargo_id": "CARGO20250121001",
    "cargo_name": "ç”µå­äº§å“",
    "cargo_type": "Container",
    "shipper": "ABC Trading Co.",
    "consignee": "XYZ Import Co.",
    "weight": 20000.00,
    "volume": 50.00,
    "quantity": 100,
    "unit": "pieces",
    "hs_code": "85171200",
    "value": 500000.00,
    "currency": "USD",
    "status": "Booked",
    "loading_port": "Shanghai",
    "loading_port_code": "CNSHA",
    "discharge_port": "Singapore",
    "discharge_port_code": "SGSIN",
    "loading_date": datetime(2025, 1, 20, 10, 0, 0),
    "vessel_id": "VESSEL001",
    "container_number": "CONT1234567"
}

cargo_id = storage.store_cargo(cargo_data)
print(f"Created cargo: {cargo_id}")

# è®°å½•è´§ç‰©äº‹ä»¶
events = [
    {
        "event_type": "Booked",
        "event_location": "Shanghai",
        "event_description": "è´§ç‰©é¢„è®¢"
    },
    {
        "event_type": "Loaded",
        "event_location": "Shanghai Port",
        "event_description": "è´§ç‰©å·²è£…èˆ¹"
    },
    {
        "event_type": "Departed",
        "event_location": "Shanghai Port",
        "event_description": "èˆ¹èˆ¶å·²ç¦»æ¸¯"
    },
    {
        "event_type": "Arrived",
        "event_location": "Singapore Port",
        "event_description": "èˆ¹èˆ¶å·²åˆ°è¾¾"
    }
]

for event in events:
    tracking_system.track_cargo_event(
        "CARGO20250121001",
        event["event_type"],
        event["event_location"],
        event["event_description"]
    )
    print(f"Tracked event: {event['event_type']} at {event['event_location']}")

# è·å–è´§ç‰©è¿½è¸ªå†å²
history = tracking_system.get_cargo_tracking_history("CARGO20250121001")
print(f"\nCargo tracking history:")
for event in history:
    print(f"  {event['event_time']}: {event['event_type']} - {event['event_location']}")

# è·å–å½“å‰çŠ¶æ€
current_status = tracking_system.get_cargo_current_status("CARGO20250121001")
if current_status:
    print(f"\nCurrent cargo status:")
    print(f"  Status: {current_status['status']}")
    print(f"  Location: {current_status['current_location']}")
    print(f"  Last update: {current_status['last_update']}")

# æŸ¥è¯¢è¿½è¸ªç»Ÿè®¡
stats = storage.get_cargo_tracking_statistics("CARGO20250121001")
print(f"\nTracking statistics:")
for stat in stats:
    print(f"  {stat['event_type']}: {stat['count']} events")
```

---

## 4. æ¡ˆä¾‹3ï¼šèˆªçº¿è§„åˆ’å’Œæ€§èƒ½åˆ†æ

### 4.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦è§„åˆ’èˆ¹èˆ¶èˆªçº¿ï¼Œç›‘æ§èˆªçº¿æ‰§è¡Œæƒ…å†µï¼Œåˆ†æèˆªçº¿æ€§èƒ½ï¼Œ
ä¼˜åŒ–ç‡ƒæ²¹æ¶ˆè€—å’Œèˆªè¡Œæ—¶é—´ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§„åˆ’æœ€ä¼˜èˆªçº¿
- éœ€è¦ç›‘æ§å®é™…æ‰§è¡Œæƒ…å†µ
- éœ€è¦åˆ†æèˆªçº¿æ€§èƒ½
- éœ€è¦ä¼˜åŒ–ç‡ƒæ²¹æ¶ˆè€—

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨MaritimeStorageå­˜å‚¨èˆªçº¿æ•°æ®ï¼Œå®ç°èˆªçº¿è§„åˆ’å’Œæ€§èƒ½åˆ†æåŠŸèƒ½ã€‚

### 4.2 Schemaå®šä¹‰

è¯¦è§ç¬¬4.2èŠ‚åŸå§‹å®šä¹‰ã€‚

### 4.3 å®ç°ä»£ç 

**å®Œæ•´çš„èˆªçº¿è§„åˆ’å®ç°**ï¼š

```python
from maritime_storage import MaritimeStorage
from datetime import datetime, timedelta

# åˆå§‹åŒ–å­˜å‚¨
storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")

# åˆ›å»ºèˆªçº¿
route_data = {
    "route_id": "ROUTE20250121001",
    "vessel_id": "VESSEL001",
    "voyage_number": "VOY001",
    "origin_port": "Shanghai",
    "origin_port_code": "CNSHA",
    "destination_port": "Singapore",
    "destination_port_code": "SGSIN",
    "planned_departure": datetime(2025, 1, 20, 14, 0, 0),
    "planned_arrival": datetime(2025, 1, 22, 8, 0, 0),
    "planned_distance": 1500.00,
    "planned_duration": 2,
    "actual_departure": datetime(2025, 1, 20, 14, 30, 0),
    "actual_arrival": datetime(2025, 1, 22, 9, 0, 0),
    "actual_distance": 1520.00,
    "actual_duration": 2,
    "average_speed": 18.5,
    "fuel_consumption": 120.50
}

route_id = storage.store_route(route_data)
print(f"Created route: {route_id}")

# æŸ¥è¯¢èˆªçº¿æ€§èƒ½ç»Ÿè®¡
performance = storage.get_route_performance_statistics("VESSEL001", days=30)
print(f"\nRoute performance statistics (30 days):")
print(f"  Voyage count: {performance['voyage_count']}")
print(f"  Avg duration: {performance['avg_duration_hours']:.2f} hours")
print(f"  Avg distance: {performance['avg_distance']:.2f} nautical miles")
print(f"  Avg speed: {performance['avg_speed']:.2f} knots")
print(f"  Avg fuel consumption: {performance['avg_fuel_consumption']:.2f} tons")
print(f"  Avg delay: {performance['avg_delay_hours']:.2f} hours")

# æŸ¥è¯¢èˆ¹èˆ¶åˆ©ç”¨ç‡
utilization = storage.get_vessel_utilization("VESSEL001", days=30)
print(f"\nVessel utilization (30 days):")
print(f"  Voyage count: {utilization['voyage_count']}")
print(f"  Days at sea: {utilization['total_days_at_sea']:.2f}")
print(f"  Cargo count: {utilization['cargo_count']}")
print(f"  Total cargo weight: {utilization['total_cargo_weight']:.2f} tons")
print(f"  Utilization rate: {utilization['utilization_rate']:.2f}%")
```

---

## 5. æ¡ˆä¾‹4ï¼šEDIFACTæ¶ˆæ¯å¤„ç†å’Œè½¬æ¢

### 5.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦å¤„ç†EDIFACTæ¶ˆæ¯ï¼ˆIFTMINã€IFTMCSã€IFTMANï¼‰ï¼Œ
ä¸åˆä½œä¼™ä¼´äº¤æ¢è´§ç‰©æ¸…å•ã€çŠ¶æ€æ›´æ–°å’Œåˆ°è¾¾é€šçŸ¥ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§£æEDIFACTæ¶ˆæ¯
- éœ€è¦è½¬æ¢ä¸ºXMLæ ¼å¼
- éœ€è¦éªŒè¯æ¶ˆæ¯å®Œæ•´æ€§
- éœ€è¦å¤„ç†å¤šç§æ¶ˆæ¯ç±»å‹

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨EDIFACTParserå’ŒEDIFACTToXMLConverterå®ç°EDIFACTæ¶ˆæ¯å¤„ç†ã€‚

### 5.2 å®ç°ä»£ç 

**å®Œæ•´çš„EDIFACTæ¶ˆæ¯å¤„ç†å®ç°**ï¼š

```python
from edifact_parser import EDIFACTParser, EDIFACTToXMLConverter
from maritime_storage import MaritimeStorage

# åˆå§‹åŒ–ç»„ä»¶
parser = EDIFACTParser()
converter = EDIFACTToXMLConverter()
storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")

# ç¤ºä¾‹EDIFACT IFTMINæ¶ˆæ¯ï¼ˆè´§ç‰©æ¸…å•ï¼‰
edifact_iftmin = """UNH+1+IFTMIN:D:96A:UN'
BGM+270+MSG001+9'
DTM+137:20250120:102'
TDT+20+1+13+MV OCEAN STAR::172'
LOC+5+CNSHA:172:6+Shanghai'
LOC+8+SGSIN:172:6+Singapore'
GID+1+Electronics'
MEA+WT+20000:KGM'
UNT+7+1'"""

# è§£æEDIFACTæ¶ˆæ¯
segments = parser.parse_message(edifact_iftmin)
print(f"Parsed {len(segments)} segments")

# è§£æIFTMINæ¶ˆæ¯
cargo_manifest = parser.parse_iftmin(segments)
print(f"\nCargo Manifest:")
print(f"  Message Reference: {cargo_manifest.get('message_reference')}")
print(f"  Vessel: {cargo_manifest.get('vessel_name')}")
print(f"  Loading Port: {cargo_manifest.get('loading_port')}")
print(f"  Discharge Port: {cargo_manifest.get('discharge_port')}")
print(f"  Cargoes: {len(cargo_manifest.get('cargoes', []))}")

# è½¬æ¢ä¸ºXML
xml_output = converter.convert_to_xml(edifact_iftmin, "IFTMIN")
print(f"\nXML Output:")
print(xml_output[:500])  # æ˜¾ç¤ºå‰500å­—ç¬¦

# å­˜å‚¨è´§ç‰©ä¿¡æ¯
for cargo in cargo_manifest.get("cargoes", []):
    cargo_data = {
        "cargo_id": f"CARGO_{cargo_manifest.get('message_reference')}_{len(cargo_manifest.get('cargoes', []))}",
        "cargo_name": cargo.get("cargo_name", ""),
        "cargo_type": "General",
        "shipper": "Unknown",
        "consignee": "Unknown",
        "weight": cargo.get("weight", 0),
        "status": "Booked",
        "loading_port": cargo_manifest.get("loading_port"),
        "loading_port_code": cargo_manifest.get("loading_port_code"),
        "discharge_port": cargo_manifest.get("discharge_port"),
        "discharge_port_code": cargo_manifest.get("discharge_port_code"),
        "vessel_id": "VESSEL001"
    }
    storage.store_cargo(cargo_data)
    print(f"\nStored cargo: {cargo_data['cargo_id']}")
```

---

## 6. æ¡ˆä¾‹5ï¼šæµ·è¿èˆªè¿æ•°æ®åˆ†æå’ŒæŠ¥è¡¨

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä½¿ç”¨PostgreSQLå­˜å‚¨æµ·è¿èˆªè¿æ•°æ®ï¼Œæ”¯æŒèˆ¹èˆ¶è¿½è¸ªã€è´§ç‰©æŸ¥è¯¢ã€
èˆªçº¿æ€§èƒ½åˆ†æå’Œèˆ¹èˆ¶åˆ©ç”¨ç‡ç»Ÿè®¡ã€‚

### 6.2 å®ç°ä»£ç 

è¯¦è§ `04_Transformation.md` ç¬¬7ç« ã€‚

### 6.3 æ•°æ®åˆ†æç¤ºä¾‹

**æµ·è¿èˆªè¿æ•°æ®åˆ†ææŸ¥è¯¢**ï¼š

```python
from maritime_storage import MaritimeStorage
from datetime import datetime, timedelta

storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")

# æŸ¥è¯¢è´§ç‰©çŠ¶æ€åˆ†å¸ƒ
status_dist = storage.get_cargo_status_distribution(days=30)
print("Cargo Status Distribution (30 days):")
for stat in status_dist:
    print(f"  {stat['status']}: {stat['count']} cargoes, "
          f"Weight: {stat['total_weight']:.2f} tons, "
          f"Value: ${stat['total_value']:,.2f}")

# æŸ¥è¯¢èˆ¹èˆ¶ä½ç½®ç»Ÿè®¡
position_stats = storage.get_vessel_position_statistics(
    "VESSEL001",
    datetime.now() - timedelta(days=1)
)
print(f"\nVessel Position Statistics (24h):")
print(f"  Position count: {position_stats['position_count']}")
print(f"  Avg speed: {position_stats['avg_speed']:.2f} knots")
print(f"  Speed range: {position_stats['min_speed']:.2f} - {position_stats['max_speed']:.2f} knots")

# æŸ¥è¯¢èˆªçº¿æ€§èƒ½
route_perf = storage.get_route_performance_statistics("VESSEL001", days=30)
print(f"\nRoute Performance (30 days):")
print(f"  Voyages: {route_perf['voyage_count']}")
print(f"  Avg duration: {route_perf['avg_duration_hours']:.2f} hours")
print(f"  Avg delay: {route_perf['avg_delay_hours']:.2f} hours")
print(f"  Avg fuel: {route_perf['avg_fuel_consumption']:.2f} tons")

# æŸ¥è¯¢èˆ¹èˆ¶åˆ©ç”¨ç‡
utilization = storage.get_vessel_utilization("VESSEL001", days=30)
print(f"\nVessel Utilization (30 days):")
print(f"  Utilization rate: {utilization['utilization_rate']:.2f}%")
print(f"  Total cargo weight: {utilization['total_cargo_weight']:.2f} tons")
```

---

## 7. æ¡ˆä¾‹6ï¼šèˆ¹èˆ¶å®æ—¶è¿½è¸ªï¼ˆAISé›†æˆï¼‰

### 7.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦å®æ—¶è¿½è¸ªèˆ¹èˆ¶ä½ç½®ï¼Œé€šè¿‡AISï¼ˆAutomatic Identification Systemï¼‰ç³»ç»Ÿæ¥æ”¶èˆ¹èˆ¶ä½ç½®æ•°æ®ï¼Œå®æ—¶æ›´æ–°èˆ¹èˆ¶çŠ¶æ€ï¼Œå¹¶é¢„æµ‹åˆ°è¾¾æ—¶é—´ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§£æAIS NMEAæ ¼å¼æ¶ˆæ¯
- éœ€è¦å®æ—¶å¤„ç†å¤§é‡AISæ•°æ®
- éœ€è¦è®¡ç®—èˆ¹èˆ¶é€Ÿåº¦å’Œèˆªå‘
- éœ€è¦é¢„æµ‹åˆ°è¾¾æ—¶é—´

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨AISMessageParserè§£æAISæ¶ˆæ¯ï¼Œä½¿ç”¨VesselPositionTrackerå®æ—¶æ›´æ–°èˆ¹èˆ¶ä½ç½®ï¼Œæ”¯æŒå¤šç§AISæ¶ˆæ¯ç±»å‹ã€‚

### 7.2 Schemaå®šä¹‰

**AISæ•°æ®Schema**ï¼š

```json
{
  "ais_message": "!AIVDM,1,1,,A,133m@ogP00PD;88MD5MTDww@2D7k,0*46",
  "message_type": 1,
  "message_type_name": "Position Report Class A",
  "mmsi": "563123456",
  "vessel_id": "VESSEL001",
  "position_data": {
    "latitude": 1.234567,
    "longitude": 103.456789,
    "course_over_ground": 45.5,
    "speed_over_ground": 18.5,
    "heading": 45,
    "navigation_status": 0
  },
  "timestamp": "2025-01-21T10:30:00Z"
}
```

### 7.3 å®ç°ä»£ç 

**å®Œæ•´çš„AISå®æ—¶è¿½è¸ªå®ç°**ï¼š

```python
import asyncio
import logging
from vessel_position_tracker import VesselPositionTracker, AISMessageParser
from maritime_storage import MaritimeStorage

logger = logging.getLogger(__name__)

async def real_time_ais_tracking():
    """å®æ—¶AISè¿½è¸ªç¤ºä¾‹"""
    storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")
    tracker = VesselPositionTracker(storage)

    # æ¨¡æ‹ŸAISæ¶ˆæ¯æµ
    ais_messages = [
        "!AIVDM,1,1,,A,133m@ogP00PD;88MD5MTDww@2D7k,0*46",
        "!AIVDM,1,1,,A,133m@ogP00PD;88MD5MTDww@2D7k,0*46",
        "!AIVDM,1,1,,A,133m@ogP00PD;88MD5MTDww@2D7k,0*46"
    ]

    print("Processing AIS messages...")
    for ais_msg in ais_messages:
        try:
            # å¤„ç†AISæ¶ˆæ¯
            tracker.process_ais_message(ais_msg)
            print(f"Processed AIS message: {ais_msg[:50]}...")
        except Exception as e:
            logger.error(f"Failed to process AIS message: {e}")

    # è·å–èˆ¹èˆ¶å½“å‰ä½ç½®
    vessel_id = "VESSEL001"
    current_pos = tracker.get_current_position(vessel_id)
    if current_pos:
        print(f"\nCurrent position for {vessel_id}:")
        print(f"  Latitude: {current_pos['latitude']}")
        print(f"  Longitude: {current_pos['longitude']}")
        print(f"  Speed: {current_pos.get('speed', 0)} knots")
        print(f"  Course: {current_pos.get('course', 0)} degrees")

    # ä¼°ç®—åˆ°è¾¾æ—¶é—´
    destination_lat = 1.300000
    destination_lon = 103.500000
    eta = tracker.estimate_arrival_time(vessel_id, destination_lat, destination_lon)
    if eta:
        print(f"\nEstimated arrival time: {eta}")

    # è·å–èˆ¹èˆ¶è½¨è¿¹
    track = tracker.get_vessel_track(vessel_id, hours=24)
    print(f"\nVessel track (24h): {len(track)} positions")

    # è·å–åŒºåŸŸå†…çš„èˆ¹èˆ¶
    vessels_in_area = tracker.get_vessels_in_area(
        min_lat=1.200000,
        max_lat=1.400000,
        min_lon=103.400000,
        max_lon=103.600000
    )
    print(f"\nVessels in area: {len(vessels_in_area)}")
    for vessel in vessels_in_area:
        print(f"  {vessel['vessel_name']}: {vessel['latitude']}, {vessel['longitude']}")

    storage.close()

if __name__ == "__main__":
    asyncio.run(real_time_ais_tracking())
```

---

## 8. æ¡ˆä¾‹7ï¼šè´§ç‰©å…¨ç¨‹è¿½è¸ªï¼ˆEDIFACTï¼‰

### 8.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦å…¨ç¨‹è¿½è¸ªè´§ç‰©çŠ¶æ€ï¼Œé€šè¿‡EDIFACTæ¶ˆæ¯ï¼ˆIFTMINã€IFTMCSã€IFTMANï¼‰ä¸åˆä½œä¼™ä¼´äº¤æ¢è´§ç‰©ä¿¡æ¯ï¼Œå®ç°è´§ç‰©ä»é¢„è®¢åˆ°äº¤ä»˜çš„å…¨ç¨‹è¿½è¸ªã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§£æå¤šç§EDIFACTæ¶ˆæ¯ç±»å‹
- éœ€è¦éªŒè¯æ¶ˆæ¯å®Œæ•´æ€§
- éœ€è¦å…³è”ä¸åŒæ¶ˆæ¯ä¸­çš„è´§ç‰©ä¿¡æ¯
- éœ€è¦ç”Ÿæˆè´§ç‰©è¿½è¸ªæŠ¥å‘Š

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨EDIFACTParserè§£æEDIFACTæ¶ˆæ¯ï¼Œä½¿ç”¨CargoTrackingSystemè¿½è¸ªè´§ç‰©çŠ¶æ€ï¼Œå®ç°è´§ç‰©å…¨ç¨‹è¿½è¸ªã€‚

### 8.2 Schemaå®šä¹‰

**è´§ç‰©å…¨ç¨‹è¿½è¸ªSchema**ï¼š

```json
{
  "cargo_id": "CARGO20250121001",
  "tracking_events": [
    {
      "event_type": "Booked",
      "event_time": "2025-01-15T10:00:00Z",
      "event_location": "Shanghai",
      "source_message": "IFTMIN",
      "message_reference": "MSG001"
    },
    {
      "event_type": "Loaded",
      "event_time": "2025-01-18T14:00:00Z",
      "event_location": "Shanghai Port",
      "source_message": "IFTMCS",
      "message_reference": "MSG002"
    },
    {
      "event_type": "Arrived",
      "event_time": "2025-01-22T08:00:00Z",
      "event_location": "Singapore Port",
      "source_message": "IFTMAN",
      "message_reference": "MSG003"
    }
  ]
}
```

### 8.3 å®ç°ä»£ç 

**å®Œæ•´çš„è´§ç‰©å…¨ç¨‹è¿½è¸ªå®ç°**ï¼š

```python
from edifact_parser import EDIFACTParser
from cargo_tracking_system import CargoTrackingSystem
from maritime_storage import MaritimeStorage

def cargo_full_tracking():
    """è´§ç‰©å…¨ç¨‹è¿½è¸ªç¤ºä¾‹"""
    storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")
    parser = EDIFACTParser()
    tracking_system = CargoTrackingSystem(storage)

    # 1. æ¥æ”¶IFTMINæ¶ˆæ¯ï¼ˆè´§ç‰©æ¸…å•ï¼‰
    iftmin_message = """UNH+1+IFTMIN:D:96A:UN'
BGM+270+MSG001+9'
DTM+137:20250115:102'
TDT+20+1+13+MV OCEAN STAR::172'
LOC+5+CNSHA:172:6+Shanghai'
LOC+8+SGSIN:172:6+Singapore'
GID+1+Electronics'
MEA+WT+20000:KGM'
UNT+8+1'"""

    segments = parser.parse_message(iftmin_message)
    cargo_manifest = parser.parse_iftmin(segments)

    cargo_id = "CARGO20250121001"

    # è®°å½•é¢„è®¢äº‹ä»¶
    tracking_system.track_cargo_event(
        cargo_id,
        "Booked",
        cargo_manifest.get("loading_port", "Unknown"),
        f"From EDIFACT message: {cargo_manifest.get('message_reference')}"
    )

    # 2. æ¥æ”¶IFTMCSæ¶ˆæ¯ï¼ˆè´§ç‰©çŠ¶æ€æ›´æ–°ï¼‰
    iftmcs_message = """UNH+1+IFTMCS:D:96A:UN'
BGM+270+MSG002+9'
RFF+BM:CARGO20250121001'
DTM+137:20250118:102'
LOC+11+Shanghai Port'
STS+1+Loaded'
UNT+5+1'"""

    segments = parser.parse_message(iftmcs_message)
    cargo_status = parser.parse_iftmcs(segments)

    # è®°å½•çŠ¶æ€æ›´æ–°
    for update in cargo_status.get("status_updates", []):
        tracking_system.track_cargo_event(
            update.get("cargo_id", cargo_id),
            update.get("status", "Unknown"),
            update.get("event_location", "Unknown"),
            f"From EDIFACT message: {cargo_status.get('message_reference')}"
        )

    # 3. æ¥æ”¶IFTMANæ¶ˆæ¯ï¼ˆåˆ°è¾¾é€šçŸ¥ï¼‰
    iftman_message = """UNH+1+IFTMAN:D:96A:UN'
BGM+270+MSG003+9'
TDT+20+1+13+MV OCEAN STAR::172'
LOC+8+SGSIN:172:6+Singapore'
DTM+132:20250122:102'
DTM+133:20250122:102'
UNT+6+1'"""

    segments = parser.parse_message(iftman_message)
    arrival_notice = parser.parse_iftman(segments)

    # è®°å½•åˆ°è¾¾äº‹ä»¶
    arrival_info = arrival_notice.get("arrival_info", {})
    tracking_system.track_cargo_event(
        cargo_id,
        "Arrived",
        arrival_info.get("port_name", "Unknown"),
        f"From EDIFACT message: {arrival_notice.get('message_reference')}"
    )

    # è·å–è´§ç‰©è¿½è¸ªå†å²
    history = tracking_system.get_cargo_tracking_history(cargo_id)
    print(f"\nCargo Tracking History for {cargo_id}:")
    for event in history:
        print(f"  {event['event_time']}: {event['event_type']} at {event['event_location']}")

    # è·å–å½“å‰çŠ¶æ€
    current_status = tracking_system.get_cargo_current_status(cargo_id)
    if current_status:
        print(f"\nCurrent Status:")
        print(f"  Status: {current_status['status']}")
        print(f"  Location: {current_status['current_location']}")
        print(f"  Last Update: {current_status['last_update']}")

    storage.close()

if __name__ == "__main__":
    cargo_full_tracking()
```

---

## 9. æ¡ˆä¾‹8ï¼šèˆªçº¿ä¼˜åŒ–ï¼ˆæˆæœ¬+æ—¶é—´ï¼‰

### 9.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦åœ¨æˆæœ¬å’Œæ—¶é—´ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ï¼Œä¼˜åŒ–èˆªçº¿è§„åˆ’ã€‚éœ€è¦è€ƒè™‘ç‡ƒæ²¹æˆæœ¬ã€æ¸¯å£æˆæœ¬ã€èˆªè¡Œæ—¶é—´ã€å¤©æ°”å› ç´ ç­‰å¤šä¸ªå› ç´ ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è®¡ç®—æœ€çŸ­è·¯å¾„
- éœ€è¦ä¼˜åŒ–ç‡ƒæ²¹æˆæœ¬
- éœ€è¦ä¼˜åŒ–èˆªè¡Œæ—¶é—´
- éœ€è¦è€ƒè™‘å¤©æ°”å› ç´ 
- éœ€è¦å¤šç›®æ ‡ä¼˜åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨RouteOptimizerå®ç°èˆªçº¿ä¼˜åŒ–ï¼Œæ”¯æŒæœ€çŸ­è·¯å¾„ã€æˆæœ¬ä¼˜åŒ–ã€æ—¶é—´ä¼˜åŒ–å’Œå¤šç›®æ ‡ä¼˜åŒ–ã€‚

### 9.2 Schemaå®šä¹‰

**èˆªçº¿ä¼˜åŒ–Schema**ï¼š

```json
{
  "optimization_id": "OPT001",
  "route_id": "ROUTE20250121001",
  "optimization_type": "multi_objective",
  "origin": {
    "latitude": 31.230416,
    "longitude": 121.473701,
    "port_code": "CNSHA",
    "port_name": "Shanghai"
  },
  "destination": {
    "latitude": 1.289670,
    "longitude": 103.850070,
    "port_code": "SGSIN",
    "port_name": "Singapore"
  },
  "optimization_parameters": {
    "weights": {
      "cost": 0.6,
      "time": 0.4
    },
    "fuel_price_per_ton": 500.0,
    "max_speed": 20.0,
    "weather_data": {
      "wind_speed": 15,
      "wind_direction": 90
    }
  },
  "optimization_result": {
    "total_distance": 1500.0,
    "estimated_hours": 75.0,
    "fuel_consumption": 75.0,
    "total_cost": 37500.0,
    "recommended_speed": 18.5
  }
}
```

### 9.3 å®ç°ä»£ç 

**å®Œæ•´çš„èˆªçº¿ä¼˜åŒ–å®ç°**ï¼š

```python
from route_optimizer import RouteOptimizer
from vessel_position_tracker import VesselPositionTracker
from maritime_storage import MaritimeStorage

def route_optimization_example():
    """èˆªçº¿ä¼˜åŒ–ç¤ºä¾‹"""
    storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")
    tracker = VesselPositionTracker(storage)
    optimizer = RouteOptimizer(storage, tracker)

    vessel_id = "VESSEL001"
    origin_lat, origin_lon = 31.230416, 121.473701  # Shanghai
    dest_lat, dest_lon = 1.289670, 103.850070  # Singapore

    # 1. æœ€çŸ­è·¯å¾„ä¼˜åŒ–
    print("1. Shortest Path Optimization:")
    shortest_result = optimizer.optimize_route_shortest_path(
        origin_lat, origin_lon, dest_lat, dest_lon
    )
    print(f"  Total distance: {shortest_result['total_distance']:.2f} nautical miles")
    print(f"  Route segments: {len(shortest_result['route_segments'])}")

    # 2. æˆæœ¬ä¼˜åŒ–
    print("\n2. Cost Optimization:")
    cost_result = optimizer.optimize_route_cost(
        origin_lat, origin_lon, dest_lat, dest_lon,
        vessel_id,
        fuel_price_per_ton=500.0,
        port_costs={"loading": 5000, "discharge": 5000}
    )
    print(f"  Total distance: {cost_result['total_distance']:.2f} nautical miles")
    print(f"  Fuel consumption: {cost_result['fuel_consumption']:.2f} tons")
    print(f"  Fuel cost: ${cost_result['fuel_cost']:,.2f}")
    print(f"  Port cost: ${cost_result['port_cost']:,.2f}")
    print(f"  Total cost: ${cost_result['total_cost']:,.2f}")
    print(f"  Estimated hours: {cost_result['estimated_hours']:.2f}")

    # 3. æ—¶é—´ä¼˜åŒ–
    print("\n3. Time Optimization:")
    time_result = optimizer.optimize_route_time(
        origin_lat, origin_lon, dest_lat, dest_lon,
        vessel_id,
        max_speed=20.0,
        weather_data={"wind_speed": 15, "wind_direction": 90}
    )
    print(f"  Total distance: {time_result['total_distance']:.2f} nautical miles")
    print(f"  Max speed: {time_result['max_speed']:.2f} knots")
    print(f"  Effective speed: {time_result['effective_speed']:.2f} knots")
    print(f"  Estimated hours: {time_result['estimated_hours']:.2f}")
    print(f"  Weather impact: {time_result['weather_impact']}")

    # 4. å¤šç›®æ ‡ä¼˜åŒ–
    print("\n4. Multi-Objective Optimization:")
    multi_result = optimizer.optimize_route_multi_objective(
        origin_lat, origin_lon, dest_lat, dest_lon,
        vessel_id,
        weights={"cost": 0.6, "time": 0.4}
    )
    print(f"  Combined score: {multi_result['combined_score']:.4f}")
    print(f"  Recommended speed: {multi_result['recommended_speed']:.2f} knots")
    print(f"  Estimated cost: ${multi_result['estimated_cost']:,.2f}")
    print(f"  Estimated hours: {multi_result['estimated_hours']:.2f}")

    # 5. å¯»æ‰¾æœ€ä¼˜ä¸­é—´æ¸¯å£
    print("\n5. Optimal Waypoints:")
    available_ports = [
        {"port_code": "CNXMN", "port_name": "Xiamen", "latitude": 24.479834, "longitude": 118.081871},
        {"port_code": "CNFOC", "port_name": "Fuzhou", "latitude": 26.074508, "longitude": 119.296494},
        {"port_code": "MYTPP", "port_name": "Port Klang", "latitude": 3.000000, "longitude": 101.400000}
    ]

    optimal_waypoints = optimizer.find_optimal_waypoints(
        origin_lat, origin_lon, dest_lat, dest_lon, available_ports
    )
    print(f"  Optimal waypoints: {len(optimal_waypoints)}")
    for wp in optimal_waypoints:
        print(f"    {wp['port_name']} ({wp['port_code']})")

    # å­˜å‚¨ä¼˜åŒ–ç»“æœ
    optimization_data = {
        "optimization_id": "OPT001",
        "route_id": "ROUTE20250121001",
        "optimization_type": "multi_objective",
        "origin_latitude": origin_lat,
        "origin_longitude": origin_lon,
        "destination_latitude": dest_lat,
        "destination_longitude": dest_lon,
        "total_distance": multi_result["total_distance"],
        "estimated_hours": multi_result["estimated_hours"],
        "fuel_consumption": multi_result["cost_optimization"]["fuel_consumption"],
        "fuel_cost": multi_result["estimated_cost"],
        "total_cost": multi_result["estimated_cost"],
        "recommended_speed": multi_result["recommended_speed"],
        "waypoints": optimal_waypoints,
        "optimization_parameters": {"weights": {"cost": 0.6, "time": 0.4}}
    }

    storage.store_route_optimization(optimization_data)
    print(f"\nStored optimization result: OPT001")

    storage.close()

if __name__ == "__main__":
    route_optimization_example()
```

---

## 10. æ¡ˆä¾‹9ï¼šæ¸¯å£æ•ˆç‡åˆ†æ

### 10.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦åˆ†ææ¸¯å£æ•ˆç‡ï¼Œäº†è§£å„æ¸¯å£çš„å¹³å‡åœé æ—¶é—´ã€è´§ç‰©å¤„ç†é€Ÿåº¦ã€ç­‰å¾…æ—¶é—´ç­‰æŒ‡æ ‡ï¼Œä»¥ä¾¿é€‰æ‹©æœ€ä¼˜æ¸¯å£å’Œä¼˜åŒ–æ¸¯å£æ“ä½œã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦æ”¶é›†æ¸¯å£æ“ä½œæ•°æ®
- éœ€è¦è®¡ç®—æ¸¯å£æ•ˆç‡æŒ‡æ ‡
- éœ€è¦æ¯”è¾ƒä¸åŒæ¸¯å£çš„æ•ˆç‡
- éœ€è¦è¯†åˆ«æ•ˆç‡ç“¶é¢ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨æ¸¯å£æ•ˆç‡è¡¨å’Œæ¸¯å£æ“ä½œè®°å½•è¡¨å­˜å‚¨æ•°æ®ï¼Œå®ç°æ¸¯å£æ•ˆç‡åˆ†æå’Œæ¯”è¾ƒã€‚

### 10.2 å®ç°ä»£ç 

**å®Œæ•´çš„æ¸¯å£æ•ˆç‡åˆ†æå®ç°**ï¼š

```python
from maritime_storage import MaritimeStorage
from datetime import datetime, timedelta

def port_efficiency_analysis():
    """æ¸¯å£æ•ˆç‡åˆ†æç¤ºä¾‹"""
    storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")

    # è®°å½•æ¸¯å£æ“ä½œ
    operations = [
        {
            "operation_id": "OP001",
            "port_code": "CNSHA",
            "vessel_id": "VESSEL001",
            "operation_type": "Loading",
            "operation_start": datetime(2025, 1, 18, 8, 0, 0),
            "operation_end": datetime(2025, 1, 18, 20, 0, 0),
            "duration_hours": 12.0,
            "cargo_tonnage": 20000.0,
            "berth_number": "Berth 5",
            "crane_count": 3,
            "efficiency_rating": 0.85
        },
        {
            "operation_id": "OP002",
            "port_code": "SGSIN",
            "vessel_id": "VESSEL001",
            "operation_type": "Discharge",
            "operation_start": datetime(2025, 1, 22, 8, 0, 0),
            "operation_end": datetime(2025, 1, 22, 18, 0, 0),
            "duration_hours": 10.0,
            "cargo_tonnage": 20000.0,
            "berth_number": "Berth 12",
            "crane_count": 4,
            "efficiency_rating": 0.90
        }
    ]

    for op in operations:
        storage.store_port_operation(op)
        print(f"Stored operation: {op['operation_id']} at {op['port_code']}")

    # æ›´æ–°æ¸¯å£æ•ˆç‡æ•°æ®
    port_efficiency_data = {
        "port_code": "CNSHA",
        "port_name": "Shanghai",
        "country_code": "CN",
        "latitude": 31.230416,
        "longitude": 121.473701,
        "average_berth_time_hours": 12.5,
        "average_cargo_handling_rate": 1666.67,  # å¨/å°æ—¶
        "average_waiting_time_hours": 2.0,
        "total_vessels": 100,
        "total_cargo_tonnage": 2000000.0,
        "efficiency_score": 0.85
    }
    storage.store_port_efficiency(port_efficiency_data)

    port_efficiency_data_sg = {
        "port_code": "SGSIN",
        "port_name": "Singapore",
        "country_code": "SG",
        "latitude": 1.289670,
        "longitude": 103.850070,
        "average_berth_time_hours": 10.0,
        "average_cargo_handling_rate": 2000.0,  # å¨/å°æ—¶
        "average_waiting_time_hours": 1.5,
        "total_vessels": 150,
        "total_cargo_tonnage": 3000000.0,
        "efficiency_score": 0.90
    }
    storage.store_port_efficiency(port_efficiency_data_sg)

    # è·å–æ¸¯å£æ•ˆç‡ç»Ÿè®¡
    print("\nPort Efficiency Statistics:")
    efficiency_stats = storage.get_port_efficiency_statistics()
    for stat in efficiency_stats:
        print(f"\n{stat['port_name']} ({stat['port_code']}):")
        print(f"  Average berth time: {stat['average_berth_time_hours']:.2f} hours")
        print(f"  Cargo handling rate: {stat['average_cargo_handling_rate']:.2f} tons/hour")
        print(f"  Average waiting time: {stat['average_waiting_time_hours']:.2f} hours")
        print(f"  Efficiency score: {stat['efficiency_score']:.2f}")
        print(f"  Total vessels: {stat['total_vessels']}")
        print(f"  Total cargo: {stat['total_cargo_tonnage']:,.2f} tons")

    # æ¯”è¾ƒæ¸¯å£æ•ˆç‡
    print("\nPort Efficiency Comparison:")
    if len(efficiency_stats) >= 2:
        port1 = efficiency_stats[0]
        port2 = efficiency_stats[1]

        print(f"\n{port1['port_name']} vs {port2['port_name']}:")
        print(f"  Berth time difference: {abs(port1['average_berth_time_hours'] - port2['average_berth_time_hours']):.2f} hours")
        print(f"  Handling rate difference: {abs(port1['average_cargo_handling_rate'] - port2['average_cargo_handling_rate']):.2f} tons/hour")
        print(f"  Efficiency score difference: {abs(port1['efficiency_score'] - port2['efficiency_score']):.2f}")

        if port1['efficiency_score'] > port2['efficiency_score']:
            print(f"  {port1['port_name']} is more efficient")
        else:
            print(f"  {port2['port_name']} is more efficient")

    storage.close()

if __name__ == "__main__":
    port_efficiency_analysis()
```

---

## 11. æ¡ˆä¾‹10ï¼šå¼‚å¸¸äº‹ä»¶å¤„ç†

### 11.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
èˆªè¿å…¬å¸éœ€è¦ç›‘æ§å’Œå¤„ç†å¼‚å¸¸äº‹ä»¶ï¼Œå¦‚èˆ¹èˆ¶æ•…éšœã€è´§ç‰©æŸåã€èˆªçº¿å»¶è¯¯ã€å¤©æ°”å¼‚å¸¸ç­‰ã€‚éœ€è¦åŠæ—¶è®°å½•ã€åˆ†æå’Œå¤„ç†è¿™äº›äº‹ä»¶ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®æ—¶ç›‘æ§å¼‚å¸¸äº‹ä»¶
- éœ€è¦åˆ†ç±»å’Œåˆ†çº§äº‹ä»¶
- éœ€è¦è®°å½•äº‹ä»¶å¤„ç†è¿‡ç¨‹
- éœ€è¦ç”Ÿæˆäº‹ä»¶æŠ¥å‘Š

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨å¼‚å¸¸äº‹ä»¶è¡¨å­˜å‚¨äº‹ä»¶æ•°æ®ï¼Œå®ç°äº‹ä»¶åˆ†ç±»ã€åˆ†çº§ã€è¿½è¸ªå’Œå¤„ç†åŠŸèƒ½ã€‚

### 11.2 Schemaå®šä¹‰

**å¼‚å¸¸äº‹ä»¶Schema**ï¼š

```json
{
  "event_id": "EVT001",
  "event_type": "VesselBreakdown",
  "event_severity": "High",
  "vessel_id": "VESSEL001",
  "route_id": "ROUTE20250121001",
  "cargo_id": "CARGO20250121001",
  "event_location": {
    "latitude": 1.250000,
    "longitude": 103.500000
  },
  "event_description": "Engine failure, vessel stopped",
  "event_time": "2025-01-21T14:30:00Z",
  "resolved_time": "2025-01-21T18:00:00Z",
  "resolution_description": "Engine repaired, vessel resumed voyage"
}
```

### 11.3 å®ç°ä»£ç 

**å®Œæ•´çš„å¼‚å¸¸äº‹ä»¶å¤„ç†å®ç°**ï¼š

```python
from maritime_storage import MaritimeStorage
from datetime import datetime

def maritime_event_handling():
    """å¼‚å¸¸äº‹ä»¶å¤„ç†ç¤ºä¾‹"""
    storage = MaritimeStorage("postgresql://user:pass@localhost/maritime")

    # è®°å½•å¼‚å¸¸äº‹ä»¶
    events = [
        {
            "event_id": "EVT001",
            "event_type": "VesselBreakdown",
            "event_severity": "High",
            "vessel_id": "VESSEL001",
            "route_id": "ROUTE20250121001",
            "cargo_id": None,
            "event_location_latitude": 1.250000,
            "event_location_longitude": 103.500000,
            "event_description": "Engine failure, vessel stopped",
            "event_time": datetime(2025, 1, 21, 14, 30, 0),
            "resolved_time": datetime(2025, 1, 21, 18, 0, 0),
            "resolution_description": "Engine repaired, vessel resumed voyage"
        },
        {
            "event_id": "EVT002",
            "event_type": "CargoDamage",
            "event_severity": "Medium",
            "vessel_id": "VESSEL001",
            "route_id": "ROUTE20250121001",
            "cargo_id": "CARGO20250121001",
            "event_location_latitude": None,
            "event_location_longitude": None,
            "event_description": "Container damaged during loading",
            "event_time": datetime(2025, 1, 18, 10, 0, 0),
            "resolved_time": datetime(2025, 1, 18, 12, 0, 0),
            "resolution_description": "Container replaced, cargo reloaded"
        },
        {
            "event_id": "EVT003",
            "event_type": "WeatherDelay",
            "event_severity": "Low",
            "vessel_id": "VESSEL001",
            "route_id": "ROUTE20250121001",
            "cargo_id": None,
            "event_location_latitude": 1.300000,
            "event_location_longitude": 103.600000,
            "event_description": "Heavy weather, vessel slowed down",
            "event_time": datetime(2025, 1, 21, 8, 0, 0),
            "resolved_time": datetime(2025, 1, 21, 12, 0, 0),
            "resolution_description": "Weather cleared, normal speed resumed"
        }
    ]

    for event in events:
        storage.store_maritime_event(event)
        print(f"Stored event: {event['event_id']} - {event['event_type']}")

    # æŸ¥è¯¢äº‹ä»¶
    print("\nAll Events:")
    all_events = storage.get_maritime_events(limit=10)
    for event in all_events:
        print(f"  {event['event_id']}: {event['event_type']} ({event['event_severity']}) at {event['event_time']}")

    # æŸ¥è¯¢ç‰¹å®šèˆ¹èˆ¶çš„äº‹ä»¶
    print("\nEvents for VESSEL001:")
    vessel_events = storage.get_maritime_events(vessel_id="VESSEL001")
    for event in vessel_events:
        print(f"  {event['event_type']}: {event['event_description']}")
        if event['resolved_time']:
            duration = (event['resolved_time'] - event['event_time']).total_seconds() / 3600
            print(f"    Resolved in {duration:.2f} hours")

    # æŸ¥è¯¢é«˜ä¸¥é‡æ€§äº‹ä»¶
    print("\nHigh Severity Events:")
    high_severity_events = storage.get_maritime_events(severity="High")
    for event in high_severity_events:
        print(f"  {event['event_id']}: {event['event_type']} - {event['event_description']}")

    # æŸ¥è¯¢æœªè§£å†³çš„äº‹ä»¶
    print("\nUnresolved Events:")
    unresolved_events = [
        e for e in all_events if e['resolved_time'] is None
    ]
    for event in unresolved_events:
        print(f"  {event['event_id']}: {event['event_type']} - {event['event_description']}")

    # äº‹ä»¶ç»Ÿè®¡
    print("\nEvent Statistics:")
    event_types = {}
    for event in all_events:
        event_type = event['event_type']
        event_types[event_type] = event_types.get(event_type, 0) + 1

    for event_type, count in event_types.items():
        print(f"  {event_type}: {count} events")

    storage.close()

if __name__ == "__main__":
    maritime_event_handling()
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
