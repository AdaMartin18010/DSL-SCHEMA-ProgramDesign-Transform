# åŒ»ç–—ä¿¡æ¯ç³»ç»ŸSchemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [åŒ»ç–—ä¿¡æ¯ç³»ç»ŸSchemaå®è·µæ¡ˆä¾‹](#åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿschemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šMediCoreç»¼åˆåŒ»é™¢æ•°å­—åŒ–å‡çº§](#2-æ¡ˆä¾‹1medicoreç»¼åˆåŒ»é™¢æ•°å­—åŒ–å‡çº§)
    - [2.1 ä¼ä¸šèƒŒæ™¯](#21-ä¼ä¸šèƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 Schemaå®šä¹‰](#25-schemaå®šä¹‰)
    - [2.6 å®Œæ•´å®ç°ä»£ç ](#26-å®Œæ•´å®ç°ä»£ç )
    - [2.7 æ•ˆæœè¯„ä¼°](#27-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šä¸´åºŠæ•°æ®è®°å½•](#3-æ¡ˆä¾‹2ä¸´åºŠæ•°æ®è®°å½•)
  - [4. æ¡ˆä¾‹3ï¼šè¯Šæ–­è®°å½•ç®¡ç†](#4-æ¡ˆä¾‹3è¯Šæ–­è®°å½•ç®¡ç†)
  - [5. æ¡ˆä¾‹4ï¼šFHIRåˆ°HL7è½¬æ¢](#5-æ¡ˆä¾‹4fhiråˆ°hl7è½¬æ¢)
  - [6. æ¡ˆä¾‹5ï¼šåŒ»ç–—æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5åŒ»ç–—æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›åŒ»ç–—ä¿¡æ¯ç³»ç»ŸSchemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–æ‚£è€…ç®¡ç†ã€ä¸´åºŠæ•°æ®ã€è¯Šæ–­è®°å½•ç­‰æ ¸å¿ƒåœºæ™¯ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šMediCoreç»¼åˆåŒ»é™¢æ•°å­—åŒ–å‡çº§

### 2.1 ä¼ä¸šèƒŒæ™¯

**MediCoreç»¼åˆåŒ»é™¢**æ˜¯åŒºåŸŸæ€§ä¸‰çº§ç”²ç­‰åŒ»é™¢ï¼Œæ‹¥æœ‰2,800å¼ åºŠä½ï¼Œå¹´é—¨è¯Šé‡450ä¸‡äººæ¬¡ï¼Œå¹´ä½é™¢é‡18ä¸‡äººæ¬¡ï¼Œæ˜¯åŒºåŸŸåŒ»ç–—ä¸­å¿ƒã€‚

- **æˆç«‹æ—¶é—´**ï¼š1952å¹´
- **å‘˜å·¥è§„æ¨¡**ï¼š5,200äººï¼ˆåŒ»ç”Ÿ850äººï¼ŒæŠ¤å£«2,100äººï¼‰
- **ç§‘å®¤æ•°é‡**ï¼š48ä¸ªä¸´åºŠç§‘å®¤ï¼Œ22ä¸ªåŒ»æŠ€ç§‘å®¤
- **å¹´åŒ»ç–—æ”¶å…¥**ï¼š45äº¿å…ƒäººæ°‘å¸
- **åŸç³»ç»Ÿ**ï¼šHISã€LISã€PACSã€EMRç­‰ç³»ç»Ÿç‹¬ç«‹è¿è¡Œï¼Œæ•°æ®å­¤å²›ä¸¥é‡

### 2.2 ä¸šåŠ¡ç—›ç‚¹

| åºå· | ç—›ç‚¹ | å½±å“ç¨‹åº¦ | ä¸šåŠ¡å½±å“ |
|------|------|----------|----------|
| 1 | **ä¿¡æ¯å­¤å²›** | ä¸¥é‡ | å„ç³»ç»Ÿæ•°æ®ä¸äº’é€šï¼ŒåŒ»ç”Ÿéœ€ç™»å½•5+ç³»ç»ŸæŸ¥çœ‹æ‚£è€…ä¿¡æ¯ |
| 2 | **ç—…å†ä¹¦å†™æ•ˆç‡ä½** | é«˜ | åŒ»ç”Ÿæ—¥å‡ä¹¦å†™ç—…å†3.5å°æ—¶ï¼Œå å·¥ä½œæ—¶é—´35% |
| 3 | **è¯å“ç®¡ç†æ··ä¹±** | é«˜ | è¯å“åº“å­˜å‘¨è½¬æ…¢ï¼Œè¿‡æœŸæŸè€—å¹´è¾¾200ä¸‡å…ƒ |
| 4 | **æ£€æŸ¥é¢„çº¦æ’é˜Ÿé•¿** | ä¸­ | MRI/CTå¹³å‡é¢„çº¦ç­‰å¾…7å¤©ï¼Œæ‚£è€…æ»¡æ„åº¦ä½ |
| 5 | **åŒ»ä¿ç»“ç®—æ…¢** | ä¸­ | åŒ»ä¿ç»“ç®—å¹³å‡è€—æ—¶15åˆ†é’Ÿ/äººæ¬¡ï¼Œçª—å£å‹åŠ›å¤§ |

### 2.3 ä¸šåŠ¡ç›®æ ‡

| åºå· | ç›®æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | æ—¶é—´æ¡†æ¶ |
|------|------|--------|--------|----------|
| 1 | ç³»ç»Ÿé›†æˆè¦†ç›–ç‡ | 30% | 95% | 18ä¸ªæœˆ |
| 2 | ç—…å†ä¹¦å†™æ—¶é—´å æ¯” | 35% | <15% | 12ä¸ªæœˆ |
| 3 | è¯å“è¿‡æœŸæŸè€— | 200ä¸‡å…ƒ/å¹´ | <50ä¸‡å…ƒ/å¹´ | 9ä¸ªæœˆ |
| 4 | æ£€æŸ¥é¢„çº¦ç­‰å¾… | 7å¤© | <3å¤© | 12ä¸ªæœˆ |
| 5 | åŒ»ä¿ç»“ç®—æ—¶é—´ | 15åˆ†é’Ÿ | <3åˆ†é’Ÿ | 9ä¸ªæœˆ |

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. **å¤šå‚å•†ç³»ç»Ÿé›†æˆ**ï¼šéœ€æ•´åˆ15+å‚å•†çš„å¼‚æ„ç³»ç»Ÿï¼Œæ¥å£æ ‡å‡†ä¸ä¸€

2. **æ•°æ®æ ‡å‡†ç»Ÿä¸€**ï¼šéœ€å»ºç«‹ç»Ÿä¸€çš„æ•°æ®å­—å…¸ï¼Œè§„èŒƒ18ä¸‡+æ¡ä¸´åºŠæœ¯è¯­

3. **å®æ—¶æ•°æ®åŒæ­¥**ï¼šæ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿéœ€ä¿è¯ç§’çº§æ•°æ®åŒæ­¥

4. **é«˜å¯ç”¨æ€§è¦æ±‚**ï¼šHISç³»ç»Ÿéœ€ä¿è¯99.99%å¯ç”¨æ€§

5. **åˆè§„æ€§è¦æ±‚**ï¼šéœ€æ»¡è¶³ç”µå­ç—…å†è¯„çº§ã€äº’è”äº’é€šè¯„çº§è¦æ±‚

### 2.5 Schemaå®šä¹‰

**æ‚£è€…ä¿¡æ¯Schema**ï¼š

```dsl
schema PatientInfo {
  patient_id: String @value("P1234567890") @required

  basic_info: {
    name: String @value("å¼ ä¸‰")
    gender: Enum { M, F } @value(M)
    birth_date: Date @value("1980-05-15") @format("YYYY-MM-DD")
    id_number: String @value("110101198005151234") @length(18)
    marital_status: Enum { Single, Married, Divorced, Widowed }
    nationality: String @value("CN")
  } @required

  contact_info: {
    phone: String @value("13800138000")
    address: String @value("åŒ—äº¬å¸‚æœé˜³åŒºXXè¡—é“XXå·")
    emergency_contact: {
      name: String @value("æå››")
      phone: String @value("13900139000")
      relationship: String @value("é…å¶")
    }
  }

  medical_info: {
    blood_type: Enum { A, B, AB, O } @value(A)
    rh_factor: Enum { Positive, Negative } @value(Positive)
    allergies: List[String] @value(["é’éœ‰ç´ ", "ç£ºèƒº"])
    chronic_diseases: List[String] @value(["é«˜è¡€å‹"])
  }

  insurance_info: {
    insurance_type: Enum { Public, Commercial, SelfPay } @value(Public)
    insurance_number: String @value("BJ123456789")
    insurance_provider: String @value("åŒ—äº¬å¸‚åŒ»ä¿")
  }
} @standard("HL7_FHIR_R4")
```

### 2.6 å®Œæ•´å®ç°ä»£ç 

```python
"""
MediCoreç»¼åˆåŒ»é™¢åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿ
é›†æˆæ‚£è€…ç®¡ç†ã€ä¸´åºŠæ•°æ®ã€è¯å“ç®¡ç†ã€é¢„çº¦ç³»ç»Ÿç­‰æ¨¡å—
"""

import json
import uuid
from dataclasses import dataclass, field
from datetime import datetime, date, timedelta
from decimal import Decimal
from enum import Enum
from typing import Optional, List, Dict, Any, Tuple
from collections import defaultdict


class Gender(Enum):
    """æ€§åˆ«"""
    MALE = "M"
    FEMALE = "F"
    UNKNOWN = "U"


class BloodType(Enum):
    """è¡€å‹"""
    A = "A"
    B = "B"
    AB = "AB"
    O = "O"
    UNKNOWN = "Unknown"


class PatientStatus(Enum):
    """æ‚£è€…çŠ¶æ€"""
    ACTIVE = "active"
    INACTIVE = "inactive"
    DECEASED = "deceased"


class AppointmentStatus(Enum):
    """é¢„çº¦çŠ¶æ€"""
    PENDING = "pending"
    CONFIRMED = "confirmed"
    CHECKED_IN = "checked-in"
    COMPLETED = "completed"
    CANCELLED = "cancelled"
    NO_SHOW = "no-show"


@dataclass
class Patient:
    """æ‚£è€…ä¿¡æ¯"""
    patient_id: str
    name: str
    gender: Gender
    birth_date: date
    id_number: str
    phone: str = ""
    address: str = ""
    blood_type: BloodType = BloodType.UNKNOWN
    rh_factor: str = "Positive"
    allergies: List[str] = field(default_factory=list)
    chronic_diseases: List[str] = field(default_factory=list)
    emergency_contact_name: str = ""
    emergency_contact_phone: str = ""
    insurance_type: str = "Public"
    insurance_number: str = ""
    created_at: datetime = field(default_factory=datetime.now)
    status: PatientStatus = PatientStatus.ACTIVE
    
    def __post_init__(self):
        if isinstance(self.birth_date, str):
            self.birth_date = date.fromisoformat(self.birth_date)
    
    def calculate_age(self) -> int:
        """è®¡ç®—å¹´é¾„"""
        today = date.today()
        return today.year - self.birth_date.year - (
            (today.month, today.day) < (self.birth_date.month, self.birth_date.day)
        )
    
    def get_age_group(self) -> str:
        """è·å–å¹´é¾„ç»„"""
        age = self.calculate_age()
        if age < 1:
            return "å©´å„¿"
        elif age < 6:
            return "å¹¼å„¿"
        elif age < 18:
            return "å„¿ç«¥"
        elif age < 60:
            return "æˆäºº"
        else:
            return "è€å¹´äºº"
    
    def to_dict(self) -> Dict[str, Any]:
        """è½¬æ¢ä¸ºå­—å…¸"""
        return {
            "patient_id": self.patient_id,
            "name": self.name,
            "gender": self.gender.value,
            "birth_date": self.birth_date.isoformat(),
            "age": self.calculate_age(),
            "age_group": self.get_age_group(),
            "id_number": self.id_number,
            "phone": self.phone,
            "address": self.address,
            "blood_type": self.blood_type.value,
            "rh_factor": self.rh_factor,
            "allergies": self.allergies,
            "chronic_diseases": self.chronic_diseases,
            "emergency_contact": {
                "name": self.emergency_contact_name,
                "phone": self.emergency_contact_phone
            },
            "insurance": {
                "type": self.insurance_type,
                "number": self.insurance_number
            },
            "status": self.status.value
        }


@dataclass
class VitalSigns:
    """ç”Ÿå‘½ä½“å¾"""
    temperature: Optional[float] = None  # æ‘„æ°åº¦
    heart_rate: Optional[int] = None  # æ¬¡/åˆ†é’Ÿ
    systolic_bp: Optional[int] = None  # æ”¶ç¼©å‹ mmHg
    diastolic_bp: Optional[int] = None  # èˆ’å¼ å‹ mmHg
    respiratory_rate: Optional[int] = None  # å‘¼å¸é¢‘ç‡ æ¬¡/åˆ†é’Ÿ
    oxygen_saturation: Optional[float] = None  # è¡€æ°§é¥±å’Œåº¦ %
    weight: Optional[float] = None  # ä½“é‡ kg
    height: Optional[float] = None  # èº«é«˜ cm
    recorded_at: datetime = field(default_factory=datetime.now)
    recorded_by: str = ""
    
    def get_bmi(self) -> Optional[float]:
        """è®¡ç®—BMI"""
        if self.weight and self.height and self.height > 0:
            height_m = self.height / 100
            return round(self.weight / (height_m ** 2), 2)
        return None
    
    def get_bp_category(self) -> str:
        """è·å–è¡€å‹åˆ†ç±»"""
        if not self.systolic_bp or not self.diastolic_bp:
            return "æœªçŸ¥"
        
        if self.systolic_bp < 120 and self.diastolic_bp < 80:
            return "æ­£å¸¸"
        elif self.systolic_bp < 130 and self.diastolic_bp < 80:
            return "æ­£å¸¸é«˜å€¼"
        elif self.systolic_bp < 140 or self.diastolic_bp < 90:
            return "1çº§é«˜è¡€å‹"
        else:
            return "2çº§é«˜è¡€å‹"
    
    def to_dict(self) -> Dict[str, Any]:
        """è½¬æ¢ä¸ºå­—å…¸"""
        return {
            "temperature": self.temperature,
            "heart_rate": self.heart_rate,
            "blood_pressure": {
                "systolic": self.systolic_bp,
                "diastolic": self.diastolic_bp,
                "category": self.get_bp_category()
            },
            "respiratory_rate": self.respiratory_rate,
            "oxygen_saturation": self.oxygen_saturation,
            "weight": self.weight,
            "height": self.height,
            "bmi": self.get_bmi(),
            "recorded_at": self.recorded_at.isoformat(),
            "recorded_by": self.recorded_by
        }


@dataclass
class Diagnosis:
    """è¯Šæ–­è®°å½•"""
    diagnosis_id: str
    patient_id: str
    diagnosis_code: str  # ICD-10ç¼–ç 
    diagnosis_name: str
    diagnosis_type: str  # ä¸»è¦è¯Šæ–­/æ¬¡è¦è¯Šæ–­
    onset_date: date
    status: str  # active, resolved, chronic
    doctor_id: str = ""
    doctor_name: str = ""
    notes: str = ""
    recorded_at: datetime = field(default_factory=datetime.now)
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "diagnosis_id": self.diagnosis_id,
            "patient_id": self.patient_id,
            "code": self.diagnosis_code,
            "name": self.diagnosis_name,
            "type": self.diagnosis_type,
            "onset_date": self.onset_date.isoformat(),
            "status": self.status,
            "doctor": {
                "id": self.doctor_id,
                "name": self.doctor_name
            },
            "notes": self.notes,
            "recorded_at": self.recorded_at.isoformat()
        }


@dataclass
class Medication:
    """è¯å“ä¿¡æ¯"""
    medication_id: str
    name: str
    generic_name: str
    dosage_form: str  # å‰‚å‹
    strength: str  # è§„æ ¼
    manufacturer: str
    unit_price: Decimal
    stock_quantity: int
    expiry_date: date
    storage_condition: str = "å¸¸æ¸©"
    
    def is_expired(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦è¿‡æœŸ"""
        return date.today() > self.expiry_date
    
    def days_until_expiry(self) -> int:
        """è·ç¦»è¿‡æœŸå¤©æ•°"""
        return (self.expiry_date - date.today()).days
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "medication_id": self.medication_id,
            "name": self.name,
            "generic_name": self.generic_name,
            "dosage_form": self.dosage_form,
            "strength": self.strength,
            "manufacturer": self.manufacturer,
            "unit_price": str(self.unit_price),
            "stock_quantity": self.stock_quantity,
            "expiry_date": self.expiry_date.isoformat(),
            "is_expired": self.is_expired(),
            "days_until_expiry": self.days_until_expiry(),
            "storage_condition": self.storage_condition
        }


@dataclass
class MedicationOrder:
    """åŒ»å˜±/å¤„æ–¹"""
    order_id: str
    patient_id: str
    medication_id: str
    medication_name: str
    dosage: str
    frequency: str
    duration: str
    quantity: int
    route: str  # ç»™è¯é€”å¾„
    instructions: str = ""
    doctor_id: str = ""
    doctor_name: str = ""
    order_time: datetime = field(default_factory=datetime.now)
    status: str = "pending"  # pending, active, completed, cancelled
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "order_id": self.order_id,
            "patient_id": self.patient_id,
            "medication": {
                "id": self.medication_id,
                "name": self.medication_name
            },
            "dosage": self.dosage,
            "frequency": self.frequency,
            "duration": self.duration,
            "quantity": self.quantity,
            "route": self.route,
            "instructions": self.instructions,
            "doctor": {
                "id": self.doctor_id,
                "name": self.doctor_name
            },
            "order_time": self.order_time.isoformat(),
            "status": self.status
        }


@dataclass
class Appointment:
    """é¢„çº¦è®°å½•"""
    appointment_id: str
    patient_id: str
    patient_name: str
    department: str
    doctor_id: str
    doctor_name: str
    appointment_date: date
    appointment_time: str
    appointment_type: str  # é—¨è¯Š/æ£€æŸ¥/æ‰‹æœ¯
    status: AppointmentStatus = AppointmentStatus.PENDING
    created_at: datetime = field(default_factory=datetime.now)
    notes: str = ""
    
    def to_dict(self) -> Dict[str, Any]:
        return {
            "appointment_id": self.appointment_id,
            "patient": {
                "id": self.patient_id,
                "name": self.patient_name
            },
            "department": self.department,
            "doctor": {
                "id": self.doctor_id,
                "name": self.doctor_name
            },
            "appointment_datetime": f"{self.appointment_date.isoformat()} {self.appointment_time}",
            "type": self.appointment_type,
            "status": self.status.value,
            "notes": self.notes
        }


class HospitalInformationSystem:
    """åŒ»é™¢ä¿¡æ¯ç³»ç»Ÿ"""
    
    def __init__(self):
        self.patients: Dict[str, Patient] = {}
        self.vital_signs: Dict[str, List[VitalSigns]] = defaultdict(list)
        self.diagnoses: Dict[str, List[Diagnosis]] = defaultdict(list)
        self.medications: Dict[str, Medication] = {}
        self.medication_orders: Dict[str, List[MedicationOrder]] = defaultdict(list)
        self.appointments: Dict[str, Appointment] = {}
        self.doctor_appointments: Dict[str, List[str]] = defaultdict(list)
        
        # ç»Ÿè®¡æŒ‡æ ‡
        self.metrics = {
            "total_patients": 0,
            "daily_visits": 0,
            "appointments_today": 0,
            "pending_prescriptions": 0
        }
    
    def register_patient(self, patient: Patient) -> str:
        """ç™»è®°æ‚£è€…"""
        if not patient.patient_id:
            patient.patient_id = f"P{datetime.now().strftime('%Y%m%d')}{len(self.patients)+1:06d}"
        self.patients[patient.patient_id] = patient
        self.metrics["total_patients"] += 1
        return patient.patient_id
    
    def get_patient(self, patient_id: str) -> Optional[Patient]:
        """è·å–æ‚£è€…ä¿¡æ¯"""
        return self.patients.get(patient_id)
    
    def search_patients(self, name: Optional[str] = None, 
                       id_number: Optional[str] = None) -> List[Patient]:
        """æœç´¢æ‚£è€…"""
        results = []
        for patient in self.patients.values():
            if name and name.lower() in patient.name.lower():
                results.append(patient)
            elif id_number and patient.id_number == id_number:
                results.append(patient)
        return results
    
    def record_vital_signs(self, patient_id: str, vitals: VitalSigns):
        """è®°å½•ç”Ÿå‘½ä½“å¾"""
        if patient_id in self.patients:
            self.vital_signs[patient_id].append(vitals)
    
    def get_vital_signs(self, patient_id: str) -> List[VitalSigns]:
        """è·å–ç”Ÿå‘½ä½“å¾å†å²"""
        return self.vital_signs.get(patient_id, [])
    
    def add_diagnosis(self, diagnosis: Diagnosis):
        """æ·»åŠ è¯Šæ–­"""
        self.diagnoses[diagnosis.patient_id].append(diagnosis)
    
    def get_diagnoses(self, patient_id: str) -> List[Diagnosis]:
        """è·å–è¯Šæ–­å†å²"""
        return self.diagnoses.get(patient_id, [])
    
    def add_medication(self, medication: Medication):
        """æ·»åŠ è¯å“"""
        self.medications[medication.medication_id] = medication
    
    def create_medication_order(self, order: MedicationOrder):
        """åˆ›å»ºåŒ»å˜±"""
        if not order.order_id:
            order.order_id = f"MO{datetime.now().strftime('%Y%m%d%H%M%S')}{uuid.uuid4().hex[:6]}"
        self.medication_orders[order.patient_id].append(order)
        self.metrics["pending_prescriptions"] += 1
    
    def create_appointment(self, appointment: Appointment) -> str:
        """åˆ›å»ºé¢„çº¦"""
        if not appointment.appointment_id:
            appointment.appointment_id = f"APT{datetime.now().strftime('%Y%m%d%H%M%S')}{uuid.uuid4().hex[:4]}"
        self.appointments[appointment.appointment_id] = appointment
        self.doctor_appointments[appointment.doctor_id].append(appointment.appointment_id)
        return appointment.appointment_id
    
    def get_doctor_schedule(self, doctor_id: str, date: date) -> List[Appointment]:
        """è·å–åŒ»ç”Ÿæ’ç­"""
        appointments = []
        for apt_id in self.doctor_appointments.get(doctor_id, []):
            apt = self.appointments.get(apt_id)
            if apt and apt.appointment_date == date:
                appointments.append(apt)
        return sorted(appointments, key=lambda a: a.appointment_time)
    
    def get_expiring_medications(self, days: int = 30) -> List[Medication]:
        """è·å–å³å°†è¿‡æœŸçš„è¯å“"""
        expiring = []
        for med in self.medications.values():
            if 0 < med.days_until_expiry() <= days:
                expiring.append(med)
        return sorted(expiring, key=lambda m: m.days_until_expiry())
    
    def get_patient_summary(self, patient_id: str) -> Dict[str, Any]:
        """è·å–æ‚£è€…æ‘˜è¦"""
        patient = self.get_patient(patient_id)
        if not patient:
            return {}
        
        vitals = self.get_vital_signs(patient_id)
        diagnoses = self.get_diagnoses(patient_id)
        orders = self.medication_orders.get(patient_id, [])
        
        return {
            "patient": patient.to_dict(),
            "latest_vitals": vitals[-1].to_dict() if vitals else None,
            "active_diagnoses": [d.to_dict() for d in diagnoses if d.status == "active"],
            "current_medications": [o.to_dict() for o in orders if o.status == "active"],
            "summary": {
                "age": patient.calculate_age(),
                "age_group": patient.get_age_group(),
                "allergy_count": len(patient.allergies),
                "chronic_disease_count": len(patient.chronic_diseases),
                "visit_count": len(vitals)
            }
        }
    
    def get_daily_statistics(self) -> Dict[str, Any]:
        """è·å–æ¯æ—¥ç»Ÿè®¡"""
        today = date.today()
        
        # ä»Šæ—¥é¢„çº¦
        today_appointments = [
            apt for apt in self.appointments.values()
            if apt.appointment_date == today
        ]
        
        # å¾…å¤„ç†å¤„æ–¹
        pending_rx = sum(
            1 for orders in self.medication_orders.values()
            for o in orders if o.status == "pending"
        )
        
        # å³å°†è¿‡æœŸè¯å“
        expiring_meds = len(self.get_expiring_medications(30))
        
        return {
            "date": today.isoformat(),
            "total_patients": self.metrics["total_patients"],
            "today_appointments": len(today_appointments),
            "pending_prescriptions": pending_rx,
            "expiring_medications_30d": expiring_meds,
            "appointments_by_status": {
                status.value: sum(1 for a in today_appointments if a.status == status)
                for status in AppointmentStatus
            }
        }


def main():
    """ä¸»å‡½æ•° - æ¼”ç¤º"""
    his = HospitalInformationSystem()
    
    # ç™»è®°æ‚£è€…
    patient = Patient(
        patient_id="P20250121001",
        name="å¼ ä¸‰",
        gender=Gender.MALE,
        birth_date=date(1980, 5, 15),
        id_number="110101198005151234",
        phone="13800138000",
        address="åŒ—äº¬å¸‚æœé˜³åŒºXXè¡—é“XXå·",
        blood_type=BloodType.A,
        allergies=["é’éœ‰ç´ ", "ç£ºèƒº"],
        chronic_diseases=["é«˜è¡€å‹", "2å‹ç³–å°¿ç—…"],
        emergency_contact_name="æå››",
        emergency_contact_phone="13900139000",
        insurance_type="åŸé•‡èŒå·¥åŒ»ä¿",
        insurance_number="110101198005151234"
    )
    patient_id = his.register_patient(patient)
    print(f"ç™»è®°æ‚£è€…: {patient_id} - {patient.name}")
    
    # è®°å½•ç”Ÿå‘½ä½“å¾
    vitals = VitalSigns(
        temperature=36.5,
        heart_rate=72,
        systolic_bp=135,
        diastolic_bp=85,
        respiratory_rate=18,
        oxygen_saturation=98.5,
        weight=70.5,
        height=175.0,
        recorded_by="ç‹åŒ»ç”Ÿ"
    )
    his.record_vital_signs(patient_id, vitals)
    print(f"\nç”Ÿå‘½ä½“å¾è®°å½•å®Œæˆ:")
    print(f"  BMI: {vitals.get_bmi()}")
    print(f"  è¡€å‹åˆ†ç±»: {vitals.get_bp_category()}")
    
    # æ·»åŠ è¯Šæ–­
    diagnosis = Diagnosis(
        diagnosis_id="D001",
        patient_id=patient_id,
        diagnosis_code="I10",
        diagnosis_name="åŸå‘æ€§é«˜è¡€å‹",
        diagnosis_type="ä¸»è¦è¯Šæ–­",
        onset_date=date(2020, 3, 15),
        status="active",
        doctor_id="DOC001",
        doctor_name="ç‹åŒ»ç”Ÿ"
    )
    his.add_diagnosis(diagnosis)
    print(f"\næ·»åŠ è¯Šæ–­: {diagnosis.diagnosis_name}")
    
    # æ·»åŠ è¯å“
    medication = Medication(
        medication_id="M001",
        name="é˜¿æ‰˜ä¼ä»–æ±€é’™ç‰‡",
        generic_name="Atorvastatin Calcium",
        dosage_form="ç‰‡å‰‚",
        strength="20mg",
        manufacturer="è¾‰ç‘åˆ¶è¯",
        unit_price=Decimal("3.50"),
        stock_quantity=500,
        expiry_date=date(2026, 12, 31)
    )
    his.add_medication(medication)
    
    # åˆ›å»ºåŒ»å˜±
    order = MedicationOrder(
        order_id="MO001",
        patient_id=patient_id,
        medication_id="M001",
        medication_name="é˜¿æ‰˜ä¼ä»–æ±€é’™ç‰‡",
        dosage="20mg",
        frequency="æ¯æ™šä¸€æ¬¡",
        duration="30å¤©",
        quantity=30,
        route="å£æœ",
        instructions="ç¡å‰æœç”¨",
        doctor_id="DOC001",
        doctor_name="ç‹åŒ»ç”Ÿ"
    )
    his.create_medication_order(order)
    print(f"åˆ›å»ºåŒ»å˜±: {order.medication_name}")
    
    # åˆ›å»ºé¢„çº¦
    appointment = Appointment(
        appointment_id="APT001",
        patient_id=patient_id,
        patient_name=patient.name,
        department="å¿ƒå†…ç§‘",
        doctor_id="DOC001",
        doctor_name="ç‹åŒ»ç”Ÿ",
        appointment_date=date(2025, 1, 28),
        appointment_time="09:00",
        appointment_type="é—¨è¯Šå¤è¯Š",
        notes="é«˜è¡€å‹éšè®¿"
    )
    his.create_appointment(appointment)
    print(f"åˆ›å»ºé¢„çº¦: {appointment.appointment_date} {appointment.appointment_time}")
    
    # è·å–æ‚£è€…æ‘˜è¦
    print("\n=== æ‚£è€…æ‘˜è¦ ===")
    summary = his.get_patient_summary(patient_id)
    print(json.dumps(summary, indent=2, ensure_ascii=False, default=str))
    
    # è·å–æ¯æ—¥ç»Ÿè®¡
    print("\n=== æ¯æ—¥ç»Ÿè®¡ ===")
    stats = his.get_daily_statistics()
    print(json.dumps(stats, indent=2, ensure_ascii=False, default=str))


if __name__ == "__main__":
    main()
```

### 2.7 æ•ˆæœè¯„ä¼°

#### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | æ”¹å–„å¹…åº¦ |
|------|--------|--------|----------|
| ç³»ç»Ÿé›†æˆè¦†ç›–ç‡ | 30% | 92% | +62% |
| ç—…å†ä¹¦å†™æ—¶é—´å æ¯” | 35% | 12% | -66% |
| è¯å“è¿‡æœŸæŸè€— | 200ä¸‡å…ƒ/å¹´ | 35ä¸‡å…ƒ/å¹´ | -82% |
| æ£€æŸ¥é¢„çº¦ç­‰å¾… | 7å¤© | 2.5å¤© | -64% |
| åŒ»ä¿ç»“ç®—æ—¶é—´ | 15åˆ†é’Ÿ | 2åˆ†é’Ÿ | -87% |

#### ROIè®¡ç®—

**æŠ•èµ„æˆæœ¬**ï¼ˆ18ä¸ªæœˆé¡¹ç›®å‘¨æœŸï¼‰ï¼š
- ç³»ç»Ÿå¼€å‘ä¸é›†æˆï¼š2,800ä¸‡å…ƒ
- ç¡¬ä»¶å‡çº§ï¼š1,200ä¸‡å…ƒ
- æ•°æ®è¿ç§»ï¼š600ä¸‡å…ƒ
- åŸ¹è®­ï¼š400ä¸‡å…ƒ
- **æ€»æŠ•èµ„**ï¼š5,000ä¸‡å…ƒ

**å¹´åº¦æ”¶ç›Š**ï¼š
- æ•ˆç‡æå‡ï¼š1,200ä¸‡å…ƒ
- è¯å“æŸè€—å‡å°‘ï¼š165ä¸‡å…ƒ
- æ‚£è€…æ»¡æ„åº¦æå‡ï¼š800ä¸‡å…ƒ
- **å¹´åº¦æ€»æ”¶ç›Š**ï¼š2,165ä¸‡å…ƒ

**ROIåˆ†æ**ï¼š
- æŠ•èµ„å›æ”¶æœŸï¼š27.7ä¸ªæœˆ
- 5å¹´ROIï¼š117%

#### ç»éªŒæ•™è®­

**æˆåŠŸå› ç´ **ï¼š
1. **ç»Ÿä¸€æ•°æ®æ ‡å‡†**ï¼šå»ºç«‹å…¨é™¢ç»Ÿä¸€æ•°æ®å­—å…¸ï¼Œè§„èŒƒ18ä¸‡+æ¡æœ¯è¯­
2. **ä¸´åºŠå‚ä¸**ï¼šåŒ»ç”Ÿå…¨ç¨‹å‚ä¸ç³»ç»Ÿè®¾è®¡ï¼Œç¬¦åˆä¸´åºŠå®é™…éœ€æ±‚
3. **åˆ†æ­¥å®æ–½**ï¼šå…ˆé—¨è¯Šåä½é™¢ï¼Œå…ˆåŸºç¡€åé«˜çº§åŠŸèƒ½

**æŒ‘æˆ˜ä¸åº”å¯¹**ï¼š
1. **ç³»ç»Ÿåˆ‡æ¢é£é™©**ï¼šé‡‡ç”¨åŒè½¨è¿è¡Œï¼Œé€æ­¥åˆ‡æ¢
2. **åŒ»ç”ŸæŠµè§¦**ï¼šåŠ å¼ºåŸ¹è®­ï¼Œå±•ç¤ºç³»ç»Ÿä»·å€¼
3. **æ•°æ®è´¨é‡é—®é¢˜**ï¼šå»ºç«‹æ•°æ®è´¨é‡ç›‘æ§ä½“ç³»

---

## 3. æ¡ˆä¾‹2ï¼šä¸´åºŠæ•°æ®è®°å½•

è¯¦è§ `04_Transformation.md` ç¬¬3ç« ã€‚

## 4. æ¡ˆä¾‹3ï¼šè¯Šæ–­è®°å½•ç®¡ç†

è¯¦è§ `04_Transformation.md` ç¬¬4ç« ã€‚

## 5. æ¡ˆä¾‹4ï¼šFHIRåˆ°HL7è½¬æ¢

è¯¦è§ `04_Transformation.md` ç¬¬2ç« ã€‚

## 6. æ¡ˆä¾‹5ï¼šåŒ»ç–—æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

è¯¦è§ `04_Transformation.md` ç¬¬6ç« ã€‚

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-02-15
