# åŠå…¬è‡ªåŠ¨åŒ–Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [åŠå…¬è‡ªåŠ¨åŒ–Schemaå®è·µæ¡ˆä¾‹](#åŠå…¬è‡ªåŠ¨åŒ–schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿå’Œç‰ˆæœ¬æ§åˆ¶](#2-æ¡ˆä¾‹1æ–‡æ¡£ç®¡ç†ç³»ç»Ÿå’Œç‰ˆæœ¬æ§åˆ¶)
    - [2.1 åœºæ™¯æè¿°](#21-åœºæ™¯æè¿°)
    - [2.2 Schemaå®šä¹‰](#22-schemaå®šä¹‰)
    - [2.3 å®ç°ä»£ç ](#23-å®ç°ä»£ç )
  - [3. æ¡ˆä¾‹2ï¼šè¯·å‡å®¡æ‰¹æµç¨‹ç®¡ç†](#3-æ¡ˆä¾‹2è¯·å‡å®¡æ‰¹æµç¨‹ç®¡ç†)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
    - [3.3 å®ç°ä»£ç ](#33-å®ç°ä»£ç )
  - [4. æ¡ˆä¾‹3ï¼šä»»åŠ¡ç®¡ç†ç³»ç»Ÿ](#4-æ¡ˆä¾‹3ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
    - [4.3 å®ç°ä»£ç ](#43-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šæ–‡æ¡£æ ¼å¼æ‰¹é‡è½¬æ¢](#5-æ¡ˆä¾‹4æ–‡æ¡£æ ¼å¼æ‰¹é‡è½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šOAæ•°æ®åˆ†æå’ŒæŠ¥è¡¨](#6-æ¡ˆä¾‹5oaæ•°æ®åˆ†æå’ŒæŠ¥è¡¨)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )
    - [6.3 æ•°æ®åˆ†æç¤ºä¾‹](#63-æ•°æ®åˆ†æç¤ºä¾‹)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›åŠå…¬è‡ªåŠ¨åŒ–Schemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿå’Œç‰ˆæœ¬æ§åˆ¶

### 2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ä¼ä¸šéœ€è¦ç®¡ç†å¤§é‡æ–‡æ¡£ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€æƒé™ç®¡ç†å’Œæ–‡æ¡£æ£€ç´¢åŠŸèƒ½ã€‚
æ–‡æ¡£éœ€è¦æ”¯æŒODFå’ŒOOXMLæ ¼å¼ï¼Œå¹¶èƒ½åœ¨è¿™ä¸¤ç§æ ¼å¼ä¹‹é—´è½¬æ¢ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®ç°æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶
- éœ€è¦ç®¡ç†æ–‡æ¡£æƒé™
- éœ€è¦æ”¯æŒæ–‡æ¡£æ ¼å¼è½¬æ¢
- éœ€è¦å®ç°æ–‡æ¡£å…¨æ–‡æ£€ç´¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨DocumentVersionManagerå®ç°æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶ï¼Œä½¿ç”¨ODFToOOXMLConverter
å®ç°æ–‡æ¡£æ ¼å¼è½¬æ¢ã€‚

### 2.2 Schemaå®šä¹‰

è¯¦è§ç¬¬2.2èŠ‚åŸå§‹å®šä¹‰ã€‚

### 2.3 å®ç°ä»£ç 

**å®Œæ•´çš„æ–‡æ¡£ç®¡ç†ç³»ç»Ÿå®ç°**ï¼š

```python
from oa_storage import OAStorage
from document_version_manager import DocumentVersionManager
from odf_to_ooxml_converter import ODFToOOXMLConverter
from datetime import datetime

# åˆå§‹åŒ–å­˜å‚¨å’Œç»„ä»¶
storage = OAStorage("postgresql://user:pass@localhost/oa")
version_manager = DocumentVersionManager(storage)
converter = ODFToOOXMLConverter()

# åˆ›å»ºæ–‡æ¡£
document_data = {
    "document_id": "DOC20250121001",
    "document_title": "é¡¹ç›®è®¡åˆ’ä¹¦",
    "document_type": "Word",
    "author": "å¼ ä¸‰",
    "file_path": "/documents/project/plan.odt",
    "file_size": 102400,
    "mime_type": "application/vnd.oasis.opendocument.text",
    "current_version": 1
}

# å­˜å‚¨æ–‡æ¡£
doc_id = storage.store_document(document_data)
print(f"Created document: {doc_id}")

# åˆ›å»ºç‰ˆæœ¬1
version1 = version_manager.create_version(
    "DOC20250121001",
    "å¼ ä¸‰",
    "/documents/project/plan_v1.odt",
    "åˆå§‹ç‰ˆæœ¬"
)
print(f"Created version 1: {version1}")

# åˆ›å»ºç‰ˆæœ¬2
version2 = version_manager.create_version(
    "DOC20250121001",
    "æå››",
    "/documents/project/plan_v2.odt",
    "æ·»åŠ é¡¹ç›®é¢„ç®—"
)
print(f"Created version 2: {version2}")

# æŸ¥è¯¢ç‰ˆæœ¬å†å²
history = version_manager.get_version_history("DOC20250121001")
print(f"\nVersion history:")
for version in history:
    print(f"  Version {version['version_number']}: {version['version_author']} - {version['version_comment']}")

# è½¬æ¢ODFåˆ°OOXML
ooxml_path = converter.convert_document("/documents/project/plan.odt")
if ooxml_path:
    print(f"\nConverted to OOXML: {ooxml_path}")

    # åˆ›å»ºOOXMLç‰ˆæœ¬
    version3 = version_manager.create_version(
        "DOC20250121001",
        "å¼ ä¸‰",
        ooxml_path,
        "è½¬æ¢ä¸ºDOCXæ ¼å¼"
    )
    print(f"Created version 3 (OOXML): {version3}")

# æ¢å¤ç‰ˆæœ¬1
restored = version_manager.restore_version("DOC20250121001", 1)
if restored:
    print("\nRestored version 1")
```

---

## 3. æ¡ˆä¾‹2ï¼šè¯·å‡å®¡æ‰¹æµç¨‹ç®¡ç†

### 3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ä¼ä¸šéœ€è¦å®ç°è¯·å‡å®¡æ‰¹æµç¨‹ï¼Œæ”¯æŒå¤šçº§å®¡æ‰¹ã€æµç¨‹è·Ÿè¸ªå’Œå®¡æ‰¹å†å²æŸ¥è¯¢ã€‚
æµç¨‹éœ€è¦æ”¯æŒBPMNæ ‡å‡†å®šä¹‰ï¼Œå¹¶èƒ½çµæ´»é…ç½®å®¡æ‰¹èŠ‚ç‚¹ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®ç°å·¥ä½œæµå¼•æ“
- éœ€è¦æ”¯æŒå¤šçº§å®¡æ‰¹
- éœ€è¦æµç¨‹çŠ¶æ€è·Ÿè¸ª
- éœ€è¦å®¡æ‰¹å†å²è®°å½•

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨WorkflowEngineå®ç°BPMNå·¥ä½œæµå¼•æ“ï¼Œæ”¯æŒæµç¨‹å®šä¹‰ã€å¯åŠ¨å’Œå®¡æ‰¹ã€‚

### 3.2 Schemaå®šä¹‰

è¯¦è§ç¬¬3.2èŠ‚åŸå§‹å®šä¹‰ã€‚

### 3.3 å®ç°ä»£ç 

**å®Œæ•´çš„è¯·å‡å®¡æ‰¹æµç¨‹å®ç°**ï¼š

```python
from workflow_engine import WorkflowEngine
from oa_storage import OAStorage
from datetime import datetime

# åˆå§‹åŒ–å·¥ä½œæµå¼•æ“å’Œå­˜å‚¨
storage = OAStorage("postgresql://user:pass@localhost/oa")
workflow_engine = WorkflowEngine(storage)

# å®šä¹‰è¯·å‡å®¡æ‰¹æµç¨‹
leave_process_definition = {
    "process_id": "LEAVE_PROCESS",
    "process_name": "è¯·å‡å®¡æ‰¹æµç¨‹",
    "process_type": "Leave",
    "process_definition": {
        "process_version": 1,
        "process_nodes": [
            {
                "node_id": "NODE001",
                "node_name": "æäº¤ç”³è¯·",
                "node_type": "Start",
                "node_order": 1
            },
            {
                "node_id": "NODE002",
                "node_name": "éƒ¨é—¨ç»ç†å®¡æ‰¹",
                "node_type": "Approval",
                "approver": "éƒ¨é—¨ç»ç†",
                "node_order": 2
            },
            {
                "node_id": "NODE003",
                "node_name": "HRå®¡æ‰¹",
                "node_type": "Approval",
                "approver": "HR",
                "node_order": 3
            },
            {
                "node_id": "NODE004",
                "node_name": "å®Œæˆ",
                "node_type": "End",
                "node_order": 4
            }
        ]
    }
}

# æ³¨å†Œæµç¨‹å®šä¹‰
workflow_engine.define_process("LEAVE_PROCESS", leave_process_definition)

# å¯åŠ¨æµç¨‹å®ä¾‹
process_data = {
    "leave_type": "å¹´å‡",
    "start_date": "2025-02-01",
    "end_date": "2025-02-05",
    "days": 5,
    "reason": "ä¸ªäººäº‹åŠ¡"
}

instance_id = workflow_engine.start_process(
    "LEAVE_PROCESS",
    "å¼ ä¸‰",
    process_data
)
print(f"Started process instance: {instance_id}")

# æŸ¥è¯¢æµç¨‹çŠ¶æ€
status = workflow_engine.get_process_status(instance_id)
print(f"\nProcess status: {status['current_status']}")
print(f"Current node: {status['current_node']}")

# éƒ¨é—¨ç»ç†å®¡æ‰¹
workflow_engine.approve_node(
    instance_id,
    "éƒ¨é—¨ç»ç†",
    "Approved",
    "åŒæ„è¯·å‡ç”³è¯·"
)

# æŸ¥è¯¢æ›´æ–°åçš„çŠ¶æ€
status = workflow_engine.get_process_status(instance_id)
print(f"\nAfter department manager approval:")
print(f"  Status: {status['current_status']}")
print(f"  Current node: {status['current_node']}")

# HRå®¡æ‰¹
workflow_engine.approve_node(
    instance_id,
    "HR",
    "Approved",
    "å®¡æ‰¹é€šè¿‡"
)

# æŸ¥è¯¢æœ€ç»ˆçŠ¶æ€
status = workflow_engine.get_process_status(instance_id)
print(f"\nFinal status: {status['current_status']}")

# æŸ¥è¯¢å®¡æ‰¹å†å²
history = storage.get_process_approval_history(instance_id)
print(f"\nApproval history:")
for record in history:
    print(f"  {record['node_id']}: {record['approver']} - {record['approval_result']} - {record['approval_time']}")
```

---

## 4. æ¡ˆä¾‹3ï¼šä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

### 4.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ä¼ä¸šéœ€è¦ç®¡ç†é¡¹ç›®ä»»åŠ¡ï¼Œæ”¯æŒä»»åŠ¡åˆ†é…ã€çŠ¶æ€è·Ÿè¸ªã€ä¼˜å…ˆçº§ç®¡ç†å’Œå·¥ä½œé‡ç»Ÿè®¡ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦ä»»åŠ¡åˆ†é…å’Œè·Ÿè¸ª
- éœ€è¦ä¼˜å…ˆçº§ç®¡ç†
- éœ€è¦å·¥ä½œé‡ç»Ÿè®¡
- éœ€è¦ä»»åŠ¡æé†’

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨OAStorageå­˜å‚¨ä»»åŠ¡æ•°æ®ï¼Œå®ç°ä»»åŠ¡ç®¡ç†å’Œç»Ÿè®¡åŠŸèƒ½ã€‚

### 4.2 Schemaå®šä¹‰

è¯¦è§ç¬¬4.2èŠ‚åŸå§‹å®šä¹‰ã€‚

### 4.3 å®ç°ä»£ç 

**å®Œæ•´çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿå®ç°**ï¼š

```python
from oa_storage import OAStorage
from datetime import datetime, timedelta

# åˆå§‹åŒ–å­˜å‚¨
storage = OAStorage("postgresql://user:pass@localhost/oa")

# åˆ›å»ºä»»åŠ¡
task_data = {
    "task_id": "TASK20250121001",
    "task_title": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
    "task_description": "ç¼–å†™é¡¹ç›®éœ€æ±‚æ–‡æ¡£å’ŒæŠ€æœ¯æ–¹æ¡ˆ",
    "assignee": "æå››",
    "assigner": "å¼ ä¸‰",
    "task_status": "Todo",
    "priority": "High",
    "due_date": datetime.now() + timedelta(days=5)
}

task_id = storage.store_task(task_data)
print(f"Created task: {task_id}")

# æ›´æ–°ä»»åŠ¡çŠ¶æ€
storage.update_task_status("TASK20250121001", "InProgress")
print("Updated task status to InProgress")

# æŸ¥è¯¢ä»»åŠ¡ç»Ÿè®¡
task_stats = storage.get_task_statistics(assignee="æå››", days=30)
print(f"\nTask statistics for æå››:")
for status, stats in task_stats.items():
    print(f"  {status}: {stats['count']} tasks, {stats['overdue_count']} overdue")

# æŸ¥è¯¢ç”¨æˆ·å·¥ä½œé‡
workload = storage.get_user_workload("æå››", days=7)
print(f"\nWorkload for æå›› (7 days):")
print(f"  Tasks: {workload['tasks']}")
print(f"  Approvals: {workload['approvals']}")
```

---

## 5. æ¡ˆä¾‹4ï¼šæ–‡æ¡£æ ¼å¼æ‰¹é‡è½¬æ¢

### 5.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ä¼ä¸šéœ€è¦å°†å¤§é‡ODFæ–‡æ¡£æ‰¹é‡è½¬æ¢ä¸ºOOXMLæ ¼å¼ï¼Œä»¥ä¾¿ä¸Microsoft Officeç³»ç»Ÿé›†æˆã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦æ‰¹é‡è½¬æ¢æ–‡æ¡£
- éœ€è¦ä¿æŒæ–‡æ¡£æ ¼å¼
- éœ€è¦è½¬æ¢è¿›åº¦è·Ÿè¸ª
- éœ€è¦é”™è¯¯å¤„ç†

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ODFToOOXMLConverterå®ç°æ‰¹é‡æ–‡æ¡£è½¬æ¢ã€‚

### 5.2 å®ç°ä»£ç 

**æ‰¹é‡æ–‡æ¡£è½¬æ¢å®ç°**ï¼š

```python
from odf_to_ooxml_converter import ODFToOOXMLConverter
from pathlib import Path
import logging

logging.basicConfig(level=logging.INFO)
converter = ODFToOOXMLConverter()

# æ‰¹é‡è½¬æ¢ODFæ–‡æ¡£
odf_directory = Path("/documents/odf")
output_directory = Path("/documents/ooxml")
output_directory.mkdir(exist_ok=True)

odf_files = list(odf_directory.glob("*.odt")) + \
            list(odf_directory.glob("*.ods")) + \
            list(odf_directory.glob("*.odp"))

print(f"Found {len(odf_files)} ODF files to convert")

success_count = 0
failed_count = 0

for odf_file in odf_files:
    try:
        output_path = output_directory / odf_file.with_suffix(
            converter._get_ooxml_extension(odf_file.suffix)
        ).name

        result = converter.convert_document(str(odf_file), str(output_path))
        if result:
            success_count += 1
            print(f"âœ“ Converted: {odf_file.name} -> {output_path.name}")
        else:
            failed_count += 1
            print(f"âœ— Failed: {odf_file.name}")
    except Exception as e:
        failed_count += 1
        print(f"âœ— Error converting {odf_file.name}: {e}")

print(f"\nConversion complete:")
print(f"  Success: {success_count}")
print(f"  Failed: {failed_count}")
```

---

## 6. æ¡ˆä¾‹5ï¼šOAæ•°æ®åˆ†æå’ŒæŠ¥è¡¨

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä½¿ç”¨PostgreSQLå­˜å‚¨åŠå…¬è‡ªåŠ¨åŒ–æ•°æ®ï¼Œæ”¯æŒæ–‡æ¡£ç»Ÿè®¡ã€æµç¨‹åˆ†æå’Œç”¨æˆ·å·¥ä½œé‡ç»Ÿè®¡ã€‚

### 6.2 å®ç°ä»£ç 

è¯¦è§ `04_Transformation.md` ç¬¬7ç« ã€‚

### 6.3 æ•°æ®åˆ†æç¤ºä¾‹

**OAæ•°æ®åˆ†ææŸ¥è¯¢**ï¼š

```python
from oa_storage import OAStorage
from datetime import datetime, timedelta

storage = OAStorage("postgresql://user:pass@localhost/oa")

# æŸ¥è¯¢æ–‡æ¡£ç»Ÿè®¡
doc_stats = storage.get_document_statistics(datetime.now() - timedelta(days=30))
print("Document Statistics (30 days):")
for stat in doc_stats:
    print(f"  {stat['document_type']}: {stat['count']} documents, "
          f"Total size: {stat['total_size']/1024/1024:.2f}MB")

# æŸ¥è¯¢æµç¨‹å®¡æ‰¹ç»Ÿè®¡
process_stats = storage.get_process_statistics(days=30)
print("\nProcess Statistics (30 days):")
for stat in process_stats:
    print(f"  {stat['process_type']} - {stat['current_status']}: "
          f"{stat['count']} processes, Avg: {stat['avg_hours']:.2f} hours")

# æŸ¥è¯¢ç”¨æˆ·å·¥ä½œé‡
workload = storage.get_user_workload("å¼ ä¸‰", days=7)
print(f"\nWorkload for å¼ ä¸‰ (7 days):")
print(f"  Tasks: {workload['tasks']}")
print(f"  Approvals: {workload['approvals']}")
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
