# gRPC Schemaæ¦‚è¿°

## ğŸ“‘ ç›®å½•

- [gRPC Schemaæ¦‚è¿°](#grpc-schemaæ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ ¸å¿ƒç»“è®º](#1-æ ¸å¿ƒç»“è®º)
    - [1.1 gRPC Schemaå®šä¹‰](#11-grpc-schemaå®šä¹‰)
    - [1.2 æ ‡å‡†ä¾æ®](#12-æ ‡å‡†ä¾æ®)
  - [2. æ¦‚å¿µå®šä¹‰](#2-æ¦‚å¿µå®šä¹‰)
    - [2.1 gRPC Schemaå®šä¹‰](#21-grpc-schemaå®šä¹‰)
    - [2.2 æ ¸å¿ƒç‰¹å¾](#22-æ ¸å¿ƒç‰¹å¾)
    - [2.3 Schemaåˆ†ç±»](#23-schemaåˆ†ç±»)
  - [3. gRPC Schemaå…ƒç´ è¯¦ç»†è¯´æ˜](#3-grpc-schemaå…ƒç´ è¯¦ç»†è¯´æ˜)
    - [3.1 æœåŠ¡å®šä¹‰Schema](#31-æœåŠ¡å®šä¹‰schema)
    - [3.2 æ¶ˆæ¯ç±»å‹Schema](#32-æ¶ˆæ¯ç±»å‹schema)
    - [3.3 RPCæ–¹æ³•Schema](#33-rpcæ–¹æ³•schema)
    - [3.4 æµå¼RPC Schema](#34-æµå¼rpc-schema)
  - [4. æ ‡å‡†å¯¹æ ‡](#4-æ ‡å‡†å¯¹æ ‡)
    - [4.1 gRPCè§„èŒƒ](#41-grpcè§„èŒƒ)
    - [4.2 Protocol Buffersè§„èŒƒ](#42-protocol-buffersè§„èŒƒ)
    - [4.3 HTTP/2è§„èŒƒ](#43-http2è§„èŒƒ)
  - [5. åº”ç”¨åœºæ™¯](#5-åº”ç”¨åœºæ™¯)
    - [5.1 å¾®æœåŠ¡é€šä¿¡](#51-å¾®æœåŠ¡é€šä¿¡)
    - [5.2 é«˜æ€§èƒ½API](#52-é«˜æ€§èƒ½api)
    - [5.3 æµå¼æ•°æ®å¤„ç†](#53-æµå¼æ•°æ®å¤„ç†)
    - [5.4 gRPCæ•°æ®å­˜å‚¨ä¸åˆ†æ](#54-grpcæ•°æ®å­˜å‚¨ä¸åˆ†æ)
  - [6. æ€ç»´å¯¼å›¾](#6-æ€ç»´å¯¼å›¾)

---

## 1. æ ¸å¿ƒç»“è®º

**gRPCå­˜åœ¨å®Œæ•´çš„Schemaä½“ç³»ï¼Œå®šä¹‰äº†æœåŠ¡ã€æ¶ˆæ¯ç±»å‹ã€RPCæ–¹æ³•ç­‰æ ¸å¿ƒå…ƒç´ **ã€‚

### 1.1 gRPC Schemaå®šä¹‰

```text
gRPC_Schema = Service_Definition âŠ• Message_Type_Schema
            âŠ• RPC_Method_Schema âŠ• Streaming_RPC_Schema
```

å…¶ä¸­ï¼š
- `Service_Definition`ï¼šgRPCæœåŠ¡å®šä¹‰
- `Message_Type_Schema`ï¼šProtocol Buffersæ¶ˆæ¯ç±»å‹Schema
- `RPC_Method_Schema`ï¼šRPCæ–¹æ³•Schema
- `Streaming_RPC_Schema`ï¼šæµå¼RPC Schema

### 1.2 æ ‡å‡†ä¾æ®

- **gRPC**ï¼šGoogleè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¡†æ¶
- **Protocol Buffers**ï¼šGoogleæ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼ˆprotobuf 3.xï¼‰
- **HTTP/2**ï¼šHTTP/2ä¼ è¾“åè®®
- **gRPC-Web**ï¼šgRPC Webæ”¯æŒè§„èŒƒ

---

## 2. æ¦‚å¿µå®šä¹‰

### 2.1 gRPC Schemaå®šä¹‰

**gRPC Schema**æ˜¯æè¿°gRPCæœåŠ¡æ¥å£ã€æ¶ˆæ¯ç±»å‹ã€RPCæ–¹æ³•çš„å½¢å¼åŒ–è§„èŒƒã€‚

### 2.2 æ ¸å¿ƒç‰¹å¾

1. **é«˜æ€§èƒ½**ï¼šåŸºäºHTTP/2å’ŒProtocol Buffersçš„é«˜æ€§èƒ½RPCæ¡†æ¶
2. **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹ç³»ç»Ÿä¿è¯RPCè°ƒç”¨çš„ç±»å‹å®‰å…¨
3. **æµå¼æ”¯æŒ**ï¼šæ”¯æŒå•å‘æµã€åŒå‘æµç­‰æµå¼RPC
4. **è·¨è¯­è¨€**ï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€
5. **ä»£ç ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»£ç 

### 2.3 Schemaåˆ†ç±»

- **æœåŠ¡å®šä¹‰Schema**ï¼šgRPCæœåŠ¡å®šä¹‰
- **æ¶ˆæ¯ç±»å‹Schema**ï¼šProtocol Buffersæ¶ˆæ¯ç±»å‹
- **RPCæ–¹æ³•Schema**ï¼šä¸€å…ƒRPCã€æœåŠ¡å™¨æµã€å®¢æˆ·ç«¯æµã€åŒå‘æµ
- **æµå¼RPC Schema**ï¼šæµå¼æ•°æ®ä¼ è¾“Schema

---

## 3. gRPC Schemaå…ƒç´ è¯¦ç»†è¯´æ˜

### 3.1 æœåŠ¡å®šä¹‰Schema

**å®šä¹‰**ï¼šæè¿°gRPCæœåŠ¡çš„ç»“æ„ã€‚

**åŒ…å«å†…å®¹**ï¼š

- **æœåŠ¡åç§°**ï¼šæœåŠ¡æ ‡è¯†ç¬¦
- **RPCæ–¹æ³•**ï¼šæœåŠ¡æ–¹æ³•å®šä¹‰
- **æœåŠ¡é€‰é¡¹**ï¼šæœåŠ¡çº§é…ç½®é€‰é¡¹

**ç¤ºä¾‹**ï¼š

```protobuf
service UserService {
  rpc GetUser(GetUserRequest) returns (User);
  rpc CreateUser(CreateUserRequest) returns (User);
  rpc UpdateUser(UpdateUserRequest) returns (User);
  rpc DeleteUser(DeleteUserRequest) returns (Empty);
}
```

### 3.2 æ¶ˆæ¯ç±»å‹Schema

**å®šä¹‰**ï¼šæè¿°gRPCæ¶ˆæ¯ç±»å‹çš„ç»“æ„ã€‚

**åŒ…å«å†…å®¹**ï¼š

- **å­—æ®µå®šä¹‰**ï¼šæ¶ˆæ¯å­—æ®µ
- **å­—æ®µç±»å‹**ï¼šæ ‡é‡ç±»å‹ã€æ¶ˆæ¯ç±»å‹ã€æšä¸¾ç±»å‹
- **å­—æ®µç¼–å·**ï¼šå”¯ä¸€å­—æ®µç¼–å·
- **å­—æ®µæ ‡ç­¾**ï¼šoptionalã€repeatedã€required

**ç¤ºä¾‹**ï¼š

```protobuf
message User {
  string id = 1;
  string name = 2;
  string email = 3;
  int64 created_at = 4;
  repeated string tags = 5;
}

message GetUserRequest {
  string user_id = 1;
}
```

### 3.3 RPCæ–¹æ³•Schema

**å®šä¹‰**ï¼šæè¿°gRPC RPCæ–¹æ³•çš„ç»“æ„ã€‚

**åŒ…å«å†…å®¹**ï¼š

- **æ–¹æ³•åç§°**ï¼šRPCæ–¹æ³•æ ‡è¯†ç¬¦
- **è¯·æ±‚ç±»å‹**ï¼šè¯·æ±‚æ¶ˆæ¯ç±»å‹
- **å“åº”ç±»å‹**ï¼šå“åº”æ¶ˆæ¯ç±»å‹
- **æ–¹æ³•ç±»å‹**ï¼šä¸€å…ƒRPCã€æœåŠ¡å™¨æµã€å®¢æˆ·ç«¯æµã€åŒå‘æµ

**ç¤ºä¾‹**ï¼š

```protobuf
service ChatService {
  // ä¸€å…ƒRPC
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);

  // æœåŠ¡å™¨æµ
  rpc SubscribeMessages(SubscribeRequest) returns (stream Message);

  // å®¢æˆ·ç«¯æµ
  rpc UploadFile(stream FileChunk) returns (UploadResponse);

  // åŒå‘æµ
  rpc Chat(stream ChatMessage) returns (stream ChatMessage);
}
```

### 3.4 æµå¼RPC Schema

**å®šä¹‰**ï¼šæè¿°gRPCæµå¼RPCçš„ç»“æ„ã€‚

**åŒ…å«å†…å®¹**ï¼š

- **æµæ–¹å‘**ï¼šæœåŠ¡å™¨æµã€å®¢æˆ·ç«¯æµã€åŒå‘æµ
- **æµæ§åˆ¶**ï¼šæµæ§åˆ¶æœºåˆ¶
- **é”™è¯¯å¤„ç†**ï¼šæµé”™è¯¯å¤„ç†

---

## 4. æ ‡å‡†å¯¹æ ‡

### 4.1 gRPCè§„èŒƒ

**æ ‡å‡†åç§°**ï¼šgRPC
**æ ¸å¿ƒå†…å®¹**ï¼š
- gRPCæœåŠ¡å®šä¹‰
- RPCæ–¹æ³•å®šä¹‰
- æµå¼RPCæ”¯æŒ
- é”™è¯¯å¤„ç†æœºåˆ¶

**Schemaæ”¯æŒ**ï¼šå®Œæ•´æ”¯æŒ
**å‚è€ƒé“¾æ¥**ï¼šhttps://grpc.io/

### 4.2 Protocol Buffersè§„èŒƒ

**æ ‡å‡†åç§°**ï¼šProtocol Buffers 3.x
**æ ¸å¿ƒå†…å®¹**ï¼š
- æ¶ˆæ¯å®šä¹‰è¯­æ³•
- å­—æ®µç±»å‹ç³»ç»Ÿ
- ç¼–ç è§„åˆ™

**Schemaæ”¯æŒ**ï¼šå®Œæ•´æ”¯æŒ
**å‚è€ƒé“¾æ¥**ï¼šhttps://developers.google.com/protocol-buffers

### 4.3 HTTP/2è§„èŒƒ

**æ ‡å‡†åç§°**ï¼šHTTP/2
**æ ¸å¿ƒå†…å®¹**ï¼š
- HTTP/2ä¼ è¾“åè®®
- å¤šè·¯å¤ç”¨
- æµæ§åˆ¶

**Schemaæ”¯æŒ**ï¼šä¼ è¾“å±‚æ”¯æŒ
**å‚è€ƒé“¾æ¥**ï¼šhttps://http2.github.io/

---

## 5. åº”ç”¨åœºæ™¯

### 5.1 å¾®æœåŠ¡é€šä¿¡

**åœºæ™¯æè¿°**ï¼šå¾®æœåŠ¡æ¶æ„ä¸­ä½¿ç”¨gRPCè¿›è¡ŒæœåŠ¡é—´é€šä¿¡ã€‚

**Schemaåº”ç”¨**ï¼š
- å®šä¹‰æœåŠ¡æ¥å£
- å®šä¹‰æ¶ˆæ¯ç±»å‹
- ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»£ç 

**ä¼˜åŠ¿**ï¼š
- é«˜æ€§èƒ½é€šä¿¡
- ç±»å‹å®‰å…¨
- è·¨è¯­è¨€æ”¯æŒ

### 5.2 é«˜æ€§èƒ½API

**åœºæ™¯æè¿°**ï¼šé«˜æ€§èƒ½APIæœåŠ¡ä½¿ç”¨gRPCã€‚

**Schemaåº”ç”¨**ï¼š
- å®šä¹‰APIæ¥å£
- ä¼˜åŒ–æ•°æ®ä¼ è¾“
- æ”¯æŒæµå¼ä¼ è¾“

**ä¼˜åŠ¿**ï¼š
- ä½å»¶è¿Ÿ
- é«˜ååé‡
- é«˜æ•ˆåºåˆ—åŒ–

### 5.3 æµå¼æ•°æ®å¤„ç†

**åœºæ™¯æè¿°**ï¼šå®æ—¶æ•°æ®å¤„ç†ä½¿ç”¨gRPCæµå¼RPCã€‚

**Schemaåº”ç”¨**ï¼š
- å®šä¹‰æµå¼æ¥å£
- å®æ—¶æ•°æ®ä¼ è¾“
- æµæ§åˆ¶

**ä¼˜åŠ¿**ï¼š
- å®æ—¶æ€§
- é«˜æ•ˆä¼ è¾“
- æµæ§åˆ¶

### 5.4 gRPCæ•°æ®å­˜å‚¨ä¸åˆ†æ

**åœºæ™¯æè¿°**ï¼šå­˜å‚¨gRPCæœåŠ¡å®šä¹‰ã€è°ƒç”¨æ—¥å¿—ã€æ€§èƒ½æŒ‡æ ‡ç­‰æ•°æ®ï¼Œè¿›è¡ŒAPIåˆ†æå’Œä¼˜åŒ–ã€‚

**Schemaåº”ç”¨**ï¼š
- å­˜å‚¨æœåŠ¡å®šä¹‰
- è®°å½•è°ƒç”¨æ—¥å¿—
- åˆ†ææ€§èƒ½æŒ‡æ ‡

**æ•°æ®åº“è®¾è®¡**ï¼š
- æœåŠ¡å®šä¹‰è¡¨ï¼šå­˜å‚¨gRPCæœåŠ¡å®šä¹‰
- è°ƒç”¨æ—¥å¿—è¡¨ï¼šè®°å½•gRPCè°ƒç”¨å†å²
- æ€§èƒ½æŒ‡æ ‡è¡¨ï¼šå­˜å‚¨è°ƒç”¨æ€§èƒ½æ•°æ®
- æ–¹æ³•ä½¿ç”¨ç»Ÿè®¡è¡¨ï¼šç»Ÿè®¡æ–¹æ³•ä½¿ç”¨æƒ…å†µ

---

## 6. æ€ç»´å¯¼å›¾

```mermaid
graph TB
    gRPC[gRPC Schema]

    gRPC --> Service[æœåŠ¡å®šä¹‰]
    gRPC --> Message[æ¶ˆæ¯ç±»å‹]
    gRPC --> RPC[RPCæ–¹æ³•]
    gRPC --> Streaming[æµå¼RPC]

    Service --> ServiceName[æœåŠ¡åç§°]
    Service --> RPCMethods[RPCæ–¹æ³•åˆ—è¡¨]
    Service --> Options[æœåŠ¡é€‰é¡¹]

    Message --> Fields[å­—æ®µå®šä¹‰]
    Message --> Types[å­—æ®µç±»å‹]
    Message --> Numbers[å­—æ®µç¼–å·]

    RPC --> Unary[ä¸€å…ƒRPC]
    RPC --> ServerStream[æœåŠ¡å™¨æµ]
    RPC --> ClientStream[å®¢æˆ·ç«¯æµ]
    RPC --> BidirectionalStream[åŒå‘æµ]

    Streaming --> FlowControl[æµæ§åˆ¶]
    Streaming --> ErrorHandling[é”™è¯¯å¤„ç†]
```

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**ç»´æŠ¤è€…**ï¼šDSL Schemaç ”ç©¶å›¢é˜Ÿ

**ç›¸å…³æ–‡æ¡£**ï¼š
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»
- `05_Case_Studies.md` - å®è·µæ¡ˆä¾‹
