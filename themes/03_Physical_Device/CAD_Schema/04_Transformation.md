# CAD Schemaè½¬æ¢ä½“ç³»

## ğŸ“‘ ç›®å½•

- [CAD Schemaè½¬æ¢ä½“ç³»](#cad-schemaè½¬æ¢ä½“ç³»)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. è½¬æ¢ä½“ç³»æ¦‚è¿°](#1-è½¬æ¢ä½“ç³»æ¦‚è¿°)
    - [1.1 è½¬æ¢ç›®æ ‡](#11-è½¬æ¢ç›®æ ‡)
  - [2. CADæ ¼å¼è½¬æ¢](#2-cadæ ¼å¼è½¬æ¢)
    - [2.1 STEPæ ¼å¼è½¬æ¢](#21-stepæ ¼å¼è½¬æ¢)
    - [2.2 IGESæ ¼å¼è½¬æ¢](#22-igesæ ¼å¼è½¬æ¢)
    - [2.3 åŸç”ŸCADæ ¼å¼è½¬æ¢](#23-åŸç”Ÿcadæ ¼å¼è½¬æ¢)
  - [3. å‡ ä½•æ¨¡å‹è½¬æ¢](#3-å‡ ä½•æ¨¡å‹è½¬æ¢)
  - [4. ç»“æ„è®¾è®¡è½¬æ¢](#4-ç»“æ„è®¾è®¡è½¬æ¢)
  - [5. æœºæ„è®¾è®¡è½¬æ¢](#5-æœºæ„è®¾è®¡è½¬æ¢)
  - [6. è½¬æ¢å·¥å…·](#6-è½¬æ¢å·¥å…·)
  - [7. è½¬æ¢éªŒè¯](#7-è½¬æ¢éªŒè¯)
  - [8. CADæ•°æ®å­˜å‚¨ä¸åˆ†æ](#8-cadæ•°æ®å­˜å‚¨ä¸åˆ†æ)
    - [8.1 PostgreSQL CADæ•°æ®å­˜å‚¨](#81-postgresql-cadæ•°æ®å­˜å‚¨)
    - [8.2 CADæ•°æ®åˆ†ææŸ¥è¯¢](#82-cadæ•°æ®åˆ†ææŸ¥è¯¢)

---

## 1. è½¬æ¢ä½“ç³»æ¦‚è¿°

CAD Schemaè½¬æ¢ä½“ç³»æ”¯æŒä¸åŒCADæ ¼å¼ä¹‹é—´çš„è½¬æ¢ï¼Œ
ä»¥åŠCADæ•°æ®åˆ°å…¶ä»–æ ¼å¼çš„è½¬æ¢ã€‚

### 1.1 è½¬æ¢ç›®æ ‡

1. **æ ¼å¼è½¬æ¢**ï¼šSTEP â†” IGES â†” åŸç”ŸCADæ ¼å¼
2. **å‡ ä½•è½¬æ¢**ï¼šå‡ ä½•æ¨¡å‹æ ¼å¼è½¬æ¢
3. **ç»“æ„è½¬æ¢**ï¼šç»“æ„è®¾è®¡æ•°æ®è½¬æ¢
4. **æœºæ„è½¬æ¢**ï¼šæœºæ„è®¾è®¡æ•°æ®è½¬æ¢

---

## 2. CADæ ¼å¼è½¬æ¢

### 2.1 STEPæ ¼å¼è½¬æ¢

**è½¬æ¢è§„åˆ™**ï¼š

- STEP AP 203 â†’ STEP AP 242
- STEP AP 214 â†’ STEP AP 242
- STEPå‡ ä½• â†’ å…¶ä»–CADæ ¼å¼å‡ ä½•

### 2.2 IGESæ ¼å¼è½¬æ¢

**è½¬æ¢è§„åˆ™**ï¼š

- IGES â†’ STEP
- IGESå‡ ä½• â†’ å…¶ä»–æ ¼å¼å‡ ä½•

### 2.3 åŸç”ŸCADæ ¼å¼è½¬æ¢

**è½¬æ¢è§„åˆ™**ï¼š

- SolidWorks â†’ STEP
- CATIA â†’ STEP
- AutoCAD â†’ STEP
- FreeCAD â†’ STEP

---

## 3. å‡ ä½•æ¨¡å‹è½¬æ¢

æ”¯æŒNURBSã€Bæ ·æ¡ã€B-repã€CSGç­‰å‡ ä½•è¡¨ç¤ºä¹‹é—´çš„è½¬æ¢ã€‚

---

## 4. ç»“æ„è®¾è®¡è½¬æ¢

æ”¯æŒç»“æ„è®¾è®¡æ•°æ®åˆ°æœ‰é™å…ƒåˆ†æè½¯ä»¶çš„è½¬æ¢ã€‚

---

## 5. æœºæ„è®¾è®¡è½¬æ¢

æ”¯æŒæœºæ„è®¾è®¡æ•°æ®åˆ°è¿åŠ¨ä»¿çœŸè½¯ä»¶çš„è½¬æ¢ã€‚

---

## 6. è½¬æ¢å·¥å…·

- **OpenCASCADE**ï¼šå¼€æºCADå†…æ ¸
- **FreeCAD**ï¼šå¼€æºCADè½¯ä»¶
- **CAD Exchanger**ï¼šCADæ ¼å¼è½¬æ¢å·¥å…·

---

## 7. è½¬æ¢éªŒè¯

éªŒè¯è½¬æ¢çš„å‡ ä½•å®Œæ•´æ€§ã€æ•°æ®å®Œæ•´æ€§å’Œè¯­ä¹‰ç­‰ä»·æ€§ã€‚

---

## 8. CADæ•°æ®å­˜å‚¨ä¸åˆ†æ

### 8.1 PostgreSQL CADæ•°æ®å­˜å‚¨

**CADæ•°æ®å­˜å‚¨æ–¹æ¡ˆ**ï¼š

```python
import psycopg2
import json
from typing import Dict, List, Optional
from datetime import datetime

class CADStorage:
    """CADæ•°æ®å­˜å‚¨ç³»ç»Ÿ"""

    def __init__(self, connection_string: str):
        self.conn = psycopg2.connect(connection_string)
        self.cur = self.conn.cursor()
        self._create_tables()

    def _create_tables(self):
        """åˆ›å»ºCADæ•°æ®è¡¨"""
        # å‡ ä½•æ¨¡å‹è¡¨
        self.cur.execute("""
            CREATE TABLE IF NOT EXISTS geometry_models (
                id SERIAL PRIMARY KEY,
                model_name VARCHAR(200) UNIQUE NOT NULL,
                model_type VARCHAR(50) NOT NULL,
                geometry_data JSONB NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """)

        # ç»“æ„è®¾è®¡è¡¨
        self.cur.execute("""
            CREATE TABLE IF NOT EXISTS structural_designs (
                id SERIAL PRIMARY KEY,
                design_name VARCHAR(200) UNIQUE NOT NULL,
                geometry_id INTEGER NOT NULL,
                material_data JSONB NOT NULL,
                loads_data JSONB,
                boundary_conditions JSONB,
                fea_model JSONB,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (geometry_id) REFERENCES geometry_models(id)
            )
        """)

        # æœºæ„è®¾è®¡è¡¨
        self.cur.execute("""
            CREATE TABLE IF NOT EXISTS mechanism_designs (
                id SERIAL PRIMARY KEY,
                mechanism_name VARCHAR(200) UNIQUE NOT NULL,
                joints_data JSONB NOT NULL,
                links_data JSONB NOT NULL,
                kinematics_data JSONB,
                dynamics_data JSONB,
                degrees_of_freedom INTEGER,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """)

        # è£…é…è¡¨
        self.cur.execute("""
            CREATE TABLE IF NOT EXISTS assemblies (
                id SERIAL PRIMARY KEY,
                assembly_name VARCHAR(200) UNIQUE NOT NULL,
                parts_data JSONB NOT NULL,
                relationships JSONB NOT NULL,
                constraints JSONB NOT NULL,
                hierarchy JSONB NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """)

        # å·¥ç¨‹å›¾è¡¨
        self.cur.execute("""
            CREATE TABLE IF NOT EXISTS engineering_drawings (
                id SERIAL PRIMARY KEY,
                drawing_number VARCHAR(100) UNIQUE NOT NULL,
                title VARCHAR(500),
                views_data JSONB NOT NULL,
                annotations JSONB,
                pmi_data JSONB,
                layers JSONB,
                title_block JSONB,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """)

        # CADæ–‡ä»¶ç‰ˆæœ¬è¡¨
        self.cur.execute("""
            CREATE TABLE IF NOT EXISTS cad_file_versions (
                id SERIAL PRIMARY KEY,
                file_name VARCHAR(500) NOT NULL,
                version_number VARCHAR(50) NOT NULL,
                file_format VARCHAR(50) NOT NULL,
                file_path TEXT,
                file_size BIGINT,
                checksum VARCHAR(64),
                metadata JSONB,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                UNIQUE(file_name, version_number)
            )
        """)

        # åˆ›å»ºç´¢å¼•
        self.cur.execute("""
            CREATE INDEX IF NOT EXISTS idx_geometry_model_type
            ON geometry_models(model_type)
        """)
        self.cur.execute("""
            CREATE INDEX IF NOT EXISTS idx_drawing_number
            ON engineering_drawings(drawing_number)
        """)

        self.conn.commit()

    def store_geometry_model(self, model_name: str, model_type: str,
                            geometry_data: Dict):
        """å­˜å‚¨å‡ ä½•æ¨¡å‹"""
        self.cur.execute("""
            INSERT INTO geometry_models
            (model_name, model_type, geometry_data)
            VALUES (%s, %s, %s::jsonb)
            ON CONFLICT (model_name) DO UPDATE
            SET model_type = EXCLUDED.model_type,
                geometry_data = EXCLUDED.geometry_data,
                updated_at = CURRENT_TIMESTAMP
        """, (model_name, model_type, json.dumps(geometry_data)))
        self.conn.commit()

    def store_structural_design(self, design_name: str, geometry_id: int,
                                material_data: Dict, loads_data: Dict = None,
                                boundary_conditions: Dict = None,
                                fea_model: Dict = None):
        """å­˜å‚¨ç»“æ„è®¾è®¡"""
        self.cur.execute("""
            INSERT INTO structural_designs
            (design_name, geometry_id, material_data, loads_data,
             boundary_conditions, fea_model)
            VALUES (%s, %s, %s::jsonb, %s::jsonb, %s::jsonb, %s::jsonb)
            ON CONFLICT (design_name) DO UPDATE
            SET geometry_id = EXCLUDED.geometry_id,
                material_data = EXCLUDED.material_data,
                loads_data = EXCLUDED.loads_data,
                boundary_conditions = EXCLUDED.boundary_conditions,
                fea_model = EXCLUDED.fea_model
        """, (design_name, geometry_id, json.dumps(material_data),
              json.dumps(loads_data or {}),
              json.dumps(boundary_conditions or {}),
              json.dumps(fea_model or {})))
        self.conn.commit()

    def store_mechanism_design(self, mechanism_name: str,
                               joints_data: Dict, links_data: Dict,
                               kinematics_data: Dict = None,
                               dynamics_data: Dict = None,
                               degrees_of_freedom: int = None):
        """å­˜å‚¨æœºæ„è®¾è®¡"""
        self.cur.execute("""
            INSERT INTO mechanism_designs
            (mechanism_name, joints_data, links_data, kinematics_data,
             dynamics_data, degrees_of_freedom)
            VALUES (%s, %s::jsonb, %s::jsonb, %s::jsonb, %s::jsonb, %s)
            ON CONFLICT (mechanism_name) DO UPDATE
            SET joints_data = EXCLUDED.joints_data,
                links_data = EXCLUDED.links_data,
                kinematics_data = EXCLUDED.kinematics_data,
                dynamics_data = EXCLUDED.dynamics_data,
                degrees_of_freedom = EXCLUDED.degrees_of_freedom
        """, (mechanism_name, json.dumps(joints_data),
              json.dumps(links_data),
              json.dumps(kinematics_data or {}),
              json.dumps(dynamics_data or {}),
              degrees_of_freedom))
        self.conn.commit()

    def store_assembly(self, assembly_name: str, parts_data: Dict,
                      relationships: Dict, constraints: Dict,
                      hierarchy: Dict):
        """å­˜å‚¨è£…é…"""
        self.cur.execute("""
            INSERT INTO assemblies
            (assembly_name, parts_data, relationships, constraints, hierarchy)
            VALUES (%s, %s::jsonb, %s::jsonb, %s::jsonb, %s::jsonb)
            ON CONFLICT (assembly_name) DO UPDATE
            SET parts_data = EXCLUDED.parts_data,
                relationships = EXCLUDED.relationships,
                constraints = EXCLUDED.constraints,
                hierarchy = EXCLUDED.hierarchy
        """, (assembly_name, json.dumps(parts_data),
              json.dumps(relationships), json.dumps(constraints),
              json.dumps(hierarchy)))
        self.conn.commit()

    def store_engineering_drawing(self, drawing_number: str, title: str,
                                 views_data: Dict, annotations: Dict = None,
                                 pmi_data: Dict = None, layers: Dict = None,
                                 title_block: Dict = None):
        """å­˜å‚¨å·¥ç¨‹å›¾"""
        self.cur.execute("""
            INSERT INTO engineering_drawings
            (drawing_number, title, views_data, annotations, pmi_data,
             layers, title_block)
            VALUES (%s, %s, %s::jsonb, %s::jsonb, %s::jsonb, %s::jsonb, %s::jsonb)
            ON CONFLICT (drawing_number) DO UPDATE
            SET title = EXCLUDED.title,
                views_data = EXCLUDED.views_data,
                annotations = EXCLUDED.annotations,
                pmi_data = EXCLUDED.pmi_data,
                layers = EXCLUDED.layers,
                title_block = EXCLUDED.title_block
        """, (drawing_number, title, json.dumps(views_data),
              json.dumps(annotations or {}), json.dumps(pmi_data or {}),
              json.dumps(layers or {}), json.dumps(title_block or {})))
        self.conn.commit()

    def store_cad_file_version(self, file_name: str, version_number: str,
                               file_format: str, file_path: str = None,
                               file_size: int = None, checksum: str = None,
                               metadata: Dict = None):
        """å­˜å‚¨CADæ–‡ä»¶ç‰ˆæœ¬"""
        self.cur.execute("""
            INSERT INTO cad_file_versions
            (file_name, version_number, file_format, file_path, file_size,
             checksum, metadata)
            VALUES (%s, %s, %s, %s, %s, %s, %s::jsonb)
            ON CONFLICT (file_name, version_number) DO UPDATE
            SET file_format = EXCLUDED.file_format,
                file_path = EXCLUDED.file_path,
                file_size = EXCLUDED.file_size,
                checksum = EXCLUDED.checksum,
                metadata = EXCLUDED.metadata
        """, (file_name, version_number, file_format, file_path,
              file_size, checksum, json.dumps(metadata or {})))
        self.conn.commit()
```

### 8.2 CADæ•°æ®åˆ†ææŸ¥è¯¢

**æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```python
# æŸ¥è¯¢å‡ ä½•æ¨¡å‹
storage.cur.execute("""
    SELECT model_name, model_type, geometry_data
    FROM geometry_models
    WHERE model_type = %s
""", ("BRepSolid",))

# æŸ¥è¯¢ç»“æ„è®¾è®¡
storage.cur.execute("""
    SELECT design_name, material_data, fea_model
    FROM structural_designs
    WHERE geometry_id = %s
""", (geometry_id,))

# æŸ¥è¯¢æœºæ„è®¾è®¡
storage.cur.execute("""
    SELECT mechanism_name, degrees_of_freedom, kinematics_data
    FROM mechanism_designs
    WHERE degrees_of_freedom = %s
""", (dof,))
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `05_Case_Studies.md` - å®è·µæ¡ˆä¾‹

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
