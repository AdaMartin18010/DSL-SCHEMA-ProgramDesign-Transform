# å¨èƒæ£€æµ‹å®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [å¨èƒæ£€æµ‹å®è·µæ¡ˆä¾‹](#å¨èƒæ£€æµ‹å®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šAIé©±åŠ¨çš„å¨èƒæ£€æµ‹å¹³å°](#2-æ¡ˆä¾‹1aié©±åŠ¨çš„å¨èƒæ£€æµ‹å¹³å°)
    - [2.1 ä¼ä¸šèƒŒæ™¯](#21-ä¼ä¸šèƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 è§£å†³æ–¹æ¡ˆ](#25-è§£å†³æ–¹æ¡ˆ)
    - [2.6 å®Œæ•´ä»£ç å®ç°](#26-å®Œæ•´ä»£ç å®ç°)
    - [2.7 æ•ˆæœè¯„ä¼°](#27-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹æ€»ç»“](#3-æ¡ˆä¾‹æ€»ç»“)
  - [4. å‚è€ƒæ–‡çŒ®](#4-å‚è€ƒæ–‡çŒ®)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å¨èƒæ£€æµ‹åœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–åŸºäºAIçš„å¼‚å¸¸æ£€æµ‹ã€è¡Œä¸ºåˆ†æã€å¨èƒæƒ…æŠ¥ã€è‡ªåŠ¨å“åº”ç­‰åœºæ™¯ã€‚

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **Darktrace**ï¼šAIé©±åŠ¨çš„ç½‘ç»œå®‰å…¨
- **CrowdStrike**ï¼šç«¯ç‚¹å¨èƒæ£€æµ‹
- **Microsoft Defender**ï¼šå…¨æ ˆå¨èƒé˜²æŠ¤

---

## 2. æ¡ˆä¾‹1ï¼šAIé©±åŠ¨çš„å¨èƒæ£€æµ‹å¹³å°

### 2.1 ä¼ä¸šèƒŒæ™¯

**ä¼ä¸šåç§°**ï¼šæŸå¤§å‹ç”µå•†å¹³å°ï¼ˆShopSecureï¼‰

**ä¼ä¸šè§„æ¨¡**ï¼š
- å‘˜å·¥äººæ•°ï¼š15000+
- æ—¥æ´»è·ƒç”¨æˆ·ï¼š5000ä¸‡+
- æ—¥å‡äº¤æ˜“ï¼š2000ä¸‡ç¬”
- æœåŠ¡å™¨æ•°é‡ï¼š50000+
- æ—¥å®‰å…¨æ—¥å¿—ï¼š500TB+

**æŠ€æœ¯æ ˆ**ï¼š
- SIEMï¼šSplunk Enterprise Security
- EDRï¼šCrowdStrike Falcon
- NDRï¼šDarktrace
- äº‘å¹³å°ï¼šAWS, Alibaba Cloud
- å¤§æ•°æ®ï¼šSpark, Kafka, Elasticsearch

### 2.2 ä¸šåŠ¡ç—›ç‚¹

1. **å‘Šè­¦ç–²åŠ³**ï¼šæ¯å¤©10ä¸‡+å®‰å…¨å‘Šè­¦ï¼Œæ— æ³•æœ‰æ•ˆå¤„ç†
2. **è¯¯æŠ¥ç‡é«˜**ï¼šä¼ ç»Ÿè§„åˆ™æ£€æµ‹è¯¯æŠ¥ç‡è¶…è¿‡80%
3. **æœªçŸ¥å¨èƒ**ï¼šæ— æ³•æ£€æµ‹0-dayæ”»å‡»å’ŒAPT
4. **å“åº”æ…¢**ï¼šä»å‘ç°å¨èƒåˆ°å“åº”å¹³å‡éœ€è¦6å°æ—¶
5. **æŠ€èƒ½ç¼ºå£**ï¼šç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨åˆ†æå¸ˆ

### 2.3 ä¸šåŠ¡ç›®æ ‡

1. **æ™ºèƒ½æ£€æµ‹**ï¼šä½¿ç”¨AIæ£€æµ‹æœªçŸ¥å¨èƒ
2. **é™å™ª90%**ï¼šå°†å‘Šè­¦é‡ä»10ä¸‡/å¤©é™ä½åˆ°1ä¸‡/å¤©
3. **å®æ—¶æ£€æµ‹**ï¼šå¨èƒæ£€æµ‹æ—¶é—´<1åˆ†é’Ÿ
4. **è‡ªåŠ¨å“åº”**ï¼šé«˜å±å¨èƒè‡ªåŠ¨å“åº”ï¼Œå“åº”æ—¶é—´<5åˆ†é’Ÿ
5. **é¢„æµ‹èƒ½åŠ›**ï¼šé¢„æµ‹æ½œåœ¨å¨èƒï¼Œæå‰é¢„é˜²

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. **æ•°æ®é‡å¤§**ï¼šæ¯å¤©500TBå®‰å…¨æ—¥å¿—
2. **å®æ—¶æ€§è¦æ±‚**ï¼šéœ€è¦å®æ—¶åˆ†æå’Œæ£€æµ‹
3. **æ¨¡å‹å‡†ç¡®æ€§**ï¼šå¹³è¡¡æ£€æµ‹ç‡å’Œè¯¯æŠ¥ç‡
4. **å¯¹æŠ—æ”»å‡»**ï¼šæ”»å‡»è€…å¯èƒ½é’ˆå¯¹æ£€æµ‹ç³»ç»Ÿ
5. **å¯è§£é‡Šæ€§**ï¼šéœ€è¦è§£é‡ŠAIçš„æ£€æµ‹å†³ç­–

### 2.5 è§£å†³æ–¹æ¡ˆ

**æ¶æ„è®¾è®¡**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AI-Driven Threat Detection Platform                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Data Ingestion Layer                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Syslog  â”‚ â”‚   EDR    â”‚ â”‚   NDR    â”‚ â”‚   Cloud Logs     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚          â”‚ â”‚ (Falcon) â”‚ â”‚(Darktrace)â”‚  â”‚ (CloudTrail)     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚            â”‚            â”‚                â”‚               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Stream Processing (Kafka)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    AI/ML Detection Engine                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Anomaly    â”‚  â”‚  Behavior   â”‚  â”‚    Threat           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Detection  â”‚  â”‚  Analysis   â”‚  â”‚    Intelligence     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  (AutoEncoder)â”‚  â”‚  (LSTM)    â”‚  â”‚    Matching         â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Graph      â”‚  â”‚  Clustering â”‚  â”‚    Deep Learning    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Analysis   â”‚  â”‚  (DBSCAN)   â”‚  â”‚    (Transformer)    â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Alert & Case Management                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Alert      â”‚  â”‚  Incident   â”‚  â”‚    Threat           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Correlationâ”‚  â”‚  Management â”‚  â”‚    Hunting          â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Automated Response (SOAR)                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Isolate â”‚ â”‚  Block   â”‚ â”‚  Collect â”‚ â”‚   Notify         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Host    â”‚ â”‚   IP     â”‚ â”‚ Evidence â”‚ â”‚   SOC            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶**ï¼š

1. **æ•°æ®æ‘„å…¥**ï¼šSyslog, EDR, NDR, Cloud Logs
2. **æµå¤„ç†**ï¼šKafka + Spark Streaming
3. **AIæ£€æµ‹**ï¼šå¼‚å¸¸æ£€æµ‹ã€è¡Œä¸ºåˆ†æã€å¨èƒæƒ…æŠ¥åŒ¹é…
4. **è‡ªåŠ¨å“åº”**ï¼šSOARå¹³å°è‡ªåŠ¨åŒ–å“åº”

### 2.6 å®Œæ•´ä»£ç å®ç°

**AIå¨èƒæ£€æµ‹å¹³å°Pythonå®ç°**ï¼š

```python
#!/usr/bin/env python3
"""
AIé©±åŠ¨çš„å¨èƒæ£€æµ‹å¹³å°
æ”¯æŒå¼‚å¸¸æ£€æµ‹ã€è¡Œä¸ºåˆ†æã€å¨èƒæƒ…æŠ¥åŒ¹é…ã€è‡ªåŠ¨å“åº”ç­‰åŠŸèƒ½
"""

import numpy as np
import pandas as pd
from typing import Dict, List, Optional, Tuple, Any
from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
import logging
import hashlib
import json
from collections import defaultdict
import pickle


class ThreatSeverity(Enum):
    """å¨èƒä¸¥é‡çº§åˆ«"""
    CRITICAL = 5
    HIGH = 4
    MEDIUM = 3
    LOW = 2
    INFO = 1


class ThreatCategory(Enum):
    """å¨èƒç±»åˆ«"""
    MALWARE = "malware"
    INTRUSION = "intrusion"
    DATA_EXFILTRATION = "data_exfiltration"
    LATERAL_MOVEMENT = "lateral_movement"
    PRIVILEGE_ESCALATION = "privilege_escalation"
    ANOMALY = "anomaly"


@dataclass
class SecurityEvent:
    """å®‰å…¨äº‹ä»¶"""
    id: str
    timestamp: datetime
    source_ip: str
    destination_ip: str
    event_type: str
    user_id: Optional[str]
    device_id: Optional[str]
    process_name: Optional[str]
    command_line: Optional[str]
    file_path: Optional[str]
    hash_md5: Optional[str]
    severity: int
    raw_data: Dict[str, Any]


@dataclass
class ThreatAlert:
    """å¨èƒå‘Šè­¦"""
    id: str
    timestamp: datetime
    category: ThreatCategory
    severity: ThreatSeverity
    title: str
    description: str
    affected_assets: List[str]
    indicators: List[Dict]
    confidence: float
    recommended_actions: List[str]
    events: List[str]


@dataclass
class BehaviorProfile:
    """è¡Œä¸ºç”»åƒ"""
    user_id: str
    baseline_patterns: Dict[str, Any]
    peer_group: str
    risk_score: float
    last_updated: datetime
    anomaly_history: List[Dict] = field(default_factory=list)


class AnomalyDetector:
    """å¼‚å¸¸æ£€æµ‹å™¨"""

    def __init__(self):
        self.logger = logging.getLogger('AnomalyDetector')
        self.models = {}
        self.thresholds = {}

    def train(self, data: pd.DataFrame, model_name: str = 'default'):
        """
        è®­ç»ƒå¼‚å¸¸æ£€æµ‹æ¨¡å‹
        
        Args:
            data: è®­ç»ƒæ•°æ®
            model_name: æ¨¡å‹åç§°
        """
        # ä½¿ç”¨Isolation Forestè¿›è¡Œå¼‚å¸¸æ£€æµ‹
        from sklearn.ensemble import IsolationForest
        
        # é€‰æ‹©æ•°å€¼ç‰¹å¾
        numeric_cols = data.select_dtypes(include=[np.number]).columns
        X = data[numeric_cols].fillna(0)
        
        model = IsolationForest(contamination=0.1, random_state=42)
        model.fit(X)
        
        self.models[model_name] = model
        self.thresholds[model_name] = -0.3  # å¼‚å¸¸åˆ†æ•°é˜ˆå€¼
        
        self.logger.info(f"æ¨¡å‹è®­ç»ƒå®Œæˆ: {model_name}")

    def detect(self, event: SecurityEvent, model_name: str = 'default') -> Tuple[bool, float]:
        """
        æ£€æµ‹å¼‚å¸¸
        
        Args:
            event: å®‰å…¨äº‹ä»¶
            model_name: æ¨¡å‹åç§°
            
        Returns:
            (æ˜¯å¦å¼‚å¸¸, å¼‚å¸¸åˆ†æ•°)
        """
        if model_name not in self.models:
            return False, 0.0
        
        # ç‰¹å¾å·¥ç¨‹
        features = self._extract_features(event)
        X = np.array([features])
        
        # é¢„æµ‹
        model = self.models[model_name]
        score = model.decision_function(X)[0]
        
        is_anomaly = score < self.thresholds[model_name]
        
        return is_anomaly, score

    def _extract_features(self, event: SecurityEvent) -> List[float]:
        """ä»äº‹ä»¶æå–ç‰¹å¾"""
        features = [
            event.severity,
            len(event.source_ip.split('.')) if event.source_ip else 0,
            len(event.destination_ip.split('.')) if event.destination_ip else 0,
            hash(event.event_type) % 1000,
            event.timestamp.hour,
            event.timestamp.weekday()
        ]
        
        return features


class BehaviorAnalyzer:
    """è¡Œä¸ºåˆ†æå™¨"""

    def __init__(self):
        self.profiles: Dict[str, BehaviorProfile] = {}
        self.logger = logging.getLogger('BehaviorAnalyzer')
        self.learning_window = timedelta(days=30)

    def create_profile(self, user_id: str) -> BehaviorProfile:
        """åˆ›å»ºç”¨æˆ·è¡Œä¸ºç”»åƒ"""
        profile = BehaviorProfile(
            user_id=user_id,
            baseline_patterns={},
            peer_group='',
            risk_score=0.0,
            last_updated=datetime.now(),
            anomaly_history=[]
        )
        
        self.profiles[user_id] = profile
        return profile

    def update_baseline(self, user_id: str, events: List[SecurityEvent]):
        """
        æ›´æ–°è¡Œä¸ºåŸºçº¿
        
        Args:
            user_id: ç”¨æˆ·ID
            events: å†å²äº‹ä»¶åˆ—è¡¨
        """
        if user_id not in self.profiles:
            self.create_profile(user_id)
        
        profile = self.profiles[user_id]
        
        # è®¡ç®—åŸºçº¿ç»Ÿè®¡
        patterns = {
            'login_hours': self._calculate_login_hours(events),
            'common_ips': self._calculate_common_ips(events),
            'common_processes': self._calculate_common_processes(events),
            'typical_data_volume': self._calculate_data_volume(events),
            'access_patterns': self._calculate_access_patterns(events)
        }
        
        profile.baseline_patterns = patterns
        profile.last_updated = datetime.now()
        
        self.logger.info(f"æ›´æ–°ç”¨æˆ·åŸºçº¿: {user_id}")

    def analyze_deviation(
        self,
        user_id: str,
        event: SecurityEvent
    ) -> Tuple[float, List[str]]:
        """
        åˆ†æè¡Œä¸ºåç¦»
        
        Args:
            user_id: ç”¨æˆ·ID
            event: å®‰å…¨äº‹ä»¶
            
        Returns:
            (åç¦»åˆ†æ•°, åç¦»åŸå› åˆ—è¡¨)
        """
        profile = self.profiles.get(user_id)
        if not profile:
            return 0.0, []
        
        deviation_score = 0.0
        reasons = []
        
        # æ£€æŸ¥ç™»å½•æ—¶é—´å¼‚å¸¸
        baseline_hours = profile.baseline_patterns.get('login_hours', [])
        if baseline_hours and event.timestamp.hour not in baseline_hours:
            deviation_score += 0.3
            reasons.append(f"å¼‚å¸¸ç™»å½•æ—¶é—´: {event.timestamp.hour}:00")
        
        # æ£€æŸ¥IPå¼‚å¸¸
        common_ips = profile.baseline_patterns.get('common_ips', [])
        if common_ips and event.source_ip not in common_ips:
            deviation_score += 0.4
            reasons.append(f"æ–°IPåœ°å€: {event.source_ip}")
        
        # æ£€æŸ¥è¿›ç¨‹å¼‚å¸¸
        if event.process_name:
            common_processes = profile.baseline_patterns.get('common_processes', [])
            if common_processes and event.process_name not in common_processes:
                deviation_score += 0.3
                reasons.append(f"æ–°è¿›ç¨‹: {event.process_name}")
        
        return min(deviation_score, 1.0), reasons

    def _calculate_login_hours(self, events: List[SecurityEvent]) -> List[int]:
        """è®¡ç®—å¸¸ç”¨ç™»å½•æ—¶é—´"""
        hours = [e.timestamp.hour for e in events]
        hour_counts = pd.Series(hours).value_counts()
        return hour_counts[hour_counts >= hour_counts.max() * 0.1].index.tolist()

    def _calculate_common_ips(self, events: List[SecurityEvent]) -> List[str]:
        """è®¡ç®—å¸¸ç”¨IP"""
        ips = [e.source_ip for e in events if e.source_ip]
        ip_counts = pd.Series(ips).value_counts()
        return ip_counts[ip_counts >= 3].index.tolist()

    def _calculate_common_processes(self, events: List[SecurityEvent]) -> List[str]:
        """è®¡ç®—å¸¸ç”¨è¿›ç¨‹"""
        processes = [e.process_name for e in events if e.process_name]
        process_counts = pd.Series(processes).value_counts()
        return process_counts[process_counts >= 5].index.tolist()

    def _calculate_data_volume(self, events: List[SecurityEvent]) -> Dict:
        """è®¡ç®—å…¸å‹æ•°æ®é‡"""
        return {'mean': 0, 'std': 0}  # ç®€åŒ–å®ç°

    def _calculate_access_patterns(self, events: List[SecurityEvent]) -> Dict:
        """è®¡ç®—è®¿é—®æ¨¡å¼"""
        return {}  # ç®€åŒ–å®ç°


class ThreatIntelligence:
    """å¨èƒæƒ…æŠ¥"""

    def __init__(self):
        self.ioc_database: Dict[str, Dict] = {
            'ips': {},
            'domains': {},
            'hashes': {},
            'urls': {}
        }
        self.logger = logging.getLogger('ThreatIntelligence')

    def add_ioc(self, ioc_type: str, value: str, metadata: Dict):
        """æ·»åŠ IOC"""
        if ioc_type in self.ioc_database:
            self.ioc_database[ioc_type][value] = {
                'metadata': metadata,
                'added_at': datetime.now().isoformat()
            }

    def check_ioc(self, ioc_type: str, value: str) -> Optional[Dict]:
        """
        æ£€æŸ¥IOC
        
        Args:
            ioc_type: IOCç±»å‹
            value: IOCå€¼
            
        Returns:
            IOCä¿¡æ¯ï¼ˆå¦‚æœåŒ¹é…ï¼‰
        """
        if ioc_type in self.ioc_database:
            return self.ioc_database[ioc_type].get(value)
        return None

    def enrich_event(self, event: SecurityEvent) -> List[Dict]:
        """
        å¢å¼ºäº‹ä»¶ä¿¡æ¯
        
        Args:
            event: å®‰å…¨äº‹ä»¶
            
        Returns:
            åŒ¹é…çš„å¨èƒæƒ…æŠ¥åˆ—è¡¨
        """
        matches = []
        
        # æ£€æŸ¥IP
        if event.source_ip:
            ip_intel = self.check_ioc('ips', event.source_ip)
            if ip_intel:
                matches.append({
                    'type': 'malicious_ip',
                    'value': event.source_ip,
                    'metadata': ip_intel['metadata']
                })
        
        # æ£€æŸ¥æ–‡ä»¶å“ˆå¸Œ
        if event.hash_md5:
            hash_intel = self.check_ioc('hashes', event.hash_md5)
            if hash_intel:
                matches.append({
                    'type': 'malware_hash',
                    'value': event.hash_md5,
                    'metadata': hash_intel['metadata']
                })
        
        return matches


class LateralMovementDetector:
    """æ¨ªå‘ç§»åŠ¨æ£€æµ‹å™¨"""

    def __init__(self):
        self.connection_graph = defaultdict(list)
        self.logger = logging.getLogger('LateralMovementDetector')

    def add_connection(self, source: str, destination: str, timestamp: datetime):
        """æ·»åŠ è¿æ¥è®°å½•"""
        self.connection_graph[source].append({
            'destination': destination,
            'timestamp': timestamp
        })

    def detect_lateral_movement(
        self,
        time_window: timedelta = timedelta(minutes=10)
    ) -> List[Dict]:
        """
        æ£€æµ‹æ¨ªå‘ç§»åŠ¨
        
        Args:
            time_window: æ—¶é—´çª—å£
            
        Returns:
            æ£€æµ‹ç»“æœåˆ—è¡¨
        """
        detections = []
        now = datetime.now()
        
        for source, connections in self.connection_graph.items():
            # è·å–æ—¶é—´çª—å£å†…çš„è¿æ¥
            recent = [
                c for c in connections
                if now - c['timestamp'] < time_window
            ]
            
            # æ£€æµ‹çŸ­æ—¶é—´å†…è¿æ¥å¤šä¸ªç›®æ ‡
            unique_destinations = set(c['destination'] for c in recent)
            if len(unique_destinations) >= 5:
                detections.append({
                    'source': source,
                    'destinations': list(unique_destinations),
                    'connection_count': len(recent),
                    'type': 'rapid_scanning'
                })
            
            # æ£€æµ‹å¼‚å¸¸è¿æ¥æ¨¡å¼
            admin_hosts = [c['destination'] for c in recent if self._is_admin_host(c['destination'])]
            if len(admin_hosts) >= 3:
                detections.append({
                    'source': source,
                    'admin_hosts': admin_hosts,
                    'type': 'privilege_hunting'
                })
        
        return detections

    def _is_admin_host(self, host: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºç®¡ç†ä¸»æœº"""
        # ç®€åŒ–çš„åˆ¤æ–­é€»è¾‘
        admin_patterns = ['dc', 'admin', 'pdc', 'bdc']
        return any(pattern in host.lower() for pattern in admin_patterns)


class AutoResponder:
    """è‡ªåŠ¨å“åº”å™¨"""

    def __init__(self):
        self.response_actions = {
            'isolate_host': self._isolate_host,
            'block_ip': self._block_ip,
            'disable_user': self._disable_user,
            'collect_evidence': self._collect_evidence,
            'notify_soc': self._notify_soc
        }
        self.logger = logging.getLogger('AutoResponder')

    def execute_response(
        self,
        alert: ThreatAlert,
        auto_execute: bool = False
    ) -> List[str]:
        """
        æ‰§è¡Œå“åº”
        
        Args:
            alert: å¨èƒå‘Šè­¦
            auto_execute: æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œ
            
        Returns:
            æ‰§è¡Œçš„å“åº”åŠ¨ä½œåˆ—è¡¨
        """
        executed = []
        
        for action in alert.recommended_actions:
            if action in self.response_actions:
                # é«˜å±å‘Šè­¦è‡ªåŠ¨æ‰§è¡Œ
                if auto_execute and alert.severity in [ThreatSeverity.CRITICAL, ThreatSeverity.HIGH]:
                    try:
                        self.response_actions[action](alert)
                        executed.append(action)
                    except Exception as e:
                        self.logger.error(f"å“åº”æ‰§è¡Œå¤±è´¥: {action} - {e}")
                else:
                    # ç­‰å¾…äººå·¥ç¡®è®¤
                    executed.append(f"{action} (pending approval)")
        
        return executed

    def _isolate_host(self, alert: ThreatAlert):
        """éš”ç¦»ä¸»æœº"""
        for asset in alert.affected_assets:
            self.logger.info(f"éš”ç¦»ä¸»æœº: {asset}")
            # å®é™…åº”è¯¥è°ƒç”¨EDR API

    def _block_ip(self, alert: ThreatAlert):
        """é˜»æ–­IP"""
        self.logger.info("é˜»æ–­æ¶æ„IP")
        # å®é™…åº”è¯¥è°ƒç”¨é˜²ç«å¢™API

    def _disable_user(self, alert: ThreatAlert):
        """ç¦ç”¨ç”¨æˆ·"""
        self.logger.info("ç¦ç”¨ç”¨æˆ·è´¦å·")
        # å®é™…åº”è¯¥è°ƒç”¨IAM API

    def _collect_evidence(self, alert: ThreatAlert):
        """æ”¶é›†è¯æ®"""
        self.logger.info(f"æ”¶é›†è¯æ®: {alert.id}")
        # å®é™…åº”è¯¥ä¿å­˜ç›¸å…³æ—¥å¿—å’Œæ–‡ä»¶

    def _notify_soc(self, alert: ThreatAlert):
        """é€šçŸ¥SOC"""
        self.logger.info(f"å‘é€SOCå‘Šè­¦: {alert.title}")
        # å®é™…åº”è¯¥å‘é€é‚®ä»¶æˆ–Slacké€šçŸ¥


class ThreatDetectionPlatform:
    """å¨èƒæ£€æµ‹å¹³å°"""

    def __init__(self):
        self.anomaly_detector = AnomalyDetector()
        self.behavior_analyzer = BehaviorAnalyzer()
        self.threat_intel = ThreatIntelligence()
        self.lateral_movement = LateralMovementDetector()
        self.auto_responder = AutoResponder()
        self.alerts: List[ThreatAlert] = []
        self.logger = logging.getLogger('ThreatDetectionPlatform')

    def process_event(self, event: SecurityEvent) -> Optional[ThreatAlert]:
        """
        å¤„ç†å®‰å…¨äº‹ä»¶
        
        Args:
            event: å®‰å…¨äº‹ä»¶
            
        Returns:
            å¨èƒå‘Šè­¦ï¼ˆå¦‚æœæ£€æµ‹åˆ°ï¼‰
        """
        indicators = []
        severity = ThreatSeverity.LOW
        category = ThreatCategory.ANOMALY
        
        # 1. å¼‚å¸¸æ£€æµ‹
        is_anomaly, anomaly_score = self.anomaly_detector.detect(event)
        if is_anomaly:
            indicators.append({
                'type': 'anomaly',
                'score': anomaly_score,
                'description': 'Statistical anomaly detected'
            })
            severity = ThreatSeverity.MEDIUM
        
        # 2. è¡Œä¸ºåˆ†æ
        if event.user_id:
            deviation_score, reasons = self.behavior_analyzer.analyze_deviation(
                event.user_id, event
            )
            if deviation_score > 0.5:
                indicators.append({
                    'type': 'behavioral_deviation',
                    'score': deviation_score,
                    'reasons': reasons
                })
                severity = max(severity, ThreatSeverity.HIGH)
        
        # 3. å¨èƒæƒ…æŠ¥åŒ¹é…
        intel_matches = self.threat_intel.enrich_event(event)
        for match in intel_matches:
            indicators.append(match)
            severity = ThreatSeverity.CRITICAL
            category = ThreatCategory.MALWARE
        
        # 4. æ¨ªå‘ç§»åŠ¨æ£€æµ‹
        self.lateral_movement.add_connection(
            event.source_ip,
            event.destination_ip,
            event.timestamp
        )
        
        # å¦‚æœæœ‰æŒ‡æ ‡ï¼Œåˆ›å»ºå‘Šè­¦
        if indicators:
            alert = ThreatAlert(
                id=hashlib.sha256(f"{event.id}-{datetime.now()}".encode()).hexdigest()[:16],
                timestamp=datetime.now(),
                category=category,
                severity=severity,
                title=f"{category.value.upper()} Detection",
                description=f"Detected {len(indicators)} suspicious indicators",
                affected_assets=[event.source_ip, event.destination_ip],
                indicators=indicators,
                confidence=min(sum(i.get('score', 0.5) for i in indicators), 1.0),
                recommended_actions=self._get_recommended_actions(severity, category),
                events=[event.id]
            )
            
            self.alerts.append(alert)
            
            # è‡ªåŠ¨å“åº”
            if severity in [ThreatSeverity.CRITICAL, ThreatSeverity.HIGH]:
                self.auto_responder.execute_response(alert, auto_execute=True)
            
            return alert
        
        return None

    def _get_recommended_actions(
        self,
        severity: ThreatSeverity,
        category: ThreatCategory
    ) -> List[str]:
        """è·å–æ¨èå“åº”åŠ¨ä½œ"""
        actions = ['notify_soc', 'collect_evidence']
        
        if severity in [ThreatSeverity.CRITICAL, ThreatSeverity.HIGH]:
            actions.extend(['isolate_host', 'block_ip'])
        
        if category == ThreatCategory.PRIVILEGE_ESCALATION:
            actions.append('disable_user')
        
        return actions

    def get_alert_summary(self) -> Dict:
        """è·å–å‘Šè­¦æ‘˜è¦"""
        summary = {
            'total_alerts': len(self.alerts),
            'by_severity': defaultdict(int),
            'by_category': defaultdict(int),
            'recent_critical': []
        }
        
        for alert in self.alerts:
            summary['by_severity'][alert.severity.name] += 1
            summary['by_category'][alert.category.value] += 1
            
            if (alert.severity == ThreatSeverity.CRITICAL and
                datetime.now() - alert.timestamp < timedelta(hours=24)):
                summary['recent_critical'].append({
                    'id': alert.id,
                    'title': alert.title,
                    'timestamp': alert.timestamp.isoformat()
                })
        
        return summary


def main():
    """ä¸»å‡½æ•°"""
    # åˆå§‹åŒ–å¹³å°
    platform = ThreatDetectionPlatform()
    
    # æ·»åŠ å¨èƒæƒ…æŠ¥
    platform.threat_intel.add_ioc(
        'ips',
        '192.168.1.100',
        {'threat_actor': 'APT28', 'malware_family': 'FancyBear'}
    )
    
    # å¤„ç†å®‰å…¨äº‹ä»¶
    event = SecurityEvent(
        id='evt001',
        timestamp=datetime.now(),
        source_ip='192.168.1.100',
        destination_ip='10.0.0.50',
        event_type='network_connection',
        user_id='user123',
        device_id='device456',
        process_name='cmd.exe',
        command_line='cmd.exe /c whoami',
        file_path=None,
        hash_md5=None,
        severity=3,
        raw_data={}
    )
    
    alert = platform.process_event(event)
    
    if alert:
        print(f"æ£€æµ‹åˆ°å¨èƒ: {alert.title}")
        print(f"ä¸¥é‡çº§åˆ«: {alert.severity.name}")
        print(f"ç½®ä¿¡åº¦: {alert.confidence}")
        print(f"æŒ‡æ ‡: {json.dumps(alert.indicators, indent=2)}")
    
    # è·å–æ‘˜è¦
    summary = platform.get_alert_summary()
    print(f"\nå‘Šè­¦æ‘˜è¦: {json.dumps(summary, indent=2)}")


if __name__ == '__main__':
    main()
```

### 2.7 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æ£€æµ‹æ—¶é—´ | 6å°æ—¶ | 30ç§’ | 720x |
| å‘Šè­¦é‡ | 10ä¸‡/å¤© | 8000/å¤© | 92%é™å™ª |
| è¯¯æŠ¥ç‡ | 80% | 15% | 81%é™ä½ |
| å¨èƒæ£€å‡ºç‡ | 60% | 92% | 53%æå‡ |
| MTTR | 6å°æ—¶ | 15åˆ†é’Ÿ | 24x |

**ROIåˆ†æ**ï¼š

1. **æˆæœ¬èŠ‚çº¦**ï¼š
   - å®‰å…¨äº‹ä»¶æŸå¤±ï¼šæ¯å¹´ 3000ä¸‡å…ƒ
   - äººå·¥åˆ†ææˆæœ¬ï¼šæ¯å¹´ 800ä¸‡å…ƒ
   - åˆè§„ç½šæ¬¾é¿å…ï¼šæ¯å¹´ 500ä¸‡å…ƒ

2. **æŠ•èµ„å›æŠ¥ç‡**ï¼š
   - æ€»æŠ•èµ„ï¼š1200ä¸‡å…ƒ
   - å¹´åº¦æ”¶ç›Šï¼š4300ä¸‡å…ƒ
   - ROIï¼š258%

**ç»éªŒæ•™è®­**ï¼š

1. **æ•°æ®è´¨é‡é‡è¦**ï¼šé«˜è´¨é‡æ•°æ®æ˜¯AIæ£€æµ‹çš„åŸºç¡€
2. **æŒç»­å­¦ä¹ **ï¼šæ¨¡å‹éœ€è¦æŒç»­å­¦ä¹ å’Œæ›´æ–°
3. **äººæœºåä½œ**ï¼šAIè¾…åŠ©è€Œéæ›¿ä»£å®‰å…¨åˆ†æå¸ˆ
4. **å¯è§£é‡Šæ€§**ï¼šéœ€è¦è§£é‡Šæ£€æµ‹ç»“æœçš„ä¾æ®

---

## 3. æ¡ˆä¾‹æ€»ç»“

### æˆåŠŸå› ç´ 

1. **AIæ£€æµ‹**ï¼šä½¿ç”¨AIæ£€æµ‹æœªçŸ¥å¨èƒ
2. **å¤šå±‚æ£€æµ‹**ï¼šå¼‚å¸¸æ£€æµ‹ã€è¡Œä¸ºåˆ†æã€æƒ…æŠ¥åŒ¹é…
3. **è‡ªåŠ¨å“åº”**ï¼šé«˜å±å¨èƒè‡ªåŠ¨å“åº”
4. **æŒç»­å­¦ä¹ **ï¼šæ¨¡å‹æŒç»­å­¦ä¹ å’Œä¼˜åŒ–

### æœ€ä½³å®è·µ

1. **åˆ†å±‚é˜²å¾¡**ï¼šå¤šå±‚æ¬¡çš„æ£€æµ‹æœºåˆ¶
2. **åŸºçº¿å­¦ä¹ **ï¼šå»ºç«‹ç”¨æˆ·å’Œå®ä½“è¡Œä¸ºåŸºçº¿
3. **å¨èƒæƒ…æŠ¥**ï¼šæ•´åˆå†…å¤–éƒ¨å¨èƒæƒ…æŠ¥
4. **å“åº”è‡ªåŠ¨åŒ–**ï¼šé«˜å±äº‹ä»¶è‡ªåŠ¨å“åº”

---

## 4. å‚è€ƒæ–‡çŒ®

- [MITRE ATT&CKæ¡†æ¶](https://attack.mitre.org/)
- [NISTç½‘ç»œå®‰å…¨æ¡†æ¶](https://www.nist.gov/cyberframework)
- [SANSå¨èƒæ£€æµ‹æŒ‡å—](https://www.sans.org/)

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025-01-21  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**ç»´æŠ¤è€…**ï¼šDSL Schemaç ”ç©¶å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2025-01-21
