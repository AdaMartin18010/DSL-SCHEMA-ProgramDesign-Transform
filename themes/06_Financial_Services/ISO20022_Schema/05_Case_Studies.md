# ISO 20022 Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [ISO 20022 Schemaå®è·µæ¡ˆä¾‹](#iso-20022-schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šGlobalPayé“¶è¡Œé›†å›¢ISO 20022æ”¯ä»˜ç°ä»£åŒ–é¡¹ç›®](#2-æ¡ˆä¾‹1globalpayé“¶è¡Œé›†å›¢iso-20022æ”¯ä»˜ç°ä»£åŒ–é¡¹ç›®)
    - [2.1 ä¼ä¸šèƒŒæ™¯](#21-ä¼ä¸šèƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 Schemaå®šä¹‰](#25-schemaå®šä¹‰)
    - [2.6 å®Œæ•´å®ç°ä»£ç ](#26-å®Œæ•´å®ç°ä»£ç )
    - [2.7 æ•ˆæœè¯„ä¼°](#27-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šcamt.053é“¶è¡Œå¯¹è´¦å•](#3-æ¡ˆä¾‹2camt053é“¶è¡Œå¯¹è´¦å•)
  - [4. æ¡ˆä¾‹3ï¼šseev.031å…¬å¸è¡ŒåŠ¨é€šçŸ¥](#4-æ¡ˆä¾‹3seev031å…¬å¸è¡ŒåŠ¨é€šçŸ¥)
  - [5. æ¡ˆä¾‹4ï¼šISO 20022åˆ°SWIFT MTè½¬æ¢](#5-æ¡ˆä¾‹4iso-20022åˆ°swift-mtè½¬æ¢)
  - [6. æ¡ˆä¾‹5ï¼šISO 20022æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5iso-20022æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ISO 20022 Schemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–è·¨å¢ƒæ”¯ä»˜ã€é“¶è¡Œå¯¹è´¦ã€å…¬å¸è¡ŒåŠ¨é€šçŸ¥ç­‰æ ¸å¿ƒé‡‘èåœºæ™¯ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šGlobalPayé“¶è¡Œé›†å›¢ISO 20022æ”¯ä»˜ç°ä»£åŒ–é¡¹ç›®

### 2.1 ä¼ä¸šèƒŒæ™¯

**GlobalPayé“¶è¡Œé›†å›¢**æ˜¯æ¬§æ´²é¢†å…ˆçš„è·¨å›½é‡‘èæœºæ„ï¼Œä¸šåŠ¡è¦†ç›–45ä¸ªå›½å®¶ï¼Œç®¡ç†èµ„äº§è¶…è¿‡8000äº¿æ¬§å…ƒã€‚è¯¥é›†å›¢æ¯æ—¥å¤„ç†è¶…è¿‡500ä¸‡ç¬”è·¨å¢ƒæ”¯ä»˜äº¤æ˜“ï¼ŒæœåŠ¡å®¢æˆ·åŒ…æ‹¬è·¨å›½å…¬å¸ã€é‡‘èæœºæ„å’Œä¸ªäººç”¨æˆ·ã€‚

- **æˆç«‹æ—¶é—´**ï¼š1985å¹´
- **å‘˜å·¥è§„æ¨¡**ï¼š45,000äºº
- **å¹´äº¤æ˜“é‡**ï¼š1.8äº¿ç¬”è·¨å¢ƒæ”¯ä»˜
- **æ ¸å¿ƒç³»ç»Ÿ**ï¼šåŸºäºSWIFT MTæ ‡å‡†çš„é—ç•™ç³»ç»Ÿï¼Œéƒ¨åˆ†å·²æœ‰25å¹´å†å²
- **ç›‘ç®¡è¦æ±‚**ï¼šéœ€åŒæ—¶æ»¡è¶³æ¬§æ´²å¤®è¡Œã€FEDã€FCAç­‰å¤šå®¶ç›‘ç®¡æœºæ„è¦æ±‚

### 2.2 ä¸šåŠ¡ç—›ç‚¹

| åºå· | ç—›ç‚¹ | å½±å“ç¨‹åº¦ | å½“å‰çŠ¶å†µ |
|------|------|----------|----------|
| 1 | **æ•°æ®å­—æ®µä¸è¶³** | é«˜ | MTæ ¼å¼å­—æ®µé™åˆ¶å¯¼è‡´æ— æ³•ä¼ è¾“å®Œæ•´æ±‡æ¬¾äºº/æ”¶æ¬¾äººä¿¡æ¯ï¼Œé€ æˆ30%çš„æ”¯ä»˜éœ€è¦äººå·¥å¹²é¢„ |
| 2 | **åˆè§„æˆæœ¬é«˜** | é«˜ | ä¸ºæ»¡è¶³åˆ¶è£ç­›æŸ¥è¦æ±‚ï¼Œéœ€ç»´æŠ¤å¤šå¥—æ•°æ®æ˜ å°„ç³»ç»Ÿï¼Œå¹´åº¦åˆè§„æˆæœ¬è¾¾1200ä¸‡æ¬§å…ƒ |
| 3 | **å¯¹è´¦æ•ˆç‡ä½** | ä¸­ | æœˆåº¦å¯¹è´¦éœ€5ä¸ªå·¥ä½œæ—¥ï¼Œé”™è¯¯ç‡8%ï¼Œäººå·¥å¤„ç†æˆæœ¬é«˜æ˜‚ |
| 4 | **ç›‘ç®¡æŠ¥å‘Šå¤æ‚** | é«˜ | ç›‘ç®¡æŠ¥å‘Šç”Ÿæˆéœ€72å°æ—¶ï¼Œæ— æ³•æ»¡è¶³å®æ—¶ç›‘ç®¡è¦æ±‚ |
| 5 | **ç³»ç»Ÿäº’æ“ä½œæ€§å·®** | ä¸­ | ä¸åˆä½œä¼™ä¼´é“¶è¡Œç³»ç»Ÿé›†æˆéœ€å®šåˆ¶åŒ–å¼€å‘ï¼Œå¹³å‡é›†æˆå‘¨æœŸ6ä¸ªæœˆ |

### 2.3 ä¸šåŠ¡ç›®æ ‡

| åºå· | ç›®æ ‡ | æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|------|------|--------|
| 1 | **æå‡ç›´é€šå¤„ç†ç‡** | STP Rate | ä»70%æå‡è‡³95% |
| 2 | **é™ä½åˆè§„æˆæœ¬** | å¹´åº¦åˆè§„æ”¯å‡º | å‡å°‘40% |
| 3 | **åŠ é€Ÿå¯¹è´¦æµç¨‹** | å¯¹è´¦æ—¶é—´ | ä»5å¤©ç¼©çŸ­è‡³T+1 |
| 4 | **å®ç°å®æ—¶æŠ¥å‘Š** | ç›‘ç®¡æŠ¥å‘Šç”Ÿæˆæ—¶é—´ | ä»72å°æ—¶ç¼©çŸ­è‡³1å°æ—¶ |
| 5 | **ç®€åŒ–ç³»ç»Ÿé›†æˆ** | æ–°é“¶è¡Œé›†æˆå‘¨æœŸ | ä»6ä¸ªæœˆç¼©çŸ­è‡³4å‘¨ |

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. **æ•°æ®æ¨¡å‹å¤æ‚åº¦é«˜**ï¼šISO 20022åŒ…å«è¶…è¿‡800ä¸ªæ¶ˆæ¯å®šä¹‰ï¼Œpacs.008æ¶ˆæ¯æœ¬èº«æœ‰150+ä¸ªå¯é€‰å­—æ®µï¼Œéœ€è¦è®¾è®¡çµæ´»çš„æ•°æ®æ˜ å°„ç­–ç•¥

2. **é—ç•™ç³»ç»Ÿå…¼å®¹æ€§**ï¼šæ ¸å¿ƒé“¶è¡Œç³»ç»ŸåŸºäºCOBOLå¼€å‘ï¼Œä¸XML/JSONæ ¼å¼çš„ISO 20022æ¶ˆæ¯é›†æˆéœ€è¦ä¸­é—´ä»¶æ¡¥æ¥

3. **é«˜å¯ç”¨æ€§è¦æ±‚**ï¼šæ”¯ä»˜ç³»ç»Ÿéœ€ä¿è¯99.99%å¯ç”¨æ€§ï¼Œæ¶ˆæ¯å¤„ç†å»¶è¿Ÿéœ€æ§åˆ¶åœ¨100msä»¥å†…

4. **å¤šå¸ç§å¤šè¯­è¨€æ”¯æŒ**ï¼šéœ€æ”¯æŒ150+å¸ç§å’Œ30+è¯­è¨€å­—ç¬¦é›†ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€é˜¿æ‹‰ä¼¯è¯­ç­‰éæ‹‰ä¸å­—ç¬¦

5. **ç›‘ç®¡åˆè§„å®æ—¶æ€§**ï¼šéœ€åœ¨æ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­å®æ—¶æ‰§è¡Œåˆ¶è£åå•ç­›æŸ¥ã€åæ´—é’±æ£€æŸ¥ç­‰åˆè§„æµç¨‹

### 2.5 Schemaå®šä¹‰

**pacs.008å®¢æˆ·è´·è®°è½¬è´¦ISO 20022 Schema**ï¼š

```dsl
schema Pacs008CustomerCreditTransfer {
  group_header: GroupHeader {
    message_identification: String @value("MSG-2025-001")
    creation_date_time: DateTime @value("2025-01-21T10:00:00Z")
    initiating_party: PartyIdentification43 {
      name: String @value("ABC Bank")
    }
  }

  payment_information: PaymentInstructionInformation {
    payment_information_identification: String @value("PAY-2025-001")
    payment_method: Enum @value("TRF")
    requested_execution_date: Date @value("2025-01-22")

    debtor: PartyIdentification43 {
      name: String @value("Customer A")
    }

    debtor_account: CashAccount16 {
      identification: AccountIdentification4Choice {
        iban: String @value("GB82WEST12345698765432")
      }
    }

    credit_transfer_transaction_information: List[CreditTransferTransactionInformation] {
      transaction1: CreditTransferTransactionInformation {
        payment_identification: PaymentIdentification3 {
          instruction_identification: String @value("INST-001")
          end_to_end_identification: String @value("E2E-001")
        }

        amount: AmountType3Choice {
          instructed_amount: ActiveCurrencyAndAmount {
            currency: String @value("USD")
            value: Decimal @value(10000.00)
          }
        }

        creditor: PartyIdentification43 {
          name: String @value("Customer B")
        }

        creditor_account: CashAccount16 {
          identification: AccountIdentification4Choice {
            iban: String @value("GB29NWBK60161331926819")
          }
        }
      }
    }
  }
} @standard("ISO_20022")
```

### 2.6 å®Œæ•´å®ç°ä»£ç 

```python
"""
GlobalPayé“¶è¡Œé›†å›¢ISO 20022æ”¯ä»˜å¤„ç†ç³»ç»Ÿ
å®ç°pacs.008æ¶ˆæ¯çš„è§£æã€éªŒè¯ã€è·¯ç”±å’Œå­˜å‚¨
"""

import xml.etree.ElementTree as ET
from dataclasses import dataclass, field
from datetime import datetime, date
from typing import Optional, List, Dict, Any, Tuple
from enum import Enum
import hashlib
import json
import re
from decimal import Decimal, ROUND_HALF_UP


class PaymentStatus(Enum):
    """æ”¯ä»˜çŠ¶æ€æšä¸¾"""
    RECEIVED = "RECEIVED"
    VALIDATED = "VALIDATED"
    SANCTIONS_CHECKED = "SANCTIONS_CHECKED"
    PROCESSING = "PROCESSING"
    SETTLED = "SETTLED"
    REJECTED = "REJECTED"


class ValidationError(Exception):
    """éªŒè¯é”™è¯¯å¼‚å¸¸"""
    pass


@dataclass
class PartyIdentification:
    """å‚ä¸æ–¹è¯†åˆ«ä¿¡æ¯"""
    name: str
    postal_address: Optional[Dict[str, Any]] = None
    identification: Optional[str] = None
    
    def validate(self) -> List[str]:
        """éªŒè¯å‚ä¸æ–¹ä¿¡æ¯"""
        errors = []
        if not self.name or len(self.name) > 140:
            errors.append(f"å‚ä¸æ–¹åç§°é•¿åº¦æ— æ•ˆ: {len(self.name) if self.name else 0}")
        return errors


@dataclass
class Amount:
    """é‡‘é¢ä¿¡æ¯"""
    currency: str
    value: Decimal
    
    def __post_init__(self):
        if isinstance(self.value, (int, float)):
            self.value = Decimal(str(self.value))
        self.value = self.value.quantize(Decimal('0.01'), rounding=ROUND_HALF_UP)
    
    def validate(self) -> List[str]:
        """éªŒè¯é‡‘é¢ä¿¡æ¯"""
        errors = []
        if not re.match(r'^[A-Z]{3}$', self.currency):
            errors.append(f"å¸ç§ä»£ç æ ¼å¼æ— æ•ˆ: {self.currency}")
        if self.value <= 0:
            errors.append(f"é‡‘é¢å¿…é¡»å¤§äº0: {self.value}")
        if self.value > Decimal('999999999999.99'):
            errors.append(f"é‡‘é¢è¶…å‡ºæœ€å¤§é™åˆ¶")
        return errors


@dataclass
class CreditTransferTransaction:
    """è´·è®°è½¬è´¦äº¤æ˜“ä¿¡æ¯"""
    instruction_id: str
    end_to_end_id: str
    amount: Amount
    creditor: PartyIdentification
    creditor_account: str
    remittance_info: Optional[str] = None
    purpose_code: Optional[str] = None
    
    def validate(self) -> List[str]:
        """éªŒè¯äº¤æ˜“ä¿¡æ¯"""
        errors = []
        if not re.match(r'^[a-zA-Z0-9]{1,35}$', self.instruction_id):
            errors.append(f"æŒ‡ä»¤IDæ ¼å¼æ— æ•ˆ: {self.instruction_id}")
        if not re.match(r'^[a-zA-Z0-9]{1,35}$', self.end_to_end_id):
            errors.append(f"ç«¯åˆ°ç«¯IDæ ¼å¼æ— æ•ˆ: {self.end_to_end_id}")
        errors.extend(self.amount.validate())
        errors.extend(self.creditor.validate())
        if not re.match(r'^[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}$', self.creditor_account):
            errors.append(f"å€ºæƒäººè´¦æˆ·IBANæ ¼å¼æ— æ•ˆ: {self.creditor_account}")
        return errors


@dataclass
class Pacs008Message:
    """pacs.008æ¶ˆæ¯æ•°æ®ç±»"""
    message_id: str
    creation_datetime: datetime
    initiating_party: PartyIdentification
    payment_info_id: str
    payment_method: str
    requested_execution_date: date
    debtor: PartyIdentification
    debtor_account: str
    transactions: List[CreditTransferTransaction] = field(default_factory=list)
    
    def __post_init__(self):
        if isinstance(self.creation_datetime, str):
            self.creation_datetime = datetime.fromisoformat(self.creation_datetime.replace('Z', '+00:00'))
        if isinstance(self.requested_execution_date, str):
            self.requested_execution_date = date.fromisoformat(self.requested_execution_date)
    
    def validate(self) -> Tuple[bool, List[str]]:
        """éªŒè¯å®Œæ•´æ¶ˆæ¯"""
        errors = []
        
        # éªŒè¯æ¶ˆæ¯ID
        if not re.match(r'^[a-zA-Z0-9]{1,35}$', self.message_id):
            errors.append(f"æ¶ˆæ¯IDæ ¼å¼æ— æ•ˆ: {self.message_id}")
        
        # éªŒè¯åˆ›å»ºæ—¶é—´
        if self.creation_datetime > datetime.now():
            errors.append("åˆ›å»ºæ—¶é—´ä¸èƒ½æ˜¯æœªæ¥æ—¶é—´")
        
        # éªŒè¯æ‰§è¡Œæ—¥æœŸ
        if self.requested_execution_date < date.today():
            errors.append("è¯·æ±‚æ‰§è¡Œæ—¥æœŸä¸èƒ½æ˜¯è¿‡å»æ—¥æœŸ")
        
        # éªŒè¯å‚ä¸æ–¹
        errors.extend(self.initiating_party.validate())
        errors.extend(self.debtor.validate())
        
        # éªŒè¯å€ºåŠ¡äººè´¦æˆ·
        if not re.match(r'^[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}$', self.debtor_account):
            errors.append(f"å€ºåŠ¡äººè´¦æˆ·IBANæ ¼å¼æ— æ•ˆ: {self.debtor_account}")
        
        # éªŒè¯äº¤æ˜“
        if not self.transactions:
            errors.append("è‡³å°‘éœ€è¦ä¸€ä¸ªäº¤æ˜“")
        total_amount = Decimal('0')
        for txn in self.transactions:
            errors.extend(txn.validate())
            total_amount += txn.amount.value
        
        # éªŒè¯å•ç¬”å’Œæ—¥ç´¯è®¡é™é¢
        if total_amount > Decimal('10000000'):  # 1000ä¸‡é™é¢
            errors.append(f"å•ç¬”æ”¯ä»˜é‡‘é¢è¶…å‡ºé™é¢: {total_amount}")
        
        return len(errors) == 0, errors
    
    def calculate_hash(self) -> str:
        """è®¡ç®—æ¶ˆæ¯å“ˆå¸Œç”¨äºå»é‡"""
        content = f"{self.message_id}:{self.creation_datetime.isoformat()}:{len(self.transactions)}"
        return hashlib.sha256(content.encode()).hexdigest()[:16]
    
    def to_xml(self) -> str:
        """è½¬æ¢ä¸ºISO 20022 XMLæ ¼å¼"""
        ns = "urn:iso:std:iso:20022:tech:xsd:pacs.008.001.08"
        root = ET.Element("{urn:iso:std:iso:20022:tech:xsd:pacs.008.001.08}Document")
        root.set("xmlns", ns)
        
        cdt_trf_tx_inf = ET.SubElement(root, "FIToFICstmrCdtTrf")
        
        # Group Header
        grp_hdr = ET.SubElement(cdt_trf_tx_inf, "GrpHdr")
        ET.SubElement(grp_hdr, "MsgId").text = self.message_id
        ET.SubElement(grp_hdr, "CreDtTm").text = self.creation_datetime.isoformat()
        
        initg_pty = ET.SubElement(grp_hdr, "InitgPty")
        ET.SubElement(initg_pty, "Nm").text = self.initiating_party.name
        
        # Credit Transfer Transaction Information
        for txn in self.transactions:
            cdt_trf_tx_inf_elem = ET.SubElement(cdt_trf_tx_inf, "CdtTrfTxInf")
            
            pmt_id = ET.SubElement(cdt_trf_tx_inf_elem, "PmtId")
            ET.SubElement(pmt_id, "InstrId").text = txn.instruction_id
            ET.SubElement(pmt_id, "EndToEndId").text = txn.end_to_end_id
            
            amt = ET.SubElement(cdt_trf_tx_inf_elem, "Amt")
            instd_amt = ET.SubElement(amt, "InstdAmt")
            instd_amt.set("Ccy", txn.amount.currency)
            instd_amt.text = str(txn.amount.value)
            
            cdtr = ET.SubElement(cdt_trf_tx_inf_elem, "Cdtr")
            ET.SubElement(cdtr, "Nm").text = txn.creditor.name
            
            cdtr_acct = ET.SubElement(cdt_trf_tx_inf_elem, "CdtrAcct")
            id_elem = ET.SubElement(cdtr_acct, "Id")
            ET.SubElement(id_elem, "IBAN").text = txn.creditor_account
        
        return ET.tostring(root, encoding='unicode')
    
    @classmethod
    def from_xml(cls, xml_string: str) -> 'Pacs008Message':
        """ä»XMLè§£æpacs.008æ¶ˆæ¯"""
        root = ET.fromstring(xml_string)
        ns = {'ns': 'urn:iso:std:iso:20022:tech:xsd:pacs.008.001.08'}
        
        cdt_trf = root.find('.//ns:FIToFICstmrCdtTrf', ns)
        grp_hdr = cdt_trf.find('ns:GrpHdr', ns)
        
        message_id = grp_hdr.find('ns:MsgId', ns).text
        creation_datetime = datetime.fromisoformat(grp_hdr.find('ns:CreDtTm', ns).text)
        initiating_party = PartyIdentification(
            name=grp_hdr.find('ns:InitgPty/ns:Nm', ns).text
        )
        
        transactions = []
        for txn_elem in cdt_trf.findall('ns:CdtTrfTxInf', ns):
            amt_elem = txn_elem.find('ns:Amt/ns:InstdAmt', ns)
            txn = CreditTransferTransaction(
                instruction_id=txn_elem.find('ns:PmtId/ns:InstrId', ns).text,
                end_to_end_id=txn_elem.find('ns:PmtId/ns:EndToEndId', ns).text,
                amount=Amount(
                    currency=amt_elem.get('Ccy'),
                    value=Decimal(amt_elem.text)
                ),
                creditor=PartyIdentification(
                    name=txn_elem.find('ns:Cdtr/ns:Nm', ns).text
                ),
                creditor_account=txn_elem.find('ns:CdtrAcct/ns:Id/ns:IBAN', ns).text
            )
            transactions.append(txn)
        
        return cls(
            message_id=message_id,
            creation_datetime=creation_datetime,
            initiating_party=initiating_party,
            payment_info_id="",
            payment_method="TRF",
            requested_execution_date=date.today(),
            debtor=PartyIdentification(name=""),
            debtor_account="",
            transactions=transactions
        )


class SanctionsChecker:
    """åˆ¶è£åå•æ£€æŸ¥å™¨"""
    
    def __init__(self):
        self.sanctions_list = set()  # æ¨¡æ‹Ÿåˆ¶è£åå•
    
    def check_party(self, party: PartyIdentification) -> Tuple[bool, List[str]]:
        """æ£€æŸ¥å‚ä¸æ–¹æ˜¯å¦åœ¨åˆ¶è£åå•ä¸­"""
        hits = []
        # æ¨¡æ‹Ÿåˆ¶è£æ£€æŸ¥é€»è¾‘
        for name in [party.name, party.identification]:
            if name and any(sanctioned in name.upper() for sanctioned in self.sanctions_list):
                hits.append(f"åˆ¶è£åå•å‘½ä¸­: {name}")
        return len(hits) == 0, hits
    
    def check_transaction(self, txn: CreditTransferTransaction) -> Tuple[bool, List[str]]:
        """æ£€æŸ¥äº¤æ˜“æ˜¯å¦æ¶‰åŠåˆ¶è£"""
        creditor_ok, creditor_hits = self.check_party(txn.creditor)
        return creditor_ok, creditor_hits


class Pacs008Processor:
    """pacs.008æ¶ˆæ¯å¤„ç†å™¨"""
    
    def __init__(self, sanctions_checker: SanctionsChecker):
        self.sanctions_checker = sanctions_checker
        self.processed_hashes = set()  # å»é‡ç¼“å­˜
        self.message_stats = {
            'total_received': 0,
            'validated': 0,
            'sanctions_blocked': 0,
            'settled': 0,
            'errors': 0
        }
    
    def process_message(self, message: Pacs008Message) -> Dict[str, Any]:
        """å¤„ç†pacs.008æ¶ˆæ¯"""
        result = {
            'message_id': message.message_id,
            'status': PaymentStatus.RECEIVED.value,
            'timestamp': datetime.now().isoformat(),
            'details': {}
        }
        
        self.message_stats['total_received'] += 1
        
        # 1. å»é‡æ£€æŸ¥
        msg_hash = message.calculate_hash()
        if msg_hash in self.processed_hashes:
            result['status'] = PaymentStatus.REJECTED.value
            result['details']['error'] = 'é‡å¤æ¶ˆæ¯'
            self.message_stats['errors'] += 1
            return result
        self.processed_hashes.add(msg_hash)
        
        # 2. éªŒè¯æ¶ˆæ¯æ ¼å¼
        is_valid, errors = message.validate()
        if not is_valid:
            result['status'] = PaymentStatus.REJECTED.value
            result['details']['validation_errors'] = errors
            self.message_stats['errors'] += 1
            return result
        
        self.message_stats['validated'] += 1
        result['status'] = PaymentStatus.VALIDATED.value
        
        # 3. åˆ¶è£æ£€æŸ¥
        for txn in message.transactions:
            is_clean, hits = self.sanctions_checker.check_transaction(txn)
            if not is_clean:
                result['status'] = PaymentStatus.REJECTED.value
                result['details']['sanctions_hits'] = hits
                self.message_stats['sanctions_blocked'] += 1
                return result
        
        result['status'] = PaymentStatus.SANCTIONS_CHECKED.value
        
        # 4. æ¨¡æ‹Ÿå¤„ç†
        result['status'] = PaymentStatus.PROCESSING.value
        
        # 5. æ¨¡æ‹Ÿç»“ç®—
        result['status'] = PaymentStatus.SETTLED.value
        self.message_stats['settled'] += 1
        
        return result
    
    def get_statistics(self) -> Dict[str, Any]:
        """è·å–å¤„ç†ç»Ÿè®¡"""
        total = self.message_stats['total_received']
        return {
            **self.message_stats,
            'stp_rate': (self.message_stats['settled'] / total * 100) if total > 0 else 0,
            'rejection_rate': (self.message_stats['errors'] / total * 100) if total > 0 else 0
        }


def main():
    """ä¸»å‡½æ•° - ç¤ºä¾‹ç”¨æ³•"""
    # åˆå§‹åŒ–ç»„ä»¶
    sanctions_checker = SanctionsChecker()
    processor = Pacs008Processor(sanctions_checker)
    
    # åˆ›å»ºç¤ºä¾‹æ¶ˆæ¯
    message = Pacs008Message(
        message_id="PACS008-20250121-001",
        creation_datetime=datetime.now(),
        initiating_party=PartyIdentification(name="GlobalPay Bank AG"),
        payment_info_id="PAY-2025-001",
        payment_method="TRF",
        requested_execution_date=date.today(),
        debtor=PartyIdentification(name="ABC Corporation GmbH"),
        debtor_account="DE89370400440532013000",
        transactions=[
            CreditTransferTransaction(
                instruction_id="INST-001",
                end_to_end_id="E2E-ABC-001",
                amount=Amount(currency="EUR", value=Decimal("50000.00")),
                creditor=PartyIdentification(name="XYZ Industries Ltd"),
                creditor_account="GB29NWBK60161331926819",
                remittance_info="Invoice #2025-001 Payment"
            )
        ]
    )
    
    # å¤„ç†æ¶ˆæ¯
    result = processor.process_message(message)
    print(f"å¤„ç†ç»“æœ: {json.dumps(result, indent=2, default=str)}")
    
    # è·å–ç»Ÿè®¡
    stats = processor.get_statistics()
    print(f"\nå¤„ç†ç»Ÿè®¡: {json.dumps(stats, indent=2, default=str)}")
    
    # è½¬æ¢ä¸ºXML
    xml_output = message.to_xml()
    print(f"\nXMLè¾“å‡º (å‰500å­—ç¬¦):\n{xml_output[:500]}...")


if __name__ == "__main__":
    main()
```

### 2.7 æ•ˆæœè¯„ä¼°

#### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | æ”¹å–„å¹…åº¦ |
|------|--------|--------|----------|
| ç›´é€šå¤„ç†ç‡ (STP) | 70% | 96% | +26% |
| å¹³å‡å¤„ç†æ—¶é—´ | 2.5ç§’ | 95ms | -96% |
| äººå·¥å¹²é¢„ç‡ | 30% | 4% | -86% |
| æœˆåº¦å¯¹è´¦æ—¶é—´ | 5å·¥ä½œæ—¥ | 1å·¥ä½œæ—¥ | -80% |
| ç›‘ç®¡æŠ¥å‘Šç”Ÿæˆ | 72å°æ—¶ | 45åˆ†é’Ÿ | -99% |
| ç³»ç»Ÿé›†æˆå‘¨æœŸ | 6ä¸ªæœˆ | 3å‘¨ | -87% |

#### ROIè®¡ç®—

**æŠ•èµ„æˆæœ¬**ï¼ˆ18ä¸ªæœˆé¡¹ç›®å‘¨æœŸï¼‰ï¼š
- è½¯ä»¶è®¸å¯å’Œå¼€å‘ï¼š450ä¸‡æ¬§å…ƒ
- åŸºç¡€è®¾æ–½å‡çº§ï¼š180ä¸‡æ¬§å…ƒ
- åŸ¹è®­å’Œå˜é©ç®¡ç†ï¼š70ä¸‡æ¬§å…ƒ
- **æ€»æŠ•èµ„**ï¼š700ä¸‡æ¬§å…ƒ

**å¹´åº¦æ”¶ç›Š**ï¼š
- åˆè§„æˆæœ¬èŠ‚çº¦ï¼š480ä¸‡æ¬§å…ƒ
- äººå·¥å¤„ç†æˆæœ¬èŠ‚çº¦ï¼š320ä¸‡æ¬§å…ƒ
- ç³»ç»Ÿç»´æŠ¤æˆæœ¬èŠ‚çº¦ï¼š150ä¸‡æ¬§å…ƒ
- **å¹´åº¦æ€»æ”¶ç›Š**ï¼š950ä¸‡æ¬§å…ƒ

**ROIåˆ†æ**ï¼š
- æŠ•èµ„å›æ”¶æœŸï¼š8.9ä¸ªæœˆ
- 3å¹´ROIï¼š307%
- 5å¹´NPVï¼ˆæŠ˜ç°ç‡8%ï¼‰ï¼š2850ä¸‡æ¬§å…ƒ

#### ç»éªŒæ•™è®­

**æˆåŠŸå› ç´ **ï¼š
1. **åˆ†é˜¶æ®µè¿ç§»ç­–ç•¥**ï¼šå…ˆå¤„ç†æ–°æ”¯ä»˜ï¼Œå†è¿ç§»å­˜é‡æµç¨‹ï¼Œé™ä½é£é™©
2. **æ²™ç®±ç¯å¢ƒå……åˆ†æµ‹è¯•**ï¼šæ¨¡æ‹Ÿ2000ä¸‡ç¬”å†å²äº¤æ˜“è¿›è¡Œå›å½’æµ‹è¯•
3. **ä¸šåŠ¡ä¸æŠ€æœ¯æ·±åº¦èåˆ**ï¼šæ”¯ä»˜ä¸“å®¶å›¢é˜Ÿå…¨ç¨‹å‚ä¸Schemaè®¾è®¡

**æŒ‘æˆ˜ä¸åº”å¯¹**ï¼š
1. **é—ç•™COBOLç³»ç»Ÿé›†æˆ**ï¼šå¼€å‘é€‚é…å™¨æ¨¡å¼ï¼Œä¿æŒæ ¸å¿ƒç³»ç»Ÿä¸å˜
2. **å‘˜å·¥æŠ€èƒ½å·®è·**ï¼šå»ºç«‹ISO 20022å­¦é™¢ï¼ŒåŸ¹è®­200+åå‘˜å·¥
3. **åˆä½œä¼™ä¼´åè°ƒ**ï¼šå»ºç«‹è¡Œä¸šè”ç›Ÿï¼Œæ¨åŠ¨äº§ä¸šé“¾åŒæ­¥å‡çº§

**å…³é”®å»ºè®®**ï¼š
- æå‰6ä¸ªæœˆå¼€å§‹åˆ¶è£åå•ç³»ç»Ÿæ”¹é€ 
- ä¿ç•™MT-MXåŒå‘è½¬æ¢èƒ½åŠ›è‡³å°‘3å¹´
- å»ºç«‹å®æ—¶æ¶ˆæ¯ç›‘æ§å¤§å±ï¼Œæå‡è¿ç»´æ•ˆç‡

---

## 3. æ¡ˆä¾‹2ï¼šcamt.053é“¶è¡Œå¯¹è´¦å•

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
é“¶è¡Œä½¿ç”¨camt.053æ¶ˆæ¯å‘å®¢æˆ·å‘é€é“¶è¡Œå¯¹è´¦å•ï¼Œæ”¯æŒä¼ä¸šç°é‡‘ç®¡ç†è‡ªåŠ¨åŒ–ã€‚

**ä¼ä¸šèƒŒæ™¯**ï¼šè·¨å›½åˆ¶é€ ä¼ä¸šï¼Œæœˆå‡äº¤æ˜“50ä¸‡ç¬”ï¼Œéœ€è¦å¯¹è´¦è‡ªåŠ¨åŒ–

**ä¸šåŠ¡ç—›ç‚¹**ï¼š
1. å¯¹è´¦æ–‡ä»¶æ ¼å¼ä¸ç»Ÿä¸€ï¼Œéœ€è¦äººå·¥è½¬æ¢
2. äº¤æ˜“æ˜ç»†ä¿¡æ¯ä¸å®Œæ•´ï¼Œéš¾ä»¥è‡ªåŠ¨åŒ¹é…
3. å¤šå¸ç§å¯¹è´¦å¤æ‚ï¼Œæ±‡ç‡å¤„ç†å›°éš¾
4. å†å²æ•°æ®æŸ¥è¯¢æ…¢ï¼Œå½±å“å†³ç­–æ•ˆç‡
5. å¼‚å¸¸äº¤æ˜“å‘ç°æ»åï¼Œé£é™©æ•å£å¤§

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š
1. camt.053æ¶ˆæ¯ç»“æ„å¤æ‚ï¼ŒåŒ…å«å¤šå±‚åµŒå¥—
2. éœ€è¦æ”¯æŒå¤šç§å¯¹è´¦ç²’åº¦ï¼ˆæ—¥/å‘¨/æœˆï¼‰
3. éœ€è¦ä¸ERPç³»ç»Ÿå®æ—¶é›†æˆ
4. å¤§æ•°æ®é‡å¤„ç†èƒ½åŠ›è¦æ±‚é«˜

### 3.2 Schemaå®šä¹‰

```dsl
schema Camt053BankStatement {
  bank_to_customer_statement: BankToCustomerStatement {
    group_header: GroupHeader {
      message_identification: String @value("STMT-2025-001")
      creation_date_time: DateTime @value("2025-01-21T09:00:00Z")
    }

    statement: List[AccountStatement] {
      statement1: AccountStatement {
        id: String @value("STMT-ACC-001")
        account: CashAccount20 {
          identification: AccountIdentification4Choice {
            iban: String @value("GB82WEST12345698765432")
          }
          currency: String @value("USD")
        }

        balance: List[CashBalance] {
          opening_balance: CashBalance {
            type: BalanceType12Choice {
              code: Enum @value("OPNG")
            }
            amount: AmountAndCurrencyExchangeDetails3 {
              amount: ActiveOrHistoricCurrencyAndAmount {
                currency: String @value("USD")
                value: Decimal @value(50000.00)
              }
            }
            credit_debit_indicator: Enum @value("CRDT")
            date: DateAndDateTimeChoice {
              date: Date @value("2025-01-01")
            }
          }

          closing_balance: CashBalance {
            type: BalanceType12Choice {
              code: Enum @value("CLSG")
            }
            amount: AmountAndCurrencyExchangeDetails3 {
              amount: ActiveOrHistoricCurrencyAndAmount {
                currency: String @value("USD")
                value: Decimal @value(60000.00)
              }
            }
            credit_debit_indicator: Enum @value("CRDT")
            date: DateAndDateTimeChoice {
              date: Date @value("2025-01-31")
            }
          }
        }

        entry: List[ReportEntry] {
          entry1: ReportEntry {
            entry_reference: String @value("ENTRY-001")
            amount: AmountAndCurrencyExchangeDetails3 {
              amount: ActiveOrHistoricCurrencyAndAmount {
                currency: String @value("USD")
                value: Decimal @value(10000.00)
              }
            }
            credit_debit_indicator: Enum @value("CRDT")
            status: EntryStatus2Code @value("BOOK")
            booking_date: DateAndDateTimeChoice {
              date: Date @value("2025-01-15")
            }
          }
        }
      }
    }
  }
} @standard("ISO_20022")
```

**æ•ˆæœè¯„ä¼°**ï¼š
- å¯¹è´¦è‡ªåŠ¨åŒ–ç‡ä»35%æå‡è‡³92%
- æœˆåº¦ç»“è´¦æ—¶é—´ä»10å¤©ç¼©çŸ­è‡³2å¤©
- å¼‚å¸¸äº¤æ˜“å‘ç°æ—¶é—´ä»T+3ç¼©çŸ­è‡³å®æ—¶

---

## 4. æ¡ˆä¾‹3ï¼šseev.031å…¬å¸è¡ŒåŠ¨é€šçŸ¥

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
è¯åˆ¸æ‰˜ç®¡æœºæ„ä½¿ç”¨seev.031æ¶ˆæ¯é€šçŸ¥å®¢æˆ·å…¬å¸è¡ŒåŠ¨äº‹ä»¶ï¼ŒåŒ…æ‹¬è‚¡æ¯æ´¾å‘ã€è‚¡ç¥¨åˆ†å‰²ã€å¹¶è´­ç­‰ã€‚

**ä¼ä¸šèƒŒæ™¯**ï¼šæ¬§æ´²å¤§å‹è¯åˆ¸æ‰˜ç®¡é“¶è¡Œï¼Œç®¡ç†èµ„äº§5ä¸‡äº¿æ¬§å…ƒ

### 4.2 Schemaå®šä¹‰

```dsl
schema Seev031CorporateActionNotification {
  corporate_action_notification: CorporateActionNotification {
    notification_general_information: CorporateActionNotification2 {
      notification_type: CorporateActionNotificationType1Code @value("NEWM")
      notification_date: Date @value("2025-01-21")
    }

    corporate_action_general_information: CorporateActionGeneralInformation {
      corporate_action_event_identification: String @value("CA-2025-001")
      corporate_action_event_type: CorporateActionEventType3Choice {
        code: Enum @value("DVCA")
      }
      underlying_security: SecurityIdentification14 {
        identification: String @value("US0378331005")
        description: String @value("Apple Inc. Common Stock")
      }
    }

    account_and_balance_details: List[AccountAndBalanceDetails] {
      account1: AccountAndBalanceDetails {
        safekeeping_account: String @value("ACC-001")
        balance: CorporateActionBalanceDetails {
          total_eligible_balance: Quantity3Choice {
            quantity: Decimal @value(1000.00)
          }
        }
      }
    }

    corporate_action_details: CorporateActionDetails {
      date_details: CorporateActionDate8 {
        record_date: DateAndDateTimeChoice {
          date: Date @value("2025-02-01")
        }
        ex_date: DateAndDateTimeChoice {
          date: Date @value("2025-01-30")
        }
        payment_date: DateAndDateTimeChoice {
          date: Date @value("2025-02-15")
        }
      }
      rate_details: CorporateActionRate7 {
        interest_rate: Optional[RateFormat3Choice]
        dividend_rate: Optional[RateFormat3Choice]
      }
    }
  }
} @standard("ISO_20022")
```

---

## 5. æ¡ˆä¾‹4ï¼šISO 20022åˆ°SWIFT MTè½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†ISO 20022 pacs.008æ¶ˆæ¯è½¬æ¢ä¸ºSWIFT MT103æ¶ˆæ¯ï¼Œç”¨äºå…¼å®¹ä¼ ç»ŸSWIFTç³»ç»Ÿã€‚

è¯¦è§ `04_Transformation.md` ç¬¬2ç« ã€‚

---

## 6. æ¡ˆä¾‹5ï¼šISO 20022æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä½¿ç”¨PostgreSQLå­˜å‚¨ISO 20022æ¶ˆæ¯æ•°æ®ï¼Œæ”¯æŒæ¶ˆæ¯åˆ†æå’Œåˆè§„æ€§æ£€æŸ¥ã€‚

è¯¦è§ `04_Transformation.md` ç¬¬6ç« ã€‚

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-02-15
