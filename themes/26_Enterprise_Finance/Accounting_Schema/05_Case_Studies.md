# ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹](#ä¼šè®¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šè´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šè´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆ](#3-æ¡ˆä¾‹2è´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆ)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
  - [4. æ¡ˆä¾‹3ï¼šæˆæœ¬ä¼šè®¡ä½œä¸šæˆæœ¬æ³•](#4-æ¡ˆä¾‹3æˆæœ¬ä¼šè®¡ä½œä¸šæˆæœ¬æ³•)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
  - [5. æ¡ˆä¾‹4ï¼šä¼šè®¡åˆ°XBRLè½¬æ¢](#5-æ¡ˆä¾‹4ä¼šè®¡åˆ°xbrlè½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ä¼šè®¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–è´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ã€è´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆã€æˆæœ¬ä¼šè®¡ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šè´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ç³»ç»Ÿ**ï¼šå‡­è¯å½•å…¥ã€å®¡æ ¸ã€è¿‡è´¦
2. **è´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ**ï¼šè‡ªåŠ¨ç”Ÿæˆè´¢åŠ¡æŠ¥è¡¨
3. **æˆæœ¬ä¼šè®¡ä½œä¸šæˆæœ¬æ³•ç³»ç»Ÿ**ï¼šä½œä¸šæˆæœ¬æ³•è®¡ç®—
4. **ä¼šè®¡åˆ°XBRLè½¬æ¢å·¥å…·**ï¼šä¼šè®¡æ•°æ®åˆ°XBRLè½¬æ¢
5. **ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šä¼šè®¡æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **IFRSå®˜æ–¹**ï¼šIFRSä¼šè®¡æ ‡å‡†
- **GAAPå®˜æ–¹**ï¼šGAAPä¼šè®¡æ ‡å‡†

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸåˆ¶é€ ä¼ä¸šéœ€è¦æ„å»ºè´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ç³»ç»Ÿï¼Œæ”¯æŒæ—¥å¸¸è´¢åŠ¡ä¼šè®¡å‡­è¯çš„å½•å…¥ã€å®¡æ ¸ã€è¿‡è´¦ç­‰æµç¨‹ï¼Œç¡®ä¿ä¼šè®¡æ•°æ®çš„å‡†ç¡®æ€§å’Œåˆè§„æ€§ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **å‡­è¯å¤„ç†æ•ˆç‡ä½**ï¼šæ‰‹å·¥å‡­è¯å¤„ç†æ•ˆç‡ä½
2. **æ•°æ®å‡†ç¡®æ€§å·®**ï¼šæ‰‹å·¥å½•å…¥å®¹æ˜“å‡ºé”™
3. **å®¡æ ¸æµç¨‹ä¸è§„èŒƒ**ï¼šç¼ºä¹è§„èŒƒçš„å®¡æ ¸æµç¨‹
4. **å€Ÿè´·ä¸å¹³è¡¡**ï¼šå®¹æ˜“å‡ºç°å€Ÿè´·ä¸å¹³è¡¡çš„æƒ…å†µ

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- æé«˜å‡­è¯å¤„ç†æ•ˆç‡
- ç¡®ä¿æ•°æ®å‡†ç¡®æ€§
- è§„èŒƒå®¡æ ¸æµç¨‹
- è‡ªåŠ¨æ£€æŸ¥å€Ÿè´·å¹³è¡¡

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å‡­è¯å¹³è¡¡æ£€æŸ¥**ï¼šç¡®ä¿å‡­è¯å€Ÿè´·å¹³è¡¡
2. **å®¡æ ¸æµç¨‹**ï¼šå®ç°è§„èŒƒçš„å®¡æ ¸æµç¨‹
3. **æˆæœ¬ä¸­å¿ƒåˆ†é…**ï¼šæ”¯æŒæˆæœ¬ä¸­å¿ƒåˆ†é…
4. **æ•°æ®éªŒè¯**ï¼šç¡®ä¿ä¼šè®¡æ•°æ®å‡†ç¡®æ€§

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰è´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**è´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
è´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import date, datetime
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

class EntryType(str, Enum):
    """å‡­è¯ç±»å‹"""
    MANUAL = "Manual"
    AUTOMATIC = "Automatic"
    ADJUSTMENT = "Adjustment"
    REVERSAL = "Reversal"

class EntryStatus(str, Enum):
    """å‡­è¯çŠ¶æ€"""
    DRAFT = "Draft"
    SUBMITTED = "Submitted"
    APPROVED = "Approved"
    POSTED = "Posted"
    REJECTED = "Rejected"

@dataclass
class JournalLine:
    """å‡­è¯è¡Œ"""
    line_number: int
    account_code: str
    account_name: str
    debit_amount: Decimal = Decimal('0')
    credit_amount: Decimal = Decimal('0')
    cost_center: Optional[str] = None
    project_code: Optional[str] = None
    description: Optional[str] = None

    def validate(self) -> bool:
        """éªŒè¯å‡­è¯è¡Œ"""
        if self.debit_amount < 0 or self.credit_amount < 0:
            return False
        if self.debit_amount > 0 and self.credit_amount > 0:
            return False
        return True

@dataclass
class FinancialJournalEntry:
    """è´¢åŠ¡ä¼šè®¡å‡­è¯"""
    entry_id: str
    entry_date: date
    entry_type: EntryType
    description: str
    lines: List[JournalLine] = field(default_factory=list)
    status: EntryStatus = EntryStatus.DRAFT
    created_by: str = ""
    approved_by: Optional[str] = None
    posted_by: Optional[str] = None
    created_at: datetime = field(default_factory=datetime.now)
    updated_at: datetime = field(default_factory=datetime.now)

    @property
    def total_debit(self) -> Decimal:
        """è®¡ç®—æ€»å€Ÿæ–¹é‡‘é¢"""
        return sum(line.debit_amount for line in self.lines)

    @property
    def total_credit(self) -> Decimal:
        """è®¡ç®—æ€»è´·æ–¹é‡‘é¢"""
        return sum(line.credit_amount for line in self.lines)

    @property
    def balance(self) -> Decimal:
        """è®¡ç®—ä½™é¢"""
        return self.total_debit - self.total_credit

    def is_balanced(self) -> bool:
        """æ£€æŸ¥å‡­è¯æ˜¯å¦å¹³è¡¡"""
        return abs(self.balance) < Decimal('0.01')

    def validate(self) -> tuple[bool, List[str]]:
        """éªŒè¯å‡­è¯"""
        errors = []

        # æ£€æŸ¥å‡­è¯è¡Œ
        if not self.lines:
            errors.append("å‡­è¯å¿…é¡»è‡³å°‘åŒ…å«ä¸€è¡Œ")

        # æ£€æŸ¥æ¯è¡Œ
        for line in self.lines:
            if not line.validate():
                errors.append(f"å‡­è¯è¡Œ{line.line_number}éªŒè¯å¤±è´¥")

        # æ£€æŸ¥å€Ÿè´·å¹³è¡¡
        if not self.is_balanced():
            errors.append(f"å‡­è¯å€Ÿè´·ä¸å¹³è¡¡ï¼Œå·®é¢: {self.balance}")

        # æ£€æŸ¥è‡³å°‘ä¸¤è¡Œ
        if len(self.lines) < 2:
            errors.append("å‡­è¯å¿…é¡»è‡³å°‘åŒ…å«ä¸¤è¡Œ")

        return len(errors) == 0, errors

    def add_line(self, line: JournalLine):
        """æ·»åŠ å‡­è¯è¡Œ"""
        line.line_number = len(self.lines) + 1
        self.lines.append(line)
        self.updated_at = datetime.now()

    def submit(self, user: str) -> tuple[bool, List[str]]:
        """æäº¤å‡­è¯"""
        if self.status != EntryStatus.DRAFT:
            return False, ["åªèƒ½æäº¤è‰ç¨¿çŠ¶æ€çš„å‡­è¯"]

        is_valid, errors = self.validate()
        if not is_valid:
            return False, errors

        self.status = EntryStatus.SUBMITTED
        self.updated_at = datetime.now()
        return True, []

    def approve(self, user: str) -> tuple[bool, List[str]]:
        """å®¡æ ¸å‡­è¯"""
        if self.status != EntryStatus.SUBMITTED:
            return False, ["åªèƒ½å®¡æ ¸å·²æäº¤çš„å‡­è¯"]

        is_valid, errors = self.validate()
        if not is_valid:
            return False, errors

        self.status = EntryStatus.APPROVED
        self.approved_by = user
        self.updated_at = datetime.now()
        return True, []

    def post(self, user: str) -> tuple[bool, List[str]]:
        """è¿‡è´¦å‡­è¯"""
        if self.status != EntryStatus.APPROVED:
            return False, ["åªèƒ½è¿‡è´¦å·²å®¡æ ¸çš„å‡­è¯"]

        is_valid, errors = self.validate()
        if not is_valid:
            return False, errors

        self.status = EntryStatus.POSTED
        self.posted_by = user
        self.updated_at = datetime.now()
        return True, []

    def reject(self, user: str, reason: str):
        """æ‹’ç»å‡­è¯"""
        if self.status not in [EntryStatus.SUBMITTED, EntryStatus.APPROVED]:
            return False, ["åªèƒ½æ‹’ç»å·²æäº¤æˆ–å·²å®¡æ ¸çš„å‡­è¯"]

        self.status = EntryStatus.REJECTED
        self.updated_at = datetime.now()
        return True, []

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºå‡­è¯
    entry = FinancialJournalEntry(
        entry_id="JE-2025-001",
        entry_date=date(2025, 1, 21),
        entry_type=EntryType.MANUAL,
        description="ææ–™é‡‡è´­å‡­è¯",
        created_by="user001"
    )

    # æ·»åŠ å‡­è¯è¡Œ
    entry.add_line(JournalLine(
        account_code="1001",
        account_name="åº“å­˜ç°é‡‘",
        debit_amount=Decimal('10000.00'),
        cost_center="CC-001"
    ))

    entry.add_line(JournalLine(
        account_code="1201",
        account_name="åŸææ–™",
        credit_amount=Decimal('10000.00'),
        cost_center="CC-001"
    ))

    # éªŒè¯å‡­è¯
    is_valid, errors = entry.validate()
    print(f"å‡­è¯éªŒè¯: {is_valid}")
    if errors:
        print(f"é”™è¯¯: {errors}")

    print(f"æ€»å€Ÿæ–¹: {entry.total_debit}")
    print(f"æ€»è´·æ–¹: {entry.total_credit}")
    print(f"ä½™é¢: {entry.balance}")
    print(f"æ˜¯å¦å¹³è¡¡: {entry.is_balanced()}")

    # æäº¤å‡­è¯
    success, errors = entry.submit("user001")
    print(f"æäº¤ç»“æœ: {success}")

    # å®¡æ ¸å‡­è¯
    success, errors = entry.approve("manager001")
    print(f"å®¡æ ¸ç»“æœ: {success}")

    # è¿‡è´¦å‡­è¯
    success, errors = entry.post("accountant001")
    print(f"è¿‡è´¦ç»“æœ: {success}")
    print(f"å‡­è¯çŠ¶æ€: {entry.status}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| å‡­è¯å¤„ç†æ•ˆç‡ | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| æ•°æ®å‡†ç¡®æ€§ | 95% | 100% | 5%æå‡ |
| å®¡æ ¸æµç¨‹è§„èŒƒæ€§ | 60% | 100% | 40%æå‡ |
| å€Ÿè´·å¹³è¡¡æ£€æŸ¥ | æ‰‹åŠ¨ | è‡ªåŠ¨ | 100% |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **å¤„ç†æ•ˆç‡æå‡**ï¼šè‡ªåŠ¨åŒ–å‡­è¯å¤„ç†æµç¨‹
2. **æ•°æ®å‡†ç¡®æ€§æé«˜**ï¼šè‡ªåŠ¨éªŒè¯ç¡®ä¿å‡†ç¡®æ€§
3. **å®¡æ ¸æµç¨‹è§„èŒƒ**ï¼šè§„èŒƒåŒ–çš„å®¡æ ¸æµç¨‹
4. **å€Ÿè´·å¹³è¡¡ä¿è¯**ï¼šè‡ªåŠ¨æ£€æŸ¥å€Ÿè´·å¹³è¡¡

**ç»éªŒæ•™è®­**ï¼š

1. å‡­è¯éªŒè¯å¾ˆé‡è¦
2. å®¡æ ¸æµç¨‹éœ€è¦è§„èŒƒåŒ–
3. å€Ÿè´·å¹³è¡¡æ£€æŸ¥å¿…é¡»è‡ªåŠ¨åŒ–
4. æˆæœ¬ä¸­å¿ƒåˆ†é…éœ€è¦æ”¯æŒ

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [IFRSä¼šè®¡æ ‡å‡†](https://www.ifrs.org/)
- [GAAPä¼šè®¡æ ‡å‡†](https://www.fasb.org/)

---

## 3. æ¡ˆä¾‹2ï¼šè´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆ

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
åŸºäºä¼šè®¡æ•°æ®ç”ŸæˆIFRSæ ¼å¼çš„è´¢åŠ¡æŠ¥è¡¨ï¼ŒåŒ…æ‹¬èµ„äº§è´Ÿå€ºè¡¨ã€åˆ©æ¶¦è¡¨ã€ç°é‡‘æµé‡è¡¨ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒIFRS 18è´¢åŠ¡æŠ¥è¡¨åˆ—æŠ¥æ ‡å‡†
- è‡ªåŠ¨è®¡ç®—æŠ¥è¡¨é¡¹ç›®é‡‘é¢
- æ”¯æŒå¤šæœŸé—´å¯¹æ¯”
- æ”¯æŒXBRLæ ¼å¼å¯¼å‡º

### 3.2 Schemaå®šä¹‰

**è´¢åŠ¡æŠ¥è¡¨ç”ŸæˆSchema**ï¼š

```dsl
schema FinancialStatements {
  balance_sheet: BalanceSheet {
    report_date: Date @value("2025-01-31")
    assets: Map<String, Decimal> {
      "current_assets": Decimal @value(500000.00)
      "non_current_assets": Decimal @value(1000000.00)
    }
    liabilities: Map<String, Decimal> {
      "current_liabilities": Decimal @value(200000.00)
      "non_current_liabilities": Decimal @value(300000.00)
    }
    equity: Map<String, Decimal> {
      "share_capital": Decimal @value(500000.00)
      "retained_earnings": Decimal @value(500000.00)
    }
    total_assets: Decimal @value(1500000.00)
    total_liabilities_equity: Decimal @value(1500000.00)
  }

  income_statement: IncomeStatement {
    period_start: Date @value("2025-01-01")
    period_end: Date @value("2025-01-31")
    revenue: Map<String, Decimal> {
      "sales_revenue": Decimal @value(1000000.00)
      "other_revenue": Decimal @value(50000.00)
    }
    expenses: Map<String, Decimal> {
      "cost_of_sales": Decimal @value(600000.00)
      "operating_expenses": Decimal @value(200000.00)
      "financial_expenses": Decimal @value(10000.00)
    }
    net_income: Decimal @value(240000.00)
  }
} @standard("IFRS 18")
```

---

## 4. æ¡ˆä¾‹3ï¼šæˆæœ¬ä¼šè®¡ä½œä¸šæˆæœ¬æ³•

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä½¿ç”¨ä½œä¸šæˆæœ¬æ³•ï¼ˆABCï¼‰è¿›è¡Œäº§å“æˆæœ¬æ ¸ç®—ï¼Œè¯†åˆ«ä½œä¸šã€æˆæœ¬åŠ¨å› ï¼Œåˆ†é…é—´æ¥æˆæœ¬ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è¯†åˆ«ä¸»è¦ä½œä¸šå’Œæˆæœ¬åŠ¨å› 
- è®¡ç®—ä½œä¸šæˆæœ¬ç‡
- å°†é—´æ¥æˆæœ¬åˆ†é…åˆ°äº§å“
- æ”¯æŒæˆæœ¬åˆ†æå’Œä¼˜åŒ–

### 4.2 Schemaå®šä¹‰

**ä½œä¸šæˆæœ¬æ³•Schema**ï¼š

```dsl
schema ActivityBasedCosting {
  activities: List<Activity> {
    activity1: Activity {
      activity_id: String @value("ACT-001")
      activity_name: String @value("æœºå™¨è®¾ç½®")
      cost_pool: Decimal @value(50000.00)
      cost_driver: String @value("è®¾ç½®æ¬¡æ•°")
      driver_quantity: Decimal @value(100.00)
      activity_rate: Decimal @value(500.00)
    }

    activity2: Activity {
      activity_id: String @value("ACT-002")
      activity_name: String @value("è´¨é‡æ£€éªŒ")
      cost_pool: Decimal @value(30000.00)
      cost_driver: String @value("æ£€éªŒæ‰¹æ¬¡")
      driver_quantity: Decimal @value(50.00)
      activity_rate: Decimal @value(600.00)
    }
  }

  cost_objects: List<ABCCostObject> {
    product1: ABCCostObject {
      object_id: String @value("PROD-001")
      object_code: String @value("äº§å“A")
      direct_costs: Decimal @value(100000.00)
      activity_consumption: Map<String, Decimal> {
        "ACT-001": Decimal @value(20.00)
        "ACT-002": Decimal @value(10.00)
      }
      allocated_costs: Decimal @value(16000.00)
      total_costs: Decimal @value(116000.00)
    }
  }
} @standard("ABC")
```

---

## 5. æ¡ˆä¾‹4ï¼šä¼šè®¡åˆ°XBRLè½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†ä¼ä¸šä¼šè®¡æ•°æ®è½¬æ¢ä¸ºXBRLæ ¼å¼ï¼Œç”¨äºå‘ç›‘ç®¡æœºæ„æäº¤æ ‡å‡†åŒ–è´¢åŠ¡æŠ¥å‘Šã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒXBRL 2.1æ ‡å‡†
- æ”¯æŒIFRS Taxonomyåˆ†ç±»æ ‡å‡†
- è‡ªåŠ¨ç”ŸæˆXBRLå®ä¾‹æ–‡æ¡£
- æ”¯æŒXBRLéªŒè¯

### 5.2 å®ç°ä»£ç 

```python
from accounting_schema import AccountingSchema
from xbrl import XBRLInstanceDocument, XBRLContext, XBRLFact

def convert_accounting_to_xbrl(accounting_data: AccountingSchema) -> XBRLInstanceDocument:
    """å°†ä¼šè®¡æ•°æ®è½¬æ¢ä¸ºXBRLæ ¼å¼"""
    xbrl_doc = XBRLInstanceDocument()

    # åˆ›å»ºå®ä½“ä¸Šä¸‹æ–‡
    entity_context = XBRLContext()
    entity_context.id = "entity_context_1"
    entity_context.entity_identifier = accounting_data.company_code
    entity_context.entity_scheme = "http://www.example.com/company"
    entity_context.period_start = accounting_data.period_start
    entity_context.period_end = accounting_data.period_end
    xbrl_doc.contexts.append(entity_context)

    # åˆ›å»ºå•ä½
    unit_usd = XBRLUnit()
    unit_usd.id = "unit_usd"
    unit_usd.measure = "iso4217:USD"
    xbrl_doc.units.append(unit_usd)

    # è½¬æ¢èµ„äº§è´Ÿå€ºè¡¨æ•°æ®
    for account in accounting_data.chart_of_accounts:
        if account.account_type == "Asset":
            fact = XBRLFact()
            fact.context_ref = entity_context.id
            fact.unit_ref = unit_usd.id
            fact.name = f"ifrs:Assets_{account.account_code}"
            fact.value = str(account.closing_balance)
            fact.decimals = "2"
            xbrl_doc.facts.append(fact)

    return xbrl_doc

# ä½¿ç”¨ç¤ºä¾‹
accounting_data = AccountingSchema.load_from_database("2025-01-31")
xbrl_doc = convert_accounting_to_xbrl(accounting_data)
xbrl_doc.save("financial_report_2025-01-31.xbrl")
```

---

## 6. æ¡ˆä¾‹5ï¼šä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒä¼šè®¡æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- PostgreSQLæ•°æ®åº“å­˜å‚¨
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒè´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆ
- æ”¯æŒæ•°æ®å¯¼å‡º

### 6.2 å®ç°ä»£ç 

```python
import psycopg2
from accounting_schema import AccountingSchema, JournalEntry, ChartOfAccounts

class AccountingDataStore:
    def __init__(self, db_config):
        self.conn = psycopg2.connect(**db_config)

    def store_journal_entry(self, entry: JournalEntry):
        """å­˜å‚¨å‡­è¯"""
        cursor = self.conn.cursor()

        # éªŒè¯å€Ÿè´·å¹³è¡¡
        if entry.total_debit != entry.total_credit:
            raise ValueError("å‡­è¯å€Ÿè´·ä¸å¹³è¡¡")

        # æ’å…¥å‡­è¯
        cursor.execute("""
            INSERT INTO journal_entries
            (entry_id, entry_date, entry_type, description, total_debit, total_credit)
            VALUES (%s, %s, %s, %s, %s, %s)
        """, (entry.entry_id, entry.entry_date, entry.entry_type,
              entry.description, entry.total_debit, entry.total_credit))

        # æ’å…¥å‡­è¯åˆ†å½•
        for line in entry.lines:
            cursor.execute("""
                INSERT INTO journal_lines
                (entry_id, account_code, debit_amount, credit_amount, cost_center)
                VALUES (%s, %s, %s, %s, %s)
            """, (entry.entry_id, line.account_code, line.debit_amount,
                  line.credit_amount, line.cost_center))

        self.conn.commit()

    def generate_trial_balance(self, period_start, period_end):
        """ç”Ÿæˆè¯•ç®—å¹³è¡¡è¡¨"""
        cursor = self.conn.cursor()

        cursor.execute("""
            SELECT
                coa.account_code,
                coa.account_name,
                COALESCE(SUM(jl.debit_amount), 0) as debit_total,
                COALESCE(SUM(jl.credit_amount), 0) as credit_total,
                COALESCE(SUM(jl.debit_amount), 0) - COALESCE(SUM(jl.credit_amount), 0) as balance
            FROM chart_of_accounts coa
            LEFT JOIN journal_lines jl ON coa.account_code = jl.account_code
            LEFT JOIN journal_entries je ON jl.entry_id = je.entry_id
            WHERE (je.entry_date BETWEEN %s AND %s OR je.entry_date IS NULL)
            GROUP BY coa.account_code, coa.account_name
            ORDER BY coa.account_code
        """, (period_start, period_end))

        return cursor.fetchall()

    def generate_balance_sheet(self, report_date):
        """ç”Ÿæˆèµ„äº§è´Ÿå€ºè¡¨"""
        cursor = self.conn.cursor()

        cursor.execute("""
            SELECT
                coa.account_type,
                SUM(gl.closing_balance) as total_balance
            FROM general_ledger gl
            JOIN chart_of_accounts coa ON gl.account_code = coa.account_code
            WHERE gl.period_end = %s
            GROUP BY coa.account_type
        """, (report_date,))

        return cursor.fetchall()

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    "host": "localhost",
    "database": "accounting",
    "user": "accounting_user",
    "password": "password"
}

store = AccountingDataStore(db_config)

# å­˜å‚¨å‡­è¯
entry = JournalEntry(
    entry_id="JE-2025-001",
    entry_date="2025-01-21",
    entry_type="Manual",
    description="ææ–™é‡‡è´­",
    lines=[
        JournalLine(account_code="1001", debit_amount=10000, credit_amount=0),
        JournalLine(account_code="1201", debit_amount=0, credit_amount=10000)
    ],
    total_debit=10000,
    total_credit=10000
)
store.store_journal_entry(entry)

# ç”Ÿæˆè¯•ç®—å¹³è¡¡è¡¨
trial_balance = store.generate_trial_balance("2025-01-01", "2025-01-31")
print("è¯•ç®—å¹³è¡¡è¡¨:")
for row in trial_balance:
    print(f"{row[0]}: {row[1]} - å€Ÿæ–¹: {row[2]}, è´·æ–¹: {row[3]}, ä½™é¢: {row[4]}")

# ç”Ÿæˆèµ„äº§è´Ÿå€ºè¡¨
balance_sheet = store.generate_balance_sheet("2025-01-31")
print("\nèµ„äº§è´Ÿå€ºè¡¨:")
for row in balance_sheet:
    print(f"{row[0]}: {row[1]}")
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
