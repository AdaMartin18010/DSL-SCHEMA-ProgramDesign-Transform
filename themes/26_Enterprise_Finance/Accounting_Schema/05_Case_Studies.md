# æ€»è´¦Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [æ€»è´¦Schemaå®è·µæ¡ˆä¾‹](#æ€»è´¦schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šå¤§å‹åˆ¶é€ é›†å›¢æ€»è´¦ç®¡ç†ç³»ç»Ÿ](#2-æ¡ˆä¾‹1å¤§å‹åˆ¶é€ é›†å›¢æ€»è´¦ç®¡ç†ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šå¤šå¸ç§æ€»è´¦æ ¸ç®—ç³»ç»Ÿ](#3-æ¡ˆä¾‹2å¤šå¸ç§æ€»è´¦æ ¸ç®—ç³»ç»Ÿ)
    - [3.1 ä¸šåŠ¡èƒŒæ™¯](#31-ä¸šåŠ¡èƒŒæ™¯)
    - [3.2 æŠ€æœ¯æŒ‘æˆ˜](#32-æŠ€æœ¯æŒ‘æˆ˜)
    - [3.3 è§£å†³æ–¹æ¡ˆ](#33-è§£å†³æ–¹æ¡ˆ)
    - [3.4 å®Œæ•´ä»£ç å®ç°](#34-å®Œæ•´ä»£ç å®ç°)
    - [3.5 æ•ˆæœè¯„ä¼°](#35-æ•ˆæœè¯„ä¼°)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æ€»è´¦Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–è´¢åŠ¡ä¼šè®¡å‡­è¯å¤„ç†ã€å¤šå¸ç§æ ¸ç®—ã€æ€»è´¦æŠ¥è¡¨ç”Ÿæˆç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **å¤§å‹åˆ¶é€ é›†å›¢æ€»è´¦ç®¡ç†ç³»ç»Ÿ**ï¼šå‡­è¯å½•å…¥ã€å®¡æ ¸ã€è¿‡è´¦ã€æœŸæœ«ç»“è´¦
2. **å¤šå¸ç§æ€»è´¦æ ¸ç®—ç³»ç»Ÿ**ï¼šå¤–å¸ä¸šåŠ¡å¤„ç†ã€æ±‡ç‡æŠ˜ç®—ã€æ±‡å…‘æŸç›Šè®¡ç®—

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **åä¸º**ï¼šå…¨çƒåŒ–æ€»è´¦ç®¡ç†ä½“ç³»
- **æµ·å°”**ï¼šè´¢åŠ¡å…±äº«ä¸­å¿ƒæ€»è´¦ç®¡ç†

---

## 2. æ¡ˆä¾‹1ï¼šå¤§å‹åˆ¶é€ é›†å›¢æ€»è´¦ç®¡ç†ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
åä¿¡åˆ¶é€ é›†å›¢æ˜¯ä¸€å®¶æ‹¥æœ‰50ä½™å®¶å­å…¬å¸ã€ä¸šåŠ¡éå¸ƒå…¨çƒ20å¤šä¸ªå›½å®¶å’Œåœ°åŒºçš„å¤§å‹åˆ¶é€ ä¼ä¸šé›†å›¢ã€‚é›†å›¢å¹´è¥ä¸šæ”¶å…¥è¶…è¿‡500äº¿å…ƒï¼Œå‘˜å·¥æ€»æ•°è¶…è¿‡3ä¸‡äººã€‚é›†å›¢é‡‡ç”¨è´¢åŠ¡å…±äº«ä¸­å¿ƒæ¨¡å¼ï¼Œéœ€è¦æ„å»ºç»Ÿä¸€çš„æ€»è´¦ç®¡ç†ç³»ç»Ÿæ¥æ”¯æ’‘é›†å›¢åŒ–è´¢åŠ¡ç®¡æ§ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **å‡­è¯å¤„ç†æ•ˆç‡ä½**ï¼šé›†å›¢æ—¥å‡å‡­è¯é‡è¶…è¿‡10000å¼ ï¼Œæ‰‹å·¥å¤„ç†æ•ˆç‡ä½ä¸‹ï¼Œæœˆç»“æœŸé—´è´¢åŠ¡äººå‘˜åŠ ç­ä¸¥é‡ï¼Œå¹³å‡æœˆç»“å‘¨æœŸé•¿è¾¾15ä¸ªå·¥ä½œæ—¥
2. **æ•°æ®å‡†ç¡®æ€§å·®**ï¼šæ‰‹å·¥å½•å…¥é”™è¯¯ç‡é«˜è¾¾3%ï¼Œè·¨å…¬å¸å¾€æ¥å¯¹è´¦å›°éš¾ï¼Œç»å¸¸å‡ºç°è´¦è´¦ä¸ç¬¦ã€è´¦å®ä¸ç¬¦çš„æƒ…å†µ
3. **å®¡æ ¸æµç¨‹ä¸è§„èŒƒ**ï¼šå„å­å…¬å¸å®¡æ ¸æ ‡å‡†ä¸ç»Ÿä¸€ï¼Œç¼ºä¹æœ‰æ•ˆçš„å†…æ§æœºåˆ¶ï¼Œå­˜åœ¨åˆè§„é£é™©
4. **å€Ÿè´·ä¸å¹³è¡¡é¢‘å‘**ï¼šæ‰‹å·¥å‡­è¯ç»å¸¸å‡ºç°å€Ÿè´·ä¸å¹³è¡¡ï¼Œæœˆæœ«è°ƒå¹³å·¥ä½œé‡å¤§ï¼Œå½±å“ç»“è´¦è¿›åº¦
5. **è·¨ç³»ç»Ÿæ•°æ®å­¤å²›**ï¼šERPã€CRMã€SCMç­‰ç³»ç»Ÿæ•°æ®æ— æ³•è‡ªåŠ¨å¯¹æ¥ï¼Œéœ€è¦æ‰‹å·¥å¯¼å…¥å¯¼å‡ºï¼Œæ•°æ®ä¸€è‡´æ€§éš¾ä»¥ä¿è¯

**ä¸šåŠ¡ç›®æ ‡**ï¼š

1. **æé«˜å‡­è¯å¤„ç†æ•ˆç‡**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–å°†æ—¥å‡å‡­è¯å¤„ç†èƒ½åŠ›æå‡è‡³20000å¼ ï¼Œæœˆç»“å‘¨æœŸç¼©çŸ­è‡³5ä¸ªå·¥ä½œæ—¥ä»¥å†…
2. **ç¡®ä¿æ•°æ®å‡†ç¡®æ€§**ï¼šå°†å½•å…¥é”™è¯¯ç‡é™ä½è‡³0.1%ä»¥ä¸‹ï¼Œå®ç°ç³»ç»Ÿè‡ªåŠ¨å€Ÿè´·å¹³è¡¡æ ¡éªŒ
3. **è§„èŒƒå®¡æ ¸æµç¨‹**ï¼šå»ºç«‹ç»Ÿä¸€çš„å‡­è¯å®¡æ ¸æ ‡å‡†å’Œæµç¨‹ï¼Œå®ç°åˆ†çº§å®¡æ‰¹å’Œç”µå­ç­¾ç« 
4. **å®ç°è‡ªåŠ¨å¯¹è´¦**ï¼šå»ºç«‹é›†å›¢å†…éƒ¨å¾€æ¥è‡ªåŠ¨å¯¹è´¦æœºåˆ¶ï¼Œå¯¹è´¦å‡†ç¡®ç‡è¾¾åˆ°99.5%ä»¥ä¸Š
5. **æ‰“é€šç³»ç»Ÿå£å’**ï¼šå®ç°ä¸ERPã€é“¶è¡Œç³»ç»Ÿçš„æ— ç¼å¯¹æ¥ï¼Œæ•°æ®è‡ªåŠ¨é‡‡é›†ç‡è¶…è¿‡95%

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **é«˜å¹¶å‘å¤„ç†**ï¼šéœ€è¦æ”¯æŒæ—¥å‡ä¸‡çº§å‡­è¯çš„é«˜å¹¶å‘å½•å…¥å’Œå¤„ç†ï¼Œç³»ç»Ÿå“åº”æ—¶é—´è¦æ±‚åœ¨2ç§’ä»¥å†…
2. **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šé›†å›¢å¤šç»„ç»‡æ¶æ„ä¸‹ï¼Œéœ€è¦ä¿è¯è·¨å…¬å¸ä¸šåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§
3. **æ•°æ®ä¸€è‡´æ€§**ï¼šå¤šç³»ç»Ÿæ•°æ®åŒæ­¥æ—¶ï¼Œéœ€è¦ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
4. **å®¡è®¡è¿½è¸ª**ï¼šéœ€è¦å®Œæ•´è®°å½•å‡­è¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒä»»æ„æ—¶é—´ç‚¹çš„æ•°æ®è¿½æº¯
5. **åˆè§„æ€§è¦æ±‚**ï¼šéœ€è¦æ»¡è¶³ä¸­å›½ä¼šè®¡å‡†åˆ™ã€ç¨æ³•ä»¥åŠä¸Šå¸‚å…¬å¸ä¿¡æ¯æŠ«éœ²è¦æ±‚

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰æ€»è´¦ç®¡ç†ç³»ç»Ÿ**ï¼Œå®ç°å‡­è¯å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œè‡ªåŠ¨åŒ–è´¢åŠ¡æ ¸ç®—ã€‚

### 2.4 å®Œæ•´ä»£ç å®ç°

**æ€»è´¦ç®¡ç†ç³»ç»Ÿå®Œæ•´ä»£ç ï¼ˆçº¦450è¡Œï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
å¤§å‹åˆ¶é€ é›†å›¢æ€»è´¦ç®¡ç†ç³»ç»Ÿ
æ”¯æŒï¼šå‡­è¯ç®¡ç†ã€ç§‘ç›®ç®¡ç†ã€è¾…åŠ©æ ¸ç®—ã€æœŸæœ«å¤„ç†ã€æŠ¥è¡¨ç”Ÿæˆ
"""

from typing import Dict, List, Optional, Tuple
from datetime import date, datetime, timedelta
from decimal import Decimal, ROUND_HALF_UP
from dataclasses import dataclass, field
from enum import Enum, auto
import json
import uuid
from collections import defaultdict


class EntryType(str, Enum):
    """å‡­è¯ç±»å‹"""
    MANUAL = "Manual"           # æ‰‹å·¥å‡­è¯
    AUTOMATIC = "Automatic"     # è‡ªåŠ¨å‡­è¯
    ADJUSTMENT = "Adjustment"   # è°ƒæ•´å‡­è¯
    REVERSAL = "Reversal"       # å†²é”€å‡­è¯
    CLOSING = "Closing"         # ç»“è´¦å‡­è¯


class EntryStatus(str, Enum):
    """å‡­è¯çŠ¶æ€"""
    DRAFT = "Draft"                     # è‰ç¨¿
    SUBMITTED = "Submitted"             # å·²æäº¤
    PENDING_APPROVAL = "PendingApproval" # å¾…å®¡æ ¸
    APPROVED = "Approved"               # å·²å®¡æ ¸
    POSTED = "Posted"                   # å·²è¿‡è´¦
    REJECTED = "Rejected"               # å·²æ‹’ç»
    CANCELLED = "Cancelled"             # å·²ä½œåºŸ


class AccountType(str, Enum):
    """ç§‘ç›®ç±»å‹"""
    ASSET = "Asset"             # èµ„äº§
    LIABILITY = "Liability"     # è´Ÿå€º
    EQUITY = "Equity"           # æƒç›Š
    REVENUE = "Revenue"         # æ”¶å…¥
    EXPENSE = "Expense"         # è´¹ç”¨


@dataclass
class Account:
    """ä¼šè®¡ç§‘ç›®"""
    account_code: str
    account_name: str
    account_type: AccountType
    parent_code: Optional[str] = None
    is_leaf: bool = True
    currency: str = "CNY"
    is_active: bool = True
    
    def get_balance_direction(self) -> str:
        """è·å–ç§‘ç›®ä½™é¢æ–¹å‘"""
        if self.account_type in [AccountType.ASSET, AccountType.EXPENSE]:
            return "Debit"
        return "Credit"


@dataclass
class AuxiliaryItem:
    """è¾…åŠ©æ ¸ç®—é¡¹"""
    auxiliary_type: str  # å®¢æˆ·ã€ä¾›åº”å•†ã€éƒ¨é—¨ã€é¡¹ç›®ç­‰
    auxiliary_code: str
    auxiliary_name: str


@dataclass
class JournalLine:
    """å‡­è¯åˆ†å½•è¡Œ"""
    line_number: int
    account_code: str
    account_name: str
    debit_amount: Decimal = Decimal('0')
    credit_amount: Decimal = Decimal('0')
    currency: str = "CNY"
    exchange_rate: Decimal = Decimal('1')
    original_amount: Decimal = Decimal('0')
    cost_center: Optional[str] = None
    project_code: Optional[str] = None
    customer_code: Optional[str] = None
    supplier_code: Optional[str] = None
    description: Optional[str] = None
    
    def __post_init__(self):
        """åˆå§‹åŒ–åè®¡ç®—åŸå¸é‡‘é¢"""
        if self.original_amount == Decimal('0'):
            self.original_amount = (self.debit_amount + self.credit_amount) / self.exchange_rate
    
    def validate(self) -> Tuple[bool, List[str]]:
        """éªŒè¯åˆ†å½•è¡Œ"""
        errors = []
        if self.debit_amount < 0 or self.credit_amount < 0:
            errors.append(f"è¡Œ{self.line_number}: é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°")
        if self.debit_amount > 0 and self.credit_amount > 0:
            errors.append(f"è¡Œ{self.line_number}: ä¸èƒ½åŒæ—¶æœ‰å€Ÿæ–¹å’Œè´·æ–¹é‡‘é¢")
        if self.debit_amount == 0 and self.credit_amount == 0:
            errors.append(f"è¡Œ{self.line_number}: å€Ÿæ–¹æˆ–è´·æ–¹é‡‘é¢ä¸èƒ½åŒæ—¶ä¸ºé›¶")
        return len(errors) == 0, errors


@dataclass
class JournalEntry:
    """è®°è´¦å‡­è¯"""
    entry_id: str
    entry_date: date
    fiscal_year: str
    fiscal_period: str
    entry_type: EntryType
    description: str
    company_code: str
    company_name: str
    created_by: str
    lines: List[JournalLine] = field(default_factory=list)
    status: EntryStatus = EntryStatus.DRAFT
    approved_by: Optional[str] = None
    approved_at: Optional[datetime] = None
    posted_by: Optional[str] = None
    posted_at: Optional[datetime] = None
    attachment_count: int = 0
    source_system: Optional[str] = None
    reference_number: Optional[str] = None
    created_at: datetime = field(default_factory=datetime.now)
    updated_at: datetime = field(default_factory=datetime.now)
    
    @property
    def total_debit(self) -> Decimal:
        """è®¡ç®—å€Ÿæ–¹æ€»é¢"""
        return sum(line.debit_amount for line in self.lines)
    
    @property
    def total_credit(self) -> Decimal:
        """è®¡ç®—è´·æ–¹æ€»é¢"""
        return sum(line.credit_amount for line in self.lines)
    
    @property
    def balance(self) -> Decimal:
        """è®¡ç®—å€Ÿè´·å·®é¢"""
        return self.total_debit - self.total_credit
    
    @property
    def is_balanced(self) -> bool:
        """æ£€æŸ¥å€Ÿè´·æ˜¯å¦å¹³è¡¡"""
        return abs(self.balance) < Decimal('0.01')
    
    @property
    def line_count(self) -> int:
        """è·å–åˆ†å½•è¡Œæ•°"""
        return len(self.lines)
    
    def add_line(self, line: JournalLine) -> None:
        """æ·»åŠ åˆ†å½•è¡Œ"""
        line.line_number = len(self.lines) + 1
        self.lines.append(line)
        self.updated_at = datetime.now()
    
    def validate(self) -> Tuple[bool, List[str]]:
        """éªŒè¯å‡­è¯"""
        errors = []
        
        # æ£€æŸ¥åˆ†å½•è¡Œ
        if len(self.lines) < 2:
            errors.append("å‡­è¯è‡³å°‘éœ€è¦ä¸¤è¡Œåˆ†å½•")
        
        # æ£€æŸ¥æ¯è¡Œ
        for line in self.lines:
            is_valid, line_errors = line.validate()
            if not is_valid:
                errors.extend(line_errors)
        
        # æ£€æŸ¥å€Ÿè´·å¹³è¡¡
        if not self.is_balanced:
            errors.append(f"å€Ÿè´·ä¸å¹³è¡¡ï¼Œå·®é¢: {self.balance}")
        
        # æ£€æŸ¥é‡‘é¢
        if self.total_debit == 0:
            errors.append("å‡­è¯é‡‘é¢ä¸èƒ½ä¸ºé›¶")
        
        return len(errors) == 0, errors
    
    def submit(self, user: str) -> Tuple[bool, List[str]]:
        """æäº¤å‡­è¯"""
        if self.status != EntryStatus.DRAFT:
            return False, ["åªèƒ½æäº¤è‰ç¨¿çŠ¶æ€çš„å‡­è¯"]
        
        is_valid, errors = self.validate()
        if not is_valid:
            return False, errors
        
        self.status = EntryStatus.SUBMITTED
        self.updated_at = datetime.now()
        return True, []
    
    def approve(self, user: str) -> Tuple[bool, str]:
        """å®¡æ ¸å‡­è¯"""
        if self.status != EntryStatus.SUBMITTED:
            return False, "åªèƒ½å®¡æ ¸å·²æäº¤çš„å‡­è¯"
        
        self.status = EntryStatus.APPROVED
        self.approved_by = user
        self.approved_at = datetime.now()
        self.updated_at = datetime.now()
        return True, "å®¡æ ¸æˆåŠŸ"
    
    def post(self, user: str) -> Tuple[bool, str]:
        """è¿‡è´¦å‡­è¯"""
        if self.status != EntryStatus.APPROVED:
            return False, "åªèƒ½è¿‡è´¦å·²å®¡æ ¸çš„å‡­è¯"
        
        self.status = EntryStatus.POSTED
        self.posted_by = user
        self.posted_at = datetime.now()
        self.updated_at = datetime.now()
        return True, "è¿‡è´¦æˆåŠŸ"
    
    def reject(self, user: str, reason: str) -> Tuple[bool, str]:
        """æ‹’ç»å‡­è¯"""
        if self.status not in [EntryStatus.SUBMITTED, EntryStatus.PENDING_APPROVAL]:
            return False, "å½“å‰çŠ¶æ€ä¸èƒ½æ‹’ç»"
        
        self.status = EntryStatus.REJECTED
        self.updated_at = datetime.now()
        return True, f"å·²æ‹’ç»ï¼ŒåŸå› : {reason}"
    
    def to_dict(self) -> Dict:
        """è½¬æ¢ä¸ºå­—å…¸"""
        return {
            'entry_id': self.entry_id,
            'entry_date': self.entry_date.isoformat(),
            'fiscal_year': self.fiscal_year,
            'fiscal_period': self.fiscal_period,
            'entry_type': self.entry_type.value,
            'description': self.description,
            'company_code': self.company_code,
            'company_name': self.company_name,
            'status': self.status.value,
            'total_debit': float(self.total_debit),
            'total_credit': float(self.total_credit),
            'line_count': self.line_count,
            'created_by': self.created_by,
            'created_at': self.created_at.isoformat(),
            'lines': [
                {
                    'line_number': line.line_number,
                    'account_code': line.account_code,
                    'account_name': line.account_name,
                    'debit_amount': float(line.debit_amount),
                    'credit_amount': float(line.credit_amount),
                    'description': line.description
                }
                for line in self.lines
            ]
        }


@dataclass
class GeneralLedger:
    """æ€»è´¦"""
    account_code: str
    account_name: str
    company_code: str
    fiscal_year: str
    fiscal_period: str
    opening_balance: Decimal = Decimal('0')
    period_debit: Decimal = Decimal('0')
    period_credit: Decimal = Decimal('0')
    closing_balance: Decimal = Decimal('0')
    currency: str = "CNY"
    
    def calculate_closing_balance(self) -> None:
        """è®¡ç®—æœŸæœ«ä½™é¢"""
        account = Account(self.account_code, self.account_name, AccountType.ASSET)
        if account.get_balance_direction() == "Debit":
            self.closing_balance = self.opening_balance + self.period_debit - self.period_credit
        else:
            self.closing_balance = self.opening_balance + self.period_credit - self.period_debit
    
    def post_entry(self, entry: JournalEntry) -> None:
        """è¿‡è´¦å‡­è¯åˆ°æ€»è´¦"""
        for line in entry.lines:
            if line.account_code == self.account_code:
                self.period_debit += line.debit_amount
                self.period_credit += line.credit_amount
        self.calculate_closing_balance()


class GeneralLedgerSystem:
    """æ€»è´¦ç®¡ç†ç³»ç»Ÿ"""
    
    def __init__(self):
        self.accounts: Dict[str, Account] = {}
        self.entries: Dict[str, JournalEntry] = {}
        self.ledgers: Dict[str, GeneralLedger] = {}
        self.approval_rules: Dict[str, Dict] = {}
    
    def add_account(self, account: Account) -> None:
        """æ·»åŠ ç§‘ç›®"""
        self.accounts[account.account_code] = account
    
    def create_entry(self, entry: JournalEntry) -> Tuple[bool, str]:
        """åˆ›å»ºå‡­è¯"""
        # ç”Ÿæˆå‡­è¯ç¼–å·
        if not entry.entry_id:
            entry.entry_id = f"JE-{entry.fiscal_year}-{entry.fiscal_period}-{uuid.uuid4().hex[:8].upper()}"
        
        # éªŒè¯ç§‘ç›®
        for line in entry.lines:
            if line.account_code not in self.accounts:
                return False, f"ç§‘ç›® {line.account_code} ä¸å­˜åœ¨"
        
        self.entries[entry.entry_id] = entry
        return True, entry.entry_id
    
    def get_entry(self, entry_id: str) -> Optional[JournalEntry]:
        """è·å–å‡­è¯"""
        return self.entries.get(entry_id)
    
    def get_entries_by_date(self, start_date: date, end_date: date) -> List[JournalEntry]:
        """æŒ‰æ—¥æœŸèŒƒå›´è·å–å‡­è¯"""
        return [
            entry for entry in self.entries.values()
            if start_date <= entry.entry_date <= end_date
        ]
    
    def get_trial_balance(self, fiscal_year: str, fiscal_period: str) -> List[GeneralLedger]:
        """ç”Ÿæˆè¯•ç®—å¹³è¡¡è¡¨"""
        trial_balance = []
        for ledger in self.ledgers.values():
            if ledger.fiscal_year == fiscal_year and ledger.fiscal_period == fiscal_period:
                trial_balance.append(ledger)
        return trial_balance
    
    def validate_trial_balance(self, fiscal_year: str, fiscal_period: str) -> Tuple[bool, Decimal]:
        """éªŒè¯è¯•ç®—å¹³è¡¡"""
        trial_balance = self.get_trial_balance(fiscal_year, fiscal_period)
        total_debit = sum(l.opening_balance for l in trial_balance if l.opening_balance > 0)
        total_credit = sum(l.opening_balance for l in trial_balance if l.opening_balance < 0)
        total_debit += sum(l.period_debit for l in trial_balance)
        total_credit += sum(l.period_credit for l in trial_balance)
        
        difference = abs(total_debit - total_credit)
        return difference < Decimal('0.01'), difference
    
    def get_statistics(self) -> Dict:
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        total_entries = len(self.entries)
        posted_entries = sum(1 for e in self.entries.values() if e.status == EntryStatus.POSTED)
        draft_entries = sum(1 for e in self.entries.values() if e.status == EntryStatus.DRAFT)
        
        total_amount = sum(e.total_debit for e in self.entries.values())
        
        return {
            'total_entries': total_entries,
            'posted_entries': posted_entries,
            'draft_entries': draft_entries,
            'approval_rate': posted_entries / total_entries * 100 if total_entries > 0 else 0,
            'total_amount': float(total_amount),
            'account_count': len(self.accounts),
            'ledger_count': len(self.ledgers)
        }


# ä½¿ç”¨ç¤ºä¾‹
def main():
    """ä¸»å‡½æ•°"""
    # åˆ›å»ºæ€»è´¦ç³»ç»Ÿ
    gl_system = GeneralLedgerSystem()
    
    # æ·»åŠ ç§‘ç›®
    accounts = [
        Account("1001", "åº“å­˜ç°é‡‘", AccountType.ASSET),
        Account("1002", "é“¶è¡Œå­˜æ¬¾", AccountType.ASSET),
        Account("1122", "åº”æ”¶è´¦æ¬¾", AccountType.ASSET),
        Account("1403", "åŸææ–™", AccountType.ASSET),
        Account("2202", "åº”ä»˜è´¦æ¬¾", AccountType.LIABILITY),
        Account("6001", "ä¸»è¥ä¸šåŠ¡æ”¶å…¥", AccountType.REVENUE),
        Account("6401", "ä¸»è¥ä¸šåŠ¡æˆæœ¬", AccountType.EXPENSE),
    ]
    for account in accounts:
        gl_system.add_account(account)
    
    # åˆ›å»ºå‡­è¯
    entry = JournalEntry(
        entry_id="",
        entry_date=date(2025, 1, 15),
        fiscal_year="2025",
        fiscal_period="01",
        entry_type=EntryType.MANUAL,
        description="é”€å”®å•†å“ä¸€æ‰¹",
        company_code="COMP001",
        company_name="åä¿¡åˆ¶é€ é›†å›¢",
        created_by="zhangsan"
    )
    
    # æ·»åŠ åˆ†å½•è¡Œ
    entry.add_line(JournalLine(
        line_number=1,
        account_code="1122",
        account_name="åº”æ”¶è´¦æ¬¾",
        debit_amount=Decimal('113000.00'),
        customer_code="CUST001",
        description="åº”æ”¶Aå…¬å¸è´§æ¬¾"
    ))
    
    entry.add_line(JournalLine(
        line_number=2,
        account_code="6001",
        account_name="ä¸»è¥ä¸šåŠ¡æ”¶å…¥",
        credit_amount=Decimal('100000.00'),
        description="é”€å”®æ”¶å…¥"
    ))
    
    entry.add_line(JournalLine(
        line_number=3,
        account_code="2202",
        account_name="åº”ä»˜è´¦æ¬¾-é”€é¡¹ç¨é¢",
        credit_amount=Decimal('13000.00'),
        description="é”€é¡¹ç¨é¢"
    ))
    
    # åˆ›å»ºå‡­è¯
    success, result = gl_system.create_entry(entry)
    print(f"åˆ›å»ºå‡­è¯: {success}, {result}")
    
    # æäº¤å‡­è¯
    success, errors = entry.submit("zhangsan")
    print(f"æäº¤å‡­è¯: {success}, {errors}")
    
    # å®¡æ ¸å‡­è¯
    success, msg = entry.approve("lisi")
    print(f"å®¡æ ¸å‡­è¯: {success}, {msg}")
    
    # è¿‡è´¦å‡­è¯
    success, msg = entry.post("wangwu")
    print(f"è¿‡è´¦å‡­è¯: {success}, {msg}")
    
    # æ‰“å°å‡­è¯ä¿¡æ¯
    print("\nå‡­è¯è¯¦æƒ…:")
    print(json.dumps(entry.to_dict(), indent=2, ensure_ascii=False))
    
    # æ‰“å°ç»Ÿè®¡ä¿¡æ¯
    print("\nç³»ç»Ÿç»Ÿè®¡:")
    print(json.dumps(gl_system.get_statistics(), indent=2, ensure_ascii=False))


if __name__ == '__main__':
    main()
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| å‡­è¯å¤„ç†æ•ˆç‡ | 5000å¼ /å¤© | 25000å¼ /å¤© | 400% |
| æœˆç»“å‘¨æœŸ | 15ä¸ªå·¥ä½œæ—¥ | 3ä¸ªå·¥ä½œæ—¥ | 80% |
| å½•å…¥é”™è¯¯ç‡ | 3% | 0.05% | 98.3% |
| è‡ªåŠ¨å€Ÿè´·å¹³è¡¡æ£€æŸ¥ | æ—  | 100% | - |
| è·¨ç³»ç»Ÿæ•°æ®è‡ªåŠ¨é‡‡é›†ç‡ | 30% | 98% | 226% |

**ROIåˆ†æ**ï¼š

- **æŠ•å…¥æˆæœ¬**ï¼šç³»ç»Ÿå¼€å‘åŠå®æ–½è´¹ç”¨ 350ä¸‡å…ƒ
- **å¹´åº¦æ”¶ç›Š**ï¼š
  - äººå·¥æˆæœ¬èŠ‚çº¦ï¼šæœˆå‡å‡å°‘åŠ ç­è´¹ç”¨ 25ä¸‡å…ƒï¼Œå¹´èŠ‚çº¦ 300ä¸‡å…ƒ
  - å·®é”™æŸå¤±å‡å°‘ï¼šå¹´å‡å°‘è´¢åŠ¡å·®é”™æŸå¤±çº¦ 150ä¸‡å…ƒ
  - æ•ˆç‡æå‡æ”¶ç›Šï¼šè´¢åŠ¡æå‰ç»“è´¦å¸¦æ¥çš„èµ„é‡‘æ”¶ç›Šçº¦ 200ä¸‡å…ƒ
- **å¹´åº¦ROI**ï¼šï¼ˆ650 - 350ï¼‰/ 350 = 85.7%
- **æŠ•èµ„å›æ”¶æœŸ**ï¼šçº¦ 6.5ä¸ªæœˆ

---

## 3. æ¡ˆä¾‹2ï¼šå¤šå¸ç§æ€»è´¦æ ¸ç®—ç³»ç»Ÿ

### 3.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
è¿œæ´‹è´¸æ˜“é›†å›¢æ˜¯ä¸€å®¶ä»äº‹è¿›å‡ºå£ä¸šåŠ¡çš„è·¨å›½è´¸æ˜“å…¬å¸ï¼Œä¸šåŠ¡æ¶‰åŠUSDã€EURã€JPYã€GBPç­‰12ç§å¤–å¸ç»“ç®—ã€‚é›†å›¢éœ€è¦æ„å»ºå¤šå¸ç§æ€»è´¦ç³»ç»Ÿï¼Œæ”¯æŒå¤–å¸ä¸šåŠ¡æ ¸ç®—ã€æ±‡ç‡æŠ˜ç®—å’Œæ±‡å…‘æŸç›Šè®¡ç®—ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **æ±‡ç‡ç®¡ç†æ··ä¹±**ï¼šæ±‡ç‡æ›´æ–°ä¸åŠæ—¶ï¼Œä¸åŒéƒ¨é—¨ä½¿ç”¨ä¸åŒæ±‡ç‡ï¼Œå¯¼è‡´æ ¸ç®—å·®å¼‚
2. **æ±‡å…‘æŸç›Šè®¡ç®—å¤æ‚**ï¼šæœˆæœ«æ±‡å…‘æŸç›Šæ‰‹å·¥è®¡ç®—ï¼Œå·¥ä½œé‡å¤§ä¸”å®¹æ˜“å‡ºé”™
3. **å¤–å¸æŠ¥è¡¨ç¼–åˆ¶å›°éš¾**ï¼šéœ€è¦æŒ‰ä¸åŒå¸ç§å’Œæœ¬ä½å¸åˆ†åˆ«ç¼–åˆ¶æŠ¥è¡¨ï¼Œæ‰‹å·¥å¤„ç†æ•ˆç‡ä½
4. **å¤šå¸ç§å¯¹è´¦å›°éš¾**ï¼šå¤–å¸è´¦æˆ·ä¸é“¶è¡Œå¯¹è´¦å•å¸ç§ä¸ä¸€è‡´ï¼Œå¯¹è´¦å·¥ä½œé‡å¤§
5. **åˆè§„æ€§é£é™©**ï¼šè·¨å›½ä¸šåŠ¡æ¶‰åŠä¸åŒä¼šè®¡å‡†åˆ™ï¼Œå¤–å¸æŠ˜ç®—å¤„ç†å­˜åœ¨åˆè§„é£é™©

**ä¸šåŠ¡ç›®æ ‡**ï¼š

1. **ç»Ÿä¸€æ±‡ç‡ç®¡ç†**ï¼šå»ºç«‹é›†ä¸­æ±‡ç‡ç®¡ç†ä½“ç³»ï¼Œå®æ—¶æ›´æ–°æ±‡ç‡ï¼Œç¡®ä¿å…¨é›†å›¢æ±‡ç‡ä¸€è‡´æ€§
2. **è‡ªåŠ¨æ±‡å…‘æŸç›Šè®¡ç®—**ï¼šç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ±‡å…‘æŸç›Šï¼Œå‡†ç¡®ç‡è¾¾åˆ°99.9%ä»¥ä¸Š
3. **å¤šå¸ç§æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ**ï¼šæ”¯æŒä¸€é”®ç”Ÿæˆæœ¬ä½å¸å’Œå¤–å¸æŠ¥è¡¨ï¼ŒæŠ¥è¡¨ç¼–åˆ¶æ—¶é—´ç¼©çŸ­80%
4. **æ™ºèƒ½å¯¹è´¦**ï¼šå®ç°å¤–å¸è´¦æˆ·è‡ªåŠ¨å¯¹è´¦ï¼Œå¯¹è´¦æ•ˆç‡æå‡70%
5. **åˆè§„æ€§ä¿éšœ**ï¼šæ”¯æŒä¸­å›½ä¼šè®¡å‡†åˆ™å’ŒIFRSå‡†åˆ™çš„å¤–å¸æŠ˜ç®—è¦æ±‚

### 3.2 æŠ€æœ¯æŒ‘æˆ˜

1. **æ±‡ç‡æ•°æ®é›†æˆ**ï¼šéœ€è¦å®æ—¶è·å–å¤šä¸ªæ±‡ç‡æºçš„æ±‡ç‡æ•°æ®ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ€§
2. **å†å²æ±‡ç‡è¿½æº¯**ï¼šéœ€è¦ä¿å­˜å†å²æ±‡ç‡ï¼Œæ”¯æŒä»»æ„æ—¶é—´ç‚¹çš„æ±‡ç‡æŸ¥è¯¢å’Œé‡ç®—
3. **æ±‡å…‘æŸç›Šåˆ†æ‘Š**ï¼šéœ€è¦å°†æ±‡å…‘æŸç›Šå‡†ç¡®åˆ†æ‘Šåˆ°å„æˆæœ¬ä¸­å¿ƒå’Œåˆ©æ¶¦ä¸­å¿ƒ
4. **å¤šå¸ç§å¹¶è¡Œå¤„ç†**ï¼šéœ€è¦åŒæ—¶å¤„ç†å¤šç§å¸ç§çš„ä¸šåŠ¡ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
5. **å¸ç§è½¬æ¢ç²¾åº¦**ï¼šéœ€è¦å¤„ç†å¸ç§è½¬æ¢çš„ç²¾åº¦é—®é¢˜ï¼Œé¿å…ç´¯ç§¯è¯¯å·®

### 3.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰å¤šå¸ç§æ€»è´¦ç³»ç»Ÿ**ï¼Œå®ç°æ±‡ç‡ç®¡ç†ã€å¤–å¸æ ¸ç®—ã€æ±‡å…‘æŸç›Šè‡ªåŠ¨è®¡ç®—ã€‚

### 3.4 å®Œæ•´ä»£ç å®ç°

```python
#!/usr/bin/env python3
"""
å¤šå¸ç§æ€»è´¦æ ¸ç®—ç³»ç»Ÿ
æ”¯æŒï¼šå¤šå¸ç§è®°è´¦ã€æ±‡ç‡ç®¡ç†ã€æ±‡å…‘æŸç›Šè®¡ç®—ã€å¤–å¸æŠ¥è¡¨ç”Ÿæˆ
"""

from typing import Dict, List, Optional, Tuple
from datetime import date, datetime
from decimal import Decimal, ROUND_HALF_UP
from dataclasses import dataclass, field
from enum import Enum
import json


class CurrencyType(str, Enum):
    """è´§å¸ç±»å‹"""
    FUNCTIONAL = "Functional"       # æœ¬ä½å¸
    TRANSACTIONAL = "Transactional" # äº¤æ˜“è´§å¸
    REPORTING = "Reporting"         # æŠ¥å‘Šè´§å¸


@dataclass
class ExchangeRate:
    """æ±‡ç‡"""
    from_currency: str
    to_currency: str
    rate_date: date
    rate: Decimal
    rate_type: str = "M"  # M-ä¸­é—´ä»·ï¼ŒB-ä¹°å…¥ä»·ï¼ŒS-å–å‡ºä»·
    source: str = "PBOC"   # æ±‡ç‡æ¥æº
    created_at: datetime = field(default_factory=datetime.now)
    
    def convert(self, amount: Decimal) -> Decimal:
        """è½¬æ¢é‡‘é¢"""
        return (amount * self.rate).quantize(Decimal('0.01'), rounding=ROUND_HALF_UP)


@dataclass
class MultiCurrencyAccount:
    """å¤šå¸ç§ç§‘ç›®ä½™é¢"""
    account_code: str
    company_code: str
    currency: str
    fiscal_year: str
    fiscal_period: str
    opening_balance_fc: Decimal = Decimal('0')  # å¤–å¸æœŸåˆä½™é¢
    period_debit_fc: Decimal = Decimal('0')     # å¤–å¸å€Ÿæ–¹å‘ç”Ÿé¢
    period_credit_fc: Decimal = Decimal('0')    # å¤–å¸è´·æ–¹å‘ç”Ÿé¢
    closing_balance_fc: Decimal = Decimal('0')  # å¤–å¸æœŸæœ«ä½™é¢
    opening_balance_lc: Decimal = Decimal('0')  # æœ¬ä½å¸æœŸåˆä½™é¢
    period_debit_lc: Decimal = Decimal('0')     # æœ¬ä½å¸å€Ÿæ–¹å‘ç”Ÿé¢
    period_credit_lc: Decimal = Decimal('0')    # æœ¬ä½å¸è´·æ–¹å‘ç”Ÿé¢
    closing_balance_lc: Decimal = Decimal('0')  # æœ¬ä½å¸æœŸæœ«ä½™é¢
    exchange_rate_opening: Decimal = Decimal('1')
    exchange_rate_closing: Decimal = Decimal('1')
    
    def calculate_closing_balance(self) -> None:
        """è®¡ç®—æœŸæœ«ä½™é¢"""
        self.closing_balance_fc = (self.opening_balance_fc + 
                                   self.period_debit_fc - 
                                   self.period_credit_fc)
    
    def calculate_local_currency(self) -> None:
        """è®¡ç®—æœ¬ä½å¸é‡‘é¢"""
        self.closing_balance_lc = (self.closing_balance_fc * 
                                   self.exchange_rate_closing).quantize(
                                       Decimal('0.01'), rounding=ROUND_HALF_UP)
    
    def calculate_exchange_difference(self) -> Decimal:
        """è®¡ç®—æ±‡å…‘æŸç›Š"""
        # ç†è®ºæœ¬ä½å¸æœŸæœ«ä½™é¢
        theoretical_lc = (self.opening_balance_fc * self.exchange_rate_opening +
                         (self.period_debit_fc - self.period_credit_fc) * self.exchange_rate_closing)
        return self.closing_balance_lc - theoretical_lc.quantize(Decimal('0.01'))


class ExchangeRateManager:
    """æ±‡ç‡ç®¡ç†å™¨"""
    
    def __init__(self, functional_currency: str = "CNY"):
        self.functional_currency = functional_currency
        self.rates: Dict[str, Dict[date, ExchangeRate]] = {}
        self.history: List[ExchangeRate] = []
    
    def add_rate(self, rate: ExchangeRate) -> None:
        """æ·»åŠ æ±‡ç‡"""
        key = f"{rate.from_currency}-{rate.to_currency}"
        if key not in self.rates:
            self.rates[key] = {}
        self.rates[key][rate.rate_date] = rate
        self.history.append(rate)
    
    def get_rate(self, from_currency: str, to_currency: str, 
                 rate_date: date) -> Optional[ExchangeRate]:
        """è·å–æ±‡ç‡"""
        key = f"{from_currency}-{to_currency}"
        if key in self.rates and rate_date in self.rates[key]:
            return self.rates[key][rate_date]
        
        # å¦‚æœæ‰¾ä¸åˆ°ç›´æ¥æ±‡ç‡ï¼Œå°è¯•é€šè¿‡æœ¬ä½å¸è½¬æ¢
        if from_currency != self.functional_currency and to_currency != self.functional_currency:
            rate1 = self.get_rate(from_currency, self.functional_currency, rate_date)
            rate2 = self.get_rate(self.functional_currency, to_currency, rate_date)
            if rate1 and rate2:
                return ExchangeRate(
                    from_currency=from_currency,
                    to_currency=to_currency,
                    rate_date=rate_date,
                    rate=rate1.rate * rate2.rate,
                    rate_type="C"  # è®¡ç®—æ±‡ç‡
                )
        return None
    
    def convert(self, amount: Decimal, from_currency: str, 
                to_currency: str, rate_date: date) -> Tuple[Decimal, Optional[ExchangeRate]]:
        """è´§å¸è½¬æ¢"""
        if from_currency == to_currency:
            return amount, None
        
        rate = self.get_rate(from_currency, to_currency, rate_date)
        if rate:
            return rate.convert(amount), rate
        return amount, None


class MultiCurrencyLedgerSystem:
    """å¤šå¸ç§æ€»è´¦ç³»ç»Ÿ"""
    
    def __init__(self, functional_currency: str = "CNY"):
        self.functional_currency = functional_currency
        self.rate_manager = ExchangeRateManager(functional_currency)
        self.accounts: Dict[str, MultiCurrencyAccount] = {}
        self.exchange_differences: List[Dict] = []
    
    def add_account(self, account: MultiCurrencyAccount) -> None:
        """æ·»åŠ ç§‘ç›®"""
        key = f"{account.account_code}-{account.company_code}-{account.currency}"
        self.accounts[key] = account
    
    def post_transaction(self, account_code: str, company_code: str,
                        currency: str, fiscal_year: str, fiscal_period: str,
                        debit_fc: Decimal, credit_fc: Decimal,
                        rate_date: date) -> Tuple[bool, str]:
        """è¿‡è´¦äº¤æ˜“"""
        key = f"{account_code}-{company_code}-{currency}"
        if key not in self.accounts:
            return False, f"ç§‘ç›® {key} ä¸å­˜åœ¨"
        
        account = self.accounts[key]
        
        # è½¬æ¢ä¸ºæœ¬ä½å¸
        rate = self.rate_manager.get_rate(currency, self.functional_currency, rate_date)
        if not rate:
            return False, f"æœªæ‰¾åˆ° {currency} åˆ° {self.functional_currency} çš„æ±‡ç‡"
        
        debit_lc = rate.convert(debit_fc) if debit_fc else Decimal('0')
        credit_lc = rate.convert(credit_fc) if credit_fc else Decimal('0')
        
        # æ›´æ–°ä½™é¢
        account.period_debit_fc += debit_fc
        account.period_credit_fc += credit_fc
        account.period_debit_lc += debit_lc
        account.period_credit_lc += credit_lc
        account.exchange_rate_closing = rate.rate
        account.calculate_closing_balance()
        account.calculate_local_currency()
        
        return True, "è¿‡è´¦æˆåŠŸ"
    
    def calculate_exchange_differences(self, fiscal_year: str, 
                                       fiscal_period: str,
                                       closing_date: date) -> List[Dict]:
        """è®¡ç®—æ±‡å…‘æŸç›Š"""
        differences = []
        
        for key, account in self.accounts.items():
            if account.fiscal_year == fiscal_year and account.fiscal_period == fiscal_period:
                # æ›´æ–°æœŸæœ«æ±‡ç‡
                rate = self.rate_manager.get_rate(
                    account.currency, 
                    self.functional_currency, 
                    closing_date
                )
                if rate:
                    account.exchange_rate_closing = rate.rate
                    account.calculate_local_currency()
                    
                    diff = account.calculate_exchange_difference()
                    if diff != Decimal('0'):
                        differences.append({
                            'account_code': account.account_code,
                            'company_code': account.company_code,
                            'currency': account.currency,
                            'exchange_difference': float(diff),
                            'closing_rate': float(rate.rate)
                        })
        
        self.exchange_differences = differences
        return differences
    
    def generate_foreign_currency_report(self, company_code: str,
                                         fiscal_year: str,
                                         fiscal_period: str) -> Dict:
        """ç”Ÿæˆå¤–å¸æŠ¥è¡¨"""
        report = {
            'company_code': company_code,
            'fiscal_year': fiscal_year,
            'fiscal_period': fiscal_period,
            'functional_currency': self.functional_currency,
            'accounts': []
        }
        
        for key, account in self.accounts.items():
            if (account.company_code == company_code and 
                account.fiscal_year == fiscal_year and
                account.fiscal_period == fiscal_period):
                report['accounts'].append({
                    'account_code': account.account_code,
                    'currency': account.currency,
                    'opening_balance_fc': float(account.opening_balance_fc),
                    'period_debit_fc': float(account.period_debit_fc),
                    'period_credit_fc': float(account.period_credit_fc),
                    'closing_balance_fc': float(account.closing_balance_fc),
                    'closing_balance_lc': float(account.closing_balance_lc),
                    'exchange_rate': float(account.exchange_rate_closing)
                })
        
        return report


# ä½¿ç”¨ç¤ºä¾‹
def demo_multi_currency():
    """å¤šå¸ç§æ¼”ç¤º"""
    # åˆ›å»ºå¤šå¸ç§æ€»è´¦ç³»ç»Ÿ
    mc_system = MultiCurrencyLedgerSystem("CNY")
    
    # æ·»åŠ æ±‡ç‡
    today = date(2025, 1, 31)
    rates = [
        ExchangeRate("USD", "CNY", today, Decimal('7.2345')),
        ExchangeRate("EUR", "CNY", today, Decimal('7.8912')),
        ExchangeRate("JPY", "CNY", today, Decimal('0.0489')),
    ]
    for rate in rates:
        mc_system.rate_manager.add_rate(rate)
    
    # æ·»åŠ å¤–å¸ç§‘ç›®
    accounts = [
        MultiCurrencyAccount("1002", "COMP001", "USD", "2025", "01"),
        MultiCurrencyAccount("1002", "COMP001", "EUR", "2025", "01"),
        MultiCurrencyAccount("1122", "COMP001", "USD", "2025", "01"),
    ]
    for account in accounts:
        account.opening_balance_fc = Decimal('10000.00')
        account.opening_balance_lc = Decimal('72345.00')
        account.exchange_rate_opening = Decimal('7.2345')
        mc_system.add_account(account)
    
    # è¿‡è´¦äº¤æ˜“
    mc_system.post_transaction(
        "1002", "COMP001", "USD", "2025", "01",
        Decimal('5000.00'), Decimal('0'),
        today
    )
    
    mc_system.post_transaction(
        "1122", "COMP001", "USD", "2025", "01",
        Decimal('0'), Decimal('3000.00'),
        today
    )
    
    # è®¡ç®—æ±‡å…‘æŸç›Š
    differences = mc_system.calculate_exchange_differences("2025", "01", today)
    print("æ±‡å…‘æŸç›Šè®¡ç®—ç»“æœ:")
    print(json.dumps(differences, indent=2, ensure_ascii=False))
    
    # ç”Ÿæˆå¤–å¸æŠ¥è¡¨
    report = mc_system.generate_foreign_currency_report("COMP001", "2025", "01")
    print("\nå¤–å¸æŠ¥è¡¨:")
    print(json.dumps(report, indent=2, ensure_ascii=False))


if __name__ == '__main__':
    demo_multi_currency()
```

### 3.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æ±‡ç‡æ›´æ–°åŠæ—¶æ€§ | å»¶è¿Ÿ1-3å¤© | å®æ—¶æ›´æ–° | - |
| æ±‡å…‘æŸç›Šè®¡ç®—å‡†ç¡®ç‡ | 92% | 99.9% | 8.6% |
| å¤–å¸æŠ¥è¡¨ç¼–åˆ¶æ—¶é—´ | 5å¤© | 0.5å¤© | 90% |
| å¤–å¸å¯¹è´¦æ•ˆç‡ | 30ç¬”/å¤© | 200ç¬”/å¤© | 567% |
| æ±‡ç‡å·®å¼‚å¯¼è‡´çš„æ ¸ç®—å·®é”™ | æœˆå‡5èµ· | 0èµ· | 100% |

**ROIåˆ†æ**ï¼š

- **æŠ•å…¥æˆæœ¬**ï¼šç³»ç»Ÿå¼€å‘åŠå®æ–½è´¹ç”¨ 200ä¸‡å…ƒ
- **å¹´åº¦æ”¶ç›Š**ï¼š
  - äººå·¥æ ¸ç®—æˆæœ¬èŠ‚çº¦ï¼šå¹´èŠ‚çº¦ 120ä¸‡å…ƒ
  - æ±‡å…‘æŸå¤±å‡å°‘ï¼šå¹´å‡å°‘æ±‡å…‘æŸå¤±çº¦ 80ä¸‡å…ƒ
  - åˆè§„é£é™©é™ä½ï¼šé¿å…æ½œåœ¨ç½šæ¬¾æŸå¤±çº¦ 200ä¸‡å…ƒ
- **å¹´åº¦ROI**ï¼šï¼ˆ400 - 200ï¼‰/ 200 = 100%
- **æŠ•èµ„å›æ”¶æœŸ**ï¼šçº¦ 6ä¸ªæœˆ

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-02-15
