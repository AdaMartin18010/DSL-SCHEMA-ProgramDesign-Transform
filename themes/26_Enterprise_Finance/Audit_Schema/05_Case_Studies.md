# å®¡è®¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [å®¡è®¡Schemaå®è·µæ¡ˆä¾‹](#å®¡è®¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šå†…éƒ¨æ§åˆ¶å®¡è®¡](#3-æ¡ˆä¾‹2å†…éƒ¨æ§åˆ¶å®¡è®¡)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
  - [4. æ¡ˆä¾‹3ï¼šåˆè§„æ€§å®¡è®¡](#4-æ¡ˆä¾‹3åˆè§„æ€§å®¡è®¡)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
  - [5. æ¡ˆä¾‹4ï¼šè´¢åŠ¡æŠ¥å‘Šåˆ°å®¡è®¡è½¬æ¢](#5-æ¡ˆä¾‹4è´¢åŠ¡æŠ¥å‘Šåˆ°å®¡è®¡è½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šå®¡è®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5å®¡è®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å®¡è®¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–è´¢åŠ¡æŠ¥è¡¨å®¡è®¡ã€å†…éƒ¨æ§åˆ¶å®¡è®¡ã€åˆè§„æ€§å®¡è®¡ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç³»ç»Ÿ**ï¼šè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç¨‹åºæ‰§è¡Œ
2. **å†…éƒ¨æ§åˆ¶å®¡è®¡ç³»ç»Ÿ**ï¼šå†…éƒ¨æ§åˆ¶å®¡è®¡
3. **åˆè§„æ€§å®¡è®¡ç³»ç»Ÿ**ï¼šåˆè§„æ€§å®¡è®¡
4. **è´¢åŠ¡æŠ¥å‘Šåˆ°å®¡è®¡è½¬æ¢å·¥å…·**ï¼šè´¢åŠ¡æŠ¥å‘Šåˆ°å®¡è®¡è½¬æ¢
5. **å®¡è®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šå®¡è®¡æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **è´¢åŠ¡æŠ¥è¡¨å®¡è®¡**ï¼šIFACå®¡è®¡æ ‡å‡†
- **å®¡è®¡æœ€ä½³å®è·µ**ï¼šAICPAå®¡è®¡æŒ‡å—

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸä¸Šå¸‚å…¬å¸éœ€è¦æ„å»ºè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç³»ç»Ÿï¼Œæ‰§è¡Œå®¡è®¡ç¨‹åºã€æ”¶é›†å®¡è®¡è¯æ®ã€å½¢æˆå®¡è®¡æ„è§ï¼Œç¡®ä¿è´¢åŠ¡æŠ¥è¡¨å®¡è®¡çš„è§„èŒƒæ€§å’Œæœ‰æ•ˆæ€§ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **å®¡è®¡ç¨‹åºä¸è§„èŒƒ**ï¼šå®¡è®¡ç¨‹åºæ‰§è¡Œä¸è§„èŒƒ
2. **è¯æ®æ”¶é›†ä¸å®Œæ•´**ï¼šå®¡è®¡è¯æ®æ”¶é›†ä¸å®Œæ•´
3. **æ„è§å½¢æˆä¸ç³»ç»Ÿ**ï¼šå®¡è®¡æ„è§å½¢æˆä¸ç³»ç»Ÿ
4. **æŠ¥å‘Šå‡ºå…·æ•ˆç‡ä½**ï¼šå®¡è®¡æŠ¥å‘Šå‡ºå…·æ•ˆç‡ä½

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- è§„èŒƒå®¡è®¡ç¨‹åºæ‰§è¡Œ
- å®Œæ•´æ”¶é›†å®¡è®¡è¯æ®
- ç³»ç»ŸåŒ–å½¢æˆå®¡è®¡æ„è§
- æé«˜æŠ¥å‘Šå‡ºå…·æ•ˆç‡

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å®¡è®¡ç¨‹åºç®¡ç†**ï¼šç®¡ç†å®¡è®¡ç¨‹åºæ‰§è¡Œ
2. **è¯æ®æ”¶é›†**ï¼šæ”¶é›†å……åˆ†é€‚å½“çš„å®¡è®¡è¯æ®
3. **æ„è§å½¢æˆ**ï¼šç³»ç»ŸåŒ–å½¢æˆå®¡è®¡æ„è§
4. **æŠ¥å‘Šç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆå®¡è®¡æŠ¥å‘Š

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰è´¢åŠ¡æŠ¥è¡¨å®¡è®¡ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**è´¢åŠ¡æŠ¥è¡¨å®¡è®¡Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
å®¡è®¡Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import date, datetime
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

class ProcedureType(str, Enum):
    """ç¨‹åºç±»å‹"""
    INSPECTION = "Inspection"
    OBSERVATION = "Observation"
    INQUIRY = "Inquiry"
    CONFIRMATION = "Confirmation"
    RECALCULATION = "Recalculation"
    ANALYTICAL_PROCEDURES = "AnalyticalProcedures"

class ProcedureResult(str, Enum):
    """ç¨‹åºç»“æœ"""
    PASS = "Pass"
    FAIL = "Fail"
    PENDING = "Pending"

class OpinionType(str, Enum):
    """æ„è§ç±»å‹"""
    UNQUALIFIED = "Unqualified"
    QUALIFIED = "Qualified"
    ADVERSE = "Adverse"
    DISCLAIMER = "Disclaimer"

@dataclass
class AuditScope:
    """å®¡è®¡èŒƒå›´"""
    audit_period_start: date
    audit_period_end: date
    audit_entities: List[str] = field(default_factory=list)
    audit_areas: List[str] = field(default_factory=list)

@dataclass
class AuditProcedure:
    """å®¡è®¡ç¨‹åº"""
    procedure_id: str
    procedure_type: ProcedureType
    procedure_description: str
    procedure_date: date
    procedure_result: ProcedureResult = ProcedureResult.PENDING
    evidence_collected: List[str] = field(default_factory=list)
    notes: Optional[str] = None

    def add_evidence(self, evidence: str):
        """æ·»åŠ è¯æ®"""
        self.evidence_collected.append(evidence)

    def complete(self, result: ProcedureResult):
        """å®Œæˆç¨‹åº"""
        self.procedure_result = result

@dataclass
class AuditOpinion:
    """å®¡è®¡æ„è§"""
    opinion_type: OpinionType
    opinion_basis: str
    opinion_date: date
    auditor_name: str
    key_audit_matters: List[str] = field(default_factory=list)

    def add_key_matter(self, matter: str):
        """æ·»åŠ å…³é”®å®¡è®¡äº‹é¡¹"""
        self.key_audit_matters.append(matter)

@dataclass
class FinancialStatementAudit:
    """è´¢åŠ¡æŠ¥è¡¨å®¡è®¡"""
    audit_scope: AuditScope
    audit_procedures: List[AuditProcedure] = field(default_factory=list)
    audit_opinion: Optional[AuditOpinion] = None
    audit_status: str = "Planning"  # Planning, Execution, Review, Completed

    def add_procedure(self, procedure: AuditProcedure):
        """æ·»åŠ å®¡è®¡ç¨‹åº"""
        self.audit_procedures.append(procedure)

    def get_procedures_by_type(self, procedure_type: ProcedureType) -> List[AuditProcedure]:
        """æŒ‰ç±»å‹è·å–ç¨‹åº"""
        return [p for p in self.audit_procedures if p.procedure_type == procedure_type]

    def get_procedures_by_result(self, result: ProcedureResult) -> List[AuditProcedure]:
        """æŒ‰ç»“æœè·å–ç¨‹åº"""
        return [p for p in self.audit_procedures if p.procedure_result == result]

    def form_opinion(self, opinion: AuditOpinion):
        """å½¢æˆå®¡è®¡æ„è§"""
        # æ£€æŸ¥æ‰€æœ‰ç¨‹åºæ˜¯å¦å®Œæˆ
        pending_procedures = self.get_procedures_by_result(ProcedureResult.PENDING)
        if pending_procedures:
            return False, f"è¿˜æœ‰{len(pending_procedures)}ä¸ªç¨‹åºæœªå®Œæˆ"

        # æ£€æŸ¥æ˜¯å¦æœ‰å¤±è´¥çš„ç¨‹åº
        failed_procedures = self.get_procedures_by_result(ProcedureResult.FAIL)
        if failed_procedures:
            # å¦‚æœæœ‰å¤±è´¥çš„ç¨‹åºï¼Œå¯èƒ½éœ€è¦å½¢æˆä¿ç•™æ„è§
            if opinion.opinion_type == OpinionType.UNQUALIFIED:
                return False, "å­˜åœ¨å¤±è´¥çš„ç¨‹åºï¼Œä¸èƒ½å½¢æˆæ— ä¿ç•™æ„è§"

        self.audit_opinion = opinion
        self.audit_status = "Completed"
        return True, "å®¡è®¡æ„è§å·²å½¢æˆ"

    def get_audit_summary(self) -> Dict:
        """è·å–å®¡è®¡æ‘˜è¦"""
        return {
            'audit_period': {
                'start': self.audit_scope.audit_period_start.isoformat(),
                'end': self.audit_scope.audit_period_end.isoformat()
            },
            'audit_areas': self.audit_scope.audit_areas,
            'procedures_count': len(self.audit_procedures),
            'procedures_by_type': {
                pt.value: len(self.get_procedures_by_type(pt))
                for pt in ProcedureType
            },
            'procedures_by_result': {
                pr.value: len(self.get_procedures_by_result(pr))
                for pr in ProcedureResult
            },
            'audit_opinion': {
                'type': self.audit_opinion.opinion_type.value if self.audit_opinion else None,
                'date': self.audit_opinion.opinion_date.isoformat() if self.audit_opinion else None
            } if self.audit_opinion else None,
            'audit_status': self.audit_status
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºè´¢åŠ¡æŠ¥è¡¨å®¡è®¡
    audit = FinancialStatementAudit(
        audit_scope=AuditScope(
            audit_period_start=date(2025, 1, 1),
            audit_period_end=date(2025, 12, 31),
            audit_entities=["COMP-001"],
            audit_areas=["Balance Sheet", "Income Statement", "Cash Flow Statement"]
        )
    )

    # æ·»åŠ å®¡è®¡ç¨‹åº
    procedure1 = AuditProcedure(
        procedure_id="PROC-BS-001",
        procedure_type=ProcedureType.INSPECTION,
        procedure_description="æ£€æŸ¥èµ„äº§è´Ÿå€ºè¡¨é¡¹ç›®ä½™é¢",
        procedure_date=date(2025, 12, 31)
    )
    procedure1.add_evidence("é“¶è¡Œå¯¹è´¦å•")
    procedure1.complete(ProcedureResult.PASS)
    audit.add_procedure(procedure1)

    # å½¢æˆå®¡è®¡æ„è§
    opinion = AuditOpinion(
        opinion_type=OpinionType.UNQUALIFIED,
        opinion_basis="è´¢åŠ¡æŠ¥è¡¨åœ¨æ‰€æœ‰é‡å¤§æ–¹é¢æŒ‰ç…§IFRSç¼–åˆ¶",
        opinion_date=date(2026, 2, 15),
        auditor_name="ABCä¼šè®¡å¸ˆäº‹åŠ¡æ‰€"
    )
    success, message = audit.form_opinion(opinion)
    print(f"å½¢æˆå®¡è®¡æ„è§: {success}, {message}")

    # è·å–å®¡è®¡æ‘˜è¦
    summary = audit.get_audit_summary()
    print(f"å®¡è®¡æ‘˜è¦: {summary}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| å®¡è®¡ç¨‹åºè§„èŒƒæ€§ | 70% | 100% | 30%æå‡ |
| è¯æ®æ”¶é›†å®Œæ•´æ€§ | 80% | 98% | 18%æå‡ |
| æ„è§å½¢æˆç³»ç»Ÿæ€§ | 60% | 95% | 35%æå‡ |
| æŠ¥å‘Šå‡ºå…·æ•ˆç‡ | ä½ | é«˜ | æ˜¾è‘—æå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **ç¨‹åºè§„èŒƒæ‰§è¡Œ**ï¼šè§„èŒƒå®¡è®¡ç¨‹åºæ‰§è¡Œ
2. **è¯æ®å®Œæ•´æ”¶é›†**ï¼šå®Œæ•´æ”¶é›†å®¡è®¡è¯æ®
3. **æ„è§ç³»ç»Ÿå½¢æˆ**ï¼šç³»ç»ŸåŒ–å½¢æˆå®¡è®¡æ„è§
4. **æŠ¥å‘Šæ•ˆç‡æé«˜**ï¼šæé«˜å®¡è®¡æŠ¥å‘Šå‡ºå…·æ•ˆç‡

**ç»éªŒæ•™è®­**ï¼š

1. å®¡è®¡ç¨‹åºç®¡ç†å¾ˆé‡è¦
2. è¯æ®æ”¶é›†éœ€è¦å®Œæ•´
3. æ„è§å½¢æˆéœ€è¦ç³»ç»ŸåŒ–
4. æŠ¥å‘Šç”Ÿæˆéœ€è¦è‡ªåŠ¨åŒ–

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [è´¢åŠ¡æŠ¥è¡¨å®¡è®¡æ ‡å‡†](https://www.ifac.org/)
- [å®¡è®¡æœ€ä½³å®è·µ](https://www.aicpa.org/)

---

## 3. æ¡ˆä¾‹2ï¼šå†…éƒ¨æ§åˆ¶å®¡è®¡

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šå†…éƒ¨æ§åˆ¶å®¡è®¡ï¼ŒåŒ…æ‹¬æ§åˆ¶ç¯å¢ƒè¯„ä»·ã€æ§åˆ¶æ´»åŠ¨æµ‹è¯•ã€æ§åˆ¶ç¼ºé™·è¯†åˆ«ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è¯„ä»·å†…éƒ¨æ§åˆ¶ç¯å¢ƒ
- æµ‹è¯•æ§åˆ¶æ´»åŠ¨æœ‰æ•ˆæ€§
- è¯†åˆ«æ§åˆ¶ç¼ºé™·
- åˆ¶å®šæ”¹è¿›å»ºè®®

### 3.2 Schemaå®šä¹‰

**å†…éƒ¨æ§åˆ¶å®¡è®¡Schema**ï¼š

```dsl
schema InternalControlAudit {
  control_environment: ControlEnvironment {
    control_environment_id: String @value("CE-001")
    management_philosophy: String @value("ç®¡ç†å±‚é‡è§†å†…éƒ¨æ§åˆ¶")
    organizational_structure: String @value("ç»„ç»‡ç»“æ„æ¸…æ™°ï¼Œæƒè´£æ˜ç¡®")
    control_environment_rating: Enum @value("Effective")
  }

  control_activities: List<ControlActivity> {
    control1: ControlActivity {
      control_id: String @value("CTRL-001")
      control_type: Enum @value("Preventive")
      control_description: String @value("é‡‡è´­å®¡æ‰¹æ§åˆ¶")
      control_frequency: Enum @value("Continuous")
      control_effectiveness: Enum @value("Effective")
    }
  }

  control_deficiencies: List<ControlDeficiency> {
    deficiency1: ControlDeficiency {
      deficiency_id: String @value("DEF-001")
      control_id: String @value("CTRL-002")
      deficiency_type: Enum @value("Deficiency")
      deficiency_description: String @value("åº“å­˜ç›˜ç‚¹æ§åˆ¶æ‰§è¡Œä¸å……åˆ†")
      deficiency_impact: String @value("å¯èƒ½å¯¼è‡´åº“å­˜è´¦å®ä¸ç¬¦")
      remediation_plan: String @value("åŠ å¼ºåº“å­˜ç›˜ç‚¹é¢‘ç‡å’Œç¨‹åº")
    }
  }
} @standard("COSO", "SOX")
```

---

## 4. æ¡ˆä¾‹3ï¼šåˆè§„æ€§å®¡è®¡

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šåˆè§„æ€§å®¡è®¡ï¼ŒåŒ…æ‹¬åˆè§„æ€§æ£€æŸ¥ã€åˆè§„æ€§æŠ¥å‘Šã€è¿è§„äº‹é¡¹ç®¡ç†ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ£€æŸ¥åˆè§„æ€§è¦æ±‚
- ç”Ÿæˆåˆè§„æ€§æŠ¥å‘Š
- ç®¡ç†è¿è§„äº‹é¡¹
- é‡‡å–çº æ­£æªæ–½

### 4.2 Schemaå®šä¹‰

**åˆè§„æ€§å®¡è®¡Schema**ï¼š

```dsl
schema ComplianceAudit {
  compliance_checks: List<ComplianceCheck> {
    check1: ComplianceCheck {
      check_id: String @value("CHECK-001")
      check_item: String @value("è´¢åŠ¡æŠ¥å‘ŠæŠ«éœ²")
      compliance_standard: String @value("IFRS 18")
      check_result: Enum @value("Compliant")
      check_date: Date @value("2025-12-31")
    }
  }

  compliance_reports: List<ComplianceReport> {
    report1: ComplianceReport {
      report_id: String @value("COMP-REPORT-2025")
      report_period_start: Date @value("2025-01-01")
      report_period_end: Date @value("2025-12-31")
      compliance_status: Enum @value("Fully_Compliant")
      compliance_summary: String @value("ä¼ä¸šå®Œå…¨ç¬¦åˆæ‰€æœ‰åˆè§„æ€§è¦æ±‚")
      report_date: Date @value("2026-01-15")
    }
  }

  violations: List<Violation> {
    violation1: Violation {
      violation_id: String @value("VIOL-001")
      violation_type: Enum @value("Regulatory")
      violation_severity: Enum @value("Low")
      violation_description: String @value("ç¨åŠ¡ç”³æŠ¥å»¶è¿Ÿ")
      violation_date: Date @value("2025-02-20")
      violation_status: Enum @value("Resolved")
      remediation_action: String @value("å·²è¡¥æŠ¥å¹¶ç¼´çº³æ»çº³é‡‘")
    }
  }
} @standard("Compliance")
```

---

## 5. æ¡ˆä¾‹4ï¼šè´¢åŠ¡æŠ¥å‘Šåˆ°å®¡è®¡è½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†ä¼ä¸šè´¢åŠ¡æŠ¥å‘Šè½¬æ¢ä¸ºå®¡è®¡æ•°æ®ï¼Œç”¨äºè´¢åŠ¡æŠ¥è¡¨å®¡è®¡ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è´¢åŠ¡æŠ¥å‘Šæ•°æ®è½¬æ¢ä¸ºå®¡è®¡èŒƒå›´
- è´¢åŠ¡æŠ¥è¡¨é¡¹ç›®è½¬æ¢ä¸ºå®¡è®¡ç¨‹åº
- è´¢åŠ¡æŠ¥è¡¨é‡‘é¢è½¬æ¢ä¸ºå®¡è®¡è¯æ®

### 5.2 å®ç°ä»£ç 

```python
from financial_reporting_schema import FinancialReportingSchema
from audit_schema import AuditSchema, FinancialAudit, AuditProcedure

def convert_financial_report_to_audit(financial_report: FinancialReportingSchema) -> AuditSchema:
    """å°†è´¢åŠ¡æŠ¥å‘Šè½¬æ¢ä¸ºå®¡è®¡æ•°æ®"""
    audit_schema = AuditSchema()
    audit_schema.company_code = financial_report.company_code

    # è½¬æ¢å®¡è®¡èŒƒå›´
    financial_audit = FinancialAudit()
    financial_audit.audit_scope.audit_period_start = financial_report.income_statement.period_start
    financial_audit.audit_scope.audit_period_end = financial_report.income_statement.period_end
    financial_audit.audit_scope.audit_entities = [financial_report.company_code]
    financial_audit.audit_scope.audit_areas = ["Balance Sheet", "Income Statement", "Cash Flow Statement"]

    # è½¬æ¢å®¡è®¡ç¨‹åº
    # èµ„äº§è´Ÿå€ºè¡¨å®¡è®¡ç¨‹åº
    balance_sheet_procedure = AuditProcedure()
    balance_sheet_procedure.procedure_id = "PROC-BS-001"
    balance_sheet_procedure.procedure_type = "Inspection"
    balance_sheet_procedure.procedure_description = "æ£€æŸ¥èµ„äº§è´Ÿå€ºè¡¨é¡¹ç›®ä½™é¢"
    balance_sheet_procedure.procedure_date = financial_report.report_date
    financial_audit.audit_procedures.append(balance_sheet_procedure)

    # åˆ©æ¶¦è¡¨å®¡è®¡ç¨‹åº
    income_statement_procedure = AuditProcedure()
    income_statement_procedure.procedure_id = "PROC-IS-001"
    income_statement_procedure.procedure_type = "Recalculation"
    income_statement_procedure.procedure_description = "é‡æ–°è®¡ç®—åˆ©æ¶¦è¡¨é¡¹ç›®"
    income_statement_procedure.procedure_date = financial_report.report_date
    financial_audit.audit_procedures.append(income_statement_procedure)

    audit_schema.financial_audit = financial_audit

    return audit_schema

# ä½¿ç”¨ç¤ºä¾‹
financial_report = FinancialReportingSchema.load_from_database("2025-12-31")
audit_data = convert_financial_report_to_audit(financial_report)
audit_data.save_to_database()
```

---

## 6. æ¡ˆä¾‹5ï¼šå®¡è®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šå®¡è®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒå®¡è®¡æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- PostgreSQLæ•°æ®åº“å­˜å‚¨
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒå®¡è®¡ç¨‹åºç»“æœåˆ†æ
- æ”¯æŒæ§åˆ¶ç¼ºé™·åˆ†æ

### 6.2 å®ç°ä»£ç 

```python
import psycopg2
from audit_schema import AuditSchema, FinancialAudit, ControlDeficiency

class AuditDataStore:
    def __init__(self, db_config):
        self.conn = psycopg2.connect(**db_config)

    def store_audit_data(self, audit_data: AuditSchema):
        """å­˜å‚¨å®¡è®¡æ•°æ®"""
        cursor = self.conn.cursor()

        audit_id = f"AUDIT-{audit_data.company_code}-{audit_data.financial_audit.audit_scope.audit_period_end}"

        # æ’å…¥å®¡è®¡ç¨‹åº
        for procedure in audit_data.financial_audit.audit_procedures:
            cursor.execute("""
                INSERT INTO audit_procedures
                (procedure_id, audit_id, procedure_type, procedure_description, procedure_date, procedure_result)
                VALUES (%s, %s, %s, %s, %s, %s)
            """, (procedure.procedure_id, audit_id, procedure.procedure_type,
                  procedure.procedure_description, procedure.procedure_date, procedure.procedure_result))

        # æ’å…¥æ§åˆ¶ç¼ºé™·
        for deficiency in audit_data.internal_control_audit.control_deficiencies:
            cursor.execute("""
                INSERT INTO control_deficiencies
                (deficiency_id, control_id, deficiency_type, deficiency_description, deficiency_impact, remediation_plan)
                VALUES (%s, %s, %s, %s, %s, %s)
            """, (deficiency.deficiency_id, deficiency.control_id,
                  deficiency.deficiency_type, deficiency.deficiency_description,
                  deficiency.deficiency_impact, deficiency.remediation_plan))

        self.conn.commit()

    def generate_audit_analysis(self, company_code, period_start, period_end):
        """ç”Ÿæˆå®¡è®¡åˆ†ææŠ¥å‘Š"""
        cursor = self.conn.cursor()

        # æŸ¥è¯¢å®¡è®¡ç¨‹åºç»“æœ
        cursor.execute("""
            SELECT
                procedure_type,
                COUNT(*) as total_procedures,
                SUM(CASE WHEN procedure_result = 'Pass' THEN 1 ELSE 0 END) as passed_procedures,
                SUM(CASE WHEN procedure_result = 'Fail' THEN 1 ELSE 0 END) as failed_procedures
            FROM audit_procedures ap
            JOIN audits a ON ap.audit_id = a.audit_id
            WHERE a.company_code = %s AND a.audit_period_end BETWEEN %s AND %s
            GROUP BY procedure_type
        """, (company_code, period_start, period_end))

        procedure_summary = cursor.fetchall()

        # æŸ¥è¯¢æ§åˆ¶ç¼ºé™·
        cursor.execute("""
            SELECT
                deficiency_type,
                COUNT(*) as deficiency_count
            FROM control_deficiencies
            WHERE created_at BETWEEN %s AND %s
            GROUP BY deficiency_type
            ORDER BY deficiency_count DESC
        """, (period_start, period_end))

        deficiency_summary = cursor.fetchall()

        return {
            "procedure_summary": procedure_summary,
            "deficiency_summary": deficiency_summary
        }

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    "host": "localhost",
    "database": "audit",
    "user": "audit_user",
    "password": "password"
}

store = AuditDataStore(db_config)

# ç”Ÿæˆå®¡è®¡åˆ†ææŠ¥å‘Š
audit_analysis = store.generate_audit_analysis("COMP-001", "2025-01-01", "2025-12-31")
print("å®¡è®¡ç¨‹åºç»“æœ:")
for row in audit_analysis["procedure_summary"]:
    print(f"{row[0]}: æ€»è®¡={row[1]}, é€šè¿‡={row[2]}, å¤±è´¥={row[3]}")

print("\næ§åˆ¶ç¼ºé™·:")
for row in audit_analysis["deficiency_summary"]:
    print(f"{row[0]}: {row[1]}ä¸ª")
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
