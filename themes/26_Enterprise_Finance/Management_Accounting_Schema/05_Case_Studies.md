# ç®¡ç†ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [ç®¡ç†ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹](#ç®¡ç†ä¼šè®¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šè´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [4. æ¡ˆä¾‹3ï¼šKPIç»©æ•ˆè¯„ä»·](#4-æ¡ˆä¾‹3kpiç»©æ•ˆè¯„ä»·)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
  - [5. æ¡ˆä¾‹4ï¼šç®¡ç†ä¼šè®¡åˆ°å¹³è¡¡è®¡åˆ†å¡è½¬æ¢](#5-æ¡ˆä¾‹4ç®¡ç†ä¼šè®¡åˆ°å¹³è¡¡è®¡åˆ†å¡è½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šç®¡ç†ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5ç®¡ç†ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ç®¡ç†ä¼šè®¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–è´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ã€é¢„ç®—å·®å¼‚åˆ†æã€KPIç»©æ•ˆè¯„ä»·ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šè´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿ**ï¼šæˆæœ¬ä¸­å¿ƒã€åˆ©æ¶¦ä¸­å¿ƒã€æŠ•èµ„ä¸­å¿ƒç®¡ç†
2. **é¢„ç®—å·®å¼‚åˆ†æç³»ç»Ÿ**ï¼šé¢„ç®—å·®å¼‚åˆ†æ
3. **KPIç»©æ•ˆè¯„ä»·ç³»ç»Ÿ**ï¼šKPIç»©æ•ˆè¯„ä»·
4. **ç®¡ç†ä¼šè®¡åˆ°å¹³è¡¡è®¡åˆ†å¡è½¬æ¢å·¥å…·**ï¼šç®¡ç†ä¼šè®¡åˆ°BSCè½¬æ¢
5. **ç®¡ç†ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šç®¡ç†ä¼šè®¡æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **ç®¡ç†ä¼šè®¡**ï¼šIMAç®¡ç†ä¼šè®¡æŒ‡å—
- **è´£ä»»ä¸­å¿ƒç®¡ç†**ï¼šCFOè´£ä»»ä¸­å¿ƒç®¡ç†æœ€ä½³å®è·µ

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸåˆ¶é€ ä¼ä¸šéœ€è¦æ„å»ºè´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿï¼Œå¯¹æˆæœ¬ä¸­å¿ƒã€åˆ©æ¶¦ä¸­å¿ƒã€æŠ•èµ„ä¸­å¿ƒè¿›è¡Œç»©æ•ˆè¯„ä»·ï¼Œä¸ºç®¡ç†å†³ç­–æä¾›æ•°æ®æ”¯æŒã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **è´£ä»»ä¸­å¿ƒç®¡ç†ç¼ºå¤±**ï¼šç¼ºä¹è´£ä»»ä¸­å¿ƒç®¡ç†ä½“ç³»
2. **ç»©æ•ˆè¯„ä»·ä¸å‡†ç¡®**ï¼šç»©æ•ˆè¯„ä»·ä¸å‡†ç¡®
3. **æŠ¥å‘Šç”Ÿæˆæ•ˆç‡ä½**ï¼šç»©æ•ˆæŠ¥å‘Šç”Ÿæˆæ•ˆç‡ä½
4. **å¯¹æ¯”åˆ†æå›°éš¾**ï¼šè´£ä»»ä¸­å¿ƒå¯¹æ¯”åˆ†æå›°éš¾

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- å»ºç«‹è´£ä»»ä¸­å¿ƒç®¡ç†ä½“ç³»
- æé«˜ç»©æ•ˆè¯„ä»·å‡†ç¡®æ€§
- æé«˜æŠ¥å‘Šç”Ÿæˆæ•ˆç‡
- æ”¯æŒå¯¹æ¯”åˆ†æ

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **è´£ä»»ä¸­å¿ƒåˆ†ç±»**ï¼šåˆ†ç±»ç®¡ç†æˆæœ¬ä¸­å¿ƒã€åˆ©æ¶¦ä¸­å¿ƒã€æŠ•èµ„ä¸­å¿ƒ
2. **ç»©æ•ˆæŒ‡æ ‡è®¡ç®—**ï¼šè®¡ç®—å„ç±»è´£ä»»ä¸­å¿ƒç»©æ•ˆæŒ‡æ ‡
3. **æŠ¥å‘Šç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆç»©æ•ˆæŠ¥å‘Š
4. **å¯¹æ¯”åˆ†æ**ï¼šæ”¯æŒè´£ä»»ä¸­å¿ƒå¯¹æ¯”åˆ†æ

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰è´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**è´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
ç®¡ç†ä¼šè®¡Schemaå®ç°
"""

from typing import Dict, List, Optional
from decimal import Decimal
from dataclasses import dataclass, field
from datetime import date, datetime

@dataclass
class CostCenter:
    """æˆæœ¬ä¸­å¿ƒ"""
    cost_center_code: str
    cost_center_name: str
    department: str
    budget_amount: Decimal
    actual_amount: Decimal = Decimal('0')
    variance: Decimal = Decimal('0')

    def calculate_variance(self):
        """è®¡ç®—å·®å¼‚"""
        self.variance = self.actual_amount - self.budget_amount

    @property
    def variance_percentage(self) -> Decimal:
        """å·®å¼‚ç™¾åˆ†æ¯”"""
        if self.budget_amount > 0:
            return (self.variance / self.budget_amount) * Decimal('100')
        return Decimal('0')

@dataclass
class ProfitCenter:
    """åˆ©æ¶¦ä¸­å¿ƒ"""
    profit_center_code: str
    profit_center_name: str
    revenue: Decimal = Decimal('0')
    costs: Decimal = Decimal('0')
    profit: Decimal = Decimal('0')
    profit_margin: Decimal = Decimal('0')

    def calculate_profit(self):
        """è®¡ç®—åˆ©æ¶¦"""
        self.profit = self.revenue - self.costs
        if self.revenue > 0:
            self.profit_margin = (self.profit / self.revenue) * Decimal('100')

@dataclass
class InvestmentCenter:
    """æŠ•èµ„ä¸­å¿ƒ"""
    investment_center_code: str
    investment_center_name: str
    investment_amount: Decimal
    net_income: Decimal = Decimal('0')
    roi: Decimal = Decimal('0')
    residual_income: Decimal = Decimal('0')
    cost_of_capital: Decimal = Decimal('10')  # èµ„æœ¬æˆæœ¬ç‡

    def calculate_roi(self):
        """è®¡ç®—æŠ•èµ„å›æŠ¥ç‡"""
        if self.investment_amount > 0:
            self.roi = (self.net_income / self.investment_amount) * Decimal('100')

    def calculate_residual_income(self):
        """è®¡ç®—å‰©ä½™æ”¶ç›Š"""
        expected_return = self.investment_amount * (self.cost_of_capital / Decimal('100'))
        self.residual_income = self.net_income - expected_return

@dataclass
class ResponsibilityCenterPerformance:
    """è´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†"""
    cost_centers: Dict[str, CostCenter] = field(default_factory=dict)
    profit_centers: Dict[str, ProfitCenter] = field(default_factory=dict)
    investment_centers: Dict[str, InvestmentCenter] = field(default_factory=dict)

    def add_cost_center(self, cost_center: CostCenter):
        """æ·»åŠ æˆæœ¬ä¸­å¿ƒ"""
        cost_center.calculate_variance()
        self.cost_centers[cost_center.cost_center_code] = cost_center

    def add_profit_center(self, profit_center: ProfitCenter):
        """æ·»åŠ åˆ©æ¶¦ä¸­å¿ƒ"""
        profit_center.calculate_profit()
        self.profit_centers[profit_center.profit_center_code] = profit_center

    def add_investment_center(self, investment_center: InvestmentCenter):
        """æ·»åŠ æŠ•èµ„ä¸­å¿ƒ"""
        investment_center.calculate_roi()
        investment_center.calculate_residual_income()
        self.investment_centers[investment_center.investment_center_code] = investment_center

    def get_performance_summary(self) -> Dict:
        """è·å–ç»©æ•ˆæ‘˜è¦"""
        return {
            'cost_centers': {
                'count': len(self.cost_centers),
                'total_budget': float(sum(cc.budget_amount for cc in self.cost_centers.values())),
                'total_actual': float(sum(cc.actual_amount for cc in self.cost_centers.values())),
                'total_variance': float(sum(cc.variance for cc in self.cost_centers.values()))
            },
            'profit_centers': {
                'count': len(self.profit_centers),
                'total_revenue': float(sum(pc.revenue for pc in self.profit_centers.values())),
                'total_profit': float(sum(pc.profit for pc in self.profit_centers.values())),
                'average_margin': float(sum(pc.profit_margin for pc in self.profit_centers.values()) / len(self.profit_centers)) if self.profit_centers else 0
            },
            'investment_centers': {
                'count': len(self.investment_centers),
                'total_investment': float(sum(ic.investment_amount for ic in self.investment_centers.values())),
                'total_net_income': float(sum(ic.net_income for ic in self.investment_centers.values())),
                'average_roi': float(sum(ic.roi for ic in self.investment_centers.values()) / len(self.investment_centers)) if self.investment_centers else 0
            }
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºè´£ä»»ä¸­å¿ƒç»©æ•ˆç®¡ç†ç³»ç»Ÿ
    performance_mgmt = ResponsibilityCenterPerformance()

    # æ·»åŠ æˆæœ¬ä¸­å¿ƒ
    cost_center = CostCenter(
        cost_center_code="CC-001",
        cost_center_name="ç”Ÿäº§éƒ¨é—¨",
        department="ç”Ÿäº§éƒ¨",
        budget_amount=Decimal('1000000.00'),
        actual_amount=Decimal('950000.00')
    )
    performance_mgmt.add_cost_center(cost_center)

    # æ·»åŠ åˆ©æ¶¦ä¸­å¿ƒ
    profit_center = ProfitCenter(
        profit_center_code="PC-001",
        profit_center_name="é”€å”®éƒ¨é—¨",
        revenue=Decimal('5000000.00'),
        costs=Decimal('3000000.00')
    )
    performance_mgmt.add_profit_center(profit_center)

    # æ·»åŠ æŠ•èµ„ä¸­å¿ƒ
    investment_center = InvestmentCenter(
        investment_center_code="IC-001",
        investment_center_name="æ–°ä¸šåŠ¡éƒ¨é—¨",
        investment_amount=Decimal('10000000.00'),
        net_income=Decimal('1500000.00')
    )
    performance_mgmt.add_investment_center(investment_center)

    # è·å–ç»©æ•ˆæ‘˜è¦
    summary = performance_mgmt.get_performance_summary()
    print(f"ç»©æ•ˆæ‘˜è¦: {summary}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| è´£ä»»ä¸­å¿ƒç®¡ç†å®Œæ•´æ€§ | 50% | 100% | 50%æå‡ |
| ç»©æ•ˆè¯„ä»·å‡†ç¡®æ€§ | 75% | 95% | 20%æå‡ |
| æŠ¥å‘Šç”Ÿæˆæ•ˆç‡ | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| å¯¹æ¯”åˆ†æèƒ½åŠ› | ä½ | é«˜ | æ˜¾è‘—æå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **ç®¡ç†ä½“ç³»å»ºç«‹**ï¼šå»ºç«‹è´£ä»»ä¸­å¿ƒç®¡ç†ä½“ç³»
2. **è¯„ä»·å‡†ç¡®æ€§æé«˜**ï¼šæé«˜ç»©æ•ˆè¯„ä»·å‡†ç¡®æ€§
3. **æŠ¥å‘Šæ•ˆç‡æé«˜**ï¼šæé«˜æŠ¥å‘Šç”Ÿæˆæ•ˆç‡
4. **å¯¹æ¯”åˆ†ææ”¯æŒ**ï¼šæ”¯æŒè´£ä»»ä¸­å¿ƒå¯¹æ¯”åˆ†æ

**ç»éªŒæ•™è®­**ï¼š

1. è´£ä»»ä¸­å¿ƒåˆ†ç±»å¾ˆé‡è¦
2. ç»©æ•ˆæŒ‡æ ‡è®¡ç®—éœ€è¦å‡†ç¡®
3. æŠ¥å‘Šç”Ÿæˆéœ€è¦è‡ªåŠ¨åŒ–
4. å¯¹æ¯”åˆ†æéœ€è¦æ”¯æŒ

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [ç®¡ç†ä¼šè®¡æœ€ä½³å®è·µ](https://www.imanet.org/)
- [è´£ä»»ä¸­å¿ƒç®¡ç†æŒ‡å—](https://www.cfo.com/)
    }
  }
} @standard("Balanced Scorecard")

```

---

## 3. æ¡ˆä¾‹2ï¼šé¢„ç®—å·®å¼‚åˆ†æ

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šé¢„ç®—å·®å¼‚åˆ†æï¼ŒåŒ…æ‹¬é¢„ç®—å·®å¼‚ã€æ•°é‡å·®å¼‚ã€ä»·æ ¼å·®å¼‚ã€æ•ˆç‡å·®å¼‚åˆ†æã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è®¡ç®—å„ç§é¢„ç®—å·®å¼‚
- åˆ†æå·®å¼‚åŸå› 
- ç”Ÿæˆå·®å¼‚åˆ†ææŠ¥å‘Š
- æ”¯æŒå·®å¼‚è¶‹åŠ¿åˆ†æ

### 3.2 Schemaå®šä¹‰

**é¢„ç®—å·®å¼‚åˆ†æSchema**ï¼š

```dsl
schema BudgetVarianceAnalysis {
  budget_variance: BudgetVariance {
    variance_id: String @value("VAR-001")
    cost_center_code: String @value("CC-001")
    account_code: String @value("3000")
    budget_amount: Decimal @value(100000.00)
    actual_amount: Decimal @value(120000.00)
    variance_amount: Decimal @value(20000.00)
    variance_percentage: Decimal @value(20.00)
  }

  volume_variance: VolumeVariance {
    variance_id: String @value("VAR-VOL-001")
    budget_volume: Decimal @value(1000.00)
    actual_volume: Decimal @value(1200.00)
    standard_price: Decimal @value(100.00)
    variance_amount: Decimal @value(20000.00)
  }

  price_variance: PriceVariance {
    variance_id: String @value("VAR-PRICE-001")
    budget_price: Decimal @value(100.00)
    actual_price: Decimal @value(110.00)
    actual_volume: Decimal @value(1200.00)
    variance_amount: Decimal @value(12000.00)
  }

  efficiency_variance: EfficiencyVariance {
    variance_id: String @value("VAR-EFF-001")
    budget_hours: Decimal @value(1000.00)
    actual_hours: Decimal @value(1100.00)
    standard_rate: Decimal @value(50.00)
    variance_amount: Decimal @value(5000.00)
  }
} @standard("Variance Analysis")
```

---

## 4. æ¡ˆä¾‹3ï¼šKPIç»©æ•ˆè¯„ä»·

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šKPIç»©æ•ˆè¯„ä»·ï¼ŒåŒ…æ‹¬KPIå®šä¹‰ã€KPIç›‘æ§ã€KPIåˆ†æã€KPIæŠ¥å‘Šã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- å®šä¹‰KPIæŒ‡æ ‡
- ç›‘æ§KPIå€¼
- è®¡ç®—KPIå¾—åˆ†
- ç”ŸæˆKPIæŠ¥å‘Š

### 4.2 Schemaå®šä¹‰

**KPIç»©æ•ˆè¯„ä»·Schema**ï¼š

```dsl
schema KPIPerformanceEvaluation {
  kpi_definitions: List<KPIDefinition> {
    kpi1: KPIDefinition {
      kpi_id: String @value("KPI-001")
      kpi_name: String @value("é”€å”®æ”¶å…¥å¢é•¿ç‡")
      kpi_type: Enum @value("Financial")
      target_value: Decimal @value(10.00)
      calculation_formula: String @value("(æœ¬æœŸæ”¶å…¥ - ä¸ŠæœŸæ”¶å…¥) / ä¸ŠæœŸæ”¶å…¥ * 100")
      measurement_unit: String @value("ç™¾åˆ†æ¯”")
    }
    kpi2: KPIDefinition {
      kpi_id: String @value("KPI-002")
      kpi_name: String @value("å®¢æˆ·æ»¡æ„åº¦")
      kpi_type: Enum @value("Customer")
      target_value: Decimal @value(85.00)
      calculation_formula: String @value("æ»¡æ„å®¢æˆ·æ•° / æ€»å®¢æˆ·æ•° * 100")
      measurement_unit: String @value("ç™¾åˆ†æ¯”")
    }
  }

  performance_metrics: List<PerformanceMetric> {
    metric1: PerformanceMetric {
      metric_id: String @value("METRIC-001")
      kpi_id: String @value("KPI-001")
      metric_value: Decimal @value(12.50)
      measurement_date: Date @value("2025-01-31")
      measurement_unit: String @value("ç™¾åˆ†æ¯”")
    }
  }

  performance_scores: List<PerformanceScore> {
    score1: PerformanceScore {
      score_id: String @value("SCORE-001")
      kpi_id: String @value("KPI-001")
      score_value: Decimal @value(85.00)
      score_level: Enum @value("Good")
      score_rank: Int @value(3)
    }
  }
} @standard("KPI")
```

---

## 5. æ¡ˆä¾‹4ï¼šç®¡ç†ä¼šè®¡åˆ°å¹³è¡¡è®¡åˆ†å¡è½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†ä¼ä¸šç®¡ç†ä¼šè®¡æ•°æ®è½¬æ¢ä¸ºå¹³è¡¡è®¡åˆ†å¡æ ¼å¼ï¼Œç”¨äºä¼ä¸šç»©æ•ˆç®¡ç†ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è½¬æ¢è´£ä»»ä¸­å¿ƒåˆ°å¹³è¡¡è®¡åˆ†å¡ç»´åº¦
- è½¬æ¢ç»©æ•ˆæŒ‡æ ‡åˆ°å¹³è¡¡è®¡åˆ†å¡æŒ‡æ ‡
- ç”Ÿæˆå¹³è¡¡è®¡åˆ†å¡æŠ¥å‘Š

### 5.2 å®ç°ä»£ç 

```python
from management_accounting_schema import ManagementAccountingSchema
from balanced_scorecard import BalancedScorecard, BSCPerspective, BSCMetric

def convert_management_to_balanced_scorecard(management_data: ManagementAccountingSchema) -> BalancedScorecard:
    """å°†ç®¡ç†ä¼šè®¡æ•°æ®è½¬æ¢ä¸ºå¹³è¡¡è®¡åˆ†å¡æ ¼å¼"""
    bsc = BalancedScorecard()

    # è½¬æ¢è´¢åŠ¡ç»´åº¦
    financial_perspective = BSCPerspective()
    financial_perspective.name = "è´¢åŠ¡ç»´åº¦"
    financial_perspective.weight = 0.25

    for profit_center in management_data.responsibility_centers.profit_centers:
        metric = BSCMetric()
        metric.name = f"{profit_center.profit_center_name}_åˆ©æ¶¦"
        metric.value = profit_center.profit
        metric.target = profit_center.profit * 1.1  # ç›®æ ‡å¢é•¿10%
        financial_perspective.metrics.append(metric)

    bsc.perspectives.append(financial_perspective)

    # è½¬æ¢å®¢æˆ·ç»´åº¦
    customer_perspective = BSCPerspective()
    customer_perspective.name = "å®¢æˆ·ç»´åº¦"
    customer_perspective.weight = 0.25

    for kpi in management_data.performance_evaluation.kpi_definitions:
        if kpi.kpi_type == "Customer":
            metric = BSCMetric()
            metric.name = kpi.kpi_name
            metric.value = get_kpi_current_value(kpi.kpi_id)
            metric.target = kpi.target_value
            customer_perspective.metrics.append(metric)

    bsc.perspectives.append(customer_perspective)

    # è½¬æ¢å†…éƒ¨æµç¨‹ç»´åº¦
    process_perspective = BSCPerspective()
    process_perspective.name = "å†…éƒ¨æµç¨‹ç»´åº¦"
    process_perspective.weight = 0.25

    for kpi in management_data.performance_evaluation.kpi_definitions:
        if kpi.kpi_type == "Process":
            metric = BSCMetric()
            metric.name = kpi.kpi_name
            metric.value = get_kpi_current_value(kpi.kpi_id)
            metric.target = kpi.target_value
            process_perspective.metrics.append(metric)

    bsc.perspectives.append(process_perspective)

    # è½¬æ¢å­¦ä¹ æˆé•¿ç»´åº¦
    learning_perspective = BSCPerspective()
    learning_perspective.name = "å­¦ä¹ æˆé•¿ç»´åº¦"
    learning_perspective.weight = 0.25

    for kpi in management_data.performance_evaluation.kpi_definitions:
        if kpi.kpi_type == "Learning":
            metric = BSCMetric()
            metric.name = kpi.kpi_name
            metric.value = get_kpi_current_value(kpi.kpi_id)
            metric.target = kpi.target_value
            learning_perspective.metrics.append(metric)

    bsc.perspectives.append(learning_perspective)

    return bsc

# ä½¿ç”¨ç¤ºä¾‹
management_data = ManagementAccountingSchema.load_from_database("2025-01")
bsc = convert_management_to_balanced_scorecard(management_data)
bsc.generate_report("balanced_scorecard_2025-01.pdf")
```

---

## 6. æ¡ˆä¾‹5ï¼šç®¡ç†ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šç®¡ç†ä¼šè®¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒç®¡ç†ä¼šè®¡æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- PostgreSQLæ•°æ®åº“å­˜å‚¨
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒç»©æ•ˆæŠ¥å‘Šç”Ÿæˆ
- æ”¯æŒå·®å¼‚åˆ†æ

### 6.2 å®ç°ä»£ç 

```python
import psycopg2
from management_accounting_schema import ManagementAccountingSchema, CostCenter, KPIDefinition

class ManagementAccountingDataStore:
    def __init__(self, db_config):
        self.conn = psycopg2.connect(**db_config)

    def store_cost_center(self, cost_center: CostCenter):
        """å­˜å‚¨æˆæœ¬ä¸­å¿ƒ"""
        cursor = self.conn.cursor()

        cursor.execute("""
            INSERT INTO cost_centers
            (cost_center_code, cost_center_name, department, budget_amount, actual_amount)
            VALUES (%s, %s, %s, %s, %s)
            ON CONFLICT (cost_center_code) DO UPDATE SET
                budget_amount = EXCLUDED.budget_amount,
                actual_amount = EXCLUDED.actual_amount
        """, (cost_center.cost_center_code, cost_center.cost_center_name,
              cost_center.department, cost_center.budget_amount, cost_center.actual_amount))

        self.conn.commit()

    def generate_performance_report(self, period_start, period_end):
        """ç”Ÿæˆç»©æ•ˆæŠ¥å‘Š"""
        cursor = self.conn.cursor()

        # æŸ¥è¯¢è´£ä»»ä¸­å¿ƒç»©æ•ˆ
        cursor.execute("""
            SELECT
                cc.cost_center_code,
                cc.cost_center_name,
                cc.budget_amount,
                cc.actual_amount,
                cc.variance,
                (cc.variance / NULLIF(cc.budget_amount, 0) * 100) as variance_percentage
            FROM cost_centers cc
            WHERE cc.created_at BETWEEN %s AND %s
            ORDER BY ABS(cc.variance) DESC
        """, (period_start, period_end))

        cost_center_performance = cursor.fetchall()

        # æŸ¥è¯¢KPIç»©æ•ˆ
        cursor.execute("""
            SELECT
                kd.kpi_id,
                kd.kpi_name,
                kd.target_value,
                AVG(pm.metric_value) as average_value,
                AVG(pm.metric_value) - kd.target_value as variance
            FROM kpi_definitions kd
            JOIN performance_metrics pm ON kd.kpi_id = pm.kpi_id
            WHERE pm.measurement_date BETWEEN %s AND %s
            GROUP BY kd.kpi_id, kd.kpi_name, kd.target_value
            ORDER BY ABS(AVG(pm.metric_value) - kd.target_value) DESC
        """, (period_start, period_end))

        kpi_performance = cursor.fetchall()

        return {
            "cost_center_performance": cost_center_performance,
            "kpi_performance": kpi_performance
        }

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    "host": "localhost",
    "database": "management_accounting",
    "user": "ma_user",
    "password": "password"
}

store = ManagementAccountingDataStore(db_config)

# ç”Ÿæˆç»©æ•ˆæŠ¥å‘Š
performance_report = store.generate_performance_report("2025-01-01", "2025-01-31")
print("è´£ä»»ä¸­å¿ƒç»©æ•ˆ:")
for row in performance_report["cost_center_performance"]:
    print(f"{row[1]}: é¢„ç®—={row[2]}, å®é™…={row[3]}, å·®å¼‚={row[4]}, å·®å¼‚ç‡={row[5]:.2f}%")

print("\nKPIç»©æ•ˆ:")
for row in performance_report["kpi_performance"]:
    print(f"{row[1]}: ç›®æ ‡={row[2]}, å®é™…={row[3]:.2f}, å·®å¼‚={row[4]:.2f}")
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
