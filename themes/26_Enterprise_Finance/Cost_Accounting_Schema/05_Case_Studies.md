# æˆæœ¬ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [æˆæœ¬ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹](#æˆæœ¬ä¼šè®¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šæ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æ](#3-æ¡ˆä¾‹2æ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æ)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
  - [4. æ¡ˆä¾‹3ï¼šæˆæœ¬åˆ†é…](#4-æ¡ˆä¾‹3æˆæœ¬åˆ†é…)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
  - [5. æ¡ˆä¾‹4ï¼šABCåˆ°æ ‡å‡†æˆæœ¬è½¬æ¢](#5-æ¡ˆä¾‹4abcåˆ°æ ‡å‡†æˆæœ¬è½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šæˆæœ¬æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5æˆæœ¬æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æˆæœ¬ä¼šè®¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–ä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ã€æ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æã€æˆæœ¬åˆ†é…ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ç³»ç»Ÿ**ï¼šABCæˆæœ¬æ ¸ç®—
2. **æ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æç³»ç»Ÿ**ï¼šæ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æ
3. **æˆæœ¬åˆ†é…ç³»ç»Ÿ**ï¼šæˆæœ¬åˆ†é…å’Œåˆ†æ‘Š
4. **ABCåˆ°æ ‡å‡†æˆæœ¬è½¬æ¢å·¥å…·**ï¼šæˆæœ¬æ ¸ç®—æ–¹æ³•è½¬æ¢
5. **æˆæœ¬æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šæˆæœ¬æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **ä½œä¸šæˆæœ¬æ³•**ï¼šIMAä½œä¸šæˆæœ¬æ³•æŒ‡å—
- **æˆæœ¬ä¼šè®¡æ ‡å‡†**ï¼šFASBæˆæœ¬ä¼šè®¡æ ‡å‡†

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸåˆ¶é€ ä¼ä¸šéœ€è¦æ„å»ºä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ç³»ç»Ÿï¼Œè¯†åˆ«ä½œä¸šã€è®¡ç®—ä½œä¸šæˆæœ¬ç‡ã€åˆ†é…é—´æ¥æˆæœ¬ï¼Œå‡†ç¡®è®¡ç®—äº§å“æˆæœ¬ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **æˆæœ¬æ ¸ç®—ä¸å‡†ç¡®**ï¼šä¼ ç»Ÿæˆæœ¬æ ¸ç®—æ–¹æ³•ä¸å‡†ç¡®
2. **é—´æ¥æˆæœ¬åˆ†é…ä¸åˆç†**ï¼šé—´æ¥æˆæœ¬åˆ†é…ä¸åˆç†
3. **ä½œä¸šè¯†åˆ«ä¸å®Œæ•´**ï¼šä¸»è¦ä½œä¸šè¯†åˆ«ä¸å®Œæ•´
4. **æˆæœ¬åŠ¨å› ä¸æ˜ç¡®**ï¼šæˆæœ¬åŠ¨å› ä¸æ˜ç¡®

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- æé«˜æˆæœ¬æ ¸ç®—å‡†ç¡®æ€§
- åˆç†åˆ†é…é—´æ¥æˆæœ¬
- å®Œæ•´è¯†åˆ«ä¸»è¦ä½œä¸š
- æ˜ç¡®æˆæœ¬åŠ¨å› 

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **ä½œä¸šè¯†åˆ«**ï¼šè¯†åˆ«ä¸»è¦ä½œä¸šå’Œæˆæœ¬åŠ¨å› 
2. **æˆæœ¬ç‡è®¡ç®—**ï¼šè®¡ç®—ä½œä¸šæˆæœ¬ç‡
3. **æˆæœ¬åˆ†é…**ï¼šå°†é—´æ¥æˆæœ¬åˆ†é…åˆ°äº§å“
4. **æˆæœ¬è®¡ç®—**ï¼šè®¡ç®—äº§å“æ€»æˆæœ¬

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰ä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**ä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
æˆæœ¬ä¼šè®¡Schemaå®ç°
"""

from typing import Dict, List, Optional
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

class ActivityType(str, Enum):
    """ä½œä¸šç±»å‹"""
    UNIT_LEVEL = "UnitLevel"
    BATCH_LEVEL = "BatchLevel"
    PRODUCT_LEVEL = "ProductLevel"
    FACILITY_LEVEL = "FacilityLevel"

class DriverType(str, Enum):
    """åŠ¨å› ç±»å‹"""
    TRANSACTION = "Transaction"
    DURATION = "Duration"
    INTENSITY = "Intensity"

@dataclass
class Activity:
    """ä½œä¸š"""
    activity_id: str
    activity_name: str
    activity_type: ActivityType
    cost_pool: Decimal
    description: Optional[str] = None

    def calculate_activity_rate(self, driver_quantity: Decimal) -> Decimal:
        """è®¡ç®—ä½œä¸šæˆæœ¬ç‡"""
        if driver_quantity > 0:
            return self.cost_pool / driver_quantity
        return Decimal('0')

@dataclass
class CostDriver:
    """æˆæœ¬åŠ¨å› """
    driver_id: str
    driver_name: str
    driver_type: DriverType
    activity_id: str
    driver_quantity: Decimal
    activity_rate: Decimal = Decimal('0')

    def calculate_activity_rate(self, activity: Activity):
        """è®¡ç®—ä½œä¸šæˆæœ¬ç‡"""
        self.activity_rate = activity.calculate_activity_rate(self.driver_quantity)

@dataclass
class Product:
    """äº§å“"""
    product_id: str
    product_name: str
    direct_material_cost: Decimal = Decimal('0')
    direct_labor_cost: Decimal = Decimal('0')
    indirect_cost: Decimal = Decimal('0')
    total_cost: Decimal = Decimal('0')
    activity_consumption: Dict[str, Decimal] = field(default_factory=dict)

    def add_activity_consumption(self, activity_id: str, consumption: Decimal):
        """æ·»åŠ ä½œä¸šæ¶ˆè€—"""
        self.activity_consumption[activity_id] = consumption

    def calculate_total_cost(self):
        """è®¡ç®—æ€»æˆæœ¬"""
        self.total_cost = self.direct_material_cost + self.direct_labor_cost + self.indirect_cost

@dataclass
class ABCProductCosting:
    """ä½œä¸šæˆæœ¬æ³•äº§å“æˆæœ¬æ ¸ç®—"""
    activities: Dict[str, Activity] = field(default_factory=dict)
    cost_drivers: Dict[str, CostDriver] = field(default_factory=dict)
    products: Dict[str, Product] = field(default_factory=dict)

    def add_activity(self, activity: Activity):
        """æ·»åŠ ä½œä¸š"""
        self.activities[activity.activity_id] = activity

    def add_cost_driver(self, driver: CostDriver):
        """æ·»åŠ æˆæœ¬åŠ¨å› """
        if driver.activity_id in self.activities:
            activity = self.activities[driver.activity_id]
            driver.calculate_activity_rate(activity)
        self.cost_drivers[driver.driver_id] = driver

    def add_product(self, product: Product):
        """æ·»åŠ äº§å“"""
        self.products[product.product_id] = product

    def allocate_indirect_costs(self):
        """åˆ†é…é—´æ¥æˆæœ¬"""
        for product in self.products.values():
            indirect_cost = Decimal('0')

            # æ ¹æ®ä½œä¸šæ¶ˆè€—åˆ†é…é—´æ¥æˆæœ¬
            for activity_id, consumption in product.activity_consumption.items():
                # æ‰¾åˆ°å¯¹åº”çš„æˆæœ¬åŠ¨å› 
                for driver in self.cost_drivers.values():
                    if driver.activity_id == activity_id:
                        indirect_cost += driver.activity_rate * consumption
                        break

            product.indirect_cost = indirect_cost
            product.calculate_total_cost()

    def get_product_cost(self, product_id: str) -> Optional[Dict]:
        """è·å–äº§å“æˆæœ¬"""
        if product_id not in self.products:
            return None

        product = self.products[product_id]
        return {
            'product_id': product_id,
            'product_name': product.product_name,
            'direct_material_cost': float(product.direct_material_cost),
            'direct_labor_cost': float(product.direct_labor_cost),
            'indirect_cost': float(product.indirect_cost),
            'total_cost': float(product.total_cost)
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºä½œä¸šæˆæœ¬æ³•æ ¸ç®—ç³»ç»Ÿ
    abc_costing = ABCProductCosting()

    # æ·»åŠ ä½œä¸š
    setup_activity = Activity(
        activity_id="ACT-001",
        activity_name="æœºå™¨è®¾ç½®",
        activity_type=ActivityType.BATCH_LEVEL,
        cost_pool=Decimal('50000.00')
    )
    abc_costing.add_activity(setup_activity)

    # æ·»åŠ æˆæœ¬åŠ¨å› 
    setup_driver = CostDriver(
        driver_id="DRIVER-001",
        driver_name="è®¾ç½®æ¬¡æ•°",
        driver_type=DriverType.TRANSACTION,
        activity_id="ACT-001",
        driver_quantity=Decimal('100.00')
    )
    abc_costing.add_cost_driver(setup_driver)

    # æ·»åŠ äº§å“
    product = Product(
        product_id="PROD-001",
        product_name="äº§å“A",
        direct_material_cost=Decimal('1000.00'),
        direct_labor_cost=Decimal('500.00')
    )
    product.add_activity_consumption("ACT-001", Decimal('2.00'))
    abc_costing.add_product(product)

    # åˆ†é…é—´æ¥æˆæœ¬
    abc_costing.allocate_indirect_costs()

    # è·å–äº§å“æˆæœ¬
    cost_info = abc_costing.get_product_cost("PROD-001")
    print(f"äº§å“æˆæœ¬: {cost_info}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æˆæœ¬æ ¸ç®—å‡†ç¡®æ€§ | 75% | 95% | 20%æå‡ |
| é—´æ¥æˆæœ¬åˆ†é…åˆç†æ€§ | 60% | 90% | 30%æå‡ |
| ä½œä¸šè¯†åˆ«å®Œæ•´æ€§ | 70% | 95% | 25%æå‡ |
| æˆæœ¬åŠ¨å› æ˜ç¡®æ€§ | 65% | 90% | 25%æå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **æˆæœ¬æ ¸ç®—å‡†ç¡®**ï¼šæé«˜æˆæœ¬æ ¸ç®—å‡†ç¡®æ€§
2. **æˆæœ¬åˆ†é…åˆç†**ï¼šåˆç†åˆ†é…é—´æ¥æˆæœ¬
3. **ä½œä¸šè¯†åˆ«å®Œæ•´**ï¼šå®Œæ•´è¯†åˆ«ä¸»è¦ä½œä¸š
4. **æˆæœ¬åŠ¨å› æ˜ç¡®**ï¼šæ˜ç¡®æˆæœ¬åŠ¨å› 

**ç»éªŒæ•™è®­**ï¼š

1. ä½œä¸šè¯†åˆ«å¾ˆé‡è¦
2. æˆæœ¬åŠ¨å› éœ€è¦å‡†ç¡®
3. æˆæœ¬åˆ†é…éœ€è¦åˆç†
4. æˆæœ¬è®¡ç®—éœ€è¦å‡†ç¡®

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [ä½œä¸šæˆæœ¬æ³•æœ€ä½³å®è·µ](https://www.imanet.org/)
- [æˆæœ¬ä¼šè®¡æ ‡å‡†](https://www.fasb.org/)

---

## 3. æ¡ˆä¾‹2ï¼šæ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æ

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æï¼ŒåŒ…æ‹¬ä»·æ ¼å·®å¼‚ã€æ•°é‡å·®å¼‚ã€æ•ˆç‡å·®å¼‚åˆ†æã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è®¡ç®—æ ‡å‡†æˆæœ¬å’Œå®é™…æˆæœ¬
- åˆ†ææˆæœ¬å·®å¼‚
- è¯†åˆ«å·®å¼‚åŸå› 
- é‡‡å–æ”¹è¿›æªæ–½

### 3.2 Schemaå®šä¹‰

**æ ‡å‡†æˆæœ¬å·®å¼‚åˆ†æSchema**ï¼š

```dsl
schema StandardCostVarianceAnalysis {
  standard_cost: StandardCost {
    product_code: String @value("PROD-001")
    material_cost: Decimal @value(50000.00)
    labor_cost: Decimal @value(30000.00)
    overhead_cost: Decimal @value(20000.00)
    total_standard_cost: Decimal @value(100000.00)
  }

  cost_variance: CostVariance {
    product_code: String @value("PROD-001")
    standard_cost: Decimal @value(100000.00)
    actual_cost: Decimal @value(110000.00)
    total_variance: Decimal @value(10000.00)
    price_variance: PriceVariance {
      material_price_variance: Decimal @value(5000.00)
      labor_price_variance: Decimal @value(2000.00)
    }
    quantity_variance: QuantityVariance {
      material_quantity_variance: Decimal @value(2000.00)
      labor_efficiency_variance: Decimal @value(1000.00)
    }
  }
} @standard("Standard Costing")
```

---

## 4. æ¡ˆä¾‹3ï¼šæˆæœ¬åˆ†é…

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æˆæœ¬ä¸­å¿ƒæˆæœ¬åˆ†é…ï¼Œå°†æœåŠ¡éƒ¨é—¨æˆæœ¬åˆ†é…åˆ°ç”Ÿäº§éƒ¨é—¨ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è¯†åˆ«åˆ†é…åŸºç¡€
- é€‰æ‹©åˆ†é…æ–¹æ³•
- è®¡ç®—åˆ†é…é‡‘é¢
- éªŒè¯åˆ†é…ç»“æœ

### 4.2 Schemaå®šä¹‰

**æˆæœ¬åˆ†é…Schema**ï¼š

```dsl
schema CostAllocation {
  allocation_bases: List<AllocationBase> {
    base1: AllocationBase {
      base_id: String @value("BASE-001")
      base_type: Enum @value("DirectLabor")
      base_amount: Decimal @value(10000.00)
    }
  }

  allocated_costs: List<AllocatedCost> {
    allocation1: AllocatedCost {
      allocation_id: String @value("ALLOC-001")
      cost_center_from: String @value("CC-SERVICE")
      cost_center_to: String @value("CC-PRODUCTION")
      allocation_base_id: String @value("BASE-001")
      allocation_amount: Decimal @value(50000.00)
      allocation_rate: Decimal @value(5.00)
    }
  }
} @standard("Cost Allocation")
```

---

## 5. æ¡ˆä¾‹4ï¼šABCåˆ°æ ‡å‡†æˆæœ¬è½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†ABCæˆæœ¬è½¬æ¢ä¸ºæ ‡å‡†æˆæœ¬ï¼Œç”¨äºæˆæœ¬æ§åˆ¶å’Œé¢„ç®—ç¼–åˆ¶ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è½¬æ¢ABCäº§å“æˆæœ¬åˆ°æ ‡å‡†æˆæœ¬
- ä¿æŒæˆæœ¬ä¿¡æ¯ä¸€è‡´æ€§
- æ”¯æŒæˆæœ¬å¯¹æ¯”åˆ†æ

### 5.2 å®ç°ä»£ç 

```python
from cost_accounting_schema import ActivityBasedCosting, StandardCosting

def convert_abc_to_standard_cost(abc_data: ActivityBasedCosting) -> StandardCosting:
    """å°†ABCæˆæœ¬è½¬æ¢ä¸ºæ ‡å‡†æˆæœ¬"""
    standard_costing = StandardCosting()

    # è½¬æ¢äº§å“æˆæœ¬
    for cost_object in abc_data.cost_objects:
        standard_cost = StandardCost()
        standard_cost.product_code = cost_object.object_code
        standard_cost.material_cost = cost_object.direct_costs * 0.6  # å‡è®¾60%ä¸ºææ–™æˆæœ¬
        standard_cost.labor_cost = cost_object.direct_costs * 0.3  # å‡è®¾30%ä¸ºäººå·¥æˆæœ¬
        standard_cost.overhead_cost = cost_object.allocated_costs  # é—´æ¥æˆæœ¬
        standard_cost.total_standard_cost = cost_object.total_costs
        standard_costing.standard_costs.append(standard_cost)

    return standard_costing

# ä½¿ç”¨ç¤ºä¾‹
abc_data = ActivityBasedCosting.load_from_database("2025-01")
standard_costing = convert_abc_to_standard_cost(abc_data)
standard_costing.save_to_database()
```

---

## 6. æ¡ˆä¾‹5ï¼šæˆæœ¬æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šæˆæœ¬æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒæˆæœ¬æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- PostgreSQLæ•°æ®åº“å­˜å‚¨
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒæˆæœ¬å·®å¼‚æŠ¥å‘Šç”Ÿæˆ
- æ”¯æŒæˆæœ¬è¶‹åŠ¿åˆ†æ

### 6.2 å®ç°ä»£ç 

```python
import psycopg2
from cost_accounting_schema import CostAccountingSchema, StandardCost, ActualCost

class CostDataStore:
    def __init__(self, db_config):
        self.conn = psycopg2.connect(**db_config)

    def store_standard_cost(self, standard_cost: StandardCost):
        """å­˜å‚¨æ ‡å‡†æˆæœ¬"""
        cursor = self.conn.cursor()

        cursor.execute("""
            INSERT INTO standard_costs
            (product_code, material_cost, labor_cost, overhead_cost, total_standard_cost, effective_date)
            VALUES (%s, %s, %s, %s, %s, %s)
            ON CONFLICT (product_code) DO UPDATE SET
                material_cost = EXCLUDED.material_cost,
                labor_cost = EXCLUDED.labor_cost,
                overhead_cost = EXCLUDED.overhead_cost,
                total_standard_cost = EXCLUDED.total_standard_cost
        """, (standard_cost.product_code, standard_cost.material_cost,
              standard_cost.labor_cost, standard_cost.overhead_cost,
              standard_cost.total_standard_cost, "2025-01-01"))

        self.conn.commit()

    def generate_cost_variance_report(self, product_code, period_start, period_end):
        """ç”Ÿæˆæˆæœ¬å·®å¼‚æŠ¥å‘Š"""
        cursor = self.conn.cursor()

        cursor.execute("""
            SELECT
                cv.product_code,
                sc.total_standard_cost,
                SUM(ac.cost_amount) as actual_cost,
                SUM(ac.cost_amount) - sc.total_standard_cost as total_variance,
                cv.price_variance,
                cv.quantity_variance
            FROM cost_variances cv
            JOIN standard_costs sc ON cv.product_code = sc.product_code
            LEFT JOIN actual_costs ac ON cv.product_code = ac.cost_object_id
            WHERE cv.product_code = %s AND cv.variance_date BETWEEN %s AND %s
            GROUP BY cv.product_code, sc.total_standard_cost, cv.price_variance, cv.quantity_variance
        """, (product_code, period_start, period_end))

        return cursor.fetchall()

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    "host": "localhost",
    "database": "cost_accounting",
    "user": "cost_user",
    "password": "password"
}

store = CostDataStore(db_config)

# ç”Ÿæˆæˆæœ¬å·®å¼‚æŠ¥å‘Š
variance_report = store.generate_cost_variance_report("PROD-001", "2025-01-01", "2025-01-31")
print("æˆæœ¬å·®å¼‚æŠ¥å‘Š:")
for row in variance_report:
    print(f"äº§å“: {row[0]}, æ ‡å‡†æˆæœ¬: {row[1]}, å®é™…æˆæœ¬: {row[2]}, æ€»å·®å¼‚: {row[3]}")
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
