# ç¨åŠ¡ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [ç¨åŠ¡ä¼šè®¡Schemaå®è·µæ¡ˆä¾‹](#ç¨åŠ¡ä¼šè®¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šæ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šæ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šå¢å€¼ç¨æ ¸ç®—](#3-æ¡ˆä¾‹2å¢å€¼ç¨æ ¸ç®—)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
  - [4. æ¡ˆä¾‹3ï¼šç¨åŠ¡ç”³æŠ¥](#4-æ¡ˆä¾‹3ç¨åŠ¡ç”³æŠ¥)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
  - [5. æ¡ˆä¾‹4ï¼šä¼šè®¡åˆ°ç¨åŠ¡è½¬æ¢](#5-æ¡ˆä¾‹4ä¼šè®¡åˆ°ç¨åŠ¡è½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šç¨åŠ¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5ç¨åŠ¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ç¨åŠ¡ä¼šè®¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–æ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ã€å¢å€¼ç¨æ ¸ç®—ã€ç¨åŠ¡ç”³æŠ¥ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šæ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ç³»ç»Ÿ**ï¼šIAS 12æ‰€å¾—ç¨æ ¸ç®—
2. **å¢å€¼ç¨æ ¸ç®—ç³»ç»Ÿ**ï¼šå¢å€¼ç¨è®¡ç®—å’Œç”³æŠ¥
3. **ç¨åŠ¡ç”³æŠ¥ç³»ç»Ÿ**ï¼šç¨åŠ¡ç”³æŠ¥è‡ªåŠ¨åŒ–
4. **ä¼šè®¡åˆ°ç¨åŠ¡è½¬æ¢å·¥å…·**ï¼šä¼šè®¡æ•°æ®åˆ°ç¨åŠ¡è½¬æ¢
5. **ç¨åŠ¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šç¨åŠ¡æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **IAS 12**ï¼šIFRSæ‰€å¾—ç¨æ ‡å‡†
- **ç¨åŠ¡ä¼šè®¡**ï¼šIMAç¨åŠ¡ä¼šè®¡æŒ‡å—

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šæ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
è…¾è®¯æ§è‚¡æœ‰é™å…¬å¸æ˜¯ä¸­å›½é¢†å…ˆçš„äº’è”ç½‘å¢å€¼æœåŠ¡æä¾›å•†ï¼Œæˆç«‹äº1998å¹´ï¼Œæ€»éƒ¨ä½äºæ·±åœ³ï¼Œä¸šåŠ¡æ¶µç›–ç¤¾äº¤ä¸é€šä¿¡ï¼ˆå¾®ä¿¡ã€QQï¼‰ã€æ•°å­—å†…å®¹ï¼ˆæ¸¸æˆã€è§†é¢‘ã€éŸ³ä¹ï¼‰ã€é‡‘èç§‘æŠ€ï¼ˆå¾®ä¿¡æ”¯ä»˜ã€ç†è´¢é€šï¼‰ã€ä¼ä¸šæœåŠ¡ï¼ˆè…¾è®¯äº‘ï¼‰ç­‰é¢†åŸŸã€‚è…¾è®¯äº2004å¹´åœ¨é¦™æ¸¯è”äº¤æ‰€ä¸Šå¸‚ï¼Œ2024å¹´è¥ä¸šæ”¶å…¥è¶…è¿‡6000äº¿å…ƒäººæ°‘å¸ï¼Œå¹´çº³ç¨é¢è¶…è¿‡500äº¿å…ƒï¼Œä¸šåŠ¡è¦†ç›–å…¨çƒ100å¤šä¸ªå›½å®¶å’Œåœ°åŒºã€‚

è…¾è®¯ç¨åŠ¡ç®¡ç†éƒ¨é—¨è´Ÿè´£é›†å›¢å…¨çƒç¨åŠ¡åˆè§„å’Œç¨åŠ¡ç­¹åˆ’ï¼Œæ¶‰åŠä¸­å›½ä¼ä¸šæ‰€å¾—ç¨ã€å¢å€¼ç¨ã€ä¸ªäººæ‰€å¾—ç¨ï¼Œä»¥åŠæµ·å¤–å­å…¬å¸æ‰€åœ¨åœ°çš„å„ç±»ç¨ç§ã€‚éšç€ä¸šåŠ¡å…¨çƒåŒ–å’Œç›‘ç®¡è¶‹ä¸¥ï¼Œç¨åŠ¡ç®¡ç†é¢ä¸´å‰æ‰€æœªæœ‰çš„æŒ‘æˆ˜ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **ç¨åŠ¡æ ¸ç®—å¤æ‚åº¦é«˜**ï¼šè…¾è®¯ä¸šåŠ¡æ¶‰åŠæ¸¸æˆã€å¹¿å‘Šã€é‡‘èç§‘æŠ€ã€äº‘æœåŠ¡ç­‰å¤šå…ƒä¸šåŠ¡ï¼Œæ”¶å…¥ç¡®è®¤ã€æˆæœ¬å½’é›†ã€è´¹ç”¨åˆ†æ‘Šè§„åˆ™å„å¼‚ï¼Œç¨åŠ¡æ ¸ç®—é€»è¾‘å¤æ‚ï¼Œæ‰‹å·¥å¤„ç†æ˜“å‡ºé”™ã€‚

2. **é€’å»¶æ‰€å¾—ç¨è®¡ç®—ç¹ç**ï¼šé›†å›¢æ‹¥æœ‰è¶…è¿‡200å®¶å­å…¬å¸ï¼Œæš‚æ—¶æ€§å·®å¼‚ã€ç¨åŠ¡äºæŸã€ç¨ç‡å˜åŠ¨ç­‰å› ç´ å¯¼è‡´é€’å»¶æ‰€å¾—ç¨èµ„äº§/è´Ÿå€ºè®¡ç®—å·¥ä½œé‡å·¨å¤§ï¼Œæœˆç»“è€—æ—¶3å¤©ã€‚

3. **å…¨çƒç¨åŠ¡åˆè§„å›°éš¾**ï¼šæµ·å¤–å­å…¬å¸åˆ†å¸ƒäºç¾å›½ã€æ¬§æ´²ã€ä¸œå—äºšç­‰åœ°ï¼Œéœ€è¦éµå¾ªå½“åœ°ç¨æ³•å’Œå›½é™…ç¨æ”¶åå®šï¼ˆå¦‚BEPS 2.0ï¼‰ï¼Œåˆè§„é£é™©é«˜ï¼Œè½¬è®©å®šä»·æ–‡æ¡£å‡†å¤‡è€—æ—¶ã€‚

4. **ç¨åŠ¡ç”³æŠ¥è‡ªåŠ¨åŒ–ä½**ï¼šå¢å€¼ç¨ã€ä¼ä¸šæ‰€å¾—ç¨ç­‰ç¨ç§ç”³æŠ¥ä¾èµ–æ‰‹å·¥å¡«æŠ¥ï¼Œæ•°æ®ä»å¤šä¸ªç³»ç»ŸæŠ½å–ï¼Œç”³æŠ¥è¡¨ç¼–åˆ¶è€—æ—¶5å¤©ï¼Œå­˜åœ¨é”™æŠ¥æ¼æŠ¥é£é™©ã€‚

5. **ç¨åŠ¡é£é™©ç®¡æ§è–„å¼±**ï¼šç¼ºä¹å®æ—¶çš„ç¨åŠ¡é£é™©ç›‘æ§é¢„è­¦æœºåˆ¶ï¼Œç¨åŠ¡ç¨½æŸ¥åº”å¯¹è¢«åŠ¨ï¼Œ2023å¹´å› ç¨åŠ¡é—®é¢˜äº§ç”Ÿæ»çº³é‡‘2000ä¸‡å…ƒã€‚

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- å»ºç«‹é›†å›¢ç»Ÿä¸€ç¨åŠ¡ç®¡ç†å¹³å°ï¼Œå®ç°ç¨åŠ¡æ ¸ç®—100%è‡ªåŠ¨åŒ–ï¼Œç¨åŠ¡æ ¸ç®—å‡†ç¡®ç‡99.9%
- å®ç°é€’å»¶æ‰€å¾—ç¨è‡ªåŠ¨è®¡ç®—ï¼Œæœˆç»“æ—¶é—´ä»3å¤©ç¼©çŸ­åˆ°4å°æ—¶
- æ„å»ºå…¨çƒç¨åŠ¡åˆè§„ä½“ç³»ï¼Œæµ·å¤–ç¨åŠ¡åˆè§„ç‡è¾¾åˆ°100%
- å®ç°ä¸»è¦ç¨ç§è‡ªåŠ¨ç”³æŠ¥ï¼Œç”³æŠ¥æ•ˆç‡æå‡80%ï¼Œé›¶å·®é”™ç”³æŠ¥
- å»ºç«‹ç¨åŠ¡é£é™©é¢„è­¦æœºåˆ¶ï¼Œç¨åŠ¡é£é™©äº‹ä»¶é™ä½90%

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å¤šä¸šæ€æ”¶å…¥ç¨åŠ¡å¤„ç†**ï¼šéœ€è¦é’ˆå¯¹æ¸¸æˆè™šæ‹Ÿé“å…·ã€å¹¿å‘Šæ”¶å…¥ã€äº‘æœåŠ¡ã€é‡‘èç§‘æŠ€ç­‰ä¸åŒä¸šåŠ¡åœºæ™¯ï¼Œå»ºç«‹æ”¶å…¥ç¡®è®¤å’Œç¨åŠ¡å¤„ç†çš„è§„åˆ™å¼•æ“ã€‚

2. **å¤æ‚é€’å»¶æ‰€å¾—ç¨å»ºæ¨¡**ï¼šéœ€è¦å»ºç«‹å¤šå±‚çº§é€’å»¶æ‰€å¾—ç¨è®¡ç®—æ¨¡å‹ï¼Œå¤„ç†æš‚æ—¶æ€§å·®å¼‚ã€ç¨åŠ¡äºæŸç»“è½¬ã€ç¨ç‡å˜åŠ¨ã€æŠ•èµ„æŠµæ‰£ç­‰å¤æ‚åœºæ™¯ã€‚

3. **å…¨çƒç¨åŠ¡è§„åˆ™å¼•æ“**ï¼šéœ€è¦æ„å»ºæ”¯æŒå¤šå›½ç¨æ³•çš„è§„åˆ™å¼•æ“ï¼Œå¤„ç†é¢„ææ‰€å¾—ç¨ã€è½¬è®©å®šä»·ã€å¸¸è®¾æœºæ„åˆ¤å®šç­‰å›½é™…ç¨æ”¶é—®é¢˜ã€‚

4. **ç¨åŠ¡æ•°æ®é›†æˆ**ï¼šéœ€è¦å¯¹æ¥SAPã€Oracleã€ç”¨å‹ç­‰è´¢åŠ¡ç³»ç»Ÿï¼Œä»¥åŠé‡‘ç¨ç³»ç»Ÿã€ç”µå­ç¨åŠ¡å±€ç­‰å¤–éƒ¨ç³»ç»Ÿï¼Œå®ç°æ•°æ®è‡ªåŠ¨æµè½¬ã€‚

5. **å®æ—¶ç¨åŠ¡é£æ§**ï¼šéœ€è¦è®¾è®¡ç¨åŠ¡é£é™©æŒ‡æ ‡ä½“ç³»å’Œé¢„è­¦æ¨¡å‹ï¼Œå®ç°äº‹å‰é¢„è­¦å’Œäº‹ä¸­ç›‘æ§ã€‚

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰ä¼ä¸šæ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**æ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
ç¨åŠ¡ä¼šè®¡Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import date, datetime
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

@dataclass
class DeferredTaxAsset:
    """é€’å»¶æ‰€å¾—ç¨èµ„äº§"""
    asset_id: str
    temporary_difference: Decimal
    tax_rate: Decimal
    asset_amount: Decimal = Decimal('0')
    recognition_date: date = field(default_factory=date.today)
    reversal_date: Optional[date] = None

    def calculate_asset_amount(self):
        """è®¡ç®—èµ„äº§é‡‘é¢"""
        self.asset_amount = self.temporary_difference * (self.tax_rate / Decimal('100'))

@dataclass
class DeferredTaxLiability:
    """é€’å»¶æ‰€å¾—ç¨è´Ÿå€º"""
    liability_id: str
    temporary_difference: Decimal
    tax_rate: Decimal
    liability_amount: Decimal = Decimal('0')
    recognition_date: date = field(default_factory=date.today)
    reversal_date: Optional[date] = None

    def calculate_liability_amount(self):
        """è®¡ç®—è´Ÿå€ºé‡‘é¢"""
        self.liability_amount = self.temporary_difference * (self.tax_rate / Decimal('100'))

@dataclass
class TaxCalculation:
    """ç¨åŠ¡è®¡ç®—"""
    taxable_income: Decimal
    tax_rate: Decimal
    tax_payable: Decimal = Decimal('0')
    tax_credits: Decimal = Decimal('0')
    net_tax_payable: Decimal = Decimal('0')

    def calculate_tax(self):
        """è®¡ç®—ç¨è´¹"""
        self.tax_payable = self.taxable_income * (self.tax_rate / Decimal('100'))
        self.net_tax_payable = self.tax_payable - self.tax_credits

@dataclass
class TaxExpense:
    """æ‰€å¾—ç¨è´¹ç”¨"""
    current_tax_expense: Decimal = Decimal('0')
    deferred_tax_expense: Decimal = Decimal('0')
    total_tax_expense: Decimal = Decimal('0')

    def calculate_total(self):
        """è®¡ç®—æ€»æ‰€å¾—ç¨è´¹ç”¨"""
        self.total_tax_expense = self.current_tax_expense + self.deferred_tax_expense

@dataclass
class IncomeTaxExpenseCalculation:
    """æ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—"""
    tax_expense: TaxExpense
    deferred_tax_assets: List[DeferredTaxAsset] = field(default_factory=list)
    deferred_tax_liabilities: List[DeferredTaxLiability] = field(default_factory=list)
    tax_calculation: Optional[TaxCalculation] = None

    def add_deferred_tax_asset(self, asset: DeferredTaxAsset):
        """æ·»åŠ é€’å»¶æ‰€å¾—ç¨èµ„äº§"""
        asset.calculate_asset_amount()
        self.deferred_tax_assets.append(asset)
        self._recalculate_deferred_tax()

    def add_deferred_tax_liability(self, liability: DeferredTaxLiability):
        """æ·»åŠ é€’å»¶æ‰€å¾—ç¨è´Ÿå€º"""
        liability.calculate_liability_amount()
        self.deferred_tax_liabilities.append(liability)
        self._recalculate_deferred_tax()

    def _recalculate_deferred_tax(self):
        """é‡æ–°è®¡ç®—é€’å»¶æ‰€å¾—ç¨è´¹ç”¨"""
        total_assets = sum(asset.asset_amount for asset in self.deferred_tax_assets)
        total_liabilities = sum(liab.liability_amount for liab in self.deferred_tax_liabilities)
        self.tax_expense.deferred_tax_expense = total_liabilities - total_assets
        self.tax_expense.calculate_total()

    def calculate_current_tax(self, taxable_income: Decimal, tax_rate: Decimal, tax_credits: Decimal = Decimal('0')):
        """è®¡ç®—å½“æœŸæ‰€å¾—ç¨"""
        self.tax_calculation = TaxCalculation(
            taxable_income=taxable_income,
            tax_rate=tax_rate,
            tax_credits=tax_credits
        )
        self.tax_calculation.calculate_tax()
        self.tax_expense.current_tax_expense = self.tax_calculation.net_tax_payable
        self.tax_expense.calculate_total()

    def get_tax_summary(self) -> Dict:
        """è·å–ç¨åŠ¡æ‘˜è¦"""
        return {
            'current_tax_expense': float(self.tax_expense.current_tax_expense),
            'deferred_tax_expense': float(self.tax_expense.deferred_tax_expense),
            'total_tax_expense': float(self.tax_expense.total_tax_expense),
            'deferred_tax_assets': float(sum(asset.asset_amount for asset in self.deferred_tax_assets)),
            'deferred_tax_liabilities': float(sum(liab.liability_amount for liab in self.deferred_tax_liabilities))
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºæ‰€å¾—ç¨è´¹ç”¨æ ¸ç®—ç³»ç»Ÿ
    tax_calculation = IncomeTaxExpenseCalculation(
        tax_expense=TaxExpense()
    )

    # è®¡ç®—å½“æœŸæ‰€å¾—ç¨
    tax_calculation.calculate_current_tax(
        taxable_income=Decimal('400000.00'),
        tax_rate=Decimal('25.00'),
        tax_credits=Decimal('0.00')
    )

    # æ·»åŠ é€’å»¶æ‰€å¾—ç¨èµ„äº§
    deferred_asset = DeferredTaxAsset(
        asset_id="DTA-001",
        temporary_difference=Decimal('50000.00'),
        tax_rate=Decimal('25.00')
    )
    tax_calculation.add_deferred_tax_asset(deferred_asset)

    # è·å–ç¨åŠ¡æ‘˜è¦
    summary = tax_calculation.get_tax_summary()
    print(f"ç¨åŠ¡æ‘˜è¦: {summary}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| ç¨åŠ¡æ ¸ç®—å‡†ç¡®ç‡ | 92% | 99.9% | 7.9%æå‡ |
| é€’å»¶æ‰€å¾—ç¨æœˆç»“æ—¶é—´ | 3å¤© | 4å°æ—¶ | 94%ç¼©çŸ­ |
| ç¨åŠ¡ç”³æŠ¥è‡ªåŠ¨åŒ–ç‡ | 30% | 95% | 65%æå‡ |
| ç”³æŠ¥å·®é”™ç‡ | 2% | 0.05% | 97.5%é™ä½ |
| ç¨åŠ¡é£é™©äº‹ä»¶ | 15èµ·/å¹´ | 1èµ·/å¹´ | 93%é™ä½ |

**ä¸šåŠ¡ä»·å€¼ä¸ROI**ï¼š

1. **ç›´æ¥ç»æµæ•ˆç›Š**ï¼š
   - ç³»ç»ŸæŠ•èµ„ï¼šç¨åŠ¡ç®¡ç†å¹³å°800ä¸‡å…ƒï¼Œæ•°æ®é›†æˆ300ä¸‡å…ƒï¼Œåˆè®¡1100ä¸‡å…ƒ
   - äººå·¥æˆæœ¬èŠ‚çœï¼šç¨åŠ¡äººå‘˜æ•ˆç‡æå‡ï¼Œå¹´èŠ‚çœäººåŠ›æˆæœ¬600ä¸‡å…ƒ
   - ç¨åŠ¡ä¼˜åŒ–ï¼šé€šè¿‡ç²¾å‡†ç¨åŠ¡ç­¹åˆ’ï¼Œå¹´èŠ‚ç¨çº¦2äº¿å…ƒ
   - é£é™©æˆæœ¬é™ä½ï¼šé¿å…æ»çº³é‡‘å’Œç½šæ¬¾ï¼Œå¹´èŠ‚çœçº¦3000ä¸‡å…ƒ

2. **ROIè®¡ç®—**ï¼š
   - é¦–å¹´ROI = (600 + 20000 + 3000 - 1100) / 1100 Ã— 100% = **2136%**

3. **æˆ˜ç•¥æ•ˆç›Š**ï¼š
   - è·å¾—"æœ€ä½³ç¨åŠ¡ç®¡ç†åˆ›æ–°å¥–"
   - ç¨åŠ¡åˆè§„è¯„çº§ä»Bçº§æå‡è‡³Açº§
   - æˆä¸ºè¡Œä¸šç¨åŠ¡æ•°å­—åŒ–è½¬å‹æ ‡æ†

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **æ ¸ç®—å‡†ç¡®æ€§æé«˜**ï¼šæé«˜ç¨åŠ¡æ ¸ç®—å‡†ç¡®æ€§
2. **é€’å»¶æ‰€å¾—ç¨è§„èŒƒ**ï¼šè§„èŒƒé€’å»¶æ‰€å¾—ç¨å¤„ç†
3. **æ ‡å‡†éµå¾ª**ï¼šéµå¾ªIAS 12æ ‡å‡†
4. **ç”³æŠ¥æ•ˆç‡æé«˜**ï¼šæé«˜ç¨åŠ¡ç”³æŠ¥æ•ˆç‡

**ç»éªŒæ•™è®­**ï¼š

1. ç¨åŠ¡æ ¸ç®—éœ€è¦å‡†ç¡®
2. é€’å»¶æ‰€å¾—ç¨å¤„ç†éœ€è¦è§„èŒƒ
3. æš‚æ—¶æ€§å·®å¼‚éœ€è¦æ­£ç¡®è¯†åˆ«
4. ç¨åŠ¡ç”³æŠ¥éœ€è¦è‡ªåŠ¨åŒ–

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [IAS 12æ‰€å¾—ç¨æ ‡å‡†](https://www.ifrs.org/)
- [ç¨åŠ¡ä¼šè®¡æœ€ä½³å®è·µ](https://www.imanet.org/)

---

## 3. æ¡ˆä¾‹2ï¼šå¢å€¼ç¨æ ¸ç®—

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šå¢å€¼ç¨æ ¸ç®—ï¼ŒåŒ…æ‹¬é”€é¡¹ç¨é¢ã€è¿›é¡¹ç¨é¢ã€åº”äº¤å¢å€¼ç¨è®¡ç®—ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- è®¡ç®—é”€é¡¹ç¨é¢
- è®¡ç®—è¿›é¡¹ç¨é¢
- è®¡ç®—åº”äº¤å¢å€¼ç¨
- æ”¯æŒVAT/GSTæ ‡å‡†

### 3.2 Schemaå®šä¹‰

**å¢å€¼ç¨æ ¸ç®—Schema**ï¼š

```dsl
schema VATCalculation {
  output_vat: List<OutputVAT> {
    output1: OutputVAT {
      transaction_id: String @value("SALE-001")
      transaction_type: Enum @value("Sale")
      transaction_amount: Decimal @value(100000.00)
      vat_rate: Decimal @value(13.00)
      vat_amount: Decimal @value(13000.00)
      transaction_date: Date @value("2025-01-15")
    }
  }

  input_vat: List<InputVAT> {
    input1: InputVAT {
      transaction_id: String @value("PURCHASE-001")
      transaction_type: Enum @value("Purchase")
      transaction_amount: Decimal @value(50000.00)
      vat_rate: Decimal @value(13.00)
      vat_amount: Decimal @value(6500.00)
      is_deductible: Boolean @value(true)
      transaction_date: Date @value("2025-01-10")
    }
  }

  vat_payable: VATPayable {
    total_output_vat: Decimal @value(13000.00)
    total_input_vat: Decimal @value(6500.00)
    vat_payable_amount: Decimal @value(6500.00)
    filing_period: Date @value("2025-01-31")
  }
} @standard("VAT/GST")
```

---

## 4. æ¡ˆä¾‹3ï¼šç¨åŠ¡ç”³æŠ¥

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šç¨åŠ¡ç”³æŠ¥ï¼ŒåŒ…æ‹¬æ‰€å¾—ç¨ç”³æŠ¥ã€å¢å€¼ç¨ç”³æŠ¥ã€ç”³æŠ¥çŠ¶æ€ç®¡ç†ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- ç”Ÿæˆç¨åŠ¡ç”³æŠ¥è¡¨
- æäº¤ç¨åŠ¡ç”³æŠ¥
- è·Ÿè¸ªç”³æŠ¥çŠ¶æ€
- ç®¡ç†ç”³æŠ¥æ•°æ®

### 4.2 Schemaå®šä¹‰

**ç¨åŠ¡ç”³æŠ¥Schema**ï¼š

```dsl
schema TaxFiling {
  tax_returns: List<TaxReturn> {
    return1: TaxReturn {
      return_id: String @value("RETURN-001")
      return_type: Enum @value("IncomeTax")
      filing_period: Date @value("2025-01-31")
      filing_date: Date @value("2025-02-15")
      tax_amount: Decimal @value(100000.00)
      filing_status: Enum @value("Submitted")
    }
    return2: TaxReturn {
      return_id: String @value("RETURN-002")
      return_type: Enum @value("VAT")
      filing_period: Date @value("2025-01-31")
      filing_date: Date @value("2025-02-10")
      tax_amount: Decimal @value(6500.00)
      filing_status: Enum @value("Approved")
    }
  }
} @standard("Tax Filing")
```

---

## 5. æ¡ˆä¾‹4ï¼šä¼šè®¡åˆ°ç¨åŠ¡è½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†ä¼ä¸šä¼šè®¡æ•°æ®è½¬æ¢ä¸ºç¨åŠ¡æ•°æ®ï¼Œç”¨äºç¨åŠ¡æ ¸ç®—å’Œç”³æŠ¥ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- ä¼šè®¡åˆ©æ¶¦è½¬æ¢ä¸ºåº”çº³ç¨æ‰€å¾—é¢
- ä¼šè®¡æ”¶å…¥è½¬æ¢ä¸ºåº”ç¨æ”¶å…¥
- ä¼šè®¡è´¹ç”¨è½¬æ¢ä¸ºå¯æ‰£é™¤è´¹ç”¨

### 5.2 å®ç°ä»£ç 

```python
from accounting_schema import AccountingSchema
from tax_accounting_schema import TaxAccountingSchema, IncomeTaxAccounting

def convert_accounting_to_tax(accounting_data: AccountingSchema) -> TaxAccountingSchema:
    """å°†ä¼šè®¡æ•°æ®è½¬æ¢ä¸ºç¨åŠ¡æ•°æ®"""
    tax_accounting = TaxAccountingSchema()
    tax_accounting.company_code = accounting_data.company_code

    # è½¬æ¢æ‰€å¾—ç¨
    income_tax = IncomeTaxAccounting()

    # è®¡ç®—åº”çº³ç¨æ‰€å¾—é¢ï¼ˆä¼šè®¡åˆ©æ¶¦è°ƒæ•´ï¼‰
    accounting_profit = accounting_data.income_statement.profit.net_profit

    # ç¨åŠ¡è°ƒæ•´ï¼ˆä¾‹å¦‚ï¼šä¸å¯æ‰£é™¤è´¹ç”¨ã€éåº”ç¨æ”¶å…¥ç­‰ï¼‰
    tax_adjustments = {
        "non_deductible_expenses": 10000.00,  # ä¸å¯æ‰£é™¤è´¹ç”¨
        "non_taxable_income": -5000.00  # éåº”ç¨æ”¶å…¥ï¼ˆå‡å°‘ï¼‰
    }

    income_tax.tax_calculation.taxable_income = accounting_profit + sum(tax_adjustments.values())
    income_tax.tax_calculation.tax_rate = 25.0  # ä¼ä¸šæ‰€å¾—ç¨ç‡25%
    income_tax.tax_calculation.tax_payable = income_tax.tax_calculation.taxable_income * 25.0 / 100

    # è®¡ç®—æ‰€å¾—ç¨è´¹ç”¨
    income_tax.tax_expense.current_tax_expense = income_tax.tax_calculation.tax_payable
    income_tax.tax_expense.deferred_tax_expense = calculate_deferred_tax(accounting_data)

    tax_accounting.income_tax_accounting = income_tax

    return tax_accounting

# ä½¿ç”¨ç¤ºä¾‹
accounting_data = AccountingSchema.load_from_database("2025-01")
tax_data = convert_accounting_to_tax(accounting_data)
tax_data.save_to_database()
```

---

## 6. æ¡ˆä¾‹5ï¼šç¨åŠ¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ä¼ä¸šç¨åŠ¡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒç¨åŠ¡æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- PostgreSQLæ•°æ®åº“å­˜å‚¨
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒç¨åŠ¡è´¹ç”¨è¶‹åŠ¿åˆ†æ
- æ”¯æŒå¢å€¼ç¨æ±‡æ€»åˆ†æ

### 6.2 å®ç°ä»£ç 

```python
import psycopg2
from tax_accounting_schema import TaxAccountingSchema, IncomeTaxAccounting, VATAccounting

class TaxDataStore:
    def __init__(self, db_config):
        self.conn = psycopg2.connect(**db_config)

    def store_tax_data(self, tax_data: TaxAccountingSchema):
        """å­˜å‚¨ç¨åŠ¡æ•°æ®"""
        cursor = self.conn.cursor()

        # æ’å…¥æ‰€å¾—ç¨è´¹ç”¨
        expense_id = f"ITE-{tax_data.company_code}-{tax_data.income_tax_accounting.tax_calculation.filing_period}"
        cursor.execute("""
            INSERT INTO income_tax_expense
            (expense_id, company_code, tax_period, current_tax_expense, deferred_tax_expense)
            VALUES (%s, %s, %s, %s, %s)
        """, (expense_id, tax_data.company_code,
              tax_data.income_tax_accounting.tax_calculation.filing_period,
              tax_data.income_tax_accounting.tax_expense.current_tax_expense,
              tax_data.income_tax_accounting.tax_expense.deferred_tax_expense))

        # æ’å…¥å¢å€¼ç¨äº¤æ˜“
        for output_vat in tax_data.vat_accounting.output_vat:
            cursor.execute("""
                INSERT INTO vat_transactions
                (transaction_id, transaction_type, transaction_amount, vat_rate, transaction_date, is_output_vat)
                VALUES (%s, %s, %s, %s, %s, %s)
            """, (output_vat.transaction_id, output_vat.transaction_type,
                  output_vat.transaction_amount, output_vat.vat_rate,
                  output_vat.transaction_date, True))

        self.conn.commit()

    def generate_tax_analysis(self, company_code, period_start, period_end):
        """ç”Ÿæˆç¨åŠ¡åˆ†ææŠ¥å‘Š"""
        cursor = self.conn.cursor()

        # æŸ¥è¯¢æ‰€å¾—ç¨è´¹ç”¨è¶‹åŠ¿
        cursor.execute("""
            SELECT
                tax_period,
                current_tax_expense,
                deferred_tax_expense,
                total_tax_expense
            FROM income_tax_expense
            WHERE company_code = %s AND tax_period BETWEEN %s AND %s
            ORDER BY tax_period
        """, (company_code, period_start, period_end))

        income_tax_trends = cursor.fetchall()

        # æŸ¥è¯¢å¢å€¼ç¨æ±‡æ€»
        cursor.execute("""
            SELECT
                DATE_TRUNC('month', transaction_date) as month,
                SUM(CASE WHEN is_output_vat THEN vat_amount ELSE 0 END) as total_output_vat,
                SUM(CASE WHEN NOT is_output_vat THEN vat_amount ELSE 0 END) as total_input_vat,
                SUM(CASE WHEN is_output_vat THEN vat_amount ELSE -vat_amount END) as net_vat
            FROM vat_transactions
            WHERE transaction_date BETWEEN %s AND %s
            GROUP BY DATE_TRUNC('month', transaction_date)
            ORDER BY month
        """, (period_start, period_end))

        vat_summary = cursor.fetchall()

        return {
            "income_tax_trends": income_tax_trends,
            "vat_summary": vat_summary
        }

# ä½¿ç”¨ç¤ºä¾‹
db_config = {
    "host": "localhost",
    "database": "tax_accounting",
    "user": "tax_user",
    "password": "password"
}

store = TaxDataStore(db_config)

# ç”Ÿæˆç¨åŠ¡åˆ†ææŠ¥å‘Š
tax_analysis = store.generate_tax_analysis("COMP-001", "2025-01-01", "2025-12-31")
print("æ‰€å¾—ç¨è´¹ç”¨è¶‹åŠ¿:")
for row in tax_analysis["income_tax_trends"]:
    print(f"æœŸé—´: {row[0]}, å½“æœŸ: {row[1]}, é€’å»¶: {row[2]}, æ€»è®¡: {row[3]}")

print("\nå¢å€¼ç¨æ±‡æ€»:")
for row in tax_analysis["vat_summary"]:
    print(f"æœˆä»½: {row[0]}, é”€é¡¹: {row[1]}, è¿›é¡¹: {row[2]}, åº”äº¤: {row[3]}")
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
