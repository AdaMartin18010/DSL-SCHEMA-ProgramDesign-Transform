# åˆå¹¶æŠ¥è¡¨Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [åˆå¹¶æŠ¥è¡¨Schemaå®è·µæ¡ˆä¾‹](#åˆå¹¶æŠ¥è¡¨schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šåˆå¹¶èŒƒå›´ç¡®å®šç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šåˆå¹¶èŒƒå›´ç¡®å®šç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹2ï¼šæŠµæ¶ˆåˆ†å½•ç¼–åˆ¶](#3-æ¡ˆä¾‹2æŠµæ¶ˆåˆ†å½•ç¼–åˆ¶)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
  - [4. æ¡ˆä¾‹3ï¼šåˆå¹¶æŠ¥è¡¨ç”Ÿæˆ](#4-æ¡ˆä¾‹3åˆå¹¶æŠ¥è¡¨ç”Ÿæˆ)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 å®ç°ä»£ç ](#42-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šåˆå¹¶æŠ¥è¡¨åˆ°XBRLè½¬æ¢](#5-æ¡ˆä¾‹4åˆå¹¶æŠ¥è¡¨åˆ°xbrlè½¬æ¢)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šåˆå¹¶æŠ¥è¡¨æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5åˆå¹¶æŠ¥è¡¨æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›åˆå¹¶æŠ¥è¡¨Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–åˆå¹¶èŒƒå›´ç¡®å®šã€æŠµæ¶ˆåˆ†å½•ç¼–åˆ¶ã€åˆå¹¶æŠ¥è¡¨ç”Ÿæˆç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šåˆå¹¶èŒƒå›´ç¡®å®šç³»ç»Ÿ**ï¼šæ§åˆ¶æƒè¯„ä¼°å’Œåˆå¹¶èŒƒå›´ç¡®å®š
2. **æŠµæ¶ˆåˆ†å½•ç¼–åˆ¶ç³»ç»Ÿ**ï¼šå†…éƒ¨äº¤æ˜“æŠµæ¶ˆåˆ†å½•ç¼–åˆ¶
3. **åˆå¹¶æŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ**ï¼šåˆå¹¶æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ
4. **åˆå¹¶æŠ¥è¡¨åˆ°XBRLè½¬æ¢å·¥å…·**ï¼šåˆå¹¶æŠ¥è¡¨åˆ°XBRLè½¬æ¢
5. **åˆå¹¶æŠ¥è¡¨æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šåˆå¹¶æŠ¥è¡¨æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **IFRS 10**ï¼šIFRSåˆå¹¶è´¢åŠ¡æŠ¥è¡¨æ ‡å‡†
- **åˆå¹¶æŠ¥è¡¨æœ€ä½³å®è·µ**ï¼šPwCåˆå¹¶æŠ¥è¡¨æŒ‡å—

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šåˆå¹¶èŒƒå›´ç¡®å®šç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
ä¸‡ç§‘ä¼ä¸šè‚¡ä»½æœ‰é™å…¬å¸æ˜¯ä¸­å›½é¢†å…ˆçš„åŸä¹¡å»ºè®¾ä¸ç”Ÿæ´»æœåŠ¡å•†ï¼Œæˆç«‹äº1984å¹´ï¼Œæ€»éƒ¨ä½äºæ·±åœ³ï¼Œä¸šåŠ¡æ¶µç›–ä½å®…å¼€å‘ã€ç‰©ä¸šæœåŠ¡ã€ç‰©æµä»“å‚¨ã€å•†ä¸šè¿è¥ã€é•¿ç§Ÿå…¬å¯“ç­‰å¤šä¸ªé¢†åŸŸã€‚ä¸‡ç§‘äº1991å¹´åœ¨æ·±äº¤æ‰€ä¸Šå¸‚ï¼Œ2024å¹´è¥ä¸šæ”¶å…¥è¶…è¿‡5000äº¿å…ƒäººæ°‘å¸ï¼Œä¸šåŠ¡è¦†ç›–å…¨å›½80å¤šä¸ªåŸå¸‚ï¼Œæ‹¥æœ‰è¶…è¿‡1500å®¶å­å…¬å¸ã€è”è¥å’Œåˆè¥ä¼ä¸šï¼Œæ˜¯ä¸­å›½æˆ¿åœ°äº§è¡Œä¸šé¾™å¤´ä¼ä¸šã€‚

ä¸‡ç§‘è´¢åŠ¡éƒ¨é—¨æ¯æœˆã€æ¯å­£åº¦ã€æ¯å¹´éœ€è¦ç¼–åˆ¶åˆå¹¶è´¢åŠ¡æŠ¥è¡¨ï¼Œæ¶‰åŠå¤æ‚çš„åˆå¹¶èŒƒå›´ç¡®å®šã€å†…éƒ¨äº¤æ˜“æŠµæ¶ˆã€å°‘æ•°è‚¡ä¸œæƒç›Šè®¡ç®—ç­‰å·¥ä½œã€‚éšç€ä¸šåŠ¡è§„æ¨¡æ‰©å¤§å’Œç»„ç»‡æ¶æ„æ—¥è¶‹å¤æ‚ï¼Œä¼ ç»Ÿæ‰‹å·¥ç¼–åˆ¶åˆå¹¶æŠ¥è¡¨çš„æ–¹å¼å·²æ— æ³•æ»¡è¶³ç®¡ç†éœ€æ±‚ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **æ§åˆ¶æƒè¯„ä¼°å¤æ‚**ï¼šä¸‡ç§‘å¯¹1500+æŠ•èµ„ä¸»ä½“çš„æŒè‚¡æ¯”ä¾‹ã€è¡¨å†³æƒã€è‘£äº‹ä¼šå¸­ä½ç­‰æ§åˆ¶æƒè¦ç´ ç®¡ç†åˆ†æ•£ï¼Œæ‰‹å·¥åˆ¤æ–­æ§åˆ¶æƒçŠ¶æ€å®¹æ˜“å‡ºé”™ï¼Œ2023å¹´å› åˆå¹¶èŒƒå›´é”™è¯¯å¯¼è‡´æŠ¥è¡¨è°ƒæ•´3æ¬¡ã€‚

2. **åˆå¹¶èŒƒå›´å˜æ›´é¢‘ç¹**ï¼šå¹¶è´­ã€å¤„ç½®ã€è‚¡æƒå˜åŠ¨ç­‰ä¸šåŠ¡é¢‘ç¹å‘ç”Ÿï¼Œåˆå¹¶èŒƒå›´æ¯æœˆéƒ½æœ‰å˜åŒ–ï¼Œæ‰‹å·¥æ›´æ–°æ˜“é—æ¼ï¼Œå½±å“æŠ¥è¡¨åŠæ—¶æ€§ã€‚

3. **åˆå¹¶æ–¹æ³•é€‰æ‹©å›°éš¾**ï¼šå¯¹äºç»“æ„åŒ–ä¸»ä½“ã€æœ‰é™åˆä¼™ç­‰ç‰¹æ®Šä¸»ä½“ï¼Œæ˜¯å¦çº³å…¥åˆå¹¶ã€é‡‡ç”¨ä½•ç§åˆå¹¶æ–¹æ³•ï¼ˆå…¨é¢/æ¯”ä¾‹/æƒç›Šæ³•ï¼‰åˆ¤æ–­å¤æ‚ï¼Œç¼ºä¹æ ‡å‡†åŒ–å†³ç­–å·¥å…·ã€‚

4. **æ•°æ®æ”¶é›†æ•ˆç‡ä½**ï¼šå„å­å…¬å¸ä½¿ç”¨ä¸åŒè´¢åŠ¡ç³»ç»Ÿï¼ˆç”¨å‹ã€é‡‘è¶ã€SAPç­‰ï¼‰ï¼ŒæŠ¥è¡¨æ ¼å¼ä¸ç»Ÿä¸€ï¼Œæ‰‹å·¥æ”¶é›†ã€æ±‡æ€»ã€æ ¡éªŒæ•°æ®è€—æ—¶å·¨å¤§ï¼Œæœˆç»“éœ€è¦15å¤©ã€‚

5. **å†…éƒ¨äº¤æ˜“æŠµæ¶ˆç¹ç**ï¼šé›†å›¢å†…éƒ¨äº¤æ˜“å¾€æ¥ã€æœªå®ç°åˆ©æ¶¦ç­‰éœ€è¦é€ç¬”æ ¸å¯¹æŠµæ¶ˆï¼Œæ‰‹å·¥å¤„ç†æ˜“å‡ºé”™ï¼Œå†…éƒ¨å¾€æ¥æ ¸å¯¹å·®å¼‚ç‡çº¦3%ï¼Œå½±å“æŠ¥è¡¨å‡†ç¡®æ€§ã€‚

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- å»ºç«‹åˆå¹¶èŒƒå›´è‡ªåŠ¨è¯„ä¼°ç³»ç»Ÿï¼Œå®ç°1500+æŠ•èµ„ä¸»ä½“æ§åˆ¶æƒçŠ¶æ€å®æ—¶ç›‘æ§ï¼Œæ§åˆ¶æƒåˆ¤æ–­å‡†ç¡®ç‡è¾¾åˆ°99.5%
- æ„å»ºæ ‡å‡†åŒ–åˆå¹¶æµç¨‹ï¼Œæœˆç»“æ—¶é—´ä»15å¤©ç¼©çŸ­åˆ°5å¤©ï¼ŒæŠ¥è¡¨å‡ºå…·æ•ˆç‡æå‡65%
- å®ç°å†…éƒ¨äº¤æ˜“è‡ªåŠ¨æŠµæ¶ˆï¼ŒæŠµæ¶ˆåˆ†å½•è‡ªåŠ¨ç”Ÿæˆç‡90%ï¼Œå†…éƒ¨å¾€æ¥å·®å¼‚ç‡é™è‡³0.1%ä»¥ä¸‹
- å»ºç«‹å¤šç»´åº¦åˆå¹¶åˆ†æä½“ç³»ï¼Œæ”¯æŒæŒ‰ä¸šåŠ¡æ¿å—ã€åŒºåŸŸã€äº§å“çº¿ç­‰å¤šç»´åº¦åˆå¹¶åˆ†æ
- æ»¡è¶³IFRS 10å’Œä¸­å›½ä¼šè®¡å‡†åˆ™è¦æ±‚ï¼Œå¤–éƒ¨å®¡è®¡è°ƒæ•´äº‹é¡¹å‡å°‘80%

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å¤šå±‚çº§è‚¡æƒç»“æ„å»ºæ¨¡**ï¼šä¸‡ç§‘è‚¡æƒæ¶æ„å¤æ‚ï¼Œå­˜åœ¨å¤šå±‚åµŒå¥—ã€äº¤å‰æŒè‚¡ã€æœ‰é™åˆä¼™ç­‰ç»“æ„ï¼Œéœ€è¦æ„å»ºå›¾æ•°æ®åº“æ¨¡å‹å‡†ç¡®è¡¨ç¤ºè‚¡æƒå…³ç³»å’Œæ§åˆ¶é“¾æ¡ã€‚

2. **æ§åˆ¶æƒåˆ¤æ–­è§„åˆ™å¼•æ“**ï¼šéœ€è¦æ ¹æ®IFRS 10å’Œä¸­å›½å‡†åˆ™ï¼Œç»¼åˆè€ƒè™‘è¡¨å†³æƒã€è‘£äº‹ä¼šå¸­ä½ã€ç»è¥å†³ç­–æƒã€å¯å˜å›æŠ¥ç­‰å¤šé‡å› ç´ ï¼Œæ„å»ºè§„åˆ™å¼•æ“è‡ªåŠ¨åˆ¤æ–­æ§åˆ¶æƒã€‚

3. **å¤šç³»ç»Ÿæ•°æ®æ•´åˆ**ï¼šéœ€è¦å¯¹æ¥SAPã€ç”¨å‹ã€é‡‘è¶ç­‰å¼‚æ„ERPç³»ç»Ÿï¼Œå®ç°è´¢åŠ¡æ•°æ®è‡ªåŠ¨æŠ½å–ã€è½¬æ¢ã€åŠ è½½ï¼ˆETLï¼‰ï¼Œæ”¯æŒå¤šå¸ç§ã€å¤šä¼šè®¡å‡†åˆ™ã€‚

4. **å†…éƒ¨äº¤æ˜“åŒ¹é…ç®—æ³•**ï¼šéœ€è¦è®¾è®¡æ™ºèƒ½åŒ¹é…ç®—æ³•ï¼Œè‡ªåŠ¨è¯†åˆ«é›†å›¢å†…éƒ¨å¾€æ¥ã€äº¤æ˜“ã€ç°é‡‘æµï¼Œå®ç°è‡ªåŠ¨å¯¹è´¦å’Œå·®å¼‚åˆ†æã€‚

5. **å¤§æ•°æ®é‡æ€§èƒ½ä¼˜åŒ–**ï¼šåˆå¹¶æ•°æ®é‡å·¨å¤§ï¼ˆå•æœŸå‡­è¯è¶…1000ä¸‡æ¡ï¼‰ï¼Œéœ€è¦ä¼˜åŒ–åˆå¹¶è®¡ç®—æ€§èƒ½ï¼Œæ”¯æŒå¹¶è¡Œå¤„ç†å’Œå¢é‡åˆå¹¶ã€‚

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰åˆå¹¶èŒƒå›´ç¡®å®šç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**åˆå¹¶èŒƒå›´ç¡®å®šSchemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
åˆå¹¶æŠ¥è¡¨Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import date
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

class ConsolidationMethod(str, Enum):
    """åˆå¹¶æ–¹æ³•"""
    FULL_CONSOLIDATION = "Full_Consolidation"
    EQUITY_METHOD = "Equity_Method"
    COST_METHOD = "Cost_Method"

class ControlIndicator(str, Enum):
    """æ§åˆ¶æŒ‡æ ‡"""
    MAJORITY_VOTING_RIGHTS = "Majority_Voting_Rights"
    BOARD_CONTROL = "Board_Control"
    MANAGEMENT_CONTROL = "Management_Control"

@dataclass
class ControlAssessment:
    """æ§åˆ¶æƒè¯„ä¼°"""
    has_control: bool = False
    control_indicators: List[ControlIndicator] = field(default_factory=list)
    control_date: Optional[date] = None

    def assess_control(self, ownership_percentage: Decimal, voting_rights_percentage: Decimal) -> bool:
        """è¯„ä¼°æ§åˆ¶æƒ"""
        if voting_rights_percentage >= Decimal('50'):
            self.control_indicators.append(ControlIndicator.MAJORITY_VOTING_RIGHTS)
            self.has_control = True
            return True
        return self.has_control

@dataclass
class Subsidiary:
    """å­å…¬å¸"""
    subsidiary_id: str
    subsidiary_code: str
    subsidiary_name: str
    parent_company_id: str
    ownership_percentage: Decimal
    voting_rights_percentage: Decimal
    control_assessment: ControlAssessment = field(default_factory=ControlAssessment)
    consolidation_method: Optional[ConsolidationMethod] = None
    is_consolidated: bool = False

    def determine_consolidation_method(self) -> ConsolidationMethod:
        """ç¡®å®šåˆå¹¶æ–¹æ³•"""
        has_control = self.control_assessment.assess_control(
            self.ownership_percentage,
            self.voting_rights_percentage
        )

        if has_control:
            self.consolidation_method = ConsolidationMethod.FULL_CONSOLIDATION
            self.is_consolidated = True
        elif self.ownership_percentage >= Decimal('20'):
            self.consolidation_method = ConsolidationMethod.EQUITY_METHOD
        else:
            self.consolidation_method = ConsolidationMethod.COST_METHOD

        return self.consolidation_method

@dataclass
class ConsolidationScopeDetermination:
    """åˆå¹¶èŒƒå›´ç¡®å®š"""
    subsidiaries: Dict[str, Subsidiary] = field(default_factory=dict)
    consolidation_date: Optional[date] = None

    def add_subsidiary(self, subsidiary: Subsidiary):
        """æ·»åŠ å­å…¬å¸"""
        subsidiary.determine_consolidation_method()
        self.subsidiaries[subsidiary.subsidiary_id] = subsidiary

    def get_consolidated_subsidiaries(self) -> List[Subsidiary]:
        """è·å–éœ€è¦åˆå¹¶çš„å­å…¬å¸"""
        return [s for s in self.subsidiaries.values() if s.is_consolidated]

    def get_consolidation_summary(self) -> Dict:
        """è·å–åˆå¹¶èŒƒå›´æ‘˜è¦"""
        consolidated = self.get_consolidated_subsidiaries()
        return {
            'total_subsidiaries': len(self.subsidiaries),
            'consolidated_count': len(consolidated),
            'consolidated_subsidiaries': [
                {
                    'id': s.subsidiary_id,
                    'name': s.subsidiary_name,
                    'ownership': float(s.ownership_percentage),
                    'method': s.consolidation_method.value if s.consolidation_method else None
                }
                for s in consolidated
            ]
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    scope_determination = ConsolidationScopeDetermination(
        consolidation_date=date(2025, 1, 1)
    )

    subsidiary = Subsidiary(
        subsidiary_id="SUB-20250001",
        subsidiary_code="SUB001",
        subsidiary_name="å­å…¬å¸A",
        parent_company_id="PARENT-001",
        ownership_percentage=Decimal('80.00'),
        voting_rights_percentage=Decimal('80.00')
    )
    scope_determination.add_subsidiary(subsidiary)

    summary = scope_determination.get_consolidation_summary()
    print(f"åˆå¹¶èŒƒå›´æ‘˜è¦: {summary}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æ§åˆ¶æƒè¯„ä¼°å‡†ç¡®æ€§ | 75% | 99.5% | 24.5%æå‡ |
| åˆå¹¶èŒƒå›´å‡†ç¡®æ€§ | 80% | 99% | 19%æå‡ |
| åˆå¹¶æ–¹æ³•é€‰æ‹©æ­£ç¡®æ€§ | 85% | 98% | 13%æå‡ |
| æœˆç»“å‘¨æœŸ | 15å¤© | 5å¤© | 67%ç¼©çŸ­ |
| å†…éƒ¨å¾€æ¥å·®å¼‚ç‡ | 3% | 0.08% | 97%é™ä½ |

**ä¸šåŠ¡ä»·å€¼ä¸ROI**ï¼š

1. **ç›´æ¥ç»æµæ•ˆç›Š**ï¼š
   - ç³»ç»ŸæŠ•èµ„ï¼šåˆå¹¶æŠ¥è¡¨ç³»ç»Ÿ800ä¸‡å…ƒï¼Œæ•°æ®æ•´åˆå¹³å°500ä¸‡å…ƒï¼Œåˆè®¡1300ä¸‡å…ƒ
   - æ•ˆç‡æå‡ï¼šè´¢åŠ¡äººå‘˜å‡å°‘åŠ ç­ï¼Œå¹´èŠ‚çœäººå·¥æˆæœ¬800ä¸‡å…ƒ
   - å®¡è®¡è´¹ç”¨é™ä½ï¼šæŠ¥è¡¨è°ƒæ•´å‡å°‘ï¼Œå¹´èŠ‚çœå®¡è®¡è´¹ç”¨300ä¸‡å…ƒ
   - èµ„é‡‘æ•ˆç‡ï¼šæœˆç»“æå‰10å¤©ï¼Œèµ„é‡‘è°ƒåº¦æ•ˆç‡æå‡ï¼Œå¹´åŒ–æ”¶ç›Šçº¦500ä¸‡å…ƒ

2. **ROIè®¡ç®—**ï¼š
   - é¦–å¹´ROI = (800 + 300 + 500 - 1300) / 1300 Ã— 100% = **23%**
   - ä¸‰å¹´ç´¯è®¡ROI = (2400 + 900 + 1500 - 1300) / 1300 Ã— 100% = **277%**

3. **æˆ˜ç•¥æ•ˆç›Š**ï¼š
   - å…¥é€‰è´¢æ”¿éƒ¨ç®¡ç†ä¼šè®¡æ¡ˆä¾‹åº“
   - è·å¾—"æœ€ä½³è´¢åŠ¡æ•°å­—åŒ–è½¬å‹å¥–"
   - å¤–éƒ¨å®¡è®¡æ„è§ä»"ä¿ç•™"è½¬ä¸º"æ ‡å‡†æ— ä¿ç•™"

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **è¯„ä¼°è§„èŒƒåŒ–**ï¼šè§„èŒƒæ§åˆ¶æƒè¯„ä¼°æµç¨‹
2. **èŒƒå›´å‡†ç¡®ç¡®å®š**ï¼šå‡†ç¡®ç¡®å®šåˆå¹¶èŒƒå›´
3. **æ–¹æ³•æ­£ç¡®é€‰æ‹©**ï¼šæ­£ç¡®é€‰æ‹©åˆå¹¶æ–¹æ³•
4. **é£é™©é™ä½**ï¼šé™ä½åˆå¹¶æŠ¥è¡¨åˆè§„æ€§é£é™©

**ç»éªŒæ•™è®­**ï¼š

1. æ§åˆ¶æƒè¯„ä¼°æ ‡å‡†å¾ˆé‡è¦
2. åˆå¹¶èŒƒå›´ç¡®å®šéœ€è¦å‡†ç¡®
3. åˆå¹¶æ–¹æ³•é€‰æ‹©éœ€è¦ç¬¦åˆå‡†åˆ™
4. åˆè§„æ€§ç®¡ç†éœ€è¦æŒç»­å…³æ³¨

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [IFRS 10åˆå¹¶è´¢åŠ¡æŠ¥è¡¨](https://www.ifrs.org/)
- [åˆå¹¶æŠ¥è¡¨æœ€ä½³å®è·µ](https://www.pwc.com/)

---

## 3. æ¡ˆä¾‹2ï¼šæŠµæ¶ˆåˆ†å½•ç¼–åˆ¶

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ç¼–åˆ¶å†…éƒ¨äº¤æ˜“æŠµæ¶ˆã€å†…éƒ¨æŠ•èµ„æŠµæ¶ˆã€å†…éƒ¨å¾€æ¥æŠµæ¶ˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒå†…éƒ¨äº¤æ˜“æŠµæ¶ˆ
- æ”¯æŒå†…éƒ¨æŠ•èµ„æŠµæ¶ˆ
- æ”¯æŒå†…éƒ¨å¾€æ¥æŠµæ¶ˆ

### 3.2 Schemaå®šä¹‰

**æŠµæ¶ˆåˆ†å½•ç¼–åˆ¶Schema**ï¼š

```dsl
schema EliminationEntriesPreparation {
  intercompany_transaction: IntercompanyTransaction {
    transaction_id: String @value("ICT-20250001")
    transaction_date: Date @value("2025-01-15")
    seller_entity_id: String @value("SUB-20250001")
    buyer_entity_id: String @value("PARENT-001")
    transaction_type: Enum @value("Sales")
    transaction_amount: Decimal @value(100000.00)
    is_eliminated: Boolean @value(true)
  }

  elimination_entry: EliminationEntry {
    elimination_id: String @value("ELIM-20250001")
    elimination_date: Date @value("2025-01-31")
    reporting_period: Date @value("2025-01")
    elimination_type: Enum @value("Intercompany_Sales")
    debit_account: String @value("Revenue")
    credit_account: String @value("Cost_of_Sales")
    elimination_amount: Decimal @value(100000.00)
    related_transactions: List<String> {
      "ICT-20250001"
    }
  }
}
```

---

## 4. æ¡ˆä¾‹3ï¼šåˆå¹¶æŠ¥è¡¨ç”Ÿæˆ

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ç”Ÿæˆåˆå¹¶èµ„äº§è´Ÿå€ºè¡¨ã€åˆå¹¶åˆ©æ¶¦è¡¨ã€åˆå¹¶ç°é‡‘æµé‡è¡¨ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒåˆå¹¶æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ
- æ”¯æŒåˆå¹¶æŠ¥è¡¨éªŒè¯
- æ”¯æŒåˆå¹¶æŠ¥è¡¨æŠ«éœ²

### 4.2 å®ç°ä»£ç 

```python
def generate_consolidated_statements(consolidated_data: ConsolidatedReportingSchema) -> ConsolidatedStatements:
    """ç”Ÿæˆåˆå¹¶æŠ¥è¡¨"""
    consolidated_statements = ConsolidatedStatements()

    # ç”Ÿæˆåˆå¹¶èµ„äº§è´Ÿå€ºè¡¨
    consolidated_balance_sheet = ConsolidatedBalanceSheet()
    consolidated_balance_sheet.report_date = consolidated_data.reporting_period
    consolidated_balance_sheet.reporting_period = consolidated_data.reporting_period

    # æ±‡æ€»å„å­å…¬å¸èµ„äº§
    total_current_assets = 0
    total_non_current_assets = 0

    for subsidiary in consolidated_data.consolidated_scope.subsidiaries:
        if subsidiary.is_consolidated:
            # è·å–å­å…¬å¸èµ„äº§è´Ÿå€ºè¡¨
            subsidiary_balance_sheet = get_subsidiary_balance_sheet(subsidiary.subsidiary_id)
            total_current_assets += subsidiary_balance_sheet.current_assets
            total_non_current_assets += subsidiary_balance_sheet.non_current_assets

    consolidated_balance_sheet.consolidated_assets.current_assets = total_current_assets
    consolidated_balance_sheet.consolidated_assets.non_current_assets = total_non_current_assets
    consolidated_balance_sheet.consolidated_assets.total_assets = total_current_assets + total_non_current_assets

    # åº”ç”¨æŠµæ¶ˆåˆ†å½•
    for elimination in consolidated_data.elimination_entries.elimination_entries:
        if elimination.elimination_type == "Intercompany_Sales":
            # æŠµæ¶ˆå†…éƒ¨é”€å”®æ”¶å…¥
            consolidated_balance_sheet.consolidated_assets.total_assets -= elimination.elimination_amount

    consolidated_statements.consolidated_balance_sheet = consolidated_balance_sheet

    # ç”Ÿæˆåˆå¹¶åˆ©æ¶¦è¡¨
    consolidated_income_statement = ConsolidatedIncomeStatement()
    consolidated_income_statement.period_start = consolidated_data.reporting_period_start
    consolidated_income_statement.period_end = consolidated_data.reporting_period_end

    # æ±‡æ€»å„å­å…¬å¸æ”¶å…¥
    total_revenue = 0
    total_expenses = 0

    for subsidiary in consolidated_data.consolidated_scope.subsidiaries:
        if subsidiary.is_consolidated:
            # è·å–å­å…¬å¸åˆ©æ¶¦è¡¨
            subsidiary_income_statement = get_subsidiary_income_statement(subsidiary.subsidiary_id)
            total_revenue += subsidiary_income_statement.revenue
            total_expenses += subsidiary_income_statement.expenses

    # åº”ç”¨æŠµæ¶ˆåˆ†å½•
    for elimination in consolidated_data.elimination_entries.elimination_entries:
        if elimination.elimination_type == "Intercompany_Sales":
            # æŠµæ¶ˆå†…éƒ¨é”€å”®æ”¶å…¥å’Œæˆæœ¬
            total_revenue -= elimination.elimination_amount
            total_expenses -= elimination.elimination_amount

    consolidated_income_statement.consolidated_revenue.total_revenue = total_revenue
    consolidated_income_statement.consolidated_expenses.total_expenses = total_expenses
    consolidated_income_statement.net_income = total_revenue - total_expenses

    # è®¡ç®—å°‘æ•°è‚¡ä¸œæƒç›Š
    for subsidiary in consolidated_data.consolidated_scope.subsidiaries:
        if subsidiary.is_consolidated and subsidiary.ownership_percentage < 100:
            minority_share = (100 - subsidiary.ownership_percentage) / 100
            consolidated_income_statement.net_income_attributable_to_minority += consolidated_income_statement.net_income * minority_share

    consolidated_income_statement.net_income_attributable_to_parent = consolidated_income_statement.net_income - consolidated_income_statement.net_income_attributable_to_minority

    consolidated_statements.consolidated_income_statement = consolidated_income_statement

    return consolidated_statements
```

---

## 5. æ¡ˆä¾‹4ï¼šåˆå¹¶æŠ¥è¡¨åˆ°XBRLè½¬æ¢

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†åˆå¹¶æŠ¥è¡¨è½¬æ¢ä¸ºXBRLæ ¼å¼ï¼Œç”¨äºç›‘ç®¡æŠ¥å‘Šã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒåˆå¹¶æŠ¥è¡¨åˆ°XBRLè½¬æ¢
- æ”¯æŒXBRLéªŒè¯
- æ”¯æŒXBRLæŠ«éœ²

### 5.2 å®ç°ä»£ç 

```python
def convert_consolidated_to_xbrl(consolidated_statements: ConsolidatedStatements) -> XBRLInstance:
    """å°†åˆå¹¶æŠ¥è¡¨è½¬æ¢ä¸ºXBRLæ ¼å¼"""
    xbrl_instance = XBRLInstance()

    # åˆ›å»ºä¸Šä¸‹æ–‡
    context = Context()
    context.entity_identifier = "Consolidated_Entity"
    context.period_start = consolidated_statements.consolidated_balance_sheet.reporting_period
    context.period_end = consolidated_statements.consolidated_balance_sheet.reporting_period

    # è½¬æ¢åˆå¹¶èµ„äº§è´Ÿå€ºè¡¨
    balance_sheet = consolidated_statements.consolidated_balance_sheet

    # èµ„äº§äº‹å®
    assets_fact = Fact()
    assets_fact.element = "ConsolidatedAssets"
    assets_fact.context = context
    assets_fact.unit = "CNY"
    assets_fact.value = balance_sheet.consolidated_assets.total_assets
    xbrl_instance.facts.append(assets_fact)

    # è´Ÿå€ºäº‹å®
    liabilities_fact = Fact()
    liabilities_fact.element = "ConsolidatedLiabilities"
    liabilities_fact.context = context
    liabilities_fact.unit = "CNY"
    liabilities_fact.value = balance_sheet.consolidated_liabilities.total_liabilities
    xbrl_instance.facts.append(liabilities_fact)

    # æƒç›Šäº‹å®
    equity_fact = Fact()
    equity_fact.element = "ConsolidatedEquity"
    equity_fact.context = context
    equity_fact.unit = "CNY"
    equity_fact.value = balance_sheet.consolidated_equity.total_equity
    xbrl_instance.facts.append(equity_fact)

    # å°‘æ•°è‚¡ä¸œæƒç›Šäº‹å®
    minority_interest_fact = Fact()
    minority_interest_fact.element = "MinorityInterest"
    minority_interest_fact.context = context
    minority_interest_fact.unit = "CNY"
    minority_interest_fact.value = balance_sheet.consolidated_equity.minority_interest
    xbrl_instance.facts.append(minority_interest_fact)

    # è½¬æ¢åˆå¹¶åˆ©æ¶¦è¡¨
    income_statement = consolidated_statements.consolidated_income_statement

    # æ”¶å…¥äº‹å®
    revenue_fact = Fact()
    revenue_fact.element = "ConsolidatedRevenue"
    revenue_fact.context = context
    revenue_fact.unit = "CNY"
    revenue_fact.value = income_statement.consolidated_revenue.total_revenue
    xbrl_instance.facts.append(revenue_fact)

    # å‡€åˆ©æ¶¦äº‹å®
    net_income_fact = Fact()
    net_income_fact.element = "ConsolidatedNetIncome"
    net_income_fact.context = context
    net_income_fact.unit = "CNY"
    net_income_fact.value = income_statement.net_income
    xbrl_instance.facts.append(net_income_fact)

    return xbrl_instance
```

---

## 6. æ¡ˆä¾‹5ï¼šåˆå¹¶æŠ¥è¡¨æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
åˆå¹¶æŠ¥è¡¨æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒæ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æã€æŠ¥è¡¨ç”Ÿæˆã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒåˆå¹¶æŠ¥è¡¨æ•°æ®å­˜å‚¨
- æ”¯æŒæ•°æ®æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒæŠ¥è¡¨ç”Ÿæˆ

### 6.2 å®ç°ä»£ç 

```python
def store_consolidated_data(consolidated_data: ConsolidatedReportingSchema, conn):
    """å­˜å‚¨åˆå¹¶æŠ¥è¡¨æ•°æ®åˆ°PostgreSQL"""
    cursor = conn.cursor()

    # å­˜å‚¨åˆå¹¶èŒƒå›´
    for subsidiary in consolidated_data.consolidation_scope.subsidiaries:
        cursor.execute("""
            INSERT INTO consolidation_scope
            (subsidiary_id, subsidiary_code, subsidiary_name, parent_company_id,
             ownership_percentage, voting_rights_percentage, has_control,
             consolidation_method, is_consolidated, reporting_period_start, reporting_period_end)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (subsidiary_id) DO UPDATE SET
            ownership_percentage = EXCLUDED.ownership_percentage,
            voting_rights_percentage = EXCLUDED.voting_rights_percentage,
            has_control = EXCLUDED.has_control,
            consolidation_method = EXCLUDED.consolidation_method,
            is_consolidated = EXCLUDED.is_consolidated,
            updated_at = CURRENT_TIMESTAMP
        """, (subsidiary.subsidiary_id, subsidiary.subsidiary_code, subsidiary.subsidiary_name,
              subsidiary.parent_company_id, subsidiary.ownership_percentage,
              subsidiary.voting_rights_percentage, subsidiary.control_assessment.has_control,
              subsidiary.consolidation_method, subsidiary.is_consolidated,
              subsidiary.reporting_period_start, subsidiary.reporting_period_end))

    # å­˜å‚¨æŠµæ¶ˆåˆ†å½•
    for elimination in consolidated_data.elimination_entries.elimination_entries:
        cursor.execute("""
            INSERT INTO elimination_entries
            (elimination_id, elimination_date, reporting_period, elimination_type,
             debit_account, credit_account, elimination_amount, description)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (elimination_id) DO UPDATE SET
            elimination_amount = EXCLUDED.elimination_amount,
            description = EXCLUDED.description
        """, (elimination.elimination_id, elimination.elimination_date,
              elimination.reporting_period, elimination.elimination_type,
              elimination.debit_account, elimination.credit_account,
              elimination.elimination_amount, elimination.description))

    # å­˜å‚¨åˆå¹¶èµ„äº§è´Ÿå€ºè¡¨
    balance_sheet = consolidated_data.consolidated_statements.consolidated_balance_sheet
    cursor.execute("""
        INSERT INTO consolidated_balance_sheets
        (report_id, report_date, reporting_period, total_assets, total_liabilities,
         total_equity, minority_interest, is_balanced)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
        ON CONFLICT (report_id) DO UPDATE SET
        total_assets = EXCLUDED.total_assets,
        total_liabilities = EXCLUDED.total_liabilities,
        total_equity = EXCLUDED.total_equity,
        minority_interest = EXCLUDED.minority_interest,
        is_balanced = EXCLUDED.is_balanced
    """, (f"BS-{balance_sheet.report_date}", balance_sheet.report_date,
          balance_sheet.reporting_period, balance_sheet.consolidated_assets.total_assets,
          balance_sheet.consolidated_liabilities.total_liabilities,
          balance_sheet.consolidated_equity.total_equity,
          balance_sheet.consolidated_equity.minority_interest,
          balance_sheet.is_balanced))

    # å­˜å‚¨åˆå¹¶åˆ©æ¶¦è¡¨
    income_statement = consolidated_data.consolidated_statements.consolidated_income_statement
    cursor.execute("""
        INSERT INTO consolidated_income_statements
        (report_id, period_start, period_end, total_revenue, total_expenses,
         net_income, net_income_attributable_to_parent, net_income_attributable_to_minority)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
        ON CONFLICT (report_id) DO UPDATE SET
        total_revenue = EXCLUDED.total_revenue,
        total_expenses = EXCLUDED.total_expenses,
        net_income = EXCLUDED.net_income,
        net_income_attributable_to_parent = EXCLUDED.net_income_attributable_to_parent,
        net_income_attributable_to_minority = EXCLUDED.net_income_attributable_to_minority
    """, (f"IS-{income_statement.period_end}", income_statement.period_start,
          income_statement.period_end, income_statement.consolidated_revenue.total_revenue,
          income_statement.consolidated_expenses.total_expenses,
          income_statement.net_income,
          income_statement.net_income_attributable_to_parent,
          income_statement.net_income_attributable_to_minority))

    conn.commit()

def generate_consolidated_report(conn, period_start, period_end):
    """ç”Ÿæˆåˆå¹¶æŠ¥è¡¨"""
    cursor = conn.cursor()

    # æŸ¥è¯¢åˆå¹¶èŒƒå›´
    cursor.execute("""
        SELECT
            cs.subsidiary_name,
            cs.ownership_percentage,
            cs.consolidation_method,
            cs.is_consolidated
        FROM consolidation_scope cs
        WHERE cs.reporting_period_start <= %s
        AND cs.reporting_period_end >= %s
        ORDER BY cs.subsidiary_name
    """, (period_end, period_start))

    scope_report = cursor.fetchall()

    # æŸ¥è¯¢åˆå¹¶èµ„äº§è´Ÿå€ºè¡¨
    cursor.execute("""
        SELECT
            cbs.report_date,
            cbs.total_assets,
            cbs.total_liabilities,
            cbs.total_equity,
            cbs.minority_interest
        FROM consolidated_balance_sheets cbs
        WHERE cbs.report_date BETWEEN %s AND %s
        ORDER BY cbs.report_date
    """, (period_start, period_end))

    balance_sheet_report = cursor.fetchall()

    # æŸ¥è¯¢åˆå¹¶åˆ©æ¶¦è¡¨
    cursor.execute("""
        SELECT
            cis.period_start,
            cis.period_end,
            cis.total_revenue,
            cis.total_expenses,
            cis.net_income,
            cis.net_income_attributable_to_parent,
            cis.net_income_attributable_to_minority
        FROM consolidated_income_statements cis
        WHERE cis.period_start >= %s
        AND cis.period_end <= %s
        ORDER BY cis.period_start
    """, (period_start, period_end))

    income_statement_report = cursor.fetchall()

    return {
        "scope_report": scope_report,
        "balance_sheet_report": balance_sheet_report,
        "income_statement_report": income_statement_report
    }
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
