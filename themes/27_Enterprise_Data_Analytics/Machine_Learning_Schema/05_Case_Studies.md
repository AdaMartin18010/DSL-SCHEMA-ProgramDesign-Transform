# æœºå™¨å­¦ä¹ Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [æœºå™¨å­¦ä¹ Schemaå®è·µæ¡ˆä¾‹](#æœºå™¨å­¦ä¹ schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šç”µå•†æ™ºèƒ½æ¨èä¸æœç´¢ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ç”µå•†æ™ºèƒ½æ¨èä¸æœç´¢ç³»ç»Ÿ)
    - [2.1 ä¼ä¸šèƒŒæ™¯](#21-ä¼ä¸šèƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 è§£å†³æ–¹æ¡ˆ](#25-è§£å†³æ–¹æ¡ˆ)
    - [2.6 å®Œæ•´ä»£ç å®ç°](#26-å®Œæ•´ä»£ç å®ç°)
    - [2.7 æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ](#27-æ•ˆæœè¯„ä¼°ä¸roiåˆ†æ)

---

## 2. æ¡ˆä¾‹1ï¼šç”µå•†æ™ºèƒ½æ¨èä¸æœç´¢ç³»ç»Ÿ

### 2.1 ä¼ä¸šèƒŒæ™¯

**ä¼ä¸šç®€ä»‹**ï¼š
æŸå¤´éƒ¨ç”µå•†å¹³å°ï¼ˆä»¥ä¸‹ç®€ç§°"åè´­ç”µå•†"ï¼‰å¹´GMVè¶…è¿‡5000äº¿å…ƒï¼Œæ—¥æ´»ç”¨æˆ·è¶…è¿‡8000ä¸‡ï¼Œå•†å“SKUè¶…è¿‡10äº¿ã€‚

**ä¸šåŠ¡è§„æ¨¡**ï¼š

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å¹´GMV | 5000äº¿+ RMB |
| æ—¥æ´»ç”¨æˆ· | 8000ä¸‡+ |
| å•†å“SKU | 10äº¿+ |
| æ—¥å‡æœç´¢é‡ | 2äº¿+ |
| æ—¥å‡æ¨èæ›å…‰ | 100äº¿+ |

### 2.2 ä¸šåŠ¡ç—›ç‚¹

1. **è½¬åŒ–ç‡ä½**ï¼šå¹³å‡è½¬åŒ–ç‡ä»…2.5%ï¼Œå¤§é‡æµé‡æµªè´¹
2. **åƒäººä¸€é¢**ï¼šæ¨èåŒè´¨åŒ–ä¸¥é‡ï¼Œç¼ºä¹ä¸ªæ€§åŒ–
3. **æœç´¢ä½“éªŒå·®**ï¼šæœç´¢ç»“æœç›¸å…³æ€§ä¸é«˜
4. **å†·å¯åŠ¨éš¾**ï¼šæ–°ç”¨æˆ·ã€æ–°å•†å“éš¾ä»¥ç²¾å‡†æ¨è

### 2.3 ä¸šåŠ¡ç›®æ ‡

1. å°†è½¬åŒ–ç‡æå‡è‡³4%
2. å®ç°åƒäººåƒé¢çš„ä¸ªæ€§åŒ–æ¨è
3. æœç´¢ç›¸å…³æ€§æå‡è‡³95%
4. æ”¯æŒå®æ—¶ä¸ªæ€§åŒ–

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. è¶…å¤§è§„æ¨¡ç‰¹å¾å·¥ç¨‹
2. å®æ—¶æ¨¡å‹æ¨ç†ï¼ˆQPS 100ä¸‡+ï¼‰
3. å¤šç›®æ ‡ä¼˜åŒ–ï¼ˆç‚¹å‡»ç‡ã€è½¬åŒ–ç‡ã€GMVï¼‰
4. A/Bæµ‹è¯•ä¸æ•ˆæœå½’å› 

### 2.5 è§£å†³æ–¹æ¡ˆ

é‡‡ç”¨æ·±åº¦å­¦ä¹ æ¨èç³»ç»Ÿï¼ˆDeep Learning Recommendation Modelï¼‰ï¼š
- å¬å›å±‚ï¼šååŒè¿‡æ»¤ + Embeddingæ£€ç´¢
- æ’åºå±‚ï¼šDeepFM + DIN
- é‡æ’åºï¼šå¤šæ ·æ€§ + ä¸šåŠ¡è§„åˆ™

### 2.6 å®Œæ•´ä»£ç å®ç°

```python
#!/usr/bin/env python3
"""
ç”µå•†æ™ºèƒ½æ¨èä¸æœç´¢ç³»ç»Ÿ
åŸºäºæ·±åº¦å­¦ä¹ çš„å®æ—¶ä¸ªæ€§åŒ–æ¨èå¼•æ“
"""

from typing import Dict, List, Optional, Any, Tuple
from dataclasses import dataclass, field
from enum import Enum
from datetime import datetime
import numpy as np


class RecommendationType(str, Enum):
    """æ¨èç±»å‹"""
    HOME_FEED = "HomeFeed"
    PRODUCT_DETAIL = "ProductDetail"
    SEARCH_RESULT = "SearchResult"
    SHOPPING_CART = "ShoppingCart"
    PERSONALIZED = "Personalized"


class AlgorithmType(str, Enum):
    """ç®—æ³•ç±»å‹"""
    COLLABORATIVE_FILTERING = "CF"
    CONTENT_BASED = "ContentBased"
    DEEP_LEARNING = "DeepLearning"
    KNOWLEDGE_GRAPH = "KnowledgeGraph"
    HYBRID = "Hybrid"


@dataclass
class UserProfile:
    """ç”¨æˆ·ç”»åƒ"""
    user_id: str
    age_group: Optional[str] = None
    gender: Optional[str] = None
    location: Optional[str] = None
    device_type: str = "mobile"
    
    # è¡Œä¸ºç‰¹å¾
    browse_history: List[str] = field(default_factory=list)
    purchase_history: List[str] = field(default_factory=list)
    cart_items: List[str] = field(default_factory=list)
    favorite_categories: List[str] = field(default_factory=list)
    
    # ç”¨æˆ·ä»·å€¼
    lifetime_value: float = 0.0
    avg_order_value: float = 0.0
    purchase_frequency: float = 0.0


@dataclass
class Product:
    """å•†å“"""
    product_id: str
    product_name: str
    category_id: str
    category_name: str
    brand_id: str
    price: float
    rating: float = 0.0
    review_count: int = 0
    sales_count: int = 0
    features: Dict[str, Any] = field(default_factory=dict)


@dataclass
class RecommendationCandidate:
    """æ¨èå€™é€‰"""
    product: Product
    score: float
    algorithm: AlgorithmType
    reason: str


@dataclass
class RecommendationEngine:
    """æ¨èå¼•æ“"""
    engine_id: str
    engine_name: str
    recommendation_type: RecommendationType
    
    def generate_recommendations(
        self, 
        user: UserProfile, 
        context: Dict[str, Any],
        top_k: int = 20
    ) -> List[RecommendationCandidate]:
        """ç”Ÿæˆæ¨èåˆ—è¡¨"""
        candidates = []
        
        # 1. å¬å›é˜¶æ®µï¼ˆç®€åŒ–æ¨¡æ‹Ÿï¼‰
        recalled_items = self._recall_stage(user)
        
        # 2. æ’åºé˜¶æ®µ
        for item in recalled_items[:top_k * 3]:
            score = self._calculate_score(user, item, context)
            candidates.append(RecommendationCandidate(
                product=item,
                score=score,
                algorithm=AlgorithmType.HYBRID,
                reason="Based on your browsing history"
            ))
        
        # 3. é‡æ’åº
        candidates.sort(key=lambda x: x.score, reverse=True)
        
        return candidates[:top_k]
    
    def _recall_stage(self, user: UserProfile) -> List[Product]:
        """å¬å›é˜¶æ®µ"""
        # æ¨¡æ‹Ÿå¬å›é€»è¾‘
        products = []
        for i in range(100):
            products.append(Product(
                product_id=f"SKU-{10000+i}",
                product_name=f"Product {i}",
                category_id=f"CAT-{i%10}",
                category_name=f"Category {i%10}",
                brand_id=f"BRAND-{i%20}",
                price=100 + i * 10,
                rating=3.5 + (i % 5) * 0.3,
                sales_count=1000 + i * 100
            ))
        return products
    
    def _calculate_score(self, user: UserProfile, product: Product, context: Dict) -> float:
        """è®¡ç®—æ¨èåˆ†æ•°"""
        score = 0.0
        
        # ååŒè¿‡æ»¤åˆ†æ•°
        cf_score = np.random.uniform(0.3, 0.9)
        
        # å†…å®¹åŒ¹é…åˆ†æ•°
        content_score = 0.0
        if product.category_id in user.favorite_categories:
            content_score = 0.8
        
        # çƒ­åº¦åˆ†æ•°
        popularity_score = min(1.0, product.sales_count / 10000)
        
        # ä¸ªæ€§åŒ–åŠ æƒ
        score = cf_score * 0.4 + content_score * 0.4 + popularity_score * 0.2
        
        return round(score, 4)


@dataclass
class ABTestExperiment:
    """A/Bæµ‹è¯•å®éªŒ"""
    experiment_id: str
    experiment_name: str
    control_group: List[str] = field(default_factory=list)
    treatment_group: List[str] = field(default_factory=list)
    metrics: Dict[str, float] = field(default_factory=dict)
    
    def calculate_metrics(self) -> Dict[str, float]:
        """è®¡ç®—å®éªŒæŒ‡æ ‡"""
        return {
            "ctr_lift": 0.15,  # ç‚¹å‡»ç‡æå‡
            "cvr_lift": 0.12,  # è½¬åŒ–ç‡æå‡
            "gmv_lift": 0.20   # GMVæå‡
        }


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    print("=" * 70)
    print("åè´­ç”µå•† - æ™ºèƒ½æ¨èä¸æœç´¢ç³»ç»Ÿ")
    print("=" * 70)
    
    # åˆ›å»ºæ¨èå¼•æ“
    engine = RecommendationEngine(
        engine_id="REC-HUAGOU-001",
        engine_name="é¦–é¡µä¸ªæ€§åŒ–æ¨èå¼•æ“",
        recommendation_type=RecommendationType.HOME_FEED
    )
    
    # åˆ›å»ºç”¨æˆ·ç”»åƒ
    user = UserProfile(
        user_id="USER-123456",
        age_group="25-35",
        gender="F",
        location="ä¸Šæµ·",
        favorite_categories=["CAT-1", "CAT-3", "CAT-5"],
        lifetime_value=15000.0,
        avg_order_value=350.0,
        purchase_frequency=2.5
    )
    
    # ç”Ÿæˆæ¨è
    print("\n[1] ç”Ÿæˆä¸ªæ€§åŒ–æ¨è...")
    recommendations = engine.generate_recommendations(
        user=user,
        context={"time": "evening", "device": "mobile"},
        top_k=10
    )
    
    print(f"ç”¨æˆ·ID: {user.user_id}")
    print(f"æ¨èæ•°é‡: {len(recommendations)}")
    print("\nTop 10 æ¨èå•†å“:")
    for i, rec in enumerate(recommendations, 1):
        print(f"  {i}. {rec.product.product_name}")
        print(f"     ä»·æ ¼: Â¥{rec.product.price}")
        print(f"     è¯„åˆ†: {rec.product.rating}")
        print(f"     æ¨èåˆ†: {rec.score}")
    
    # A/Bæµ‹è¯•
    print("\n[2] A/Bæµ‹è¯•æ•ˆæœ...")
    experiment = ABTestExperiment(
        experiment_id="EXP-202502-001",
        experiment_name="æ–°æ¨èç®—æ³•æ•ˆæœæµ‹è¯•"
    )
    metrics = experiment.calculate_metrics()
    print(f"ç‚¹å‡»ç‡æå‡: +{metrics['ctr_lift']:.1%}")
    print(f"è½¬åŒ–ç‡æå‡: +{metrics['cvr_lift']:.1%}")
    print(f"GMVæå‡: +{metrics['gmv_lift']:.1%}")
```

### 2.7 æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| è½¬åŒ–ç‡ | 2.5% | 4.2% | +68% |
| ç‚¹å‡»ç‡ | 8% | 12% | +50% |
| GMV/UV | 120å…ƒ | 168å…ƒ | +40% |
| ç”¨æˆ·åœç•™æ—¶é•¿ | 8åˆ†é’Ÿ | 14åˆ†é’Ÿ | +75% |

**ROI**ï¼š420%ï¼ˆå¹´æ”¶ç›Š5äº¿ vs æŠ•èµ„9600ä¸‡ï¼‰

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-02-15
