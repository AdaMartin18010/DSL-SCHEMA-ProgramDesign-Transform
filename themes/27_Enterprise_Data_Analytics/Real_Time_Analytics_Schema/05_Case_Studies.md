# å®æ—¶åˆ†æSchemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [å®æ—¶åˆ†æSchemaå®è·µæ¡ˆä¾‹](#å®æ—¶åˆ†æschemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šç‰©æµé›†å›¢å®æ—¶ç‰©æµè¿½è¸ªä¸è°ƒåº¦ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ç‰©æµé›†å›¢å®æ—¶ç‰©æµè¿½è¸ªä¸è°ƒåº¦ç³»ç»Ÿ)
    - [2.1 ä¼ä¸šèƒŒæ™¯](#21-ä¼ä¸šèƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 è§£å†³æ–¹æ¡ˆ](#25-è§£å†³æ–¹æ¡ˆ)
    - [2.6 å®Œæ•´ä»£ç å®ç°](#26-å®Œæ•´ä»£ç å®ç°)
    - [2.7 æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ](#27-æ•ˆæœè¯„ä¼°ä¸roiåˆ†æ)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å®æ—¶åˆ†æSchemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„æ·±åº¦å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–ç‰©æµè¿½è¸ªã€IoTæ•°æ®åˆ†æã€å®æ—¶é£æ§ç­‰ä¼ä¸šçº§åœºæ™¯ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šç‰©æµé›†å›¢å®æ—¶ç‰©æµè¿½è¸ªä¸è°ƒåº¦ç³»ç»Ÿ

### 2.1 ä¼ä¸šèƒŒæ™¯

**ä¼ä¸šç®€ä»‹**ï¼š
æŸå¤§å‹ç‰©æµé›†å›¢ï¼ˆä»¥ä¸‹ç®€ç§°"åè¿ç‰©æµ"ï¼‰æ‹¥æœ‰è½¦è¾†5ä¸‡å°ã€å‘˜å·¥10ä¸‡äººï¼Œè¦†ç›–å…¨å›½3000ä¸ªåŒºå¿ï¼Œæ—¥å¤„ç†è®¢å•500ä¸‡å•ï¼Œæ˜¯ä¸­å›½é¢†å…ˆçš„ç»¼åˆç‰©æµæœåŠ¡å•†ã€‚

**ä¸šåŠ¡è§„æ¨¡**ï¼š

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| è¿è¾“è½¦è¾† | 5ä¸‡+ |
| æ—¥å¤„ç†è®¢å• | 500ä¸‡+ |
| æœåŠ¡ç½‘ç‚¹ | 1ä¸‡+ |
| è¦†ç›–åŒºå¿ | 3000+ |
| æ—¥æ•°æ®é‡ | 10TB+ |
| IoTè®¾å¤‡ | 50ä¸‡+ |

### 2.2 ä¸šåŠ¡ç—›ç‚¹

**ç—›ç‚¹1ï¼šè´§ç‰©è¿½è¸ªæ»å**
å®¢æˆ·æ— æ³•å®æ—¶äº†è§£è´§ç‰©ä½ç½®ï¼Œå®¢æœæŸ¥è¯¢å“åº”æ…¢ï¼Œå®¢æˆ·æ»¡æ„åº¦ä½ã€‚

**ç—›ç‚¹2ï¼šè¿åŠ›è°ƒåº¦ä½æ•ˆ**
è½¦è¾†ç©ºé©¶ç‡é«˜è¾¾30%ï¼Œè·¯çº¿è§„åˆ’ä¾èµ–ç»éªŒï¼Œè¿è¾“æˆæœ¬é«˜ã€‚

**ç—›ç‚¹3ï¼šå¼‚å¸¸å¤„ç†æ»å**
å»¶è¯¯ã€ç ´æŸç­‰å¼‚å¸¸å‘ç°æ…¢ï¼Œè¢«åŠ¨å¤„ç†å¯¼è‡´å®¢æˆ·æŠ•è¯‰å¤šã€‚

**ç—›ç‚¹4ï¼šèµ„æºåˆ©ç”¨ç‡ä½**
ä»“å‚¨ã€è½¦è¾†ã€äººå‘˜èµ„æºæ— æ³•åŠ¨æ€ä¼˜åŒ–é…ç½®ï¼Œæµªè´¹ä¸¥é‡ã€‚

**ç—›ç‚¹5ï¼šå†³ç­–ç¼ºä¹å®æ—¶æ€§**
ç®¡ç†å±‚ä¾èµ–æ—¥æŠ¥/å‘¨æŠ¥ï¼Œæ— æ³•å®æ—¶æŒæ¡è¿è¥çŠ¶å†µï¼Œå†³ç­–æ»åã€‚

### 2.3 ä¸šåŠ¡ç›®æ ‡

**ç›®æ ‡1ï¼šå…¨é“¾è·¯å®æ—¶è¿½è¸ª**
å®ç°è´§ç‰©ä»æ½æ”¶åˆ°ç­¾æ”¶çš„å…¨é“¾è·¯å®æ—¶è¿½è¸ªï¼Œä½ç½®æ›´æ–°å»¶è¿Ÿ<30ç§’ã€‚

**ç›®æ ‡2ï¼šæ™ºèƒ½è°ƒåº¦ä¼˜åŒ–**
åŸºäºå®æ—¶æ•°æ®åŠ¨æ€è°ƒåº¦è¿åŠ›ï¼Œå°†ç©ºé©¶ç‡é™è‡³15%ä»¥ä¸‹ã€‚

**ç›®æ ‡3ï¼šå¼‚å¸¸å®æ—¶é¢„è­¦**
å»ºç«‹å®æ—¶å¼‚å¸¸æ£€æµ‹æœºåˆ¶ï¼Œå¼‚å¸¸å‘ç°æ—¶é—´<5åˆ†é’Ÿã€‚

**ç›®æ ‡4ï¼šèµ„æºåŠ¨æ€ä¼˜åŒ–**
å®ç°ä»“å‚¨ã€è½¦è¾†ã€äººå‘˜çš„å®æ—¶ä¼˜åŒ–é…ç½®ï¼Œæå‡èµ„æºåˆ©ç”¨ç‡ã€‚

**ç›®æ ‡5ï¼šå®æ—¶å†³ç­–æ”¯æŒ**
æ„å»ºå®æ—¶è¿è¥ä»ªè¡¨ç›˜ï¼Œæ”¯æŒç®¡ç†å±‚å®æ—¶å†³ç­–ã€‚

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

**æŒ‘æˆ˜1ï¼šæµ·é‡IoTæ•°æ®å¤„ç†**
50ä¸‡+ IoTè®¾å¤‡æ¯ç§’äº§ç”Ÿæ•°ç™¾ä¸‡æ•°æ®ç‚¹ï¼Œéœ€è¦é«˜ååçš„æµå¤„ç†èƒ½åŠ›ã€‚

**æŒ‘æˆ˜2ï¼šå®æ—¶åœ°ç†è®¡ç®—**
éœ€è¦å®æ—¶è¿›è¡Œè·¯å¾„è§„åˆ’ã€ETAè®¡ç®—ã€è·ç¦»è®¡ç®—ç­‰åœ°ç†è¿ç®—ã€‚

**æŒ‘æˆ˜3ï¼šå¤æ‚äº‹ä»¶å¤„ç†**
éœ€è¦è¯†åˆ«å»¶è¯¯é£é™©ã€å¼‚å¸¸äº‹ä»¶ã€æœ€ä¼˜è°ƒåº¦æ—¶æœºç­‰å¤æ‚æ¨¡å¼ã€‚

**æŒ‘æˆ˜4ï¼šé«˜å¯ç”¨ä¿éšœ**
7Ã—24å°æ—¶ä¸é—´æ–­æœåŠ¡ï¼Œä¸èƒ½å®¹å¿æ•°æ®ä¸¢å¤±æˆ–æœåŠ¡ä¸­æ–­ã€‚

**æŒ‘æˆ˜5ï¼šå¤šæºæ•°æ®èåˆ**
éœ€è¦èåˆGPSã€è®¢å•ã€å¤©æ°”ã€è·¯å†µç­‰å¤šæºå¼‚æ„æ•°æ®ã€‚

### 2.5 è§£å†³æ–¹æ¡ˆ

**æ¶æ„è®¾è®¡**ï¼š
- **æ•°æ®é‡‡é›†å±‚**ï¼šIoT Hub + Kafka
- **æµå¤„ç†å±‚**ï¼šFlink + Kafka Streams
- **åˆ†æè®¡ç®—å±‚**ï¼šRedis + ClickHouse
- **åº”ç”¨æœåŠ¡å±‚**ï¼šå®æ—¶API + æ¨é€æœåŠ¡

### 2.6 å®Œæ•´ä»£ç å®ç°

```python
#!/usr/bin/env python3
"""
ç‰©æµé›†å›¢å®æ—¶ç‰©æµè¿½è¸ªä¸è°ƒåº¦ç³»ç»Ÿ
åŸºäºFlinkå’ŒKafkaçš„ä¼ä¸šçº§å®æ—¶ç‰©æµè§£å†³æ–¹æ¡ˆ
"""

from typing import Dict, List, Optional, Tuple, Any
from dataclasses import dataclass, field
from enum import Enum
from datetime import datetime, timedelta
import json
import math
from collections import defaultdict


class VehicleStatus(str, Enum):
    """è½¦è¾†çŠ¶æ€"""
    IDLE = "Idle"
    LOADING = "Loading"
    IN_TRANSIT = "InTransit"
    UNLOADING = "Unloading"
    MAINTENANCE = "Maintenance"


class OrderStatus(str, Enum):
    """è®¢å•çŠ¶æ€"""
    CREATED = "Created"
    PICKED_UP = "PickedUp"
    IN_TRANSIT = "InTransit"
    DELIVERED = "Delivered"
    EXCEPTION = "Exception"


class AlertType(str, Enum):
    """é¢„è­¦ç±»å‹"""
    DELAY_RISK = "DelayRisk"
    ROUTE_DEVIATION = "RouteDeviation"
    TEMPERATURE_ALERT = "TemperatureAlert"
    VEHICLE_BREAKDOWN = "VehicleBreakdown"
    CONGESTION_DETECTED = "CongestionDetected"


@dataclass
class GPSPoint:
    """GPSåæ ‡ç‚¹"""
    latitude: float
    longitude: float
    timestamp: datetime
    speed: float = 0.0  # km/h
    altitude: float = 0.0
    
    def distance_to(self, other: 'GPSPoint') -> float:
        """è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        # ä½¿ç”¨Haversineå…¬å¼
        R = 6371  # åœ°çƒåŠå¾„(km)
        lat1, lon1 = math.radians(self.latitude), math.radians(self.longitude)
        lat2, lon2 = math.radians(other.latitude), math.radians(other.longitude)
        
        dlat = lat2 - lat1
        dlon = lon2 - lon1
        
        a = math.sin(dlat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dlon/2)**2
        c = 2 * math.atan2(math.sqrt(a), math.sqrt(1-a))
        
        return R * c


@dataclass
class Vehicle:
    """è½¦è¾†"""
    vehicle_id: str
    plate_number: str
    vehicle_type: str  # truck, van, etc.
    capacity_kg: float
    capacity_cbm: float
    
    current_status: VehicleStatus = VehicleStatus.IDLE
    current_location: Optional[GPSPoint] = None
    current_order_id: Optional[str] = None
    driver_id: Optional[str] = None
    
    # å†å²è½¨è¿¹
    trajectory: List[GPSPoint] = field(default_factory=list)
    
    def update_location(self, point: GPSPoint):
        """æ›´æ–°ä½ç½®"""
        self.current_location = point
        self.trajectory.append(point)
        # ä¿ç•™æœ€è¿‘1000ä¸ªç‚¹
        if len(self.trajectory) > 1000:
            self.trajectory = self.trajectory[-1000:]
    
    def calculate_eta(self, destination: GPSPoint) -> timedelta:
        """è®¡ç®—é¢„è®¡åˆ°è¾¾æ—¶é—´"""
        if not self.current_location:
            return timedelta(hours=999)
        
        distance = self.current_location.distance_to(destination)
        # å‡è®¾å¹³å‡é€Ÿåº¦60km/h
        hours = distance / 60
        return timedelta(hours=hours)


@dataclass
class Shipment:
    """è¿å•"""
    shipment_id: str
    order_id: str
    origin: Dict[str, Any]  # èµ·ç‚¹ä¿¡æ¯
    destination: Dict[str, Any]  # ç»ˆç‚¹ä¿¡æ¯
    cargo_info: Dict[str, Any]  # è´§ç‰©ä¿¡æ¯
    
    status: OrderStatus = OrderStatus.CREATED
    assigned_vehicle_id: Optional[str] = None
    
    planned_pickup_time: Optional[datetime] = None
    planned_delivery_time: Optional[datetime] = None
    actual_pickup_time: Optional[datetime] = None
    actual_delivery_time: Optional[datetime] = None
    
    current_temperature: Optional[float] = None  # å†·é“¾ç›‘æ§
    
    def is_delayed(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦å»¶è¯¯"""
        if self.status == OrderStatus.DELIVERED:
            return False
        if not self.planned_delivery_time:
            return False
        return datetime.now() > self.planned_delivery_time
    
    def get_delay_risk_score(self, vehicle: Optional[Vehicle]) -> float:
        """è·å–å»¶è¯¯é£é™©è¯„åˆ†ï¼ˆ0-1ï¼‰"""
        if not self.planned_delivery_time:
            return 0.0
        
        if not vehicle or not vehicle.current_location:
            return 0.5
        
        dest = GPSPoint(
            latitude=self.destination.get("lat", 0),
            longitude=self.destination.get("lng", 0),
            timestamp=datetime.now()
        )
        eta = vehicle.calculate_eta(dest)
        estimated_arrival = datetime.now() + eta
        
        time_diff = (self.planned_delivery_time - estimated_arrival).total_seconds()
        if time_diff < 0:
            return 1.0  # è‚¯å®šä¼šå»¶è¯¯
        elif time_diff < 3600:  # 1å°æ—¶å†…
            return 0.8
        elif time_diff < 7200:  # 2å°æ—¶å†…
            return 0.5
        else:
            return 0.0


@dataclass
class RealTimeAlert:
    """å®æ—¶é¢„è­¦"""
    alert_id: str
    alert_type: AlertType
    severity: str  # Low, Medium, High, Critical
    shipment_id: Optional[str]
    vehicle_id: Optional[str]
    message: str
    created_at: datetime
    location: Optional[GPSPoint] = None
    suggested_action: Optional[str] = None


@dataclass
class LogisticsRealTimePlatform:
    """ç‰©æµå®æ—¶å¹³å°"""
    platform_id: str
    platform_name: str
    
    # è½¦è¾†æ³¨å†Œè¡¨
    vehicles: Dict[str, Vehicle] = field(default_factory=dict)
    
    # è¿å•æ³¨å†Œè¡¨
    shipments: Dict[str, Shipment] = field(default_factory=dict)
    
    # é¢„è­¦åˆ—è¡¨
    active_alerts: List[RealTimeAlert] = field(default_factory=list)
    
    # åŒºåŸŸçƒ­åŠ›å›¾
    zone_heatmap: Dict[str, int] = field(default_factory=dict)
    
    def register_vehicle(self, vehicle: Vehicle):
        """æ³¨å†Œè½¦è¾†"""
        self.vehicles[vehicle.vehicle_id] = vehicle
    
    def register_shipment(self, shipment: Shipment):
        """æ³¨å†Œè¿å•"""
        self.shipments[shipment.shipment_id] = shipment
    
    def process_iot_message(self, message: Dict[str, Any]):
        """å¤„ç†IoTæ¶ˆæ¯"""
        msg_type = message.get("type")
        
        if msg_type == "GPS_UPDATE":
            self._process_gps_update(message)
        elif msg_type == "TEMPERATURE_UPDATE":
            self._process_temperature_update(message)
        elif msg_type == "STATUS_UPDATE":
            self._process_status_update(message)
    
    def _process_gps_update(self, message: Dict):
        """å¤„ç†GPSæ›´æ–°"""
        vehicle_id = message.get("vehicle_id")
        vehicle = self.vehicles.get(vehicle_id)
        if not vehicle:
            return
        
        point = GPSPoint(
            latitude=message.get("lat"),
            longitude=message.get("lng"),
            timestamp=datetime.fromisoformat(message.get("timestamp")),
            speed=message.get("speed", 0)
        )
        
        vehicle.update_location(point)
        
        # æ›´æ–°çƒ­åŠ›å›¾
        zone_key = f"{int(point.latitude)},{int(point.longitude)}"
        self.zone_heatmap[zone_key] = self.zone_heatmap.get(zone_key, 0) + 1
        
        # æ£€æŸ¥è·¯çº¿åç¦»
        self._check_route_deviation(vehicle, point)
    
    def _process_temperature_update(self, message: Dict):
        """å¤„ç†æ¸©åº¦æ›´æ–°ï¼ˆå†·é“¾ï¼‰"""
        shipment_id = message.get("shipment_id")
        shipment = self.shipments.get(shipment_id)
        if not shipment:
            return
        
        temperature = message.get("temperature")
        shipment.current_temperature = temperature
        
        # æ£€æŸ¥æ¸©åº¦å¼‚å¸¸
        if temperature and (temperature > 8 or temperature < -2):
            alert = RealTimeAlert(
                alert_id=f"ALERT-{datetime.now().strftime('%Y%m%d%H%M%S')}",
                alert_type=AlertType.TEMPERATURE_ALERT,
                severity="High" if temperature > 10 or temperature < -5 else "Medium",
                shipment_id=shipment_id,
                vehicle_id=shipment.assigned_vehicle_id,
                message=f"Temperature out of range: {temperature}Â°C",
                created_at=datetime.now(),
                suggested_action="Check refrigeration system immediately"
            )
            self.active_alerts.append(alert)
    
    def _process_status_update(self, message: Dict):
        """å¤„ç†çŠ¶æ€æ›´æ–°"""
        shipment_id = message.get("shipment_id")
        shipment = self.shipments.get(shipment_id)
        if not shipment:
            return
        
        new_status = message.get("status")
        if new_status == "PICKED_UP":
            shipment.status = OrderStatus.PICKED_UP
            shipment.actual_pickup_time = datetime.now()
        elif new_status == "DELIVERED":
            shipment.status = OrderStatus.DELIVERED
            shipment.actual_delivery_time = datetime.now()
            
            # é‡Šæ”¾è½¦è¾†
            if shipment.assigned_vehicle_id:
                vehicle = self.vehicles.get(shipment.assigned_vehicle_id)
                if vehicle:
                    vehicle.current_status = VehicleStatus.IDLE
                    vehicle.current_order_id = None
    
    def _check_route_deviation(self, vehicle: Vehicle, point: GPSPoint):
        """æ£€æŸ¥è·¯çº¿åç¦»"""
        # ç®€åŒ–å®ç°ï¼Œå®é™…åº”å¯¹æ¯”è§„åˆ’è·¯çº¿
        if vehicle.current_order_id:
            shipment = self.shipments.get(vehicle.current_order_id)
            if shipment:
                dest = GPSPoint(
                    latitude=shipment.destination.get("lat", 0),
                    longitude=shipment.destination.get("lng", 0),
                    timestamp=datetime.now()
                )
                # å¦‚æœè·ç¦»ç»ˆç‚¹è¶Šæ¥è¶Šè¿œï¼Œå¯èƒ½å­˜åœ¨åç¦»
                # ç®€åŒ–é€»è¾‘
                pass
    
    def check_delay_risks(self) -> List[RealTimeAlert]:
        """æ£€æŸ¥å»¶è¯¯é£é™©"""
        alerts = []
        
        for shipment in self.shipments.values():
            if shipment.status in [OrderStatus.DELIVERED, OrderStatus.EXCEPTION]:
                continue
            
            vehicle = None
            if shipment.assigned_vehicle_id:
                vehicle = self.vehicles.get(shipment.assigned_vehicle_id)
            
            risk_score = shipment.get_delay_risk_score(vehicle)
            
            if risk_score > 0.5:
                severity = "Critical" if risk_score > 0.8 else "High"
                alert = RealTimeAlert(
                    alert_id=f"ALERT-DELAY-{shipment.shipment_id}",
                    alert_type=AlertType.DELAY_RISK,
                    severity=severity,
                    shipment_id=shipment.shipment_id,
                    vehicle_id=shipment.assigned_vehicle_id,
                    message=f"High delay risk detected for shipment {shipment.shipment_id}",
                    created_at=datetime.now(),
                    suggested_action="Consider rerouting or backup vehicle"
                )
                alerts.append(alert)
                self.active_alerts.append(alert)
        
        return alerts
    
    def optimize_dispatch(self, new_shipment: Shipment) -> Optional[Vehicle]:
        """æ™ºèƒ½è°ƒåº¦ä¼˜åŒ–"""
        best_vehicle = None
        best_score = -999
        
        for vehicle in self.vehicles.values():
            if vehicle.current_status != VehicleStatus.IDLE:
                continue
            
            if not vehicle.current_location:
                continue
            
            # è®¡ç®—è°ƒåº¦è¯„åˆ†
            pickup_point = GPSPoint(
                latitude=new_shipment.origin.get("lat", 0),
                longitude=new_shipment.origin.get("lng", 0),
                timestamp=datetime.now()
            )
            
            # è·ç¦»å› ç´ ï¼ˆè¶Šè¿‘è¶Šå¥½ï¼‰
            distance = vehicle.current_location.distance_to(pickup_point)
            distance_score = max(0, 100 - distance)
            
            # è½¦è¾†å®¹é‡åŒ¹é…
            cargo_weight = new_shipment.cargo_info.get("weight_kg", 0)
            capacity_score = 100 if vehicle.capacity_kg >= cargo_weight else 0
            
            # ç»¼åˆè¯„åˆ†
            score = distance_score * 0.6 + capacity_score * 0.4
            
            if score > best_score:
                best_score = score
                best_vehicle = vehicle
        
        if best_vehicle:
            # åˆ†é…è¿å•
            new_shipment.assigned_vehicle_id = best_vehicle.vehicle_id
            best_vehicle.current_status = VehicleStatus.LOADING
            best_vehicle.current_order_id = new_shipment.shipment_id
        
        return best_vehicle
    
    def get_realtime_dashboard(self) -> Dict[str, Any]:
        """è·å–å®æ—¶ä»ªè¡¨ç›˜æ•°æ®"""
        total_vehicles = len(self.vehicles)
        active_vehicles = len([v for v in self.vehicles.values() 
                             if v.current_status == VehicleStatus.IN_TRANSIT])
        
        total_shipments = len(self.shipments)
        delivered_shipments = len([s for s in self.shipments.values() 
                                  if s.status == OrderStatus.DELIVERED])
        
        critical_alerts = len([a for a in self.active_alerts 
                              if a.severity in ["High", "Critical"]])
        
        return {
            "timestamp": datetime.now().isoformat(),
            "fleet_status": {
                "total_vehicles": total_vehicles,
                "active_vehicles": active_vehicles,
                "idle_vehicles": total_vehicles - active_vehicles,
                "utilization_rate": active_vehicles / total_vehicles if total_vehicles else 0
            },
            "shipment_status": {
                "total": total_shipments,
                "delivered": delivered_shipments,
                "in_transit": len([s for s in self.shipments.values() 
                                  if s.status == OrderStatus.IN_TRANSIT]),
                "delayed": len([s for s in self.shipments.values() 
                               if s.is_delayed()])
            },
            "alerts": {
                "total_active": len(self.active_alerts),
                "critical": critical_alerts
            },
            "hot_zones": sorted(self.zone_heatmap.items(), 
                               key=lambda x: x[1], reverse=True)[:10]
        }


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    print("=" * 70)
    print("åè¿ç‰©æµ - å®æ—¶ç‰©æµè¿½è¸ªä¸è°ƒåº¦ç³»ç»Ÿ")
    print("=" * 70)
    
    # åˆ›å»ºå¹³å°
    platform = LogisticsRealTimePlatform(
        platform_id="RT-HUAYUN-001",
        platform_name="åè¿ç‰©æµå®æ—¶å¹³å°"
    )
    
    # 1. æ³¨å†Œè½¦è¾†
    print("\n[1] æ³¨å†Œè¿è¾“è½¦è¾†...")
    for i in range(5):
        vehicle = Vehicle(
            vehicle_id=f"VEH-{1000+i}",
            plate_number=f"äº¬A{80000+i}",
            vehicle_type="HeavyTruck",
            capacity_kg=20000,
            capacity_cbm=80
        )
        platform.register_vehicle(vehicle)
    print(f"å·²æ³¨å†Œ {len(platform.vehicles)} è¾†è½¦è¾†")
    
    # 2. æ³¨å†Œè¿å•
    print("\n[2] æ³¨å†Œè¿å•...")
    shipment1 = Shipment(
        shipment_id="SHIP-001",
        order_id="ORD-202502-001",
        origin={"lat": 39.9042, "lng": 116.4074, "address": "åŒ—äº¬"},
        destination={"lat": 31.2304, "lng": 121.4737, "address": "ä¸Šæµ·"},
        cargo_info={"weight_kg": 5000, "volume_cbm": 20, "type": " Electronics"},
        planned_delivery_time=datetime.now() + timedelta(hours=18)
    )
    platform.register_shipment(shipment1)
    print(f"è¿å•ID: {shipment1.shipment_id}")
    print(f"è·¯çº¿: {shipment1.origin['address']} -> {shipment1.destination['address']}")
    
    # 3. æ™ºèƒ½è°ƒåº¦
    print("\n[3] æ™ºèƒ½è°ƒåº¦...")
    vehicle = platform.optimize_dispatch(shipment1)
    if vehicle:
        print(f"åˆ†é…è½¦è¾†: {vehicle.vehicle_id}")
        print(f"è½¦ç‰Œå·: {vehicle.plate_number}")
        print(f"è½¦è¾†çŠ¶æ€: {vehicle.current_status.value}")
    
    # 4. æ¨¡æ‹ŸGPSæ›´æ–°
    print("\n[4] æ¨¡æ‹ŸGPSä½ç½®æ›´æ–°...")
    gps_message = {
        "type": "GPS_UPDATE",
        "vehicle_id": vehicle.vehicle_id,
        "lat": 39.9042,
        "lng": 116.4074,
        "speed": 80,
        "timestamp": datetime.now().isoformat()
    }
    platform.process_iot_message(gps_message)
    print(f"è½¦è¾†ä½ç½®å·²æ›´æ–°")
    
    # 5. æ¨¡æ‹Ÿæ¸©åº¦ç›‘æ§ï¼ˆå†·é“¾ï¼‰
    print("\n[5] æ¨¡æ‹Ÿå†·é“¾æ¸©åº¦ç›‘æ§...")
    temp_message = {
        "type": "TEMPERATURE_UPDATE",
        "shipment_id": shipment1.shipment_id,
        "temperature": 12.5
    }
    platform.process_iot_message(temp_message)
    
    if platform.active_alerts:
        print(f"æ£€æµ‹åˆ° {len(platform.active_alerts)} ä¸ªé¢„è­¦")
        for alert in platform.active_alerts:
            print(f"  [{alert.severity}] {alert.message}")
    
    # 6. å»¶è¯¯é£é™©æ£€æŸ¥
    print("\n[6] å»¶è¯¯é£é™©æ£€æŸ¥...")
    # æ›´æ–°è½¦è¾†ä½ç½®åˆ°è¿œç¦»ç›®çš„åœ°çš„ä½ç½®
    vehicle.current_location = GPSPoint(
        latitude=35.0,  # è¿˜åœ¨ä¸­é—´ä½ç½®
        longitude=118.0,
        timestamp=datetime.now(),
        speed=60
    )
    
    delay_alerts = platform.check_delay_risks()
    if delay_alerts:
        print(f"æ£€æµ‹åˆ° {len(delay_alerts)} ä¸ªå»¶è¯¯é£é™©")
        for alert in delay_alerts:
            print(f"  - {alert.message}")
            print(f"    å»ºè®®: {alert.suggested_action}")
    
    # 7. å®æ—¶ä»ªè¡¨ç›˜
    print("\n[7] å®æ—¶è¿è¥ä»ªè¡¨ç›˜...")
    dashboard = platform.get_realtime_dashboard()
    print(f"è½¦é˜ŸçŠ¶æ€:")
    print(f"  æ€»è½¦è¾†: {dashboard['fleet_status']['total_vehicles']}")
    print(f"  è¿è¾“ä¸­: {dashboard['fleet_status']['active_vehicles']}")
    print(f"  åˆ©ç”¨ç‡: {dashboard['fleet_status']['utilization_rate']:.1%}")
    print(f"è¿å•çŠ¶æ€:")
    print(f"  æ€»è¿å•: {dashboard['shipment_status']['total']}")
    print(f"  å»¶è¯¯: {dashboard['shipment_status']['delayed']}")
    print(f"é¢„è­¦çŠ¶æ€:")
    print(f"  æ´»è·ƒé¢„è­¦: {dashboard['alerts']['total_active']}")
    print(f"  ä¸¥é‡é¢„è­¦: {dashboard['alerts']['critical']}")
```

### 2.7 æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ

**é¡¹ç›®æŠ•å…¥**ï¼š

| æŠ•å…¥ç±»åˆ« | é‡‘é¢ï¼ˆä¸‡å…ƒï¼‰ |
|---------|------------|
| IoTè®¾å¤‡ | 2000 |
| è½¯ä»¶å¹³å° | 800 |
| äº‘æœåŠ¡ | 400 |
| å®æ–½æœåŠ¡ | 600 |
| **æ€»æŠ•èµ„** | **3800** |

**é‡åŒ–æ”¶ç›Š**ï¼š

| æ”¶ç›Šç±»åˆ« | å¹´æ”¶ç›Šï¼ˆä¸‡å…ƒï¼‰ |
|---------|--------------|
| ç©ºé©¶ç‡é™ä½ | 4500 |
| å¼‚å¸¸æŸå¤±å‡å°‘ | 1200 |
| å®¢æˆ·ç•™å­˜æå‡ | 800 |
| è¿è¥æ•ˆç‡æå‡ | 600 |
| **å¹´æ€»æ”¶ç›Š** | **7100** |

**ROI**ï¼š95%ï¼ˆå¹´æ”¶ç›Š7100ä¸‡ vs æŠ•èµ„3800ä¸‡ï¼Œå›æ”¶æœŸçº¦6ä¸ªæœˆï¼‰

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| ä½ç½®æ›´æ–°å»¶è¿Ÿ | 5åˆ†é’Ÿ | 10ç§’ | 30å€ |
| ç©ºé©¶ç‡ | 30% | 15% | -50% |
| å¼‚å¸¸å‘ç°æ—¶é—´ | 2å°æ—¶ | 3åˆ†é’Ÿ | 40å€ |
| å®¢æˆ·æ»¡æ„åº¦ | 75% | 92% | +23% |

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-02-15
