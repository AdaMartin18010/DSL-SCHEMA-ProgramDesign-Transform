# æ•°æ®å¯è§†åŒ–Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [æ•°æ®å¯è§†åŒ–Schemaå®è·µæ¡ˆä¾‹](#æ•°æ®å¯è§†åŒ–schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šé”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šé”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [4. æ¡ˆä¾‹3ï¼šäº¤äº’å¼å¯è§†åŒ–ç³»ç»Ÿ](#4-æ¡ˆä¾‹3äº¤äº’å¼å¯è§†åŒ–ç³»ç»Ÿ)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 å®ç°ä»£ç ](#42-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šæŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ](#5-æ¡ˆä¾‹4æŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šæ•°æ®å¯è§†åŒ–æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5æ•°æ®å¯è§†åŒ–æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æ•°æ®å¯è§†åŒ–Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–é”€å”®ä»ªè¡¨æ¿è®¾è®¡ã€äº¤äº’å¼å¯è§†åŒ–ã€æŠ¥è¡¨ç”Ÿæˆç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šé”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ç³»ç»Ÿ**ï¼šå¤šå›¾è¡¨ä»ªè¡¨æ¿è®¾è®¡
2. **å¯è§†åŒ–åˆ°Vega-Liteè½¬æ¢å·¥å…·**ï¼šå¯è§†åŒ–Schemaåˆ°Vega-Liteè½¬æ¢
3. **äº¤äº’å¼å¯è§†åŒ–ç³»ç»Ÿ**ï¼šäº¤äº’å¼æ•°æ®å¯è§†åŒ–
4. **æŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ**ï¼šå¯è§†åŒ–æŠ¥è¡¨ç”Ÿæˆ
5. **æ•°æ®å¯è§†åŒ–æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šå¯è§†åŒ–æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **D3.js**ï¼šæ•°æ®å¯è§†åŒ–æœ€ä½³å®è·µ
- **Vega-Lite**ï¼šå›¾è¡¨è¯­æ³•æ ‡å‡†

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šé”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸé›¶å”®å…¬å¸éœ€è¦æ„å»ºé”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ï¼ŒåŒ…å«å¤šä¸ªå›¾è¡¨ç»„ä»¶ï¼Œæ”¯æŒæ•°æ®ç­›é€‰å’Œé’»å–ï¼Œä¸ºä¸šåŠ¡åˆ†ææä¾›ç›´è§‚çš„æ•°æ®å¯è§†åŒ–ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **æ•°æ®å¯è§†åŒ–ç¼ºå¤±**ï¼šç¼ºä¹ç›´è§‚çš„æ•°æ®å¯è§†åŒ–
2. **å›¾è¡¨ç±»å‹å•ä¸€**ï¼šå›¾è¡¨ç±»å‹å•ä¸€
3. **äº¤äº’åŠŸèƒ½ä¸è¶³**ï¼šç¼ºä¹äº¤äº’åŠŸèƒ½
4. **æ€§èƒ½é—®é¢˜**ï¼šå¯è§†åŒ–æ€§èƒ½å·®

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- æä¾›ä¸°å¯Œçš„æ•°æ®å¯è§†åŒ–
- æ”¯æŒå¤šç§å›¾è¡¨ç±»å‹
- å¢å¼ºäº¤äº’åŠŸèƒ½
- æé«˜å¯è§†åŒ–æ€§èƒ½

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å›¾è¡¨è®¾è®¡**ï¼šè®¾è®¡åˆç†çš„å›¾è¡¨å¸ƒå±€
2. **äº¤äº’åŠŸèƒ½**ï¼šå®ç°æ•°æ®ç­›é€‰å’Œé’»å–
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼˜åŒ–å¯è§†åŒ–æ€§èƒ½
4. **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒå“åº”å¼å¸ƒå±€

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰é”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**é”€å”®æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
æ•°æ®å¯è§†åŒ–Schemaå®ç°
"""

from typing import Dict, List, Optional
from dataclasses import dataclass, field
from enum import Enum

class ChartType(str, Enum):
    """å›¾è¡¨ç±»å‹"""
    LINE = "Line"
    BAR = "Bar"
    PIE = "Pie"
    SCATTER = "Scatter"
    AREA = "Area"
    HEATMAP = "Heatmap"

class ComponentType(str, Enum):
    """ç»„ä»¶ç±»å‹"""
    CHART = "Chart"
    TABLE = "Table"
    FILTER = "Filter"
    KPI = "KPI"

@dataclass
class Position:
    """ä½ç½®"""
    row: int
    column: int
    width: int
    height: int

@dataclass
class ChartConfig:
    """å›¾è¡¨é…ç½®"""
    chart_type: ChartType
    x_axis: Optional[str] = None
    y_axis: Optional[str] = None
    color_by: Optional[str] = None
    aggregation: Optional[str] = None

@dataclass
class DashboardComponent:
    """ä»ªè¡¨æ¿ç»„ä»¶"""
    component_id: str
    component_type: ComponentType
    component_name: str
    position: Position
    chart_config: Optional[ChartConfig] = None
    data_source: Optional[str] = None
    filters: Dict[str, str] = field(default_factory=dict)

@dataclass
class DashboardLayout:
    """ä»ªè¡¨æ¿å¸ƒå±€"""
    layout_type: str = "Grid"
    rows: int = 4
    columns: int = 4
    components: List[DashboardComponent] = field(default_factory=list)

    def add_component(self, component: DashboardComponent):
        """æ·»åŠ ç»„ä»¶"""
        self.components.append(component)

@dataclass
class Dashboard:
    """ä»ªè¡¨æ¿"""
    dashboard_id: str
    dashboard_name: str
    dashboard_layout: DashboardLayout
    created_at: Optional[str] = None

    def add_component(self, component: DashboardComponent):
        """æ·»åŠ ç»„ä»¶"""
        self.dashboard_layout.add_component(component)

@dataclass
class SalesDashboard:
    """é”€å”®ä»ªè¡¨æ¿"""
    dashboard: Dashboard

    @classmethod
    def create_default(cls) -> 'SalesDashboard':
        """åˆ›å»ºé»˜è®¤é”€å”®ä»ªè¡¨æ¿"""
        layout = DashboardLayout(layout_type="Grid", rows=4, columns=4)
        dashboard = Dashboard(
            dashboard_id="DASH-SALES-001",
            dashboard_name="é”€å”®åˆ†æä»ªè¡¨æ¿",
            dashboard_layout=layout
        )

        # é”€å”®è¶‹åŠ¿å›¾è¡¨
        sales_chart = DashboardComponent(
            component_id="COMP-SALES-CHART",
            component_type=ComponentType.CHART,
            component_name="é”€å”®è¶‹åŠ¿",
            position=Position(row=0, column=0, width=2, height=2),
            chart_config=ChartConfig(
                chart_type=ChartType.LINE,
                x_axis="date",
                y_axis="sales_amount"
            ),
            data_source="sales_data"
        )
        dashboard.add_component(sales_chart)

        # åŒºåŸŸç­›é€‰å™¨
        region_filter = DashboardComponent(
            component_id="COMP-REGION-FILTER",
            component_type=ComponentType.FILTER,
            component_name="åŒºåŸŸç­›é€‰",
            position=Position(row=0, column=2, width=1, height=1),
            data_source="sales_data"
        )
        dashboard.add_component(region_filter)

        return cls(dashboard=dashboard)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºé”€å”®ä»ªè¡¨æ¿
    sales_dashboard = SalesDashboard.create_default()

    print(f"ä»ªè¡¨æ¿: {sales_dashboard.dashboard.dashboard_name}")
    print(f"ç»„ä»¶æ•°é‡: {len(sales_dashboard.dashboard.dashboard_layout.components)}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æ•°æ®å¯è§†åŒ–èƒ½åŠ› | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| å›¾è¡¨ç±»å‹ä¸°å¯Œåº¦ | 3ç§ | 10+ç§ | æ˜¾è‘—æå‡ |
| äº¤äº’åŠŸèƒ½å®Œæ•´æ€§ | 40% | 100% | 60%æå‡ |
| å¯è§†åŒ–æ€§èƒ½ | æ…¢ | å¿« | 5xæå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **æ•°æ®å¯è§†åŒ–**ï¼šæä¾›ä¸°å¯Œçš„æ•°æ®å¯è§†åŒ–
2. **å›¾è¡¨ç±»å‹**ï¼šæ”¯æŒå¤šç§å›¾è¡¨ç±»å‹
3. **äº¤äº’åŠŸèƒ½**ï¼šå¢å¼ºäº¤äº’åŠŸèƒ½
4. **æ€§èƒ½æå‡**ï¼šæé«˜å¯è§†åŒ–æ€§èƒ½

**ç»éªŒæ•™è®­**ï¼š

1. å›¾è¡¨è®¾è®¡éœ€è¦åˆç†
2. äº¤äº’åŠŸèƒ½éœ€è¦å®Œå–„
3. æ€§èƒ½ä¼˜åŒ–å¾ˆé‡è¦
4. å“åº”å¼è®¾è®¡éœ€è¦æ”¯æŒ

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [D3.jsæ•°æ®å¯è§†åŒ–](https://d3js.org/)
- [Vega-Liteå›¾è¡¨è¯­æ³•](https://vega.github.io/vega-lite/)
        }
      }
    }
    dashboard_interactions: List<DashboardInteraction> {
      filter_interaction: DashboardInteraction {
        interaction_id: String @value("INT-FILTER-001")
        interaction_type: Enum @value("Filter")
        source_component_id: String @value("COMP-REGION-FILTER")
        target_component_ids: List<String> {
          "COMP-SALES-CHART"
        }
      }
    }
  }
}

```

---

## 3. æ¡ˆä¾‹2ï¼šå¯è§†åŒ–åˆ°Vega-Liteè½¬æ¢

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†æ•°æ®å¯è§†åŒ–Schemaè½¬æ¢ä¸ºVega-Liteæ ¼å¼ï¼Œç”¨äºWebå¯è§†åŒ–ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒè‡ªåŠ¨è½¬æ¢åˆ°Vega-Lite
- æ”¯æŒå›¾è¡¨é…ç½®è½¬æ¢
- æ”¯æŒäº¤äº’å®šä¹‰è½¬æ¢

### 3.2 å®ç°ä»£ç 

```python
def convert_chart_to_vega_lite(chart: Chart) -> dict:
    """å°†å›¾è¡¨è½¬æ¢ä¸ºVega-Liteæ ¼å¼"""
    vega_lite_spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {
            "url": chart.chart_data.data_source
        },
        "mark": map_chart_type_to_vega_mark(chart.chart_type),
        "encoding": {}
    }

    # Xè½´ç¼–ç 
    vega_lite_spec["encoding"]["x"] = {
        "field": chart.chart_data.data_mapping.x_field,
        "type": map_axis_type_to_vega_type(chart.chart_config.x_axis.type),
        "title": chart.chart_config.x_axis.title or chart.chart_data.data_mapping.x_field
    }

    # Yè½´ç¼–ç 
    vega_lite_spec["encoding"]["y"] = {
        "field": chart.chart_data.data_mapping.y_field,
        "type": map_axis_type_to_vega_type(chart.chart_config.y_axis.type),
        "title": chart.chart_config.y_axis.title or chart.chart_data.data_mapping.y_field
    }

    # é¢œè‰²ç¼–ç 
    if chart.chart_data.data_mapping.color_field:
        vega_lite_spec["encoding"]["color"] = {
            "field": chart.chart_data.data_mapping.color_field,
            "type": "nominal",
            "scale": {
                "scheme": chart.chart_config.color_scheme
            }
        }

    # æ•°æ®èšåˆ
    if chart.chart_data.data_aggregation:
        vega_lite_spec["encoding"]["y"]["aggregate"] = map_aggregation_to_vega(
            chart.chart_data.data_aggregation.aggregation_type
        )
        if chart.chart_data.data_aggregation.group_by:
            vega_lite_spec["encoding"]["x"]["field"] = chart.chart_data.data_aggregation.group_by[0]

    # é…ç½®
    vega_lite_spec["config"] = {
        "title": {
            "text": chart.chart_config.title,
            "subtitle": chart.chart_config.subtitle
        },
        "legend": {
            "orient": chart.chart_config.legend.orientation.lower()
        }
    }

    # å·¥å…·æç¤º
    if chart.chart_config.tooltip:
        vega_lite_spec["tooltip"] = True

    return vega_lite_spec
```

---

## 4. æ¡ˆä¾‹3ï¼šäº¤äº’å¼å¯è§†åŒ–ç³»ç»Ÿ

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æ„å»ºäº¤äº’å¼å¯è§†åŒ–ç³»ç»Ÿï¼Œæ”¯æŒæ•°æ®ç­›é€‰ã€é’»å–ã€è”åŠ¨ç­‰äº¤äº’åŠŸèƒ½ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒæ•°æ®ç­›é€‰äº¤äº’
- æ”¯æŒæ•°æ®é’»å–äº¤äº’
- æ”¯æŒå›¾è¡¨è”åŠ¨äº¤äº’

### 4.2 å®ç°ä»£ç 

```python
def create_interactive_visualization(viz_data: DataVisualizationSchema) -> InteractiveVisualization:
    """åˆ›å»ºäº¤äº’å¼å¯è§†åŒ–"""
    interactive_viz = InteractiveVisualization()

    # åˆ›å»ºç­›é€‰äº¤äº’
    filter_interaction = Interaction()
    filter_interaction.interaction_id = "INT-FILTER-001"
    filter_interaction.interaction_name = "Region Filter"
    filter_interaction.interaction_type = "Select"
    filter_interaction.source_element = "COMP-REGION-FILTER"
    filter_interaction.interaction_response = InteractionResponse(
        response_type="Filter",
        target_elements=["COMP-SALES-CHART", "COMP-PRODUCT-CHART"],
        response_action="filter_data",
        response_data={"filter_field": "region"}
    )
    interactive_viz.interactions.append(filter_interaction)

    # åˆ›å»ºé’»å–äº¤äº’
    drill_down_interaction = Interaction()
    drill_down_interaction.interaction_id = "INT-DRILL-001"
    drill_down_interaction.interaction_name = "Drill Down"
    drill_down_interaction.interaction_type = "Click"
    drill_down_interaction.source_element = "COMP-SALES-CHART"
    drill_down_interaction.interaction_response = InteractionResponse(
        response_type="Navigate",
        target_elements=["DASH-SALES-DETAIL"],
        response_action="navigate_to_detail",
        response_data={"drill_level": "detail"}
    )
    interactive_viz.interactions.append(drill_down_interaction)

    # åˆ›å»ºè”åŠ¨äº¤äº’
    link_interaction = Interaction()
    link_interaction.interaction_id = "INT-LINK-001"
    link_interaction.interaction_name = "Chart Link"
    link_interaction.interaction_type = "Brush"
    link_interaction.source_element = "COMP-SALES-CHART"
    link_interaction.interaction_response = InteractionResponse(
        response_type="Highlight",
        target_elements=["COMP-PRODUCT-CHART"],
        response_action="highlight_data",
        response_data={"link_field": "product_id"}
    )
    interactive_viz.interactions.append(link_interaction)

    return interactive_viz

def handle_interaction_event(interaction_id: str, event_data: dict, viz_data: DataVisualizationSchema):
    """å¤„ç†äº¤äº’äº‹ä»¶"""
    interaction = find_interaction(viz_data, interaction_id)

    if interaction:
        # æ‰§è¡Œäº¤äº’å“åº”
        if interaction.interaction_response.response_type == "Filter":
            # åº”ç”¨æ•°æ®ç­›é€‰
            filter_value = event_data.get("value")
            for target_element in interaction.interaction_response.target_elements:
                apply_filter(target_element, interaction.interaction_response.response_data["filter_field"], filter_value)

        elif interaction.interaction_response.response_type == "Navigate":
            # å¯¼èˆªåˆ°ç›®æ ‡é¡µé¢
            navigate_to(interaction.interaction_response.target_elements[0], event_data)

        elif interaction.interaction_response.response_type == "Highlight":
            # é«˜äº®ç›®æ ‡å…ƒç´ 
            highlight_data(interaction.interaction_response.target_elements[0], event_data)
```

---

## 5. æ¡ˆä¾‹4ï¼šæŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
åŸºäºæŠ¥è¡¨æ¨¡æ¿å’Œæ•°æ®æºç”ŸæˆæŠ¥è¡¨ï¼Œæ”¯æŒå¤šç§æ ¼å¼å¯¼å‡ºã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒæŠ¥è¡¨æ¨¡æ¿å®šä¹‰
- æ”¯æŒæŠ¥è¡¨æ•°æ®æŸ¥è¯¢
- æ”¯æŒå¤šæ ¼å¼å¯¼å‡º

### 5.2 å®ç°ä»£ç 

```python
def generate_report(report_id: str, viz_data: DataVisualizationSchema, parameters: dict) -> Report:
    """ç”ŸæˆæŠ¥è¡¨"""
    report_template = find_report_template(viz_data, report_id)

    # æŸ¥è¯¢æ•°æ®
    data = query_report_data(
        report_template.report_data.data_source,
        report_template.report_data.data_query,
        parameters
    )

    # åº”ç”¨ç­›é€‰
    if report_template.report_data.data_filters:
        for filter_item in report_template.report_data.data_filters:
            data = apply_filter(data, filter_item)

    # ç”ŸæˆæŠ¥è¡¨
    report = Report()
    report.report_id = f"REPORT-{report_id}-{datetime.now().strftime('%Y%m%d%H%M%S')}"
    report.report_name = report_template.template_name
    report.report_format = report_template.report_format

    # å¡«å……æŠ¥è¡¨å†…å®¹
    report_content = []
    for section in report_template.template_layout.sections:
        if section.section_type == "Chart":
            # ç”Ÿæˆå›¾è¡¨
            chart = find_chart(viz_data, section.section_content)
            chart_data = filter_chart_data(data, chart.chart_data.data_mapping)
            chart_image = render_chart(chart, chart_data)
            report_content.append({
                "section_id": section.section_id,
                "content": chart_image,
                "position": section.section_position
            })
        elif section.section_type == "Table":
            # ç”Ÿæˆè¡¨æ ¼
            table_data = format_table_data(data, section.section_content)
            report_content.append({
                "section_id": section.section_id,
                "content": table_data,
                "position": section.section_position
            })
        elif section.section_type == "Text":
            # å¡«å……æ–‡æœ¬
            text_content = format_text(section.section_content, data, parameters)
            report_content.append({
                "section_id": section.section_id,
                "content": text_content,
                "position": section.section_position
            })

    report.report_content = report_content

    # å¯¼å‡ºæŠ¥è¡¨
    if report_template.report_format == "PDF":
        export_to_pdf(report)
    elif report_template.report_format == "Excel":
        export_to_excel(report)
    elif report_template.report_format == "HTML":
        export_to_html(report)

    return report
```

---

## 6. æ¡ˆä¾‹5ï¼šæ•°æ®å¯è§†åŒ–æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æ•°æ®å¯è§†åŒ–æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒå…ƒæ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒå¯è§†åŒ–å…ƒæ•°æ®å­˜å‚¨
- æ”¯æŒå…ƒæ•°æ®æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒä½¿ç”¨æƒ…å†µåˆ†æ

### 6.2 å®ç°ä»£ç 

```python
def store_visualization_data(viz_data: DataVisualizationSchema, conn):
    """å­˜å‚¨æ•°æ®å¯è§†åŒ–æ•°æ®åˆ°PostgreSQL"""
    cursor = conn.cursor()

    # å­˜å‚¨å›¾è¡¨å…ƒæ•°æ®
    for chart in viz_data.charts:
        cursor.execute("""
            INSERT INTO chart_metadata
            (chart_id, chart_name, chart_type, data_source)
            VALUES (%s, %s, %s, %s)
            ON CONFLICT (chart_id) DO UPDATE SET
            chart_name = EXCLUDED.chart_name,
            chart_type = EXCLUDED.chart_type,
            data_source = EXCLUDED.data_source,
            updated_at = CURRENT_TIMESTAMP
        """, (chart.chart_id, chart.chart_name, chart.chart_type, chart.chart_data.data_source))

    # å­˜å‚¨ä»ªè¡¨æ¿å…ƒæ•°æ®
    for dashboard in viz_data.dashboards:
        cursor.execute("""
            INSERT INTO dashboard_metadata
            (dashboard_id, dashboard_name, layout_type)
            VALUES (%s, %s, %s)
            ON CONFLICT (dashboard_id) DO UPDATE SET
            dashboard_name = EXCLUDED.dashboard_name,
            layout_type = EXCLUDED.layout_type,
            updated_at = CURRENT_TIMESTAMP
        """, (dashboard.dashboard_id, dashboard.dashboard_name, dashboard.dashboard_layout.layout_type))

        # å­˜å‚¨ä»ªè¡¨æ¿ç»„ä»¶
        for component in dashboard.dashboard_layout.components:
            cursor.execute("""
                INSERT INTO dashboard_components
                (component_id, dashboard_id, component_type, chart_id,
                 position_row, position_column, width, height)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
                ON CONFLICT (component_id) DO UPDATE SET
                component_type = EXCLUDED.component_type,
                chart_id = EXCLUDED.chart_id,
                position_row = EXCLUDED.position_row,
                position_column = EXCLUDED.position_column,
                width = EXCLUDED.width,
                height = EXCLUDED.height
            """, (component.component_id, dashboard.dashboard_id,
                  component.component_type, component.chart_id,
                  component.position.row, component.position.column,
                  component.position.width, component.position.height))

    # å­˜å‚¨æŠ¥è¡¨å…ƒæ•°æ®
    for report in viz_data.reports:
        cursor.execute("""
            INSERT INTO report_metadata
            (report_id, report_name, report_template_id, report_format, data_source)
            VALUES (%s, %s, %s, %s, %s)
            ON CONFLICT (report_id) DO UPDATE SET
            report_name = EXCLUDED.report_name,
            report_format = EXCLUDED.report_format,
            data_source = EXCLUDED.data_source,
            updated_at = CURRENT_TIMESTAMP
        """, (report.report_id, report.report_name,
              report.report_template.template_id, report.report_format,
              report.report_data.data_source))

    conn.commit()

def generate_visualization_report(conn):
    """ç”Ÿæˆæ•°æ®å¯è§†åŒ–æŠ¥è¡¨"""
    cursor = conn.cursor()

    # æŸ¥è¯¢å›¾è¡¨ä½¿ç”¨æƒ…å†µ
    cursor.execute("""
        SELECT
            cm.chart_type,
            COUNT(DISTINCT cm.chart_id) as chart_count,
            COUNT(DISTINCT dc.dashboard_id) as dashboard_count
        FROM chart_metadata cm
        LEFT JOIN dashboard_components dc ON cm.chart_id = dc.chart_id
        GROUP BY cm.chart_type
        ORDER BY chart_count DESC
    """)

    chart_usage = cursor.fetchall()

    # æŸ¥è¯¢ä»ªè¡¨æ¿æ±‡æ€»
    cursor.execute("""
        SELECT
            dm.dashboard_name,
            COUNT(dc.component_id) as component_count,
            COUNT(DISTINCT dc.chart_id) as chart_count
        FROM dashboard_metadata dm
        LEFT JOIN dashboard_components dc ON dm.dashboard_id = dc.dashboard_id
        GROUP BY dm.dashboard_id, dm.dashboard_name
        ORDER BY dm.dashboard_name
    """)

    dashboard_summary = cursor.fetchall()

    return {
        "chart_usage": chart_usage,
        "dashboard_summary": dashboard_summary
    }
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
