# å»ºç­‘ä¿¡æ¯æ¨¡å‹Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [å»ºç­‘ä¿¡æ¯æ¨¡å‹Schemaå®è·µæ¡ˆä¾‹](#å»ºç­‘ä¿¡æ¯æ¨¡å‹schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šå»ºç­‘è®¾è®¡ç®¡ç†](#2-æ¡ˆä¾‹1å»ºç­‘è®¾è®¡ç®¡ç†)
    - [2.1 åœºæ™¯æè¿°](#21-åœºæ™¯æè¿°)
    - [2.2 Schemaå®šä¹‰](#22-schemaå®šä¹‰)
    - [2.3 å®ç°ä»£ç ](#23-å®ç°ä»£ç )
  - [3. æ¡ˆä¾‹2ï¼šIFCæ–‡ä»¶è§£æå’Œå­˜å‚¨](#3-æ¡ˆä¾‹2ifcæ–‡ä»¶è§£æå’Œå­˜å‚¨)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
    - [3.3 å®ç°ä»£ç ](#33-å®ç°ä»£ç )
  - [4. æ¡ˆä¾‹3ï¼šæ–½å·¥ç®¡ç†](#4-æ¡ˆä¾‹3æ–½å·¥ç®¡ç†)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
    - [4.3 å®ç°ä»£ç ](#43-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šCOBieæ•°æ®ç”Ÿæˆ](#5-æ¡ˆä¾‹4cobieæ•°æ®ç”Ÿæˆ)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 Schemaå®šä¹‰](#52-schemaå®šä¹‰)
    - [5.3 å®ç°ä»£ç ](#53-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šgbXMLèƒ½è€—åˆ†æ](#6-æ¡ˆä¾‹5gbxmlèƒ½è€—åˆ†æ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 Schemaå®šä¹‰](#62-schemaå®šä¹‰)
    - [6.3 å®ç°ä»£ç ](#63-å®ç°ä»£ç )
  - [7. æ¡ˆä¾‹6ï¼šè¿ç»´ç®¡ç†](#7-æ¡ˆä¾‹6è¿ç»´ç®¡ç†)
    - [7.1 åœºæ™¯æè¿°](#71-åœºæ™¯æè¿°)
    - [7.2 Schemaå®šä¹‰](#72-schemaå®šä¹‰)
    - [7.3 å®ç°ä»£ç ](#73-å®ç°ä»£ç )
  - [8. æ¡ˆä¾‹7ï¼šBIMæ•°æ®æŸ¥è¯¢å’Œåˆ†æ](#8-æ¡ˆä¾‹7bimæ•°æ®æŸ¥è¯¢å’Œåˆ†æ)
    - [8.1 åœºæ™¯æè¿°](#81-åœºæ™¯æè¿°)
    - [8.2 å®ç°ä»£ç ](#82-å®ç°ä»£ç )
  - [9. æ¡ˆä¾‹8ï¼šæ™ºèƒ½å»ºç­‘è¿è¥ç³»ç»Ÿ](#9-æ¡ˆä¾‹8æ™ºèƒ½å»ºç­‘è¿è¥ç³»ç»Ÿ)
    - [9.1 åœºæ™¯æè¿°](#91-åœºæ™¯æè¿°)
    - [9.2 Schemaå®šä¹‰](#92-schemaå®šä¹‰)
    - [9.3 å®ç°ä»£ç ](#93-å®ç°ä»£ç )
  - [10. æ¡ˆä¾‹9ï¼šå»ºç­‘èƒ½è€—ä¼˜åŒ–ç³»ç»Ÿ](#10-æ¡ˆä¾‹9å»ºç­‘èƒ½è€—ä¼˜åŒ–ç³»ç»Ÿ)
    - [10.1 åœºæ™¯æè¿°](#101-åœºæ™¯æè¿°)
    - [10.2 Schemaå®šä¹‰](#102-schemaå®šä¹‰)
    - [10.3 å®ç°ä»£ç ](#103-å®ç°ä»£ç )
  - [11. æ¡ˆä¾‹10ï¼šå»ºç­‘ç»´æŠ¤ç®¡ç†ç³»ç»Ÿ](#11-æ¡ˆä¾‹10å»ºç­‘ç»´æŠ¤ç®¡ç†ç³»ç»Ÿ)
    - [11.1 åœºæ™¯æè¿°](#111-åœºæ™¯æè¿°)
    - [11.2 Schemaå®šä¹‰](#112-schemaå®šä¹‰)
    - [11.3 å®ç°ä»£ç ](#113-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å»ºç­‘ä¿¡æ¯æ¨¡å‹Schemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–å»ºç­‘è®¾è®¡ã€IFCæ–‡ä»¶å¤„ç†ã€æ–½å·¥ç®¡ç†ã€COBieæ•°æ®ç”Ÿæˆã€gbXMLèƒ½è€—åˆ†æã€è¿ç»´ç®¡ç†ç­‰åœºæ™¯ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šå»ºç­‘è®¾è®¡ç®¡ç†

### 2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘è®¾è®¡å…¬å¸éœ€è¦ç®¡ç†å»ºç­‘é¡¹ç›®çš„è®¾è®¡æ•°æ®ï¼ŒåŒ…æ‹¬å»ºç­‘å…ƒç´ ã€ç©ºé—´å®šä¹‰ã€ææ–™å±æ€§ç­‰ï¼Œç¡®ä¿è®¾è®¡æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯è¿½æº¯æ€§ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦ç®¡ç†å¤šç§å»ºç­‘å…ƒç´ ç±»å‹ï¼ˆå¢™ã€æŸ±ã€æ¢ã€æ¿ã€é—¨ã€çª—ç­‰ï¼‰
- éœ€è¦å®šä¹‰ç©ºé—´å…³ç³»ï¼ˆæ¥¼å±‚ã€æˆ¿é—´ã€åŒºåŸŸï¼‰
- éœ€è¦ç®¡ç†ææ–™å±æ€§å’Œå‡ ä½•ä¿¡æ¯
- éœ€è¦æ”¯æŒIFCæ ‡å‡†æ•°æ®æ ¼å¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIM_Schemaå®šä¹‰å»ºç­‘è®¾è®¡æ•°æ®ç»“æ„ï¼Œå®ç°å»ºç­‘å…ƒç´ çš„åˆ›å»ºã€ç©ºé—´çš„å®šä¹‰ã€ææ–™çš„ç®¡ç†ç­‰åŠŸèƒ½ã€‚

### 2.2 Schemaå®šä¹‰

**å»ºç­‘è®¾è®¡ç®¡ç†Schema**ï¼š

```json
{
  "project_id": "PROJ20250121001",
  "project_name": "åŠå…¬æ¥¼A",
  "building_elements": [
    {
      "element_id": "ELEM001",
      "element_type": "Wall",
      "global_id": "3xK8j9L2mN4pQ6rS8tU0vW",
      "name": "å¤–å¢™-ä¸œä¾§",
      "description": "é’¢ç­‹æ··å‡åœŸå¤–å¢™",
      "tag": "W-001",
      "geometry": {
        "placement": {
          "location": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "axis": {
            "x": 0.0,
            "y": 1.0,
            "z": 0.0
          }
        },
        "representation": {
          "representation_type": "SweptSolid",
          "shape": {
            "dimensions": {
              "length": 20.0,
              "height": 3.0,
              "thickness": 0.3
            },
            "volume": 18.0,
            "area": 60.0
          }
        }
      },
      "material": {
        "material_id": "MAT001",
        "material_name": "C30æ··å‡åœŸ",
        "material_type": "Concrete",
        "properties": {
          "density": 2400.0,
          "thermal_conductivity": 1.51,
          "specific_heat": 920.0,
          "strength": 30.0
        }
      }
    },
    {
      "element_id": "ELEM002",
      "element_type": "Door",
      "global_id": "4yL9k0M3nO5qR7sT9uV1wX",
      "name": "ä¸»å…¥å£é—¨",
      "description": "åŒæ‰‡ç»ç’ƒé—¨",
      "tag": "D-001",
      "geometry": {
        "placement": {
          "location": {
            "x": 10.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        "representation": {
          "representation_type": "BRep",
          "shape": {
            "dimensions": {
              "width": 2.0,
              "height": 2.5,
              "thickness": 0.1
            },
            "area": 5.0
          }
        }
      }
    }
  ],
  "spaces": [
    {
      "space_id": "SPACE001",
      "global_id": "5zM0l1N4oP6rS8tU0vW2xY",
      "space_name": "åŠå…¬å®¤101",
      "space_type": "Room",
      "long_name": "ä¸€å±‚åŠå…¬å®¤101",
      "description": "æ ‡å‡†åŠå…¬å®¤",
      "geometry": {
        "placement": {
          "location": {
            "x": 5.0,
            "y": 5.0,
            "z": 0.0
          }
        },
        "representation": {
          "representation_type": "BRep",
          "shape": {
            "volume": 60.0,
            "area": 20.0
          }
        }
      },
      "floor": "F1",
      "elevation": 0.0,
      "height": 3.0
    }
  ],
  "floors": [
    {
      "floor_id": "FLOOR001",
      "global_id": "6aN1m2O5pQ7sT9uV1wX3yZ",
      "floor_name": "ä¸€å±‚",
      "elevation": 0.0,
      "height": 3.0
    }
  ]
}
```

### 2.3 å®ç°ä»£ç 

**å®Œæ•´çš„å»ºç­‘è®¾è®¡ç®¡ç†å®ç°**ï¼š

```python
import logging
from typing import Dict, List
from datetime import datetime
from bim_schema.transformation import BIMStorage

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹1ï¼šå»ºç­‘è®¾è®¡ç®¡ç†
def case1_building_design_management():
    """æ¡ˆä¾‹1ï¼šå»ºç­‘è®¾è®¡ç®¡ç†"""

    # 1. åˆå§‹åŒ–BIMå­˜å‚¨
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "bim_db",
        "user": "bim_user",
        "password": "bim_password"
    }
    storage = BIMStorage(db_config)
    storage.connect()
    storage.create_tables()

    # 2. åˆ›å»ºå»ºç­‘é¡¹ç›®
    project_data = {
        "project_id": "PROJ20250121001",
        "project_name": "åŠå…¬æ¥¼A",
        "building_elements": [
            {
                "element_id": "ELEM001",
                "element_type": "Wall",
                "global_id": "3xK8j9L2mN4pQ6rS8tU0vW",
                "name": "å¤–å¢™-ä¸œä¾§",
                "description": "é’¢ç­‹æ··å‡åœŸå¤–å¢™",
                "tag": "W-001",
                "geometry": {
                    "placement": {
                        "location": {"x": 0.0, "y": 0.0, "z": 0.0},
                        "axis": {"x": 0.0, "y": 1.0, "z": 0.0}
                    },
                    "representation": {
                        "representation_type": "SweptSolid",
                        "shape": {
                            "dimensions": {
                                "length": 20.0,
                                "height": 3.0,
                                "thickness": 0.3
                            },
                            "volume": 18.0,
                            "area": 60.0
                        }
                    }
                },
                "material": {
                    "material_id": "MAT001",
                    "material_name": "C30æ··å‡åœŸ",
                    "material_type": "Concrete",
                    "properties": {
                        "density": 2400.0,
                        "thermal_conductivity": 1.51,
                        "specific_heat": 920.0,
                        "strength": 30.0
                    }
                }
            }
        ],
        "spaces": [
            {
                "space_id": "SPACE001",
                "global_id": "5zM0l1N4oP6rS8tU0vW2xY",
                "space_name": "åŠå…¬å®¤101",
                "space_type": "Room",
                "long_name": "ä¸€å±‚åŠå…¬å®¤101",
                "description": "æ ‡å‡†åŠå…¬å®¤",
                "geometry": {
                    "placement": {
                        "location": {"x": 5.0, "y": 5.0, "z": 0.0}
                    },
                    "representation": {
                        "representation_type": "BRep",
                        "shape": {
                            "volume": 60.0,
                            "area": 20.0
                        }
                    }
                },
                "floor": "F1",
                "elevation": 0.0,
                "height": 3.0
            }
        ],
        "floors": [
            {
                "floor_id": "FLOOR001",
                "global_id": "6aN1m2O5pQ7sT9uV1wX3yZ",
                "floor_name": "ä¸€å±‚",
                "elevation": 0.0,
                "height": 3.0
            }
        ]
    }

    # 3. å­˜å‚¨å»ºç­‘å…ƒç´ 
    for element in project_data["building_elements"]:
        element_id = storage.store_building_element(element)
        logger.info(f"Stored building element: {element_id}")

    # 4. å­˜å‚¨ç©ºé—´
    for space in project_data["spaces"]:
        space_id = storage.store_space(space)
        logger.info(f"Stored space: {space_id}")

    # 5. æŸ¥è¯¢å»ºç­‘å…ƒç´ 
    walls = storage.query_building_elements("Wall")
    logger.info(f"Found {len(walls)} walls")

    # 6. æŸ¥è¯¢ç©ºé—´
    rooms = storage.query_spaces("Room")
    logger.info(f"Found {len(rooms)} rooms")

    return project_data

# è¿è¡Œæ¡ˆä¾‹1
if __name__ == "__main__":
    case1_building_design_management()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Stored building element: 1
Stored space: 1
Found 1 walls
Found 1 rooms
```

---

## 3. æ¡ˆä¾‹2ï¼šIFCæ–‡ä»¶è§£æå’Œå­˜å‚¨

### 3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘å…¬å¸éœ€è¦ä»IFCæ–‡ä»¶ä¸­æå–å»ºç­‘ä¿¡æ¯ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œä»¥ä¾¿åç»­æŸ¥è¯¢å’Œåˆ†æã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- IFCæ–‡ä»¶æ ¼å¼å¤æ‚ï¼Œéœ€è¦æ­£ç¡®è§£æ
- IFCæ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œéœ€è¦é«˜æ•ˆå¤„ç†
- éœ€è¦æå–å…³é”®ä¿¡æ¯ï¼ˆå»ºç­‘å…ƒç´ ã€ç©ºé—´ã€ææ–™ç­‰ï¼‰
- éœ€è¦å¤„ç†IFCå®ä½“ä¹‹é—´çš„å…³ç³»

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨IFCParserè§£æIFCæ–‡ä»¶ï¼Œæå–å»ºç­‘å…ƒç´ ã€ç©ºé—´ã€ææ–™ç­‰ä¿¡æ¯ï¼Œå­˜å‚¨åˆ°PostgreSQLæ•°æ®åº“ä¸­ã€‚

### 3.2 Schemaå®šä¹‰

**IFCæ–‡ä»¶è§£æSchema**ï¼š

```json
{
  "ifc_file": {
    "file_path": "/data/building.ifc",
    "file_name": "building.ifc",
    "file_size": 5242880,
    "file_schema": "IFC4",
    "file_author": "Architect A",
    "file_organization": "ABC Architecture",
    "creation_date": "2025-01-21T10:00:00Z"
  },
  "ifc_entities": [
    {
      "entity_id": 1,
      "entity_type": "IFCWALL",
      "global_id": "3xK8j9L2mN4pQ6rS8tU0vW",
      "name": "å¤–å¢™-ä¸œä¾§",
      "description": "é’¢ç­‹æ··å‡åœŸå¤–å¢™",
      "tag": "W-001"
    },
    {
      "entity_id": 2,
      "entity_type": "IFCSPACE",
      "global_id": "5zM0l1N4oP6rS8tU0vW2xY",
      "name": "åŠå…¬å®¤101",
      "description": "æ ‡å‡†åŠå…¬å®¤"
    }
  ]
}
```

### 3.3 å®ç°ä»£ç 

**å®Œæ•´çš„IFCæ–‡ä»¶è§£æå’Œå­˜å‚¨å®ç°**ï¼š

```python
import logging
from typing import Dict
from bim_schema.transformation import IFCParser, BIMStorage

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹2ï¼šIFCæ–‡ä»¶è§£æå’Œå­˜å‚¨
def case2_ifc_file_parsing():
    """æ¡ˆä¾‹2ï¼šIFCæ–‡ä»¶è§£æå’Œå­˜å‚¨"""

    # 1. åˆå§‹åŒ–IFCè§£æå™¨
    ifc_parser = IFCParser()

    # 2. è§£æIFCæ–‡ä»¶
    ifc_file_path = "/data/building.ifc"
    try:
        ifc_data = ifc_parser.parse_ifc_file(ifc_file_path)
        logger.info(f"Parsed IFC file: {ifc_data['file_path']}")
        logger.info(f"Found {ifc_data['ifc_data']['entity_count']} entities")
    except Exception as e:
        logger.error(f"Failed to parse IFC file: {e}")
        raise

    # 3. åˆå§‹åŒ–BIMå­˜å‚¨
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "bim_db",
        "user": "bim_user",
        "password": "bim_password"
    }
    storage = BIMStorage(db_config)
    storage.connect()
    storage.create_tables()

    # 4. å­˜å‚¨IFCæ–‡ä»¶ä¿¡æ¯
    file_id = storage.store_ifc_file(ifc_data)
    logger.info(f"Stored IFC file with ID: {file_id}")

    # 5. è§£æå¹¶å­˜å‚¨ä¸»è¦å®ä½“
    entity_parser = ifc_parser.IFCEntityParser()
    entities = ifc_data.get("ifc_data", {}).get("entities", [])

    for entity in entities:
        entity_type = entity.get("type")

        if entity_type == "IFCWALL":
            wall_data = entity_parser.parse_ifc_wall(entity)
            if wall_data:
                logger.info(f"Parsed IfcWall: {wall_data.get('name')}")

        elif entity_type == "IFCDOOR":
            door_data = entity_parser.parse_ifc_door(entity)
            if door_data:
                logger.info(f"Parsed IfcDoor: {door_data.get('name')}")

        elif entity_type == "IFCSPACE":
            space_data = entity_parser.parse_ifc_space(entity)
            if space_data:
                logger.info(f"Parsed IfcSpace: {space_data.get('name')}")

    return ifc_data

# è¿è¡Œæ¡ˆä¾‹2
if __name__ == "__main__":
    case2_ifc_file_parsing()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Parsed IFC file: /data/building.ifc
Found 1250 entities
Stored IFC file with ID: 1
Parsed IfcWall: å¤–å¢™-ä¸œä¾§
Parsed IfcDoor: ä¸»å…¥å£é—¨
Parsed IfcSpace: åŠå…¬å®¤101
```

---

## 4. æ¡ˆä¾‹3ï¼šæ–½å·¥ç®¡ç†

### 4.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
æ–½å·¥å…¬å¸éœ€è¦ç®¡ç†æ–½å·¥è®¡åˆ’ã€è¿›åº¦è·Ÿè¸ªã€è´¨é‡æ£€æŸ¥ã€å®‰å…¨ç®¡ç†ç­‰ä¿¡æ¯ï¼Œç¡®ä¿æ–½å·¥é¡¹ç›®æŒ‰æ—¶æŒ‰è´¨å®Œæˆã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦ç®¡ç†å¤æ‚çš„æ–½å·¥ä»»åŠ¡å’Œä¾èµ–å…³ç³»
- éœ€è¦å®æ—¶è·Ÿè¸ªæ–½å·¥è¿›åº¦
- éœ€è¦è®°å½•è´¨é‡æ£€æŸ¥ç»“æœ
- éœ€è¦ç®¡ç†å®‰å…¨é£é™©å’Œäº‹æ•…

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIM_Schemaå®šä¹‰æ–½å·¥ç®¡ç†æ•°æ®ç»“æ„ï¼Œå®ç°æ–½å·¥è®¡åˆ’åˆ¶å®šã€è¿›åº¦è·Ÿè¸ªã€è´¨é‡æ£€æŸ¥ã€å®‰å…¨ç®¡ç†ç­‰åŠŸèƒ½ã€‚

### 4.2 Schemaå®šä¹‰

**æ–½å·¥ç®¡ç†Schema**ï¼š

```json
{
  "project_id": "PROJ20250121001",
  "project_name": "åŠå…¬æ¥¼A",
  "schedule": {
    "schedule_id": "SCHED001",
    "schedule_name": "åŠå…¬æ¥¼Aæ–½å·¥è®¡åˆ’",
    "start_date": "2025-02-01",
    "end_date": "2025-12-31",
    "tasks": [
      {
        "task_id": "TASK001",
        "task_name": "åŸºç¡€æ–½å·¥",
        "task_type": "Foundation",
        "planned_start": "2025-02-01",
        "planned_end": "2025-03-15",
        "planned_duration": 43,
        "progress": 75.0,
        "status": "InProgress",
        "assigned_resources": [
          {
            "resource_id": "RES001",
            "resource_type": "Labor",
            "resource_name": "æ–½å·¥é˜ŸA",
            "quantity": 20.0,
            "unit": "äºº"
          }
        ],
        "related_elements": ["ELEM001", "ELEM002"]
      }
    ]
  },
  "quality": {
    "inspections": [
      {
        "inspection_id": "INS001",
        "inspection_type": "Structure",
        "inspection_date": "2025-02-20",
        "inspector": "è´¨æ£€å‘˜A",
        "inspected_element": "ELEM001",
        "inspection_result": "Pass",
        "inspection_notes": "è´¨é‡åˆæ ¼"
      }
    ]
  },
  "safety": {
    "hazards": [
      {
        "hazard_id": "HAZ001",
        "hazard_type": "Fall",
        "hazard_location": "äºŒå±‚æ–½å·¥åŒºåŸŸ",
        "hazard_description": "é«˜ç©ºä½œä¸šé£é™©",
        "risk_level": "High",
        "mitigation_measures": "è®¾ç½®å®‰å…¨ç½‘å’Œé˜²æŠ¤æ ",
        "status": "Mitigated"
      }
    ]
  }
}
```

### 4.3 å®ç°ä»£ç 

**å®Œæ•´çš„æ–½å·¥ç®¡ç†å®ç°**ï¼š

```python
import logging
from typing import Dict
from datetime import date
from bim_schema.transformation import BIMStorage

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹3ï¼šæ–½å·¥ç®¡ç†
def case3_construction_management():
    """æ¡ˆä¾‹3ï¼šæ–½å·¥ç®¡ç†"""

    # 1. åˆå§‹åŒ–BIMå­˜å‚¨
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "bim_db",
        "user": "bim_user",
        "password": "bim_password"
    }
    storage = BIMStorage(db_config)
    storage.connect()
    storage.create_tables()

    # 2. åˆ›å»ºæ–½å·¥è®¡åˆ’
    construction_data = {
        "project_id": "PROJ20250121001",
        "project_name": "åŠå…¬æ¥¼A",
        "schedule": {
            "schedule_id": "SCHED001",
            "schedule_name": "åŠå…¬æ¥¼Aæ–½å·¥è®¡åˆ’",
            "start_date": date(2025, 2, 1),
            "end_date": date(2025, 12, 31),
            "tasks": [
                {
                    "task_id": "TASK001",
                    "task_name": "åŸºç¡€æ–½å·¥",
                    "task_type": "Foundation",
                    "planned_start": date(2025, 2, 1),
                    "planned_end": date(2025, 3, 15),
                    "planned_duration": 43,
                    "progress": 75.0,
                    "status": "InProgress",
                    "assigned_resources": [
                        {
                            "resource_id": "RES001",
                            "resource_type": "Labor",
                            "resource_name": "æ–½å·¥é˜ŸA",
                            "quantity": 20.0,
                            "unit": "äºº"
                        }
                    ],
                    "related_elements": ["ELEM001", "ELEM002"]
                }
            ]
        },
        "quality": {
            "inspections": [
                {
                    "inspection_id": "INS001",
                    "inspection_type": "Structure",
                    "inspection_date": date(2025, 2, 20),
                    "inspector": "è´¨æ£€å‘˜A",
                    "inspected_element": "ELEM001",
                    "inspection_result": "Pass",
                    "inspection_notes": "è´¨é‡åˆæ ¼"
                }
            ]
        },
        "safety": {
            "hazards": [
                {
                    "hazard_id": "HAZ001",
                    "hazard_type": "Fall",
                    "hazard_location": "äºŒå±‚æ–½å·¥åŒºåŸŸ",
                    "hazard_description": "é«˜ç©ºä½œä¸šé£é™©",
                    "risk_level": "High",
                    "mitigation_measures": "è®¾ç½®å®‰å…¨ç½‘å’Œé˜²æŠ¤æ ",
                    "status": "Mitigated"
                }
            ]
        }
    }

    # 3. å­˜å‚¨æ–½å·¥è®¡åˆ’
    schedule_id = storage.store_schedule(construction_data["schedule"])
    logger.info(f"Stored schedule: {schedule_id}")

    # 4. å­˜å‚¨è´¨é‡æ£€æŸ¥
    for inspection in construction_data["quality"]["inspections"]:
        inspection_id = storage.store_inspection(inspection)
        logger.info(f"Stored inspection: {inspection_id}")

    # 5. å­˜å‚¨å®‰å…¨é£é™©
    for hazard in construction_data["safety"]["hazards"]:
        hazard_id = storage.store_hazard(hazard)
        logger.info(f"Stored hazard: {hazard_id}")

    # 6. æŸ¥è¯¢æ–½å·¥è¿›åº¦
    progress = storage.query_progress("PROJ20250121001")
    logger.info(f"Overall progress: {progress['overall_progress']}%")

    return construction_data

# è¿è¡Œæ¡ˆä¾‹3
if __name__ == "__main__":
    case3_construction_management()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Stored schedule: 1
Stored inspection: 1
Stored hazard: 1
Overall progress: 25.5%
```

---

## 5. æ¡ˆä¾‹4ï¼šCOBieæ•°æ®ç”Ÿæˆ

### 5.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘äº¤ä»˜ç»™è¿è¥æ–¹æ—¶ï¼Œéœ€è¦ç”ŸæˆCOBieæ ¼å¼çš„æ•°æ®ï¼ŒåŒ…å«è®¾å¤‡æ¸…å•ã€ç»´æŠ¤ä¿¡æ¯ã€ç©ºé—´ä¿¡æ¯ç­‰ï¼Œä»¥ä¾¿è¿è¥æ–¹è¿›è¡Œè®¾æ–½ç®¡ç†ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦ä»IFCæ¨¡å‹ä¸­æå–è¿è¥ç›¸å…³ä¿¡æ¯
- éœ€è¦ç”Ÿæˆç¬¦åˆCOBieæ ‡å‡†çš„Excelæ–‡ä»¶
- éœ€è¦åŒ…å«è®¾å¤‡ã€ç©ºé—´ã€ç³»ç»Ÿã€æ–‡æ¡£ç­‰ä¿¡æ¯
- éœ€è¦ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨COBieGeneratorä»IFCæ•°æ®ç”ŸæˆCOBieæ•°æ®ï¼Œå¯¼å‡ºä¸ºExcelæ ¼å¼ï¼Œä¾›è¿è¥æ–¹ä½¿ç”¨ã€‚

### 5.2 Schemaå®šä¹‰

**COBieæ•°æ®ç”ŸæˆSchema**ï¼š

```json
{
  "version": "2.4",
  "generated_date": "2025-01-21T10:00:00Z",
  "sheets": {
    "Facility": [
      {
        "Name": "åŠå…¬æ¥¼A",
        "CreatedBy": "Architect A",
        "CreatedOn": "2025-01-21T10:00:00Z",
        "Category": "Building",
        "ProjectName": "åŠå…¬æ¥¼Aé¡¹ç›®",
        "SiteName": "å»ºè®¾è·¯1å·",
        "LinearUnits": "Meters",
        "AreaUnits": "SquareMeters",
        "VolumeUnits": "CubicMeters",
        "CurrencyUnit": "CNY"
      }
    ],
    "Space": [
      {
        "Name": "åŠå…¬å®¤101",
        "CreatedBy": "Architect A",
        "CreatedOn": "2025-01-21T10:00:00Z",
        "Category": "Space",
        "FloorName": "ä¸€å±‚",
        "Description": "æ ‡å‡†åŠå…¬å®¤",
        "GrossArea": 20.0,
        "NetArea": 18.0
      }
    ],
    "Component": [
      {
        "Name": "ç©ºè°ƒæœºç»„-001",
        "CreatedBy": "Architect A",
        "CreatedOn": "2025-01-21T10:00:00Z",
        "TypeName": "VRVç©ºè°ƒç³»ç»Ÿ",
        "Space": "åŠå…¬å®¤101",
        "Description": "VRVå¤šè”æœºç©ºè°ƒ",
        "SerialNumber": "AC-2025-001",
        "InstallationDate": "2025-06-01",
        "TagNumber": "AC-001"
      }
    ]
  }
}
```

### 5.3 å®ç°ä»£ç 

**å®Œæ•´çš„COBieæ•°æ®ç”Ÿæˆå®ç°**ï¼š

```python
import logging
from typing import Dict
from bim_schema.transformation import IFCParser, COBieGenerator

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹4ï¼šCOBieæ•°æ®ç”Ÿæˆ
def case4_cobie_generation():
    """æ¡ˆä¾‹4ï¼šCOBieæ•°æ®ç”Ÿæˆ"""

    # 1. è§£æIFCæ–‡ä»¶
    ifc_parser = IFCParser()
    ifc_file_path = "/data/building.ifc"

    try:
        ifc_data = ifc_parser.parse_ifc_file(ifc_file_path)
        logger.info(f"Parsed IFC file: {ifc_file_path}")
    except Exception as e:
        logger.error(f"Failed to parse IFC file: {e}")
        raise

    # 2. ç”ŸæˆCOBieæ•°æ®
    cobie_generator = COBieGenerator()

    try:
        cobie_data = cobie_generator.generate_cobie_from_ifc(ifc_data)
        logger.info(f"Generated COBie data with {len(cobie_data['sheets'])} sheets")
    except Exception as e:
        logger.error(f"Failed to generate COBie data: {e}")
        raise

    # 3. å¯¼å‡ºCOBieæ•°æ®åˆ°Excel
    output_dir = "/data/cobie"

    try:
        exported_files = cobie_generator.export_to_csv(cobie_data, output_dir)
        logger.info(f"Exported {len(exported_files)} COBie sheets to {output_dir}")
        for file_path in exported_files:
            logger.info(f"  - {file_path}")
    except Exception as e:
        logger.error(f"Failed to export COBie data: {e}")
        raise

    # 4. éªŒè¯COBieæ•°æ®
    required_sheets = ["Contact", "Facility", "Floor", "Space", "Type", "Component"]
    missing_sheets = [s for s in required_sheets if s not in cobie_data["sheets"]]

    if missing_sheets:
        logger.warning(f"Missing required COBie sheets: {missing_sheets}")
    else:
        logger.info("All required COBie sheets are present")

    return cobie_data

# è¿è¡Œæ¡ˆä¾‹4
if __name__ == "__main__":
    case4_cobie_generation()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Parsed IFC file: /data/building.ifc
Generated COBie data with 19 sheets
Exported 19 COBie sheets to /data/cobie
  - /data/cobie/Contact.csv
  - /data/cobie/Facility.csv
  - /data/cobie/Floor.csv
  - /data/cobie/Space.csv
  - /data/cobie/Type.csv
  - /data/cobie/Component.csv
All required COBie sheets are present
```

---

## 6. æ¡ˆä¾‹5ï¼šgbXMLèƒ½è€—åˆ†æ

### 6.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘è®¾è®¡å…¬å¸éœ€è¦è¿›è¡Œå»ºç­‘èƒ½è€—åˆ†æï¼Œè¯„ä¼°å»ºç­‘çš„èƒ½æºæ€§èƒ½ï¼Œä¼˜åŒ–å»ºç­‘è®¾è®¡æ–¹æ¡ˆã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦ä»IFCæ¨¡å‹ç”ŸæˆgbXMLæ–‡ä»¶
- éœ€è¦å®šä¹‰å»ºç­‘çš„çƒ­å·¥å‚æ•°
- éœ€è¦é…ç½®HVACç³»ç»Ÿå’Œç…§æ˜ç³»ç»Ÿ
- éœ€è¦ä¸èƒ½è€—åˆ†æè½¯ä»¶ï¼ˆå¦‚EnergyPlusï¼‰é›†æˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨gbXMLParserè§£ægbXMLæ–‡ä»¶ï¼Œæˆ–ä»IFCæ¨¡å‹ç”ŸæˆgbXMLæ–‡ä»¶ï¼Œç”¨äºèƒ½è€—åˆ†æã€‚

### 6.2 Schemaå®šä¹‰

**gbXMLèƒ½è€—åˆ†æSchema**ï¼š

```json
{
  "version": "6.01",
  "campus": {
    "id": "CAMPUS001",
    "location": {
      "latitude": 31.2304,
      "longitude": 121.4737,
      "elevation": 10.0
    },
    "building": {
      "id": "BUILDING001",
      "building_type": "Office",
      "spaces": [
        {
          "id": "SPACE001",
          "space_type": "Office",
          "volume": 60.0,
          "area": 20.0,
          "people_number": 2.0,
          "lighting_power": 10.0,
          "equipment_power": 5.0
        }
      ],
      "surfaces": [
        {
          "id": "SURFACE001",
          "surface_type": "ExteriorWall",
          "construction_id_ref": "CONSTR001",
          "planar_geometry": {
            "polygon": {
              "points": [
                {"x": 0.0, "y": 0.0, "z": 0.0},
                {"x": 20.0, "y": 0.0, "z": 0.0},
                {"x": 20.0, "y": 0.0, "z": 3.0},
                {"x": 0.0, "y": 0.0, "z": 3.0}
              ]
            }
          }
        }
      ]
    }
  },
  "construction": [
    {
      "id": "CONSTR001",
      "u_value": 0.5,
      "layer_ids": ["LAYER001", "LAYER002"]
    }
  ],
  "material": [
    {
      "id": "MAT001",
      "name": "C30æ··å‡åœŸ",
      "r_value": 0.66,
      "thickness": 0.3,
      "conductivity": 1.51,
      "density": 2400.0,
      "specific_heat": 920.0
    }
  ]
}
```

### 6.3 å®ç°ä»£ç 

**å®Œæ•´çš„gbXMLèƒ½è€—åˆ†æå®ç°**ï¼š

```python
import logging
from typing import Dict
from bim_schema.transformation import gbXMLParser

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹5ï¼šgbXMLèƒ½è€—åˆ†æ
def case5_gbxml_energy_analysis():
    """æ¡ˆä¾‹5ï¼šgbXMLèƒ½è€—åˆ†æ"""

    # 1. è§£ægbXMLæ–‡ä»¶
    gbxml_parser = gbXMLParser()
    gbxml_file_path = "/data/building.xml"

    try:
        gbxml_data = gbxml_parser.parse_gbxml_file(gbxml_file_path)
        logger.info(f"Parsed gbXML file: {gbxml_file_path}")
    except Exception as e:
        logger.error(f"Failed to parse gbXML file: {e}")
        raise

    # 2. æå–å»ºç­‘ä¿¡æ¯
    building = gbxml_data.get("campus", {}).get("building", {})
    building_id = building.get("id", "")
    building_type = building.get("building_type", "")
    logger.info(f"Building ID: {building_id}, Type: {building_type}")

    # 3. æå–ç©ºé—´ä¿¡æ¯
    spaces = building.get("spaces", [])
    logger.info(f"Found {len(spaces)} spaces")

    total_area = sum(space.get("area", 0) for space in spaces)
    total_volume = sum(space.get("volume", 0) for space in spaces)
    logger.info(f"Total area: {total_area} mÂ², Total volume: {total_volume} mÂ³")

    # 4. æå–è¡¨é¢ä¿¡æ¯
    surfaces = building.get("surfaces", [])
    logger.info(f"Found {len(surfaces)} surfaces")

    exterior_walls = [s for s in surfaces if s.get("surface_type") == "ExteriorWall"]
    logger.info(f"Found {len(exterior_walls)} exterior walls")

    # 5. æå–æ„é€ ä¿¡æ¯
    constructions = gbxml_data.get("construction", [])
    logger.info(f"Found {len(constructions)} constructions")

    for constr in constructions:
        u_value = constr.get("u_value", 0)
        logger.info(f"Construction {constr.get('id')}: U-value = {u_value} W/(mÂ²Â·K)")

    # 6. æå–ææ–™ä¿¡æ¯
    materials = gbxml_data.get("material", [])
    logger.info(f"Found {len(materials)} materials")

    for mat in materials:
        mat_name = mat.get("name", "")
        conductivity = mat.get("conductivity", 0)
        logger.info(f"Material {mat_name}: Conductivity = {conductivity} W/(mÂ·K)")

    return gbxml_data

# è¿è¡Œæ¡ˆä¾‹5
if __name__ == "__main__":
    case5_gbxml_energy_analysis()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Parsed gbXML file: /data/building.xml
Building ID: BUILDING001, Type: Office
Found 50 spaces
Total area: 2000.0 mÂ², Total volume: 6000.0 mÂ³
Found 200 surfaces
Found 80 exterior walls
Found 20 constructions
Construction CONSTR001: U-value = 0.5 W/(mÂ²Â·K)
Found 30 materials
Material C30æ··å‡åœŸ: Conductivity = 1.51 W/(mÂ·K)
```

---

## 7. æ¡ˆä¾‹6ï¼šè¿ç»´ç®¡ç†

### 7.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
è®¾æ–½ç®¡ç†å…¬å¸éœ€è¦ç®¡ç†å»ºç­‘çš„è®¾å¤‡ã€ç»´æŠ¤è®¡åˆ’ã€èƒ½è€—ç›‘æµ‹ã€ç©ºé—´ä½¿ç”¨ç­‰ä¿¡æ¯ï¼Œç¡®ä¿å»ºç­‘æ­£å¸¸è¿è¥ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦ç®¡ç†å¤§é‡è®¾å¤‡ä¿¡æ¯
- éœ€è¦åˆ¶å®šå’Œç»´æŠ¤ç»´æŠ¤è®¡åˆ’
- éœ€è¦ç›‘æµ‹å’Œåˆ†æèƒ½è€—æ•°æ®
- éœ€è¦ç®¡ç†ç©ºé—´ä½¿ç”¨å’Œç§Ÿèµä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIM_Schemaå®šä¹‰è¿ç»´ç®¡ç†æ•°æ®ç»“æ„ï¼Œå®ç°è®¾å¤‡ç®¡ç†ã€ç»´æŠ¤è®¡åˆ’ã€èƒ½è€—ç›‘æµ‹ã€ç©ºé—´ç®¡ç†ç­‰åŠŸèƒ½ã€‚

### 7.2 Schemaå®šä¹‰

**è¿ç»´ç®¡ç†Schema**ï¼š

```json
{
  "facility_id": "FACILITY001",
  "facility_name": "åŠå…¬æ¥¼A",
  "equipment": [
    {
      "equipment_id": "EQ001",
      "equipment_name": "ç©ºè°ƒæœºç»„-001",
      "equipment_type": "HVAC",
      "manufacturer": "å¤§é‡‘",
      "model_number": "VRV-S",
      "serial_number": "AC-2025-001",
      "installation_date": "2025-06-01",
      "warranty_start_date": "2025-06-01",
      "warranty_duration": 2,
      "location": {
        "space_id": "SPACE001",
        "space_name": "åŠå…¬å®¤101",
        "coordinates": {
          "x": 5.0,
          "y": 5.0,
          "z": 2.5
        }
      },
      "status": "Operational"
    }
  ],
  "maintenance": {
    "maintenance_plans": [
      {
        "plan_id": "PLAN001",
        "plan_name": "ç©ºè°ƒæœºç»„å®šæœŸç»´æŠ¤",
        "equipment_id": "EQ001",
        "maintenance_type": "Preventive",
        "frequency": "Monthly",
        "frequency_value": 30,
        "estimated_duration": 2,
        "estimated_cost": 500.0,
        "maintenance_procedures": "1. æ¸…æ´è¿‡æ»¤å™¨\n2. æ£€æŸ¥åˆ¶å†·å‰‚\n3. æ£€æŸ¥ç”µæ°”è¿æ¥"
      }
    ],
    "maintenance_history": [
      {
        "record_id": "REC001",
        "plan_id": "PLAN001",
        "equipment_id": "EQ001",
        "maintenance_date": "2025-01-15",
        "maintenance_type": "Preventive",
        "performed_by": "ç»´æŠ¤å·¥ç¨‹å¸ˆA",
        "duration": 2,
        "cost": 500.0,
        "description": "å®šæœŸç»´æŠ¤å®Œæˆ",
        "next_maintenance_date": "2025-02-15",
        "status": "Completed"
      }
    ]
  },
  "energy": {
    "energy_monitoring": [
      {
        "data_id": "ENERGY001",
        "timestamp": "2025-01-21T10:00:00Z",
        "energy_type": "Electricity",
        "consumption": 1500.0,
        "cost": 1200.0,
        "source": "Main Meter",
        "location": "åŠå…¬æ¥¼A"
      }
    ]
  }
}
```

### 7.3 å®ç°ä»£ç 

**å®Œæ•´çš„è¿ç»´ç®¡ç†å®ç°**ï¼š

```python
import logging
from typing import Dict
from datetime import date, datetime
from bim_schema.transformation import BIMStorage

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹6ï¼šè¿ç»´ç®¡ç†
def case6_operation_management():
    """æ¡ˆä¾‹6ï¼šè¿ç»´ç®¡ç†"""

    # 1. åˆå§‹åŒ–BIMå­˜å‚¨
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "bim_db",
        "user": "bim_user",
        "password": "bim_password"
    }
    storage = BIMStorage(db_config)
    storage.connect()
    storage.create_tables()

    # 2. åˆ›å»ºè¿ç»´ç®¡ç†æ•°æ®
    operation_data = {
        "facility_id": "FACILITY001",
        "facility_name": "åŠå…¬æ¥¼A",
        "equipment": [
            {
                "equipment_id": "EQ001",
                "equipment_name": "ç©ºè°ƒæœºç»„-001",
                "equipment_type": "HVAC",
                "manufacturer": "å¤§é‡‘",
                "model_number": "VRV-S",
                "serial_number": "AC-2025-001",
                "installation_date": date(2025, 6, 1),
                "warranty_start_date": date(2025, 6, 1),
                "warranty_duration": 2,
                "location": {
                    "space_id": "SPACE001",
                    "space_name": "åŠå…¬å®¤101",
                    "coordinates": {"x": 5.0, "y": 5.0, "z": 2.5}
                },
                "status": "Operational"
            }
        ],
        "maintenance": {
            "maintenance_plans": [
                {
                    "plan_id": "PLAN001",
                    "plan_name": "ç©ºè°ƒæœºç»„å®šæœŸç»´æŠ¤",
                    "equipment_id": "EQ001",
                    "maintenance_type": "Preventive",
                    "frequency": "Monthly",
                    "frequency_value": 30,
                    "estimated_duration": 2,
                    "estimated_cost": 500.0,
                    "maintenance_procedures": "1. æ¸…æ´è¿‡æ»¤å™¨\n2. æ£€æŸ¥åˆ¶å†·å‰‚\n3. æ£€æŸ¥ç”µæ°”è¿æ¥"
                }
            ],
            "maintenance_history": [
                {
                    "record_id": "REC001",
                    "plan_id": "PLAN001",
                    "equipment_id": "EQ001",
                    "maintenance_date": date(2025, 1, 15),
                    "maintenance_type": "Preventive",
                    "performed_by": "ç»´æŠ¤å·¥ç¨‹å¸ˆA",
                    "duration": 2,
                    "cost": 500.0,
                    "description": "å®šæœŸç»´æŠ¤å®Œæˆ",
                    "next_maintenance_date": date(2025, 2, 15),
                    "status": "Completed"
                }
            ]
        },
        "energy": {
            "energy_monitoring": [
                {
                    "data_id": "ENERGY001",
                    "timestamp": datetime(2025, 1, 21, 10, 0, 0),
                    "energy_type": "Electricity",
                    "consumption": 1500.0,
                    "cost": 1200.0,
                    "source": "Main Meter",
                    "location": "åŠå…¬æ¥¼A"
                }
            ]
        }
    }

    # 3. å­˜å‚¨è®¾å¤‡ä¿¡æ¯
    for equipment in operation_data["equipment"]:
        equipment_id = storage.store_equipment(equipment)
        logger.info(f"Stored equipment: {equipment_id}")

    # 4. å­˜å‚¨ç»´æŠ¤è®¡åˆ’
    for plan in operation_data["maintenance"]["maintenance_plans"]:
        plan_id = storage.store_maintenance_plan(plan)
        logger.info(f"Stored maintenance plan: {plan_id}")

    # 5. å­˜å‚¨ç»´æŠ¤å†å²
    for record in operation_data["maintenance"]["maintenance_history"]:
        record_id = storage.store_maintenance_record(record)
        logger.info(f"Stored maintenance record: {record_id}")

    # 6. å­˜å‚¨èƒ½è€—æ•°æ®
    for energy_data in operation_data["energy"]["energy_monitoring"]:
        energy_id = storage.store_energy_data(energy_data)
        logger.info(f"Stored energy data: {energy_id}")

    # 7. æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯
    hvac_equipment = storage.query_equipment("HVAC")
    logger.info(f"Found {len(hvac_equipment)} HVAC equipment")

    # 8. æŸ¥è¯¢ç»´æŠ¤è®¡åˆ’
    preventive_plans = storage.query_maintenance_plans("Preventive")
    logger.info(f"Found {len(preventive_plans)} preventive maintenance plans")

    return operation_data

# è¿è¡Œæ¡ˆä¾‹6
if __name__ == "__main__":
    case6_operation_management()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Stored equipment: 1
Stored maintenance plan: 1
Stored maintenance record: 1
Stored energy data: 1
Found 1 HVAC equipment
Found 1 preventive maintenance plans
```

---

## 8. æ¡ˆä¾‹7ï¼šBIMæ•°æ®æŸ¥è¯¢å’Œåˆ†æ

### 8.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘å…¬å¸éœ€è¦æŸ¥è¯¢å’Œåˆ†æBIMæ•°æ®ï¼Œç”ŸæˆæŠ¥è¡¨ï¼Œæ”¯æŒå†³ç­–åˆ¶å®šã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦é«˜æ•ˆæŸ¥è¯¢å¤§é‡BIMæ•°æ®
- éœ€è¦æ”¯æŒå¤æ‚çš„æŸ¥è¯¢æ¡ä»¶
- éœ€è¦ç”Ÿæˆå„ç§åˆ†ææŠ¥è¡¨
- éœ€è¦æ”¯æŒæ•°æ®å¯è§†åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIMStorageæä¾›çš„æ•°æ®æŸ¥è¯¢åŠŸèƒ½ï¼Œå®ç°BIMæ•°æ®çš„æŸ¥è¯¢å’Œåˆ†æã€‚

### 8.2 å®ç°ä»£ç 

**å®Œæ•´çš„BIMæ•°æ®æŸ¥è¯¢å’Œåˆ†æå®ç°**ï¼š

```python
import logging
from typing import Dict, List
from bim_schema.transformation import BIMStorage

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹7ï¼šBIMæ•°æ®æŸ¥è¯¢å’Œåˆ†æ
def case7_bim_data_analysis():
    """æ¡ˆä¾‹7ï¼šBIMæ•°æ®æŸ¥è¯¢å’Œåˆ†æ"""

    # 1. åˆå§‹åŒ–BIMå­˜å‚¨
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "bim_db",
        "user": "bim_user",
        "password": "bim_password"
    }
    storage = BIMStorage(db_config)
    storage.connect()

    # 2. æŸ¥è¯¢å»ºç­‘å…ƒç´ ç»Ÿè®¡
    walls = storage.query_building_elements("Wall")
    doors = storage.query_building_elements("Door")
    windows = storage.query_building_elements("Window")

    logger.info(f"Building elements statistics:")
    logger.info(f"  Walls: {len(walls)}")
    logger.info(f"  Doors: {len(doors)}")
    logger.info(f"  Windows: {len(windows)}")

    # 3. æŸ¥è¯¢ç©ºé—´ç»Ÿè®¡
    rooms = storage.query_spaces("Room")
    total_area = sum(room.get("area", 0) for room in rooms)
    total_volume = sum(room.get("volume", 0) for room in rooms)

    logger.info(f"Space statistics:")
    logger.info(f"  Rooms: {len(rooms)}")
    logger.info(f"  Total area: {total_area} mÂ²")
    logger.info(f"  Total volume: {total_volume} mÂ³")

    # 4. æŸ¥è¯¢è®¾å¤‡ç»Ÿè®¡
    hvac_equipment = storage.query_equipment("HVAC")
    electrical_equipment = storage.query_equipment("Electrical")

    logger.info(f"Equipment statistics:")
    logger.info(f"  HVAC: {len(hvac_equipment)}")
    logger.info(f"  Electrical: {len(electrical_equipment)}")

    # 5. æŸ¥è¯¢ç»´æŠ¤è®¡åˆ’ç»Ÿè®¡
    preventive_plans = storage.query_maintenance_plans("Preventive")
    corrective_plans = storage.query_maintenance_plans("Corrective")

    logger.info(f"Maintenance plan statistics:")
    logger.info(f"  Preventive: {len(preventive_plans)}")
    logger.info(f"  Corrective: {len(corrective_plans)}")

    # 6. ç”Ÿæˆåˆ†ææŠ¥è¡¨
    analysis_report = {
        "building_elements": {
            "walls": len(walls),
            "doors": len(doors),
            "windows": len(windows)
        },
        "spaces": {
            "rooms": len(rooms),
            "total_area": total_area,
            "total_volume": total_volume
        },
        "equipment": {
            "hvac": len(hvac_equipment),
            "electrical": len(electrical_equipment)
        },
        "maintenance": {
            "preventive_plans": len(preventive_plans),
            "corrective_plans": len(corrective_plans)
        }
    }

    logger.info(f"Analysis report: {analysis_report}")

    return analysis_report

# è¿è¡Œæ¡ˆä¾‹7
if __name__ == "__main__":
    case7_bim_data_analysis()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Building elements statistics:
  Walls: 50
  Doors: 20
  Windows: 80
Space statistics:
  Rooms: 30
  Total area: 2000.0 mÂ²
  Total volume: 6000.0 mÂ³
Equipment statistics:
  HVAC: 10
  Electrical: 15
Maintenance plan statistics:
  Preventive: 8
  Corrective: 2
Analysis report: {...}
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

---

## 9. æ¡ˆä¾‹8ï¼šæ™ºèƒ½å»ºç­‘è¿è¥ç³»ç»Ÿ

### 9.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
æ™ºèƒ½å»ºç­‘è¿è¥ç³»ç»Ÿæ•´åˆBIMæ•°æ®å’ŒIoTä¼ æ„Ÿå™¨æ•°æ®ï¼Œ
å®ç°å»ºç­‘è®¾å¤‡æ™ºèƒ½æ§åˆ¶ã€èƒ½è€—ä¼˜åŒ–ã€ç¯å¢ƒèˆ’é€‚åº¦ç®¡ç†ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦BIMæ•°æ®ä¸IoTæ•°æ®èåˆ
- éœ€è¦è®¾å¤‡æ§åˆ¶ç®—æ³•
- éœ€è¦å®æ—¶ç›‘æµ‹
- éœ€è¦è¿è¥ä¼˜åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIM_Schemaæ•´åˆå»ºç­‘æ•°æ®å’ŒIoTæ•°æ®ï¼Œ
ä½¿ç”¨AIç®—æ³•è¿›è¡Œè¿è¥ä¼˜åŒ–ï¼Œ
ä½¿ç”¨BIMStorageå­˜å‚¨è¿è¥æ•°æ®ã€‚

### 9.2 Schemaå®šä¹‰

**æ™ºèƒ½å»ºç­‘è¿è¥Schema**ï¼š

```dsl
schema SmartBuildingOperations {
  operation_session_id: String @value("BUILDING-OPS-20250121-001") @required
  building_id: String @value("BUILDING-001") @required
  operation_time: DateTime @value("2025-01-21T10:00:00") @required

  building_status: {
    occupancy: Integer @value(500) @unit("people")
    occupancy_rate: Decimal @value(0.75) @range(0.0, 1.0)
    temperature: Decimal @value(22.5) @unit("Celsius")
    humidity: Decimal @value(55.0) @unit("%")
    air_quality: Integer @value(85) @unit("AQI")
    lighting_level: Decimal @value(0.8) @range(0.0, 1.0)
  } @required

  equipment_status: {
    hvac_systems: [
      {
        system_id: String @value("HVAC-001")
        status: Enum { Running } @value(Running)
        power_consumption: Decimal @value(50.5) @unit("kW")
        efficiency: Decimal @value(0.85) @range(0.0, 1.0)
      }
    ]
    lighting_systems: [
      {
        system_id: String @value("LIGHT-001")
        status: Enum { On } @value(On)
        brightness: Integer @value(80) @range(0, 100)
        power_consumption: Decimal @value(5.2) @unit("kW")
      }
    ]
  } @required

  optimization_results: {
    energy_savings: Decimal @value(0.15) @unit("15% reduction")
    comfort_improvement: Decimal @value(0.10) @unit("10% improvement")
    cost_savings: Decimal @value(5000.0) @unit("RMB/month")
  } @required
} @standard("IFC")
```

### 9.3 å®ç°ä»£ç 

```python
from bim_storage import BIMStorage
from datetime import datetime

def smart_building_operations():
    """æ™ºèƒ½å»ºç­‘è¿è¥ç³»ç»Ÿç¤ºä¾‹"""
    storage = BIMStorage("postgresql://user:password@localhost/bim_db")

    # å»ºç­‘çŠ¶æ€
    building_status = {
        "building_id": "BUILDING-001",
        "occupancy": 500,
        "occupancy_rate": 0.75,
        "temperature": 22.5,
        "humidity": 55.0,
        "air_quality": 85,
        "lighting_level": 0.8
    }

    # è®¾å¤‡çŠ¶æ€
    equipment_status = {
        "hvac_systems": [
            {
                "system_id": "HVAC-001",
                "status": "Running",
                "power_consumption": 50.5,
                "efficiency": 0.85
            }
        ],
        "lighting_systems": [
            {
                "system_id": "LIGHT-001",
                "status": "On",
                "brightness": 80,
                "power_consumption": 5.2
            }
        ]
    }

    # è¿è¥ä¼˜åŒ–ç®—æ³•
    def optimize_operations(building_status, equipment_status):
        """ä¼˜åŒ–å»ºç­‘è¿è¥"""
        energy_savings = 0.0
        comfort_improvement = 0.0
        cost_savings = 0.0

        # æ ¹æ®å ç”¨ç‡è°ƒæ•´è®¾å¤‡
        if building_status["occupancy_rate"] < 0.5:
            # ä½å ç”¨ç‡æ—¶é™ä½èƒ½è€—
            energy_savings = 0.15
            comfort_improvement = 0.0
        else:
            # æ­£å¸¸å ç”¨ç‡æ—¶ä¼˜åŒ–èˆ’é€‚åº¦
            energy_savings = 0.10
            comfort_improvement = 0.10

        # æ ¹æ®ç¯å¢ƒæ¡ä»¶è°ƒæ•´
        if building_status["temperature"] > 25.0:
            # æ¸©åº¦è¿‡é«˜ï¼Œä¼˜åŒ–ç©ºè°ƒ
            energy_savings += 0.05
            comfort_improvement += 0.05

        # è®¡ç®—æˆæœ¬èŠ‚çº¦
        total_power = sum(
            h["power_consumption"] for h in equipment_status["hvac_systems"]
        ) + sum(
            l["power_consumption"] for l in equipment_status["lighting_systems"]
        )

        cost_savings = total_power * 24 * 30 * 0.8 * energy_savings  # å‡è®¾ç”µä»·0.8å…ƒ/kWh

        return {
            "energy_savings": energy_savings,
            "comfort_improvement": comfort_improvement,
            "cost_savings": cost_savings
        }

    # æ‰§è¡Œè¿è¥ä¼˜åŒ–
    optimization_results = optimize_operations(building_status, equipment_status)

    # å­˜å‚¨è¿è¥æ•°æ®
    operation_data = {
        "operation_session_id": "BUILDING-OPS-20250121-001",
        "building_id": building_status["building_id"],
        "operation_time": datetime.now(),
        "occupancy": building_status["occupancy"],
        "occupancy_rate": building_status["occupancy_rate"],
        "temperature": building_status["temperature"],
        "humidity": building_status["humidity"],
        "air_quality": building_status["air_quality"],
        "lighting_level": building_status["lighting_level"],
        "total_power_consumption": sum(
            h["power_consumption"] for h in equipment_status["hvac_systems"]
        ) + sum(
            l["power_consumption"] for l in equipment_status["lighting_systems"]
        ),
        "energy_savings": optimization_results["energy_savings"],
        "comfort_improvement": optimization_results["comfort_improvement"],
        "cost_savings": optimization_results["cost_savings"]
    }

    # å­˜å‚¨åˆ°æ•°æ®åº“
    operation_id = storage.store_bim_data(operation_data)
    print(f"Building operations data stored: {operation_id}")

    print(f"\nSmart Building Operations:")
    print(f"  Building: {building_status['building_id']}")
    print(f"  Occupancy: {building_status['occupancy']} ({building_status['occupancy_rate']*100:.1f}%)")
    print(f"  Temperature: {building_status['temperature']:.1f}Â°C")
    print(f"  Energy savings: {optimization_results['energy_savings']*100:.1f}%")
    print(f"  Comfort improvement: {optimization_results['comfort_improvement']*100:.1f}%")
    print(f"  Cost savings: Â¥{optimization_results['cost_savings']:.2f}/month")

    return operation_data

if __name__ == "__main__":
    smart_building_operations()
```

---

## 10. æ¡ˆä¾‹9ï¼šå»ºç­‘èƒ½è€—ä¼˜åŒ–ç³»ç»Ÿ

### 10.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘èƒ½è€—ä¼˜åŒ–ç³»ç»Ÿåˆ†æå»ºç­‘èƒ½è€—æ•°æ®ï¼Œ
è¯†åˆ«èƒ½è€—çƒ­ç‚¹ï¼Œä¼˜åŒ–èƒ½è€—ç­–ç•¥ï¼Œé™ä½å»ºç­‘è¿è¥æˆæœ¬ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦èƒ½è€—æ•°æ®æ”¶é›†
- éœ€è¦èƒ½è€—åˆ†æ
- éœ€è¦ä¼˜åŒ–ç­–ç•¥
- éœ€è¦æ•ˆæœè¯„ä¼°

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIM_Schemaæ•´åˆèƒ½è€—æ•°æ®ï¼Œ
ä½¿ç”¨ä¼˜åŒ–ç®—æ³•è¿›è¡Œèƒ½è€—ä¼˜åŒ–ï¼Œ
ä½¿ç”¨BIMStorageå­˜å‚¨èƒ½è€—æ•°æ®ã€‚

### 10.2 Schemaå®šä¹‰

**å»ºç­‘èƒ½è€—ä¼˜åŒ–Schema**ï¼š

```dsl
schema BuildingEnergyOptimization {
  optimization_session_id: String @value("ENERGY-OPT-20250121-001") @required
  building_id: String @value("BUILDING-001") @required
  optimization_period: {
    start_date: Date @value("2025-01-01")
    end_date: Date @value("2025-01-21")
  } @required

  energy_consumption: {
    total_consumption: Decimal @value(50000.0) @unit("kWh")
    hvac_consumption: Decimal @value(30000.0) @unit("kWh")
    lighting_consumption: Decimal @value(10000.0) @unit("kWh")
    equipment_consumption: Decimal @value(10000.0) @unit("kWh")
    consumption_per_area: Decimal @value(50.0) @unit("kWh/mÂ²")
    consumption_per_person: Decimal @value(100.0) @unit("kWh/person")
  } @required

  optimization_analysis: {
    energy_waste_points: [
      {
        location: String @value("3F HVAC System")
        waste_type: String @value("Over-cooling")
        waste_amount: Decimal @value(5000.0) @unit("kWh")
        optimization_potential: Decimal @value(0.15)
      }
    ]
    optimization_strategies: [
      {
        strategy: String @value("ä¼˜åŒ–HVACè¿è¡Œæ—¶é—´")
        expected_savings: Decimal @value(0.10)
        implementation_cost: Decimal @value(10000.0) @unit("RMB")
        payback_period: Decimal @value(12.0) @unit("months")
      }
    ]
    expected_total_savings: Decimal @value(0.15) @unit("15% reduction")
  } @required
} @standard("gbXML")
```

### 10.3 å®ç°ä»£ç 

```python
from bim_storage import BIMStorage
from datetime import datetime, date

def building_energy_optimization():
    """å»ºç­‘èƒ½è€—ä¼˜åŒ–ç³»ç»Ÿç¤ºä¾‹"""
    storage = BIMStorage("postgresql://user:password@localhost/bim_db")

    # èƒ½è€—æ•°æ®
    energy_consumption = {
        "building_id": "BUILDING-001",
        "optimization_start_date": date(2025, 1, 1),
        "optimization_end_date": date(2025, 1, 21),
        "total_consumption": 50000.0,
        "hvac_consumption": 30000.0,
        "lighting_consumption": 10000.0,
        "equipment_consumption": 10000.0,
        "building_area": 1000.0,  # mÂ²
        "occupancy": 500
    }

    # èƒ½è€—åˆ†æç®—æ³•
    def analyze_energy_consumption(consumption_data):
        """åˆ†æèƒ½è€—"""
        energy_waste_points = []
        optimization_strategies = []

        # è¯†åˆ«èƒ½è€—æµªè´¹ç‚¹
        hvac_ratio = consumption_data["hvac_consumption"] / consumption_data["total_consumption"]
        if hvac_ratio > 0.6:
            energy_waste_points.append({
                "location": "3F HVAC System",
                "waste_type": "Over-cooling",
                "waste_amount": consumption_data["hvac_consumption"] * 0.15,
                "optimization_potential": 0.15
            })

        # ç”Ÿæˆä¼˜åŒ–ç­–ç•¥
        if hvac_ratio > 0.6:
            optimization_strategies.append({
                "strategy": "ä¼˜åŒ–HVACè¿è¡Œæ—¶é—´",
                "expected_savings": 0.10,
                "implementation_cost": 10000.0,
                "payback_period": 12.0
            })

        # è®¡ç®—æ€»èŠ‚çº¦æ½œåŠ›
        expected_total_savings = sum(
            s["expected_savings"] for s in optimization_strategies
        ) / len(optimization_strategies) if optimization_strategies else 0.0

        return {
            "energy_waste_points": energy_waste_points,
            "optimization_strategies": optimization_strategies,
            "expected_total_savings": expected_total_savings
        }

    # æ‰§è¡Œèƒ½è€—åˆ†æ
    optimization_analysis = analyze_energy_consumption(energy_consumption)

    # è®¡ç®—å•ä½é¢ç§¯å’Œäººå‡èƒ½è€—
    consumption_per_area = energy_consumption["total_consumption"] / energy_consumption["building_area"]
    consumption_per_person = energy_consumption["total_consumption"] / energy_consumption["occupancy"]

    # å­˜å‚¨ä¼˜åŒ–æ•°æ®
    optimization_data = {
        "optimization_session_id": "ENERGY-OPT-20250121-001",
        "building_id": energy_consumption["building_id"],
        "optimization_start_date": energy_consumption["optimization_start_date"],
        "optimization_end_date": energy_consumption["optimization_end_date"],
        "total_consumption": energy_consumption["total_consumption"],
        "hvac_consumption": energy_consumption["hvac_consumption"],
        "lighting_consumption": energy_consumption["lighting_consumption"],
        "equipment_consumption": energy_consumption["equipment_consumption"],
        "consumption_per_area": consumption_per_area,
        "consumption_per_person": consumption_per_person,
        "energy_waste_points": optimization_analysis["energy_waste_points"],
        "optimization_strategies": optimization_analysis["optimization_strategies"],
        "expected_total_savings": optimization_analysis["expected_total_savings"]
    }

    # å­˜å‚¨åˆ°æ•°æ®åº“
    optimization_id = storage.store_bim_data(optimization_data)
    print(f"Energy optimization data stored: {optimization_id}")

    print(f"\nBuilding Energy Optimization:")
    print(f"  Building: {energy_consumption['building_id']}")
    print(f"  Total consumption: {energy_consumption['total_consumption']:.1f} kWh")
    print(f"  Consumption per area: {consumption_per_area:.1f} kWh/mÂ²")
    print(f"  Consumption per person: {consumption_per_person:.1f} kWh/person")
    print(f"  Energy waste points: {len(optimization_analysis['energy_waste_points'])}")
    print(f"  Optimization strategies: {len(optimization_analysis['optimization_strategies'])}")
    print(f"  Expected total savings: {optimization_analysis['expected_total_savings']*100:.1f}%")

    return optimization_data

if __name__ == "__main__":
    building_energy_optimization()
```

---

## 11. æ¡ˆä¾‹10ï¼šå»ºç­‘ç»´æŠ¤ç®¡ç†ç³»ç»Ÿ

### 11.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
å»ºç­‘ç»´æŠ¤ç®¡ç†ç³»ç»ŸåŸºäºBIMæ•°æ®åˆ¶å®šç»´æŠ¤è®¡åˆ’ï¼Œ
è·Ÿè¸ªç»´æŠ¤æ‰§è¡Œï¼Œä¼˜åŒ–ç»´æŠ¤ç­–ç•¥ï¼Œå»¶é•¿è®¾å¤‡å¯¿å‘½ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦BIMæ•°æ®ä¸ç»´æŠ¤æ•°æ®å…³è”
- éœ€è¦ç»´æŠ¤è®¡åˆ’åˆ¶å®š
- éœ€è¦ç»´æŠ¤æ‰§è¡Œè·Ÿè¸ª
- éœ€è¦ç»´æŠ¤æ•ˆæœè¯„ä¼°

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BIM_Schemaæ•´åˆç»´æŠ¤æ•°æ®ï¼Œ
ä½¿ç”¨ç»´æŠ¤ç®—æ³•åˆ¶å®šç»´æŠ¤è®¡åˆ’ï¼Œ
ä½¿ç”¨BIMStorageå­˜å‚¨ç»´æŠ¤æ•°æ®ã€‚

### 11.2 Schemaå®šä¹‰

**å»ºç­‘ç»´æŠ¤ç®¡ç†Schema**ï¼š

```dsl
schema BuildingMaintenanceManagement {
  maintenance_session_id: String @value("MAINT-20250121-001") @required
  building_id: String @value("BUILDING-001") @required
  equipment_id: String @value("EQUIP-001") @required

  equipment_info: {
    equipment_type: String @value("HVAC System")
    manufacturer: String @value("Manufacturer A")
    installation_date: Date @value("2020-01-15")
    warranty_expiry: Date @value("2025-01-15")
    last_maintenance_date: Date @value("2024-12-15")
    maintenance_interval: Integer @value(30) @unit("days")
  } @required

  maintenance_plan: {
    maintenance_type: Enum { Preventive } @value(Preventive)
    scheduled_date: Date @value("2025-01-25")
    maintenance_tasks: [
      {
        task: String @value("æ›´æ¢è¿‡æ»¤å™¨")
        priority: Enum { High } @value(High)
        estimated_duration: Integer @value(2) @unit("hours")
        required_parts: [String] @value(["Filter-001"])
      },
      {
        task: String @value("æ¸…æ´è®¾å¤‡")
        priority: Enum { Medium } @value(Medium)
        estimated_duration: Integer @value(1) @unit("hours")
      }
    ]
    estimated_cost: Decimal @value(500.0) @unit("RMB")
  } @required

  maintenance_history: {
    total_maintenances: Integer @value(24)
    average_interval: Decimal @value(30.5) @unit("days")
    total_cost: Decimal @value(12000.0) @unit("RMB")
    equipment_reliability: Decimal @value(0.95) @range(0.0, 1.0)
  } @required
} @standard("COBie")
```

### 11.3 å®ç°ä»£ç 

```python
from bim_storage import BIMStorage
from datetime import datetime, date, timedelta

def building_maintenance_management():
    """å»ºç­‘ç»´æŠ¤ç®¡ç†ç³»ç»Ÿç¤ºä¾‹"""
    storage = BIMStorage("postgresql://user:password@localhost/bim_db")

    # è®¾å¤‡ä¿¡æ¯
    equipment_info = {
        "equipment_id": "EQUIP-001",
        "building_id": "BUILDING-001",
        "equipment_type": "HVAC System",
        "manufacturer": "Manufacturer A",
        "installation_date": date(2020, 1, 15),
        "warranty_expiry": date(2025, 1, 15),
        "last_maintenance_date": date(2024, 12, 15),
        "maintenance_interval": 30  # days
    }

    # ç»´æŠ¤è®¡åˆ’åˆ¶å®šç®—æ³•
    def create_maintenance_plan(equipment_info):
        """åˆ¶å®šç»´æŠ¤è®¡åˆ’"""
        days_since_last_maintenance = (date.today() - equipment_info["last_maintenance_date"]).days

        # æ£€æŸ¥æ˜¯å¦éœ€è¦ç»´æŠ¤
        if days_since_last_maintenance >= equipment_info["maintenance_interval"]:
            scheduled_date = date.today() + timedelta(days=5)

            maintenance_tasks = [
                {
                    "task": "æ›´æ¢è¿‡æ»¤å™¨",
                    "priority": "High",
                    "estimated_duration": 2,
                    "required_parts": ["Filter-001"]
                },
                {
                    "task": "æ¸…æ´è®¾å¤‡",
                    "priority": "Medium",
                    "estimated_duration": 1,
                    "required_parts": []
                }
            ]

            estimated_cost = sum(
                200 if task["priority"] == "High" else 100
                for task in maintenance_tasks
            )

            return {
                "maintenance_type": "Preventive",
                "scheduled_date": scheduled_date,
                "maintenance_tasks": maintenance_tasks,
                "estimated_cost": estimated_cost
            }

        return None

    # åˆ¶å®šç»´æŠ¤è®¡åˆ’
    maintenance_plan = create_maintenance_plan(equipment_info)

    # ç»´æŠ¤å†å²æ•°æ®
    maintenance_history = {
        "total_maintenances": 24,
        "average_interval": 30.5,
        "total_cost": 12000.0,
        "equipment_reliability": 0.95
    }

    # å­˜å‚¨ç»´æŠ¤æ•°æ®
    if maintenance_plan:
        maintenance_data = {
            "maintenance_session_id": "MAINT-20250121-001",
            "building_id": equipment_info["building_id"],
            "equipment_id": equipment_info["equipment_id"],
            "equipment_type": equipment_info["equipment_type"],
            "manufacturer": equipment_info["manufacturer"],
            "installation_date": equipment_info["installation_date"],
            "warranty_expiry": equipment_info["warranty_expiry"],
            "last_maintenance_date": equipment_info["last_maintenance_date"],
            "maintenance_interval": equipment_info["maintenance_interval"],
            "maintenance_type": maintenance_plan["maintenance_type"],
            "scheduled_date": maintenance_plan["scheduled_date"],
            "maintenance_tasks": maintenance_plan["maintenance_tasks"],
            "estimated_cost": maintenance_plan["estimated_cost"],
            "total_maintenances": maintenance_history["total_maintenances"],
            "average_interval": maintenance_history["average_interval"],
            "total_cost": maintenance_history["total_cost"],
            "equipment_reliability": maintenance_history["equipment_reliability"]
        }

        # å­˜å‚¨åˆ°æ•°æ®åº“
        maintenance_id = storage.store_bim_data(maintenance_data)
        print(f"Maintenance plan stored: {maintenance_id}")

        print(f"\nBuilding Maintenance Management:")
        print(f"  Equipment: {equipment_info['equipment_id']}")
        print(f"  Equipment type: {equipment_info['equipment_type']}")
        print(f"  Scheduled date: {maintenance_plan['scheduled_date']}")
        print(f"  Maintenance tasks: {len(maintenance_plan['maintenance_tasks'])}")
        print(f"  Estimated cost: Â¥{maintenance_plan['estimated_cost']:.2f}")
        print(f"  Equipment reliability: {maintenance_history['equipment_reliability']:.2f}")

        return maintenance_data
    else:
        print("No maintenance required at this time")
        return None

if __name__ == "__main__":
    building_maintenance_management()
```

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
