# åª’ä½“å¨±ä¹Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
- [2. ä¼ä¸šèƒŒæ™¯](#2-ä¼ä¸šèƒŒæ™¯)
- [3. ä¸šåŠ¡ç—›ç‚¹ä¸ç›®æ ‡](#3-ä¸šåŠ¡ç—›ç‚¹ä¸ç›®æ ‡)
- [4. æŠ€æœ¯æŒ‘æˆ˜](#4-æŠ€æœ¯æŒ‘æˆ˜)
- [5. è§£å†³æ–¹æ¡ˆæ¶æ„](#5-è§£å†³æ–¹æ¡ˆæ¶æ„)
- [6. å®Œæ•´å®ç°ä»£ç ](#6-å®Œæ•´å®ç°ä»£ç )
- [7. æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ](#7-æ•ˆæœè¯„ä¼°ä¸roiåˆ†æ)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›åª’ä½“å¨±ä¹è¡Œä¸šSchemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®Œæ•´å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–å†…å®¹ç®¡ç†ã€ç”¨æˆ·ç”»åƒã€æ¨èç³»ç»Ÿã€ç‰ˆæƒç®¡ç†ã€å¹¿å‘ŠæŠ•æ”¾ç­‰æ ¸å¿ƒåœºæ™¯ã€‚

---

## 2. ä¼ä¸šèƒŒæ™¯

### 2.1 ä¼ä¸šæ¦‚å†µ

**ä¼ä¸šåç§°**ï¼šæ˜Ÿè¾°ä¼ åª’å¨±ä¹é›†å›¢ï¼ˆè™šæ„æ¡ˆä¾‹ä¼ä¸šï¼‰

**ä¼ä¸šè§„æ¨¡**ï¼š
- æœˆæ´»è·ƒç”¨æˆ·ï¼š1.5äº¿
- å†…å®¹åº“å­˜ï¼š200ä¸‡+å°æ—¶
- åˆä½œå†…å®¹æ–¹ï¼š500+å®¶
- å¹´è¥ä¸šé¢ï¼š85äº¿å…ƒäººæ°‘å¸

---

## 3. ä¸šåŠ¡ç—›ç‚¹ä¸ç›®æ ‡

### 3.1 äº”å¤§ä¸šåŠ¡ç—›ç‚¹

| åºå· | ç—›ç‚¹ | å…·ä½“è¡¨ç° | å½±å“ç¨‹åº¦ |
|------|------|----------|----------|
| 1 | **å†…å®¹å‘ç°éš¾** | é•¿å°¾å†…å®¹æ›å…‰ç‡ä½ | é«˜ |
| 2 | **ç‰ˆæƒç®¡ç†ä¹±** | æˆæƒåˆ°æœŸæœªåŠæ—¶å‘ç° | é«˜ |
| 3 | **ç”¨æˆ·æµå¤±å¿«** | æœˆæµå¤±ç‡8% | é«˜ |
| 4 | **å¹¿å‘Šæ•ˆæœå·®** | ç‚¹å‡»ç‡ä½äº1% | ä¸­ |
| 5 | **å†…å®¹å®¡æ ¸æ…¢** | äººå·¥å®¡æ ¸æ•ˆç‡ä½ | ä¸­ |

### 3.2 äº”å¤§ä¸šåŠ¡ç›®æ ‡

| åºå· | ç›®æ ‡ | å…·ä½“æŒ‡æ ‡ | å®ŒæˆæœŸé™ |
|------|------|----------|----------|
| 1 | **ä¸ªæ€§åŒ–æ¨è** | æ¨èç‚¹å‡»ç‡>15% | 12ä¸ªæœˆ |
| 2 | **ç‰ˆæƒè‡ªåŠ¨åŒ–** | 100%æˆæƒè‡ªåŠ¨ç®¡ç† | 9ä¸ªæœˆ |
| 3 | **é™ä½æµå¤±ç‡** | æœˆæµå¤±ç‡<5% | 12ä¸ªæœˆ |
| 4 | **ç²¾å‡†æŠ•æ”¾** | å¹¿å‘ŠROIæå‡100% | 12ä¸ªæœˆ |
| 5 | **æ™ºèƒ½å®¡æ ¸** | 90%å†…å®¹è‡ªåŠ¨è¿‡å®¡ | 9ä¸ªæœˆ |

---

## 4. æŠ€æœ¯æŒ‘æˆ˜

1. **æµ·é‡å†…å®¹å¤„ç†**ï¼šç™¾ä¸‡å°æ—¶å†…å®¹çš„å­˜å‚¨å’Œæ£€ç´¢
2. **å®æ—¶æ¨è**ï¼šæ¯«ç§’çº§ä¸ªæ€§åŒ–æ¨è
3. **å¤šæ¨¡æ€ç†è§£**ï¼šè§†é¢‘ã€éŸ³é¢‘ã€æ–‡æœ¬çš„è”åˆç†è§£
4. **ç‰ˆæƒè¿½è¸ª**ï¼šå†…å®¹çš„ç‰ˆæƒçŠ¶æ€å’Œä¼ æ’­è¿½è¸ª
5. **AIGCç®¡ç†**ï¼šAIç”Ÿæˆå†…å®¹çš„è¯†åˆ«å’Œç®¡ç†

---

## 5. è§£å†³æ–¹æ¡ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚                                    â”‚
â”‚  è§†é¢‘APP  éŸ³ä¹APP  æ¸¸æˆå¹³å°  ç¤¾äº¤ç¤¾åŒº  å¹¿å‘Šå¹³å°              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æœåŠ¡å±‚                                    â”‚
â”‚  æ¨èå¼•æ“  æœç´¢æœåŠ¡  å†…å®¹ç†è§£  ç‰ˆæƒç®¡ç†  ç”¨æˆ·ç”»åƒ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å±‚                                    â”‚
â”‚  å†…å®¹åº“  ç”¨æˆ·åº“  è¡Œä¸ºåº“  çŸ¥è¯†å›¾è°±  ç‰¹å¾åº“                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚                                â”‚
â”‚  CDN  å¯¹è±¡å­˜å‚¨  æµåª’ä½“  AIè®¡ç®—  å¤§æ•°æ®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å®Œæ•´å®ç°ä»£ç 

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
åª’ä½“å¨±ä¹Schemaå®è·µæ¡ˆä¾‹
ä¼ä¸šï¼šæ˜Ÿè¾°ä¼ åª’å¨±ä¹é›†å›¢
"""

import json
import uuid
from datetime import datetime, date, timedelta
from typing import Dict, List, Optional, Any, Set
from dataclasses import dataclass, field
from enum import Enum
import random
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


class ContentType(Enum):
    """å†…å®¹ç±»å‹"""
    VIDEO = "è§†é¢‘"
    MUSIC = "éŸ³ä¹"
    GAME = "æ¸¸æˆ"
    LIVE = "ç›´æ’­"
    SHORT_VIDEO = "çŸ­è§†é¢‘"


class ContentGenre(Enum):
    """å†…å®¹é¢˜æ"""
    ACTION = "åŠ¨ä½œ"
    COMEDY = "å–œå‰§"
    DRAMA = "å‰§æƒ…"
    ROMANCE = "çˆ±æƒ…"
    SCIFI = "ç§‘å¹»"
    DOCUMENTARY = "çºªå½•ç‰‡"
    MUSIC_POP = "æµè¡Œ"
    MUSIC_ROCK = "æ‘‡æ»š"
    MUSIC_CLASSICAL = "å¤å…¸"


class UserTier(Enum):
    """ç”¨æˆ·ç­‰çº§"""
    FREE = "å…è´¹"
    VIP = "VIP"
    SVIP = "è¶…çº§VIP"


class AdType(Enum):
    """å¹¿å‘Šç±»å‹"""
    PRE_ROLL = "å‰è´´ç‰‡"
    MID_ROLL = "ä¸­æ’"
    POST_ROLL = "åè´´ç‰‡"
    BANNER = "æ¨ªå¹…"
    NATIVE = "åŸç”Ÿ"


@dataclass
class ContentItem:
    """å†…å®¹é¡¹"""
    content_id: str
    title: str
    content_type: ContentType
    genres: List[ContentGenre] = field(default_factory=list)
    duration_seconds: int = 0
    release_date: date = field(default_factory=date.today)
    rating: float = 0.0  # è¯„åˆ† 0-10
    view_count: int = 0
    like_count: int = 0
    
    # å†…å®¹å±æ€§
    cast: List[str] = field(default_factory=list)
    director: str = ""
    tags: List[str] = field(default_factory=list)
    
    # ç‰ˆæƒä¿¡æ¯
    copyright_holder: str = ""
    license_start: Optional[date] = None
    license_end: Optional[date] = None
    
    def is_available(self) -> bool:
        """æ£€æŸ¥å†…å®¹æ˜¯å¦å¯ç”¨"""
        today = date.today()
        if self.license_start and today < self.license_start:
            return False
        if self.license_end and today > self.license_end:
            return False
        return True
    
    def to_dict(self) -> Dict:
        return {
            "content_id": self.content_id,
            "title": self.title,
            "content_type": self.content_type.value,
            "genres": [g.value for g in self.genres],
            "duration": f"{self.duration_seconds // 60}åˆ†{self.duration_seconds % 60}ç§’",
            "rating": self.rating,
            "view_count": self.view_count,
            "is_available": self.is_available()
        }


@dataclass
class UserProfile:
    """ç”¨æˆ·ç”»åƒ"""
    user_id: str
    username: str
    tier: UserTier = UserTier.FREE
    registration_date: date = field(default_factory=date.today)
    
    # å…´è¶£æ ‡ç­¾
    preferred_genres: List[ContentGenre] = field(default_factory=list)
    preferred_content_types: List[ContentType] = field(default_factory=list)
    
    # è¡Œä¸ºç»Ÿè®¡
    total_watch_time: int = 0  # åˆ†é’Ÿ
    favorite_cast: List[str] = field(default_factory=list)
    watch_history: List[str] = field(default_factory=list)
    
    # ä»·å€¼æŒ‡æ ‡
    lifetime_value: float = 0.0
    churn_risk: float = 0.0
    
    def update_churn_risk(self, days_since_last_active: int):
        """æ›´æ–°æµå¤±é£é™©"""
        if days_since_last_active > 30:
            self.churn_risk = 0.8
        elif days_since_last_active > 14:
            self.churn_risk = 0.5
        elif days_since_last_active > 7:
            self.churn_risk = 0.2
        else:
            self.churn_risk = 0.05
    
    def to_dict(self) -> Dict:
        return {
            "user_id": self.user_id,
            "username": self.username,
            "tier": self.tier.value,
            "preferred_genres": [g.value for g in self.preferred_genres],
            "total_watch_time": self.total_watch_time,
            "churn_risk": round(self.churn_risk, 2)
        }


@dataclass
class UserEvent:
    """ç”¨æˆ·è¡Œä¸ºäº‹ä»¶"""
    event_id: str
    user_id: str
    content_id: str
    event_type: str  # play, pause, like, share, complete
    timestamp: datetime
    duration_watched: int = 0  # è§‚çœ‹æ—¶é•¿ï¼ˆç§’ï¼‰
    device_type: str = ""
    location: str = ""
    
    def to_dict(self) -> Dict:
        return {
            "event_id": self.event_id,
            "user_id": self.user_id,
            "content_id": self.content_id,
            "event_type": self.event_type,
            "timestamp": self.timestamp.isoformat()
        }


@dataclass
class Copyright:
    """ç‰ˆæƒä¿¡æ¯"""
    copyright_id: str
    content_id: str
    holder_name: str
    license_type: str  # exclusive, non-exclusive
    territory: List[str] = field(default_factory=list)
    start_date: date = field(default_factory=date.today)
    end_date: date = field(default_factory=lambda: date.today() + timedelta(days=365))
    usage_rights: List[str] = field(default_factory=list)
    
    def days_until_expiry(self) -> int:
        """è·ç¦»åˆ°æœŸå¤©æ•°"""
        return (self.end_date - date.today()).days
    
    def is_expiring_soon(self, days: int = 30) -> bool:
        """æ˜¯å¦å³å°†åˆ°æœŸ"""
        return 0 < self.days_until_expiry() <= days
    
    def to_dict(self) -> Dict:
        return {
            "copyright_id": self.copyright_id,
            "content_id": self.content_id,
            "holder_name": self.holder_name,
            "license_type": self.license_type,
            "start_date": self.start_date.isoformat(),
            "end_date": self.end_date.isoformat(),
            "days_until_expiry": self.days_until_expiry(),
            "is_expiring_soon": self.is_expiring_soon()
        }


@dataclass
class Ad:
    """å¹¿å‘Š"""
    ad_id: str
    ad_type: AdType
    title: str
    advertiser: str
    target_audience: Dict[str, Any] = field(default_factory=dict)
    budget: float = 0.0
    cpm: float = 0.0  # åƒæ¬¡å±•ç¤ºæˆæœ¬
    ctr_target: float = 0.01  # ç›®æ ‡ç‚¹å‡»ç‡
    
    # æŠ•æ”¾æ•°æ®
    impressions: int = 0
    clicks: int = 0
    
    @property
    def ctr(self) -> float:
        return self.clicks / self.impressions if self.impressions > 0 else 0
    
    @property
    def spend(self) -> float:
        return self.impressions / 1000 * self.cpm
    
    def to_dict(self) -> Dict:
        return {
            "ad_id": self.ad_id,
            "ad_type": self.ad_type.value,
            "title": self.title,
            "advertiser": self.advertiser,
            "ctr": round(self.ctr, 4),
            "spend": round(self.spend, 2)
        }


class RecommendationEngine:
    """æ¨èå¼•æ“"""
    
    def __init__(self):
        self.content_pool: Dict[str, ContentItem] = {}
        self.user_profiles: Dict[str, UserProfile] = {}
        self.content_features: Dict[str, Dict] = {}
        self.similarity_matrix: Dict[str, Dict[str, float]] = {}
    
    def add_content(self, content: ContentItem):
        """æ·»åŠ å†…å®¹"""
        self.content_pool[content.content_id] = content
        # æå–å†…å®¹ç‰¹å¾
        self.content_features[content.content_id] = {
            "genres": [g.value for g in content.genres],
            "type": content.content_type.value,
            "rating": content.rating,
            "popularity": content.view_count
        }
    
    def add_user(self, user: UserProfile):
        """æ·»åŠ ç”¨æˆ·"""
        self.user_profiles[user.user_id] = user
    
    def calculate_similarity(self, content1_id: str, content2_id: str) -> float:
        """è®¡ç®—å†…å®¹ç›¸ä¼¼åº¦"""
        c1 = self.content_pool.get(content1_id)
        c2 = self.content_pool.get(content2_id)
        
        if not c1 or not c2:
            return 0.0
        
        # åŸºäºç±»å‹çš„ç›¸ä¼¼åº¦
        if c1.content_type != c2.content_type:
            return 0.1
        
        # åŸºäºé¢˜æçš„ç›¸ä¼¼åº¦
        genre_overlap = len(set(c1.genres) & set(c2.genres))
        genre_sim = genre_overlap / max(len(c1.genres), len(c2.genres), 1)
        
        # ç»¼åˆç›¸ä¼¼åº¦
        return 0.3 + 0.5 * genre_sim + 0.2 * (min(c1.rating, c2.rating) / 10)
    
    def recommend(self, user_id: str, top_k: int = 10) -> List[Dict]:
        """ä¸ºç”¨æˆ·æ¨èå†…å®¹"""
        user = self.user_profiles.get(user_id)
        if not user:
            return []
        
        scores = {}
        
        for content_id, content in self.content_pool.items():
            if not content.is_available():
                continue
            
            score = 0.0
            
            # 1. åŸºäºç”¨æˆ·åå¥½çš„åŒ¹é…åº¦
            genre_match = len(set(user.preferred_genres) & set(content.genres))
            score += genre_match * 0.3
            
            type_match = content.content_type in user.preferred_content_types
            score += 0.2 if type_match else 0
            
            # 2. åŸºäºçƒ­é—¨åº¦
            score += min(content.view_count / 1000000, 0.2)
            
            # 3. åŸºäºè¯„åˆ†
            score += content.rating / 10 * 0.2
            
            # 4. åŸºäºè§‚çœ‹å†å²ï¼ˆååŒè¿‡æ»¤ç®€åŒ–ç‰ˆï¼‰
            for watched_id in user.watch_history[-5:]:
                sim = self.calculate_similarity(content_id, watched_id)
                score += sim * 0.3
            
            # 5. å»é‡æƒ©ç½š
            if content_id in user.watch_history:
                score *= 0.3
            
            scores[content_id] = score
        
        # æ’åºå–TopK
        sorted_content = sorted(scores.items(), key=lambda x: x[1], reverse=True)
        
        recommendations = []
        for content_id, score in sorted_content[:top_k]:
            content = self.content_pool[content_id]
            recommendations.append({
                "content_id": content_id,
                "title": content.title,
                "type": content.content_type.value,
                "score": round(score, 3),
                "reason": self._generate_reason(user, content)
            })
        
        return recommendations
    
    def _generate_reason(self, user: UserProfile, content: ContentItem) -> str:
        """ç”Ÿæˆæ¨èç†ç”±"""
        if user.preferred_genres and content.genres:
            overlap = set(user.preferred_genres) & set(content.genres)
            if overlap:
                return f"å› ä¸ºä½ å–œæ¬¢{list(overlap)[0].value}"
        
        if content.view_count > 1000000:
            return "è¿‘æœŸçƒ­é—¨"
        
        if content.rating > 8:
            return "é«˜åˆ†æ¨è"
        
        return "çŒœä½ å–œæ¬¢"


class CopyrightManager:
    """ç‰ˆæƒç®¡ç†å™¨"""
    
    def __init__(self):
        self.copyrights: Dict[str, Copyright] = {}
        self.alerts: List[Dict] = []
    
    def register_copyright(self, copyright: Copyright):
        """æ³¨å†Œç‰ˆæƒ"""
        self.copyrights[copyright.copyright_id] = copyright
        logger.info(f"Registered copyright: {copyright.copyright_id}")
    
    def check_expiring_copyrights(self, days: int = 30) -> List[Copyright]:
        """æ£€æŸ¥å³å°†åˆ°æœŸçš„ç‰ˆæƒ"""
        expiring = []
        for cp in self.copyrights.values():
            if cp.is_expiring_soon(days):
                expiring.append(cp)
                self.alerts.append({
                    "type": "copyright_expiring",
                    "copyright_id": cp.copyright_id,
                    "content_id": cp.content_id,
                    "days_left": cp.days_until_expiry(),
                    "timestamp": datetime.now().isoformat()
                })
        return expiring
    
    def get_copyright_summary(self) -> Dict:
        """è·å–ç‰ˆæƒæ‘˜è¦"""
        total = len(self.copyrights)
        active = sum(1 for cp in self.copyrights.values() if cp.days_until_expiry() > 0)
        expiring_soon = len(self.check_expiring_copyrights(30))
        expired = sum(1 for cp in self.copyrights.values() if cp.days_until_expiry() <= 0)
        
        return {
            "total_copyrights": total,
            "active": active,
            "expiring_soon": expiring_soon,
            "expired": expired
        }


class AdPlatform:
    """å¹¿å‘Šå¹³å°"""
    
    def __init__(self):
        self.ads: Dict[str, Ad] = {}
        self.delivery_log: List[Dict] = []
    
    def create_ad(self, ad: Ad):
        """åˆ›å»ºå¹¿å‘Š"""
        self.ads[ad.ad_id] = ad
    
    def select_ad(self, user: UserProfile, content: ContentItem) -> Optional[Ad]:
        """ä¸ºç”¨æˆ·å’Œå†…å®¹é€‰æ‹©å¹¿å‘Š"""
        # åŸºäºç”¨æˆ·ç­‰çº§çš„ç­–ç•¥
        if user.tier == UserTier.SVIP:
            return None  # SVIPå…å¹¿å‘Š
        
        # åŸºäºå†…å®¹çš„å¹¿å‘ŠåŒ¹é…
        available_ads = [ad for ad in self.ads.values() if ad.budget > ad.spend]
        
        if not available_ads:
            return None
        
        # é€‰æ‹©æœ€åŒ¹é…çš„å¹¿å‘Šï¼ˆç®€åŒ–ç‰ˆï¼‰
        return random.choice(available_ads)
    
    def deliver_ad(self, ad_id: str, user_id: str, content_id: str) -> bool:
        """æŠ•æ”¾å¹¿å‘Š"""
        ad = self.ads.get(ad_id)
        if not ad:
            return False
        
        ad.impressions += 1
        
        self.delivery_log.append({
            "ad_id": ad_id,
            "user_id": user_id,
            "content_id": content_id,
            "timestamp": datetime.now().isoformat(),
            "impression": True
        })
        
        return True
    
    def record_click(self, ad_id: str, user_id: str):
        """è®°å½•ç‚¹å‡»"""
        ad = self.ads.get(ad_id)
        if ad:
            ad.clicks += 1
            
            self.delivery_log.append({
                "ad_id": ad_id,
                "user_id": user_id,
                "timestamp": datetime.now().isoformat(),
                "click": True
            })
    
    def get_ad_report(self, ad_id: str) -> Dict:
        """è·å–å¹¿å‘ŠæŠ¥å‘Š"""
        ad = self.ads.get(ad_id)
        if not ad:
            return {}
        
        return {
            "ad_id": ad_id,
            "impressions": ad.impressions,
            "clicks": ad.clicks,
            "ctr": round(ad.ctr * 100, 2),
            "spend": round(ad.spend, 2),
            "budget_left": round(ad.budget - ad.spend, 2)
        }


class MediaPlatform:
    """åª’ä½“å¹³å°"""
    
    def __init__(self):
        self.recommendation_engine = RecommendationEngine()
        self.copyright_manager = CopyrightManager()
        self.ad_platform = AdPlatform()
        self.events: List[UserEvent] = []
    
    def record_event(self, event: UserEvent):
        """è®°å½•ç”¨æˆ·äº‹ä»¶"""
        self.events.append(event)
        
        # æ›´æ–°ç”¨æˆ·ç”»åƒ
        user = self.recommendation_engine.user_profiles.get(event.user_id)
        if user:
            if event.event_type == "complete":
                content = self.recommendation_engine.content_pool.get(event.content_id)
                if content:
                    user.watch_history.append(event.content_id)
                    user.total_watch_time += event.duration_watched // 60
    
    def get_user_dashboard(self, user_id: str) -> Dict:
        """è·å–ç”¨æˆ·ä»ªè¡¨æ¿"""
        user = self.recommendation_engine.user_profiles.get(user_id)
        if not user:
            return {}
        
        # è·å–æ¨è
        recommendations = self.recommendation_engine.recommend(user_id, top_k=6)
        
        # æ£€æŸ¥å¹¿å‘Š
        content = random.choice(list(self.recommendation_engine.content_pool.values()))
        ad = self.ad_platform.select_ad(user, content)
        
        return {
            "user": user.to_dict(),
            "recommendations": recommendations,
            "ad": ad.to_dict() if ad else None,
            "watch_history_count": len(user.watch_history)
        }


def create_demo_platform():
    """åˆ›å»ºæ¼”ç¤ºå¹³å°"""
    platform = MediaPlatform()
    
    # æ·»åŠ å†…å®¹
    contents = [
        ContentItem("MOV-001", "æ˜Ÿé™…ç©¿è¶Š", ContentType.VIDEO, 
                   [ContentGenre.SCIFI, ContentGenre.DRAMA], 10800, rating=9.3,
                   view_count=5000000, cast=["é©¬ä¿®Â·éº¦åº·çº³", "å®‰å¦®Â·æµ·ç‘Ÿè–‡"]),
        ContentItem("MOV-002", "è‚–ç”³å…‹çš„æ•‘èµ", ContentType.VIDEO,
                   [ContentGenre.DRAMA], 8400, rating=9.7,
                   view_count=8000000),
        ContentItem("MUS-001", "æ™´å¤©", ContentType.MUSIC,
                   [ContentGenre.MUSIC_POP], 240, rating=9.0,
                   view_count=10000000),
        ContentItem("MUS-002", "è´å¤šèŠ¬ç¬¬ä¹äº¤å“æ›²", ContentType.MUSIC,
                   [ContentGenre.MUSIC_CLASSICAL], 3600, rating=9.5,
                   view_count=500000),
        ContentItem("SV-001", "æç¬‘åˆé›†", ContentType.SHORT_VIDEO,
                   [ContentGenre.COMEDY], 180, rating=8.5,
                   view_count=20000000),
    ]
    
    for content in contents:
        platform.recommendation_engine.add_content(content)
    
    # æ·»åŠ ç”¨æˆ·
    users = [
        UserProfile("U001", "ç”¨æˆ·A", UserTier.VIP, preferred_genres=[ContentGenre.SCIFI, ContentGenre.ACTION]),
        UserProfile("U002", "ç”¨æˆ·B", UserTier.SVIP, preferred_genres=[ContentGenre.MUSIC_POP]),
        UserProfile("U003", "ç”¨æˆ·C", UserTier.FREE),
    ]
    
    for user in users:
        platform.recommendation_engine.add_user(user)
    
    # æ·»åŠ ç‰ˆæƒ
    copyrights = [
        Copyright("CP-001", "MOV-001", "æ´¾æ‹‰è’™å½±ä¸š", "non-exclusive",
                 end_date=date(2025, 12, 31)),
        Copyright("CP-002", "MOV-002", "åçº³å…„å¼Ÿ", "non-exclusive",
                 end_date=date(2025, 6, 30)),
    ]
    
    for cp in copyrights:
        platform.copyright_manager.register_copyright(cp)
    
    # æ·»åŠ å¹¿å‘Š
    ads = [
        Ad("AD-001", AdType.PRE_ROLL, "æ–°ç‰‡é¢„å‘Š", "å½±ä¸šå…¬å¸A", cpm=50, budget=100000),
        Ad("AD-002", AdType.NATIVE, "æ¸¸æˆæ¨å¹¿", "æ¸¸æˆå…¬å¸B", cpm=30, budget=50000),
    ]
    
    for ad in ads:
        platform.ad_platform.create_ad(ad)
    
    return platform


def main():
    """ä¸»å‡½æ•°"""
    print("=" * 80)
    print("åª’ä½“å¨±ä¹Schemaå®è·µæ¡ˆä¾‹ - æ˜Ÿè¾°ä¼ åª’")
    print("=" * 80)
    
    # åˆ›å»ºå¹³å°
    print("\nã€æ­¥éª¤1ã€‘åˆå§‹åŒ–åª’ä½“å¹³å°...")
    platform = create_demo_platform()
    print(f"  å†…å®¹æ•°é‡: {len(platform.recommendation_engine.content_pool)}")
    print(f"  ç”¨æˆ·æ•°: {len(platform.recommendation_engine.user_profiles)}")
    print(f"  å¹¿å‘Šæ•°: {len(platform.ad_platform.ads)}")
    
    # ä¸ªæ€§åŒ–æ¨è
    print("\nã€æ­¥éª¤2ã€‘ä¸ªæ€§åŒ–å†…å®¹æ¨è...")
    for user_id in ["U001", "U002"]:
        recommendations = platform.recommendation_engine.recommend(user_id, top_k=3)
        user = platform.recommendation_engine.user_profiles[user_id]
        print(f"\n  {user.username} (ç­‰çº§: {user.tier.value}):")
        for rec in recommendations:
            print(f"    - {rec['title']} ({rec['type']}) [{rec['reason']}]")
    
    # ç‰ˆæƒç®¡ç†
    print("\nã€æ­¥éª¤3ã€‘ç‰ˆæƒåˆ°æœŸæ£€æŸ¥...")
    expiring = platform.copyright_manager.check_expiring_copyrights(30)
    summary = platform.copyright_manager.get_copyright_summary()
    print(f"  ç‰ˆæƒæ€»æ•°: {summary['total_copyrights']}")
    print(f"  å³å°†åˆ°æœŸ: {summary['expiring_soon']}")
    for cp in expiring:
        print(f"    - å†…å®¹ID: {cp.content_id}, å‰©ä½™{cp.days_until_expiry()}å¤©")
    
    # å¹¿å‘ŠæŠ•æ”¾
    print("\nã€æ­¥éª¤4ã€‘å¹¿å‘ŠæŠ•æ”¾æ¼”ç¤º...")
    user = platform.recommendation_engine.user_profiles["U001"]
    content = platform.recommendation_engine.content_pool["MOV-001"]
    ad = platform.ad_platform.select_ad(user, content)
    if ad:
        platform.ad_platform.deliver_ad(ad.ad_id, user.user_id, content.content_id)
        print(f"  ä¸ºç”¨æˆ· {user.username} æŠ•æ”¾å¹¿å‘Š: {ad.title}")
        print(f"  å¹¿å‘Šç±»å‹: {ad.ad_type.value}")
    else:
        print(f"  ç”¨æˆ· {user.username} å…å¹¿å‘Š")
    
    # å¹¿å‘ŠæŠ¥å‘Š
    print("\nã€æ­¥éª¤5ã€‘å¹¿å‘Šæ•ˆæœæŠ¥å‘Š...")
    for ad_id in ["AD-001"]:
        report = platform.ad_platform.get_ad_report(ad_id)
        print(f"  å¹¿å‘Š: {ad_id}")
        print(f"    å±•ç¤º: {report['impressions']}, ç‚¹å‡»: {report['clicks']}")
        print(f"    CTR: {report['ctr']}%")
        print(f"    æ¶ˆè€—: Â¥{report['spend']}")
    
    # ç”¨æˆ·ä»ªè¡¨æ¿
    print("\nã€æ­¥éª¤6ã€‘ç”¨æˆ·ä»ªè¡¨æ¿...")
    dashboard = platform.get_user_dashboard("U001")
    print(f"  ç”¨æˆ·: {dashboard['user']['username']}")
    print(f"  æµå¤±é£é™©: {dashboard['user']['churn_risk']}")
    print(f"  æ¨èæ•°: {len(dashboard['recommendations'])}")
    
    print("\n" + "=" * 80)
    print("åª’ä½“å¨±ä¹Schemaå®è·µæ¡ˆä¾‹æ‰§è¡Œå®Œæˆ")
    print("=" * 80)


if __name__ == "__main__":
    main()
```

---

## 7. æ•ˆæœè¯„ä¼°ä¸ROIåˆ†æ

### 7.1 å…³é”®ç»©æ•ˆæŒ‡æ ‡

| æŒ‡æ ‡ | å®æ–½å‰ | å®æ–½å | æ”¹å–„ |
|------|--------|--------|------|
| æ¨èç‚¹å‡»ç‡ | 3% | 18% | +500% |
| ç‰ˆæƒåˆ°æœŸé—æ¼ | 20èµ·/å¹´ | 0èµ· | -100% |
| æœˆæµå¤±ç‡ | 8% | 4.5% | -44% |
| å¹¿å‘ŠCTR | 0.5% | 2.5% | +400% |
| å®¡æ ¸æ•ˆç‡ | 100æ¡/äººå¤© | 1000æ¡/äººå¤© | +900% |

### 7.2 ROIåˆ†æ

**æŠ•èµ„**ï¼šÂ¥800ä¸‡  
**å¹´æ”¶ç›Š**ï¼šÂ¥3200ä¸‡  
**ROI**ï¼š300%ï¼ˆ3å¹´ï¼‰

---

**åˆ›å»ºæ—¶é—´**ï¼š2026-02-15  
**ç‰ˆæœ¬**ï¼š1.0.0
