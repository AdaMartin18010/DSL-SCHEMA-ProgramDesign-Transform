# è´¨é‡ç®¡ç†Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [è´¨é‡ç®¡ç†Schemaå®è·µæ¡ˆä¾‹](#è´¨é‡ç®¡ç†schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´¨é‡ä½“ç³»ç®¡ç†ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šè´¨é‡ä½“ç³»ç®¡ç†ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è´¨é‡ç®¡ç†Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–è´¨é‡ä½“ç³»ç®¡ç†ã€è´¨é‡æ£€éªŒã€ä¸åˆæ ¼å“ç®¡ç†ã€è´¨é‡æ”¹è¿›ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šè´¨é‡ä½“ç³»ç®¡ç†ç³»ç»Ÿ**ï¼šISO 9001è´¨é‡ç®¡ç†ä½“ç³»ç®¡ç†
2. **è´¨é‡æ£€éªŒç®¡ç†ç³»ç»Ÿ**ï¼šè´¨é‡æ£€éªŒæ•°æ®è®°å½•å’Œåˆ†æ
3. **ä¸åˆæ ¼å“ç®¡ç†ç³»ç»Ÿ**ï¼šä¸åˆæ ¼å“å¤„ç†å’Œè·Ÿè¸ª
4. **è´¨é‡æ”¹è¿›ç®¡ç†ç³»ç»Ÿ**ï¼šè´¨é‡æ”¹è¿›é¡¹ç›®å’Œæªæ–½ç®¡ç†
5. **è´¨é‡æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šè´¨é‡æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **ISO 9001**ï¼šISO 9001è´¨é‡ç®¡ç†ä½“ç³»æ ‡å‡†
- **å…­è¥¿æ ¼ç›**ï¼šå…­è¥¿æ ¼ç›è´¨é‡ç®¡ç†æ–¹æ³•

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šè´¨é‡ä½“ç³»ç®¡ç†ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æ¯”äºšè¿ªè‚¡ä»½æœ‰é™å…¬å¸æ˜¯ä¸­å›½é¢†å…ˆçš„æ–°èƒ½æºæ±½è½¦å’Œé«˜æ–°æŠ€æœ¯ä¼ä¸šï¼Œæˆç«‹äº1995å¹´ï¼Œæ€»éƒ¨ä½äºæ·±åœ³ã€‚å…¬å¸ä¸šåŠ¡æ¶µç›–æ±½è½¦ã€è½¨é“äº¤é€šã€æ–°èƒ½æºå’Œç”µå­å››å¤§äº§ä¸šï¼Œæ˜¯å…¨çƒé¢†å…ˆçš„æ–°èƒ½æºæ•´ä½“è§£å†³æ–¹æ¡ˆå¼€åˆ›è€…ã€‚2024å¹´æ¯”äºšè¿ªæ–°èƒ½æºæ±½è½¦é”€é‡è¶…è¿‡300ä¸‡è¾†ï¼Œä½å±…å…¨çƒæ–°èƒ½æºæ±½è½¦é”€é‡ç¬¬ä¸€ï¼Œå¹´è¥ä¸šæ”¶å…¥è¶…è¿‡6000äº¿å…ƒäººæ°‘å¸ï¼Œå‘˜å·¥æ€»æ•°è¶…è¿‡60ä¸‡äººã€‚

æ¯”äºšè¿ªæ±½è½¦äº‹ä¸šéƒ¨æ‹¥æœ‰æ·±åœ³ã€è¥¿å®‰ã€é•¿æ²™ã€å¸¸å·ç­‰ä¹å¤§ç”Ÿäº§åŸºåœ°ï¼Œå¹´äº§èƒ½åŠ›è¶…è¿‡400ä¸‡è¾†ã€‚æ±½è½¦äº§å“åŒ…æ‹¬ä¹˜ç”¨è½¦ï¼ˆç‹æœç³»åˆ—ã€æµ·æ´‹ç³»åˆ—ï¼‰ã€å•†ç”¨è½¦ï¼ˆå¤§å·´ã€å¡è½¦ï¼‰ç­‰ï¼Œé”€å¾€å…¨çƒ70å¤šä¸ªå›½å®¶å’Œåœ°åŒºã€‚å…¬å¸å»ºç«‹äº†å®Œå–„çš„ä¾›åº”é“¾ä½“ç³»ï¼Œæ‹¥æœ‰è¶…è¿‡2000å®¶ä¾›åº”å•†ï¼Œé›¶éƒ¨ä»¶å“ç±»è¶…è¿‡10ä¸‡ç§ï¼Œè´¨é‡ç®¡ç†æŒ‘æˆ˜å·¨å¤§ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **è´¨é‡ä½“ç³»ç®¡ç†åˆ†æ•£**ï¼šå„ç”Ÿäº§åŸºåœ°ç‹¬ç«‹ç®¡ç†è´¨é‡ä½“ç³»ï¼Œç¼ºä¹ç»Ÿä¸€å¹³å°ï¼ŒISO 9001/IATF 16949ç­‰æ ‡å‡†æ‰§è¡Œä¸ä¸€è‡´ï¼Œå¤–å®¡å‘ç°é—®é¢˜é‡å¤ç‡é«˜ã€‚

2. **æ£€éªŒæ•°æ®è®°å½•ä¸å®Œæ•´**ï¼šæ¥æ–™æ£€éªŒã€è¿‡ç¨‹æ£€éªŒã€æˆå“æ£€éªŒæ•°æ®åˆ†æ•£åœ¨çº¸è´¨è¡¨å•å’Œå¤šä¸ªExcelæ–‡ä»¶ä¸­ï¼Œæ•°æ®æ£€ç´¢å›°éš¾ï¼Œæ— æ³•æœ‰æ•ˆåˆ†æè´¨é‡è¶‹åŠ¿ã€‚

3. **ä¸åˆæ ¼å“è·Ÿè¸ªå›°éš¾**ï¼šä¸åˆæ ¼å“å‘ç°ã€éš”ç¦»ã€è¯„å®¡ã€å¤„ç½®æµç¨‹ä¸é€æ˜ï¼Œå¤„ç½®å‘¨æœŸé•¿ï¼ˆå¹³å‡7å¤©ï¼‰ï¼Œä¸åˆæ ¼å“ç§¯å‹å ç”¨èµ„é‡‘å’Œä»“å‚¨ç©ºé—´ã€‚

4. **ä¾›åº”å•†è´¨é‡ç®¡æ§å¼±**ï¼šä¾›åº”å•†æ¥æ–™åˆæ ¼ç‡æ³¢åŠ¨å¤§ï¼ˆ88%-96%ï¼‰ï¼Œç¼ºä¹æœ‰æ•ˆçš„ä¾›åº”å•†è´¨é‡æ•°æ®åˆ†æå’Œé¢„è­¦æœºåˆ¶ï¼Œç´¢èµ”å¤„ç†æ•ˆç‡ä½ã€‚

5. **è´¨é‡æ”¹è¿›ç¼ºä¹ç³»ç»Ÿæ€§**ï¼šè´¨é‡æ”¹è¿›é¡¹ç›®é ç»éªŒé©±åŠ¨ï¼Œç¼ºä¹æ•°æ®æ”¯æ’‘å’ŒPDCAé—­ç¯ç®¡ç†ï¼Œæ”¹è¿›æ•ˆæœéš¾ä»¥é‡åŒ–å’Œå›ºåŒ–ã€‚

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- å»ºç«‹é›†å›¢çº§ç»Ÿä¸€è´¨é‡ç®¡ç†å¹³å°ï¼Œå®ç°ISO 9001/IATF 16949å…¨è¦ç´ æ•°å­—åŒ–ç®¡ç†ï¼Œä½“ç³»æ–‡ä»¶å—æ§ç‡100%
- å®ç°æ£€éªŒæ•°æ®100%ç”µå­åŒ–ï¼Œæ£€éªŒæ•°æ®å®æ—¶åˆ†æï¼Œæ¥æ–™æ£€éªŒæ•ˆç‡æå‡50%
- å»ºç«‹ä¸åˆæ ¼å“é—­ç¯ç®¡ç†æµç¨‹ï¼Œå¤„ç½®å‘¨æœŸä»7å¤©ç¼©çŸ­åˆ°2å¤©ï¼Œä¸åˆæ ¼å“åº“å­˜é™ä½60%
- æ„å»ºä¾›åº”å•†è´¨é‡ç®¡ç†ç³»ç»Ÿï¼ˆSQMï¼‰ï¼Œä¾›åº”å•†æ¥æ–™åˆæ ¼ç‡ç¨³å®šåœ¨98%ä»¥ä¸Š
- å»ºç«‹è´¨é‡æ”¹è¿›é¡¹ç›®ç®¡ç†å¹³å°ï¼Œæ”¹è¿›é¡¹ç›®å®Œæˆç‡æå‡è‡³95%ï¼Œå¹´åº¦è´¨é‡æˆæœ¬é™ä½15%

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å¤šåŸºåœ°ååŒç®¡ç†**ï¼šéœ€è¦æ”¯æŒ9å¤§ç”Ÿäº§åŸºåœ°ã€60ä¸‡å‘˜å·¥çš„è´¨é‡ç®¡ç†ååŒï¼Œç³»ç»Ÿéœ€è¦é«˜å¹¶å‘ã€é«˜å¯ç”¨ï¼Œæ”¯æŒå¤šè¯­è¨€ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€è¥¿ç­ç‰™æ–‡ï¼‰ã€‚

2. **å¤æ‚æ£€éªŒæ ‡å‡†ç®¡ç†**ï¼šæ±½è½¦é›¶éƒ¨ä»¶æ£€éªŒæ ‡å‡†å¤æ‚ï¼ˆå¦‚èºçº¹è§„ã€ç¡¬åº¦ã€é‡‘ç›¸ã€ä¸‰åæ ‡ç­‰ï¼‰ï¼Œéœ€è¦æ”¯æŒå¤šç§æ£€éªŒç±»å‹å’Œåˆ¤å®šè§„åˆ™ï¼Œä»¥åŠä¸æ£€æµ‹è®¾å¤‡çš„è‡ªåŠ¨æ¥å£ï¼ˆRS232ã€TCP/IPã€GPIBï¼‰ã€‚

3. **å®æ—¶SPCç›‘æ§**ï¼šéœ€è¦å¯¹æ¥ç”Ÿäº§çº¿æ£€æµ‹è®¾å¤‡ï¼Œå®æ—¶é‡‡é›†è´¨é‡æ•°æ®ï¼ˆCMMã€è§†è§‰æ£€æµ‹ã€æ‰­åŠ›ç­‰ï¼‰ï¼Œå®ç°åœ¨çº¿SPCï¼ˆç»Ÿè®¡è¿‡ç¨‹æ§åˆ¶ï¼‰åˆ†æå’Œé¢„è­¦ã€‚

4. **ä¾›åº”å•†ååŒé›†æˆ**ï¼šéœ€è¦ä¸2000+ä¾›åº”å•†çš„è´¨é‡ç³»ç»Ÿè¿›è¡Œå¯¹æ¥ï¼Œæ”¯æŒä¾›åº”å•†è‡ªæ£€æ•°æ®ä¸Šä¼ ã€è´¨é‡æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆã€ç´¢èµ”å•åœ¨çº¿æµè½¬ã€‚

5. **è´¨é‡å¤§æ•°æ®åˆ†æ**ï¼šéœ€è¦å¤„ç†æ¯å¤©è¶…è¿‡1000ä¸‡æ¡è´¨é‡æ•°æ®ï¼Œæ„å»ºè´¨é‡é¢„æµ‹æ¨¡å‹ï¼ˆå¦‚è®¾å¤‡æ•…éšœé¢„æµ‹ã€ä¾›åº”å•†é£é™©é¢„æµ‹ï¼‰ï¼Œå®ç°ä»"äº‹åæ£€éªŒ"åˆ°"äº‹å‰é¢„é˜²"çš„è½¬å˜ã€‚

### 2.3 è§£å†³æ–¹æ¡ˆ

**åŸºäºISO 9001/IATF 16949æ ‡å‡†ï¼Œæ„å»ºé›†å›¢çº§è´¨é‡ç®¡ç†å¹³å°ï¼ˆQMSï¼‰ï¼Œå®ç°è´¨é‡ä½“ç³»ã€æ¥æ–™æ£€éªŒã€è¿‡ç¨‹æ§åˆ¶ã€æˆå“æ£€éªŒã€ä¸åˆæ ¼å“ã€ä¾›åº”å•†è´¨é‡ã€è´¨é‡æ”¹è¿›ç­‰å…¨æµç¨‹æ•°å­—åŒ–ç®¡ç†**ã€‚

æ ¸å¿ƒæŠ€æœ¯æ¶æ„ï¼š
- æ ‡å‡†å±‚ï¼šISO 9001 + IATF 16949 + VDA 6.3æ ‡å‡†åº“
- æ•°æ®å±‚ï¼šOracle RACï¼ˆä¸šåŠ¡æ•°æ®ï¼‰+ Hadoopï¼ˆè´¨é‡å¤§æ•°æ®ï¼‰+ InfluxDBï¼ˆæ—¶åºæ•°æ®ï¼‰
- æœåŠ¡å±‚ï¼šJava Spring Cloudå¾®æœåŠ¡ + MQTTï¼ˆIoTæ•°æ®é‡‡é›†ï¼‰
- åˆ†æå±‚ï¼šPython Spark MLï¼ˆè´¨é‡é¢„æµ‹ï¼‰+ Tableauï¼ˆå¯è§†åŒ–ï¼‰
- é›†æˆå±‚ï¼šEDIï¼ˆä¾›åº”å•†å¯¹æ¥ï¼‰+ OPC UAï¼ˆè®¾å¤‡å¯¹æ¥ï¼‰

### 2.4 å®Œæ•´ä»£ç å®ç°

**è´¨é‡ä½“ç³»ç®¡ç†Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
è´¨é‡ç®¡ç†Schemaå®ç° - æ¯”äºšè¿ªé›†å›¢è´¨é‡ç®¡ç†ä½“ç³»
"""

from typing import Dict, List, Optional, Set
from datetime import date, datetime, timedelta
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum
import statistics


class StandardType(str, Enum):
    """æ ‡å‡†ç±»å‹"""
    ISO9001 = "ISO9001"
    ISO14001 = "ISO14001"
    ISO45001 = "ISO45001"
    IATF16949 = "IATF16949"
    VDA63 = "VDA6.3"


class InspectionResult(str, Enum):
    """æ£€éªŒç»“æœ"""
    PASS = "Pass"
    FAIL = "Fail"
    CONDITIONAL = "Conditional"
    PENDING = "Pending"


class NonConformanceStatus(str, Enum):
    """ä¸åˆæ ¼å“çŠ¶æ€"""
    IDENTIFIED = "Identified"  # å·²è¯†åˆ«
    UNDER_INVESTIGATION = "Under Investigation"  # è°ƒæŸ¥ä¸­
    CORRECTIVE_ACTION = "Corrective Action"  # çº æ­£æªæ–½
    VERIFIED = "Verified"  # å·²éªŒè¯
    CLOSED = "Closed"  # å·²å…³é—­
    SCRAP = "Scrap"  # æŠ¥åºŸ
    REWORK = "Rework"  # è¿”å·¥
    CONCESSION = "Concession"  # è®©æ­¥æ¥æ”¶


class DefectType(str, Enum):
    """ç¼ºé™·ç±»å‹"""
    CRITICAL = "Critical"  # è‡´å‘½ç¼ºé™·
    MAJOR = "Major"  # ä¸¥é‡ç¼ºé™·
    MINOR = "Minor"  # è½»å¾®ç¼ºé™·


class InspectionType(str, Enum):
    """æ£€éªŒç±»å‹"""
    INCOMING = "Incoming"  # æ¥æ–™æ£€éªŒ
    INPROCESS = "In-Process"  # è¿‡ç¨‹æ£€éªŒ
    FINAL = "Final"  # æˆå“æ£€éªŒ
    SHIPPING = "Shipping"  # å‡ºè´§æ£€éªŒ
    AUDIT = "Audit"  # å®¡æ ¸æ£€éªŒ


@dataclass
class QualitySystem:
    """è´¨é‡ä½“ç³»"""
    system_id: str
    system_name: str
    standard_type: StandardType
    certification_date: date
    expiry_date: date
    certification_body: str
    scope: str
    sites: List[str] = field(default_factory=list)  # è¦†ç›–å·¥å‚
    documents: List[str] = field(default_factory=list)
    created_date: Optional[datetime] = None
    
    def is_valid(self) -> bool:
        """æ£€æŸ¥è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ"""
        return date.today() <= self.expiry_date
    
    def days_to_expiry(self) -> int:
        """è·ç¦»è¯ä¹¦åˆ°æœŸå¤©æ•°"""
        return (self.expiry_date - date.today()).days


@dataclass
class Supplier:
    """ä¾›åº”å•†"""
    supplier_id: str
    supplier_name: str
    supplier_code: str
    category: str  # é›¶éƒ¨ä»¶ç±»åˆ«
    qualification_status: str = "Qualified"  # åˆæ ¼/è§‚å¯Ÿ/æš‚åœ/æ·˜æ±°
    quality_rating: str = "A"  # è´¨é‡ç­‰çº§ A/B/C/D
    last_audit_date: Optional[date] = None
    annual_rating_score: float = 0.0
    ppm: int = 0  # ç™¾ä¸‡ä»¶ä¸è‰¯æ•°


@dataclass
class InspectionItem:
    """æ£€éªŒé¡¹ç›®"""
    item_id: str
    item_name: str
    specification: str  # è§„æ ¼è¦æ±‚
    tolerance_upper: Optional[float] = None
    tolerance_lower: Optional[float] = None
    unit: str = ""
    inspection_method: str = ""
    aql: float = 0.0  # å¯æ¥å—è´¨é‡æ°´å¹³


@dataclass
class QualityInspection:
    """è´¨é‡æ£€éªŒ"""
    inspection_id: str
    inspection_type: InspectionType
    inspection_date: date
    product_id: Optional[str] = None
    product_name: Optional[str] = None
    supplier_id: Optional[str] = None
    batch_number: Optional[str] = None
    inspector: str = ""
    result: InspectionResult = InspectionResult.PENDING
    inspection_items: List[Dict] = field(default_factory=list)
    notes: Optional[str] = None
    created_date: Optional[datetime] = None
    
    def __post_init__(self):
        if self.created_date is None:
            self.created_date = datetime.now()
    
    def add_measurement(self, item_id: str, item_name: str, 
                       measured_value: float,
                       upper_limit: Optional[float] = None,
                       lower_limit: Optional[float] = None):
        """æ·»åŠ æµ‹é‡å€¼"""
        item_result = InspectionResult.PASS
        if upper_limit is not None and measured_value > upper_limit:
            item_result = InspectionResult.FAIL
        if lower_limit is not None and measured_value < lower_limit:
            item_result = InspectionResult.FAIL
        
        self.inspection_items.append({
            "item_id": item_id,
            "item_name": item_name,
            "measured_value": measured_value,
            "upper_limit": upper_limit,
            "lower_limit": lower_limit,
            "result": item_result.value
        })
        
        # æ›´æ–°æ•´ä½“ç»“æœ
        if item_result == InspectionResult.FAIL:
            self.result = InspectionResult.FAIL
    
    def calculate_pass_rate(self) -> float:
        """è®¡ç®—åˆæ ¼ç‡"""
        if not self.inspection_items:
            return 0.0
        passed = sum(1 for item in self.inspection_items 
                    if item.get("result") == InspectionResult.PASS.value)
        return passed / len(self.inspection_items) * 100


@dataclass
class NonConformance:
    """ä¸åˆæ ¼å“"""
    nc_id: str
    nc_date: date
    product_id: str
    product_name: str
    batch_number: str
    defect_type: DefectType
    defect_description: str
    quantity: int
    status: NonConformanceStatus
    found_location: str  # å‘ç°åœ°ç‚¹
    found_by: str
    root_cause: Optional[str] = None
    corrective_action: Optional[str] = None
    preventive_action: Optional[str] = None
    responsible_department: Optional[str] = None
    verified_by: Optional[str] = None
    verified_date: Optional[date] = None
    closed_date: Optional[date] = None
    cost_impact: Decimal = Decimal("0")
    created_date: Optional[datetime] = None
    
    def __post_init__(self):
        if self.created_date is None:
            self.created_date = datetime.now()
    
    def start_investigation(self, root_cause: str):
        """å¼€å§‹è°ƒæŸ¥"""
        self.status = NonConformanceStatus.UNDER_INVESTIGATION
        self.root_cause = root_cause
    
    def implement_corrective_action(self, action: str, department: str):
        """å®æ–½çº æ­£æªæ–½"""
        self.status = NonConformanceStatus.CORRECTIVE_ACTION
        self.corrective_action = action
        self.responsible_department = department
    
    def verify_closure(self, verified_by: str):
        """éªŒè¯å…³é—­"""
        self.status = NonConformanceStatus.CLOSED
        self.verified_by = verified_by
        self.verified_date = date.today()
        self.closed_date = date.today()


@dataclass
class QualityImprovement:
    """è´¨é‡æ”¹è¿›"""
    improvement_id: str
    improvement_name: str
    improvement_type: str  # 8D, å…­è¥¿æ ¼ç›, QCCç­‰
    start_date: date
    target_date: date
    owner: str
    team_members: List[str] = field(default_factory=list)
    description: Optional[str] = None
    current_status: str = "Planning"  # Planning, In Progress, Completed
    target_metric: str = ""
    baseline_value: float = 0.0
    target_value: float = 0.0
    actual_value: float = 0.0
    results: Optional[str] = None
    cost_savings: Decimal = Decimal("0")
    created_date: Optional[datetime] = None
    
    def __post_init__(self):
        if self.created_date is None:
            self.created_date = datetime.now()
    
    def update_progress(self, status: str, actual_value: float):
        """æ›´æ–°è¿›åº¦"""
        self.current_status = status
        self.actual_value = actual_value
    
    def calculate_improvement(self) -> float:
        """è®¡ç®—æ”¹è¿›å¹…åº¦"""
        if self.baseline_value == 0:
            return 0.0
        return ((self.baseline_value - self.actual_value) / self.baseline_value) * 100


@dataclass
class SPCData:
    """SPCæ•°æ®"""
    data_id: str
    process_id: str
    parameter_name: str
    measurement_value: float
    measurement_time: datetime
    sample_size: int = 1
    usl: Optional[float] = None  # è§„æ ¼ä¸Šé™
    lsl: Optional[float] = None  # è§„æ ¼ä¸‹é™
    
    def calculate_cp(self, avg: float, std: float) -> float:
        """è®¡ç®—è¿‡ç¨‹èƒ½åŠ›æŒ‡æ•°Cp"""
        if self.usl is None or self.lsl is None or std == 0:
            return 0.0
        return (self.usl - self.lsl) / (6 * std)
    
    def calculate_cpk(self, avg: float, std: float) -> float:
        """è®¡ç®—è¿‡ç¨‹èƒ½åŠ›æŒ‡æ•°Cpk"""
        if self.usl is None or self.lsl is None or std == 0:
            return 0.0
        cpu = (self.usl - avg) / (3 * std)
        cpl = (avg - self.lsl) / (3 * std)
        return min(cpu, cpl)


@dataclass
class QualityManagementStorage:
    """è´¨é‡ç®¡ç†æ•°æ®å­˜å‚¨"""
    quality_systems: Dict[str, QualitySystem] = field(default_factory=dict)
    suppliers: Dict[str, Supplier] = field(default_factory=dict)
    inspections: Dict[str, QualityInspection] = field(default_factory=dict)
    non_conformances: Dict[str, NonConformance] = field(default_factory=dict)
    improvements: Dict[str, QualityImprovement] = field(default_factory=dict)
    spc_data: List[SPCData] = field(default_factory=list)
    
    def store_quality_system(self, system: QualitySystem):
        """å­˜å‚¨è´¨é‡ä½“ç³»"""
        self.quality_systems[system.system_id] = system
    
    def store_supplier(self, supplier: Supplier):
        """å­˜å‚¨ä¾›åº”å•†"""
        self.suppliers[supplier.supplier_id] = supplier
    
    def store_inspection(self, inspection: QualityInspection):
        """å­˜å‚¨æ£€éªŒ"""
        self.inspections[inspection.inspection_id] = inspection
    
    def store_non_conformance(self, nc: NonConformance):
        """å­˜å‚¨ä¸åˆæ ¼å“"""
        self.non_conformances[nc.nc_id] = nc
    
    def store_improvement(self, improvement: QualityImprovement):
        """å­˜å‚¨æ”¹è¿›"""
        self.improvements[improvement.improvement_id] = improvement
    
    def store_spc_data(self, data: SPCData):
        """å­˜å‚¨SPCæ•°æ®"""
        self.spc_data.append(data)
    
    def get_inspection_summary(self, start_date: date, end_date: date) -> Dict:
        """è·å–æ£€éªŒæ‘˜è¦"""
        filtered = [
            i for i in self.inspections.values()
            if start_date <= i.inspection_date <= end_date
        ]
        
        total = len(filtered)
        passed = len([i for i in filtered if i.result == InspectionResult.PASS])
        failed = len([i for i in filtered if i.result == InspectionResult.FAIL])
        
        by_type = {}
        for i in filtered:
            by_type[i.inspection_type.value] = by_type.get(i.inspection_type.value, 0) + 1
        
        return {
            "total": total,
            "passed": passed,
            "failed": failed,
            "pass_rate": float(passed / total * 100) if total > 0 else 0,
            "by_type": by_type
        }
    
    def get_non_conformance_summary(self, start_date: date, end_date: date) -> Dict:
        """è·å–ä¸åˆæ ¼å“æ‘˜è¦"""
        filtered = [
            nc for nc in self.non_conformances.values()
            if start_date <= nc.nc_date <= end_date
        ]
        
        summary = {
            "total": len(filtered),
            "by_status": {},
            "by_defect_type": {},
            "total_cost": Decimal("0")
        }
        
        for nc in filtered:
            # æŒ‰çŠ¶æ€ç»Ÿè®¡
            status = nc.status.value
            summary["by_status"][status] = summary["by_status"].get(status, 0) + 1
            
            # æŒ‰ç¼ºé™·ç±»å‹ç»Ÿè®¡
            defect = nc.defect_type.value
            summary["by_defect_type"][defect] = summary["by_defect_type"].get(defect, 0) + 1
            
            # æˆæœ¬æ±‡æ€»
            summary["total_cost"] += nc.cost_impact
        
        return summary
    
    def calculate_supplier_ppm(self, supplier_id: str, year: int) -> int:
        """è®¡ç®—ä¾›åº”å•†PPM"""
        supplier_inspections = [
            i for i in self.inspections.values()
            if i.supplier_id == supplier_id and i.inspection_date.year == year
        ]
        
        total_quantity = len(supplier_inspections)
        failed_quantity = len([i for i in supplier_inspections if i.result == InspectionResult.FAIL])
        
        if total_quantity == 0:
            return 0
        
        return int(failed_quantity / total_quantity * 1000000)
    
    def calculate_process_capability(self, process_id: str, 
                                     parameter: str,
                                     days: int = 30) -> Dict:
        """è®¡ç®—è¿‡ç¨‹èƒ½åŠ›"""
        end_time = datetime.now()
        start_time = end_time - timedelta(days=days)
        
        data_points = [
            d for d in self.spc_data
            if d.process_id == process_id 
            and d.parameter_name == parameter
            and start_time <= d.measurement_time <= end_time
        ]
        
        if len(data_points) < 10:
            return {"error": "Insufficient data"}
        
        values = [d.measurement_value for d in data_points]
        avg = statistics.mean(values)
        std = statistics.stdev(values) if len(values) > 1 else 0
        
        usl = data_points[0].usl
        lsl = data_points[0].lsl
        
        cp = (usl - lsl) / (6 * std) if usl and lsl and std > 0 else 0
        cpu = (usl - avg) / (3 * std) if usl and std > 0 else 0
        cpl = (avg - lsl) / (3 * std) if lsl and std > 0 else 0
        cpk = min(cpu, cpl)
        
        return {
            "process_id": process_id,
            "parameter": parameter,
            "sample_size": len(values),
            "mean": round(avg, 4),
            "std": round(std, 4),
            "usl": usl,
            "lsl": lsl,
            "cp": round(cp, 2),
            "cpk": round(cpk, 2),
            "capability_grade": "A" if cpk >= 1.33 else "B" if cpk >= 1.0 else "C"
        }
    
    def get_quality_dashboard(self) -> Dict:
        """è·å–è´¨é‡çœ‹æ¿æ•°æ®"""
        today = date.today()
        month_start = today.replace(day=1)
        
        # æœ¬æœˆæ£€éªŒæ•°æ®
        inspection_summary = self.get_inspection_summary(month_start, today)
        
        # æœ¬æœˆä¸åˆæ ¼å“
        nc_summary = self.get_non_conformance_summary(month_start, today)
        
        # è´¨é‡ä½“ç³»çŠ¶æ€
        valid_systems = sum(1 for s in self.quality_systems.values() if s.is_valid())
        expiring_systems = sum(1 for s in self.quality_systems.values() 
                              if 0 < s.days_to_expiry() <= 90)
        
        # æ”¹è¿›é¡¹ç›®è¿›åº¦
        active_improvements = [
            imp for imp in self.improvements.values()
            if imp.current_status in ["Planning", "In Progress"]
        ]
        
        return {
            "inspection_this_month": inspection_summary,
            "non_conformance_this_month": nc_summary,
            "quality_systems": {
                "total": len(self.quality_systems),
                "valid": valid_systems,
                "expiring_soon": expiring_systems
            },
            "active_improvements": len(active_improvements),
            "supplier_count": len(self.suppliers),
            "total_nc_cost": nc_summary["total_cost"]
        }


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºè´¨é‡ç®¡ç†å­˜å‚¨
    qm = QualityManagementStorage()
    
    # åˆ›å»ºè´¨é‡ä½“ç³»
    system = QualitySystem(
        system_id="QS001",
        system_name="æ¯”äºšè¿ªæ±½è½¦è´¨é‡ç®¡ç†ä½“ç³»",
        standard_type=StandardType.IATF16949,
        certification_date=date(2023, 1, 15),
        expiry_date=date(2026, 1, 14),
        certification_body="TUV SUD",
        scope="æ–°èƒ½æºæ±½è½¦è®¾è®¡ã€å¼€å‘ã€ç”Ÿäº§å’Œé”€å”®",
        sites=["æ·±åœ³", "è¥¿å®‰", "é•¿æ²™", "å¸¸å·"]
    )
    qm.store_quality_system(system)
    
    # æ³¨å†Œä¾›åº”å•†
    supplier = Supplier(
        supplier_id="SUP001",
        supplier_name="å®å¾·æ—¶ä»£æ–°èƒ½æº",
        supplier_code="CATL001",
        category="åŠ¨åŠ›ç”µæ± ",
        quality_rating="A",
        ppm=50
    )
    qm.store_supplier(supplier)
    
    # åˆ›å»ºæ¥æ–™æ£€éªŒ
    inspection = QualityInspection(
        inspection_id="INS20250121001",
        inspection_type=InspectionType.INCOMING,
        inspection_date=date(2025, 1, 21),
        product_id="BATTERY-100KWH",
        product_name="åŠ¨åŠ›ç”µæ± åŒ…100kWh",
        supplier_id="SUP001",
        batch_number="CATL20250115A",
        inspector="å¼ ä¸‰"
    )
    
    # æ·»åŠ æ£€éªŒé¡¹ç›®
    inspection.add_measurement(
        item_id="VOLTAGE",
        item_name="é¢å®šç”µå‹",
        measured_value=652.8,
        upper_limit=660.0,
        lower_limit=640.0
    )
    inspection.add_measurement(
        item_id="CAPACITY",
        item_name="é¢å®šå®¹é‡",
        measured_value=153.2,
        upper_limit=155.0,
        lower_limit=150.0
    )
    inspection.add_measurement(
        item_id="RESISTANCE",
        item_name="å†…é˜»",
        measured_value=0.8,
        upper_limit=1.0,
        lower_limit=0.5
    )
    
    qm.store_inspection(inspection)
    
    # åˆ›å»ºä¸åˆæ ¼å“è®°å½•
    nc = NonConformance(
        nc_id="NC20250121001",
        nc_date=date(2025, 1, 21),
        product_id="SEAT-001",
        product_name="é©¾é©¶å‘˜åº§æ¤…æ€»æˆ",
        batch_number="SEAT20250120A",
        defect_type=DefectType.MAJOR,
        defect_description="åº§æ¤…è°ƒèŠ‚ç”µæœºå¼‚å“",
        quantity=25,
        status=NonConformanceStatus.IDENTIFIED,
        found_location="æ€»è£…è½¦é—´",
        found_by="æå››",
        cost_impact=Decimal("15000.00")
    )
    qm.store_non_conformance(nc)
    
    # å¤„ç†ä¸åˆæ ¼å“
    nc.start_investigation("ç”µæœºè½´æ‰¿æ¶¦æ»‘ä¸è¶³")
    nc.implement_corrective_action("æ›´æ¢ä¾›åº”å•†ï¼Œå¢åŠ æ¥æ–™æ£€éªŒé¡¹ç›®", "é‡‡è´­éƒ¨")
    nc.verify_closure("ç‹äº”")
    
    # åˆ›å»ºè´¨é‡æ”¹è¿›é¡¹ç›®
    improvement = QualityImprovement(
        improvement_id="IMP2025001",
        improvement_name="é™ä½ç”µæ± åŒ…æ¥æ–™ä¸è‰¯ç‡",
        improvement_type="å…­è¥¿æ ¼ç›",
        start_date=date(2025, 1, 1),
        target_date=date(2025, 6, 30),
        owner="èµµå…­",
        description="é€šè¿‡æ”¹è¿›ä¾›åº”å•†è¿‡ç¨‹æ§åˆ¶ï¼Œé™ä½ç”µæ± åŒ…æ¥æ–™ä¸è‰¯ç‡",
        target_metric="æ¥æ–™ä¸è‰¯ç‡PPM",
        baseline_value=500.0,
        target_value=100.0
    )
    improvement.update_progress("In Progress", 280.0)
    qm.store_improvement(improvement)
    
    # è·å–è´¨é‡çœ‹æ¿
    dashboard = qm.get_quality_dashboard()
    print(f"è´¨é‡çœ‹æ¿æ•°æ®:")
    print(f"  æœ¬æœˆæ£€éªŒæ‰¹æ¬¡: {dashboard['inspection_this_month']['total']}")
    print(f"  æ£€éªŒåˆæ ¼ç‡: {dashboard['inspection_this_month']['pass_rate']:.2f}%")
    print(f"  æœ¬æœˆä¸åˆæ ¼å“: {dashboard['non_conformance_this_month']['total']}")
    print(f"  è´¨é‡ä½“ç³»æœ‰æ•ˆ: {dashboard['quality_systems']['valid']}/{dashboard['quality_systems']['total']}")
    print(f"  æ´»è·ƒæ”¹è¿›é¡¹ç›®: {dashboard['active_improvements']}")
    
    # è®¡ç®—è¿‡ç¨‹èƒ½åŠ›
    # æ¨¡æ‹Ÿæ·»åŠ SPCæ•°æ®
    import random
    for i in range(50):
        spc = SPCData(
            data_id=f"SPC{i}",
            process_id="WELD-001",
            parameter_name="ç„Šæ¥ç”µæµ",
            measurement_value=random.gauss(180, 5),
            measurement_time=datetime.now() - timedelta(hours=i),
            usl=200.0,
            lsl=160.0
        )
        qm.store_spc_data(spc)
    
    capability = qm.calculate_process_capability("WELD-001", "ç„Šæ¥ç”µæµ")
    print(f"\nè¿‡ç¨‹èƒ½åŠ›åˆ†æ:")
    print(f"  Cp: {capability.get('cp', 'N/A')}")
    print(f"  Cpk: {capability.get('cpk', 'N/A')}")
    print(f"  ç­‰çº§: {capability.get('capability_grade', 'N/A')}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| ä½“ç³»æ–‡ä»¶å—æ§ç‡ | 75% | 100% | 25%æå‡ |
| æ£€éªŒæ•°æ®ç”µå­åŒ–ç‡ | 40% | 100% | 60%æå‡ |
| æ¥æ–™æ£€éªŒæ•ˆç‡ | 2å°æ—¶/æ‰¹ | 45åˆ†é’Ÿ/æ‰¹ | 62%æå‡ |
| ä¸åˆæ ¼å“å¤„ç½®å‘¨æœŸ | 7å¤© | 1.8å¤© | 74%ç¼©çŸ­ |
| ä¾›åº”å•†æ¥æ–™åˆæ ¼ç‡ | 92% | 98.5% | 6.5%æå‡ |
| è´¨é‡æˆæœ¬å æ¯” | 3.2% | 2.1% | 34%é™ä½ |

**ä¸šåŠ¡ä»·å€¼ä¸ROI**ï¼š

1. **ç›´æ¥ç»æµæ•ˆç›Š**ï¼š
   - ç³»ç»ŸæŠ•èµ„ï¼šQMSå¹³å°å»ºè®¾800ä¸‡å…ƒï¼ŒSPCç³»ç»Ÿ300ä¸‡å…ƒï¼ŒSQMç³»ç»Ÿ400ä¸‡å…ƒï¼Œåˆè®¡1500ä¸‡å…ƒ
   - æ£€éªŒæ•ˆç‡æå‡ï¼šå¹´èŠ‚çœæ£€éªŒäººå·¥æˆæœ¬600ä¸‡å…ƒ
   - è´¨é‡æˆæœ¬é™ä½ï¼šå¹´åº¦è´¨é‡æˆæœ¬ä»19.2äº¿å…ƒé™è‡³12.6äº¿å…ƒï¼ŒèŠ‚çœ6.6äº¿å…ƒ
   - ä¾›åº”å•†ç´¢èµ”æ•ˆç‡ï¼šç´¢èµ”å¤„ç†å‘¨æœŸç¼©çŸ­ï¼Œå¹´å¢æ”¶ç´¢èµ”æ¬¾2000ä¸‡å…ƒ

2. **ROIè®¡ç®—**ï¼š
   - é¦–å¹´ROI = (600 + 66000 + 2000 - 1500) / 1500 Ã— 100% = **4473%**
   - ï¼ˆæ³¨ï¼šè´¨é‡æˆæœ¬é™ä½è´¡çŒ®æœ€å¤§ï¼‰

3. **æˆ˜ç•¥æ•ˆç›Š**ï¼š
   - IATF 16949å¤–å®¡ä¸ç¬¦åˆé¡¹å‡å°‘80%
   - è·å¾—"å…¨å›½è´¨é‡å¥–"
   - æ–°èƒ½æºæ±½è½¦è´¨é‡æŠ•è¯‰ç‡è¡Œä¸šæœ€ä½
   - ä¾›åº”å•†æ»¡æ„åº¦ä»72%æå‡è‡³88%

**ç»éªŒæ•™è®­**ï¼š

1. æ£€éªŒæ ‡å‡†è¦ä¸æ£€æµ‹è®¾å¤‡æ·±åº¦é›†æˆï¼Œå‡å°‘äººå·¥å½•å…¥
2. SPCéœ€è¦å®æ—¶æ•°æ®é‡‡é›†ï¼Œäº‹åè¡¥å½•å¤±å»é¢„é˜²æ„ä¹‰
3. ä¾›åº”å•†ååŒè¦å¾ªåºæ¸è¿›ï¼Œå…ˆä»å…³é”®ä¾›åº”å•†è¯•ç‚¹
4. è´¨é‡æ”¹è¿›è¦æœ‰è´¢åŠ¡éƒ¨é—¨å‚ä¸ï¼Œé‡åŒ–æ”¹è¿›æ”¶ç›Š

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [ISO 9001è´¨é‡ç®¡ç†ä½“ç³»](https://www.iso.org/iso-9001-quality-management.html)
- [IATF 16949æ ‡å‡†](https://www.iatfglobaloversight.org/)

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
