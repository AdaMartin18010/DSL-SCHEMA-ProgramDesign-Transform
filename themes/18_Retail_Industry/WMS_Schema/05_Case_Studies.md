# WMS Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [WMS Schemaå®è·µæ¡ˆä¾‹](#wms-schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šç”µå•†å·¨å¤´æ™ºèƒ½ä»“å‚¨ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ç”µå•†å·¨å¤´æ™ºèƒ½ä»“å‚¨ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 Schemaå®šä¹‰](#25-schemaå®šä¹‰)
    - [2.6 å®Œæ•´ä»£ç å®ç°](#26-å®Œæ•´ä»£ç å®ç°)
    - [2.7 æ•ˆæœè¯„ä¼°](#27-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹æ€»ç»“](#3-æ¡ˆä¾‹æ€»ç»“)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›WMS Schemaåœ¨é›¶å”®ç‰©æµé¢†åŸŸçš„å®è·µæ¡ˆä¾‹ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šç”µå•†å·¨å¤´æ™ºèƒ½ä»“å‚¨ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šæ¦‚å†µ**ï¼šæŸå¤´éƒ¨ç”µå•†å¹³å°ï¼ˆä»¥ä¸‹ç®€ç§°"Jç”µå•†"ï¼‰ï¼Œæ—¥å‡è®¢å•é‡è¶…è¿‡500ä¸‡å•ï¼Œåœ¨å…¨å›½æ‹¥æœ‰å¤§å‹ä»“å‚¨ä¸­å¿ƒ50ä¸ªï¼Œä»“å‚¨æ€»é¢ç§¯è¶…è¿‡1000ä¸‡å¹³æ–¹ç±³ã€‚

### 2.2 ä¸šåŠ¡ç—›ç‚¹

1. **æ‹£è´§æ•ˆç‡ä½**ï¼šä¼ ç»Ÿäººæµ·æˆ˜æœ¯æ‹£è´§ï¼Œäººå‡æ‹£è´§æ•ˆç‡ä»…80å•/å°æ—¶
2. **åº“å­˜å‡†ç¡®ç‡ä½**ï¼šåº“å­˜è´¦å®ä¸ç¬¦ç‡é«˜è¾¾5%ï¼Œè¶…å–ã€ç¼ºè´§é¢‘å‘
3. **æ³¢å³°åº”å¯¹éš¾**ï¼šå¤§ä¿ƒæœŸé—´è®¢å•é‡æš´å¢10å€ï¼Œç³»ç»Ÿé¢‘ç¹å®•æœº
4. **é€†å‘ç‰©æµæ…¢**ï¼šé€€è´§å¤„ç†å‘¨æœŸé•¿è¾¾7å¤©ï¼Œå®¢æˆ·æ»¡æ„åº¦ä½
5. **ä»“å‚¨æˆæœ¬é«˜**ï¼šäººå·¥æˆæœ¬å æ¯”è¶…è¿‡60%ï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦ä½

### 2.3 ä¸šåŠ¡ç›®æ ‡

1. **æå‡æ‹£è´§æ•ˆç‡**ï¼šé€šè¿‡æ™ºèƒ½æ‹£è´§ï¼Œäººå‡æ•ˆç‡æå‡è‡³300å•/å°æ—¶
2. **æé«˜åº“å­˜å‡†ç¡®ç‡**ï¼šåº“å­˜å‡†ç¡®ç‡è¾¾åˆ°99.99%
3. **å¼¹æ€§åº”å¯¹æ³¢å³°**ï¼šç³»ç»Ÿæ”¯æŒ10å€æµé‡æ‰©å®¹ï¼Œå¤§ä¿ƒé›¶æ•…éšœ
4. **ç¼©çŸ­é€€è´§å‘¨æœŸ**ï¼šé€€è´§å¤„ç†å‘¨æœŸç¼©çŸ­è‡³24å°æ—¶
5. **é™ä½ä»“å‚¨æˆæœ¬**ï¼šè‡ªåŠ¨åŒ–ç‡æå‡è‡³80%ï¼Œäººå·¥æˆæœ¬é™ä½40%

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. **é«˜å¹¶å‘åº“å­˜ç®¡ç†**ï¼šæ—¥å‡10äº¿çº§åº“å­˜æ“ä½œï¼Œéœ€è¦ä¿è¯å¼ºä¸€è‡´æ€§
2. **æ™ºèƒ½è·¯å¾„è§„åˆ’**ï¼šå¤šè®¢å•ã€å¤šå•†å“çš„æœ€ä¼˜æ‹£è´§è·¯å¾„è®¡ç®—
3. **è‡ªåŠ¨åŒ–è®¾å¤‡é›†æˆ**ï¼šAGVã€æœºæ¢°è‡‚ã€è‡ªåŠ¨åˆ†æ‹£æœºç­‰è®¾å¤‡ååŒ
4. **å®æ—¶æ•°æ®åˆ†æ**ï¼šåº“å­˜é¢„æµ‹ã€çƒ­é”€é¢„è­¦ç­‰å®æ—¶åˆ†æéœ€æ±‚

### 2.5 Schemaå®šä¹‰

```json
{
  "warehouse": {
    "warehouse_id": "WH-BJ-001",
    "warehouse_name": "åŒ—äº¬æ™ºèƒ½ä»“",
    "warehouse_type": "automated",
    "zones": [
      {
        "zone_id": "Z-001",
        "zone_type": "storage",
        "locations": [
          {"location_id": "A-01-01-01", "location_type": "shelf"}
        ]
      }
    ]
  },
  "inventory": {
    "sku_id": "SKU-12345",
    "quantity": 1000,
    "available_qty": 950,
    "reserved_qty": 50,
    "location": "A-01-01-01"
  },
  "order": {
    "order_id": "ORDER-2025-001",
    "order_type": "normal",
    "items": [
      {"sku_id": "SKU-12345", "qty": 2}
    ],
    "status": "picked"
  }
}
```

### 2.6 å®Œæ•´ä»£ç å®ç°

```python
#!/usr/bin/env python3
"""
æ™ºèƒ½ä»“å‚¨ç®¡ç†ç³»ç»Ÿ
åŠŸèƒ½ï¼šåº“å­˜ç®¡ç†ã€æ³¢æ¬¡ç®¡ç†ã€æ‹£è´§ä¼˜åŒ–ã€è‡ªåŠ¨åŒ–è®¾å¤‡è°ƒåº¦
"""

from datetime import datetime, timedelta
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass, field
from enum import Enum
import uuid
import heapq


class OrderStatus(str, Enum):
    """è®¢å•çŠ¶æ€"""
    PENDING = "pending"
    WAVED = "waved"
    PICKING = "picking"
    PACKED = "packed"
    SHIPPED = "shipped"


class LocationType(str, Enum):
    """åº“ä½ç±»å‹"""
    SHELF = "shelf"
    FLOOR = "floor"
    COLD = "cold"
    DANGEROUS = "dangerous"


@dataclass
class Location:
    """åº“ä½"""
    location_id: str
    zone_id: str
    location_type: LocationType
    aisle: str
    section: str
    level: str
    position: str
    max_weight: float = 1000.0
    sku_id: Optional[str] = None
    quantity: int = 0


@dataclass
class SKU:
    """å•†å“SKU"""
    sku_id: str
    sku_name: str
    category: str
    weight: float
    volume: float
    is_fragile: bool = False
    is_perishable: bool = False
    abc_class: str = "C"  # A, B, C


@dataclass
class Inventory:
    """åº“å­˜"""
    sku_id: str
    location_id: str
    quantity: int
    available_qty: int
    reserved_qty: int = 0
    inbound_date: datetime = field(default_factory=datetime.now)
    expiry_date: Optional[datetime] = None
    
    def reserve(self, qty: int) -> bool:
        """é¢„ç•™åº“å­˜"""
        if self.available_qty >= qty:
            self.available_qty -= qty
            self.reserved_qty += qty
            return True
        return False
    
    def release(self, qty: int):
        """é‡Šæ”¾é¢„ç•™"""
        self.available_qty += min(qty, self.reserved_qty)
        self.reserved_qty -= min(qty, self.reserved_qty)
    
    def pick(self, qty: int):
        """æ‹£è´§å‡ºåº“"""
        if self.reserved_qty >= qty:
            self.reserved_qty -= qty
            self.quantity -= qty


@dataclass
class OrderLine:
    """è®¢å•è¡Œé¡¹"""
    line_no: int
    sku_id: str
    quantity: int
    picked_qty: int = 0
    picked_location: Optional[str] = None


@dataclass
class Order:
    """è®¢å•"""
    order_id: str
    order_type: str
    priority: int  # 1-10, 1ä¸ºæœ€é«˜
    status: OrderStatus
    lines: List[OrderLine] = field(default_factory=list)
    wave_id: Optional[str] = None
    create_time: datetime = field(default_factory=datetime.now)
    promise_time: Optional[datetime] = None
    
    def get_total_skus(self) -> int:
        """è·å–SKUç§ç±»æ•°"""
        return len(self.lines)
    
    def get_total_qty(self) -> int:
        """è·å–æ€»æ•°é‡"""
        return sum(line.quantity for line in self.lines)


@dataclass
class Wave:
    """æ³¢æ¬¡"""
    wave_id: str
    wave_type: str  # pick, replenish, cycle_count
    status: str  # pending, picking, completed
    orders: List[str] = field(default_factory=list)
    pick_tasks: List[Dict] = field(default_factory=list)
    create_time: datetime = field(default_factory=datetime.now)
    
    def add_order(self, order_id: str):
        """æ·»åŠ è®¢å•"""
        self.orders.append(order_id)


class WMS:
    """ä»“å‚¨ç®¡ç†ç³»ç»Ÿæ ¸å¿ƒ"""
    
    def __init__(self, warehouse_id: str):
        self.warehouse_id = warehouse_id
        self.locations: Dict[str, Location] = {}
        self.skus: Dict[str, SKU] = {}
        self.inventory: Dict[str, Inventory] = {}  # key: sku_id@location_id
        self.orders: Dict[str, Order] = {}
        self.waves: Dict[str, Wave] = {}
        self.agv_tasks: List[Dict] = []
    
    def add_location(self, location: Location):
        """æ·»åŠ åº“ä½"""
        self.locations[location.location_id] = location
    
    def add_sku(self, sku: SKU):
        """æ·»åŠ SKU"""
        self.skus[sku.sku_id] = sku
    
    def receive_inventory(self, sku_id: str, location_id: str, qty: int) -> bool:
        """å…¥åº“"""
        key = f"{sku_id}@{location_id}"
        
        if key in self.inventory:
            self.inventory[key].quantity += qty
            self.inventory[key].available_qty += qty
        else:
            self.inventory[key] = Inventory(
                sku_id=sku_id,
                location_id=location_id,
                quantity=qty,
                available_qty=qty
            )
        
        # æ›´æ–°åº“ä½
        if location_id in self.locations:
            self.locations[location_id].sku_id = sku_id
            self.locations[location_id].quantity += qty
        
        return True
    
    def create_order(self, order_type: str, priority: int = 5) -> Order:
        """åˆ›å»ºè®¢å•"""
        order_id = f"ORD-{datetime.now().strftime('%Y%m%d')}-{uuid.uuid4().hex[:6].upper()}"
        order = Order(
            order_id=order_id,
            order_type=order_type,
            priority=priority,
            status=OrderStatus.PENDING
        )
        self.orders[order_id] = order
        return order
    
    def allocate_inventory(self, order_id: str) -> bool:
        """åº“å­˜åˆ†é…"""
        order = self.orders.get(order_id)
        if not order:
            return False
        
        for line in order.lines:
            sku_id = line.sku_id
            qty = line.quantity
            
            # æŸ¥æ‰¾å¯ç”¨åº“å­˜
            allocated = False
            for key, inv in self.inventory.items():
                if inv.sku_id == sku_id and inv.available_qty >= qty:
                    if inv.reserve(qty):
                        line.picked_location = inv.location_id
                        allocated = True
                        break
            
            if not allocated:
                return False
        
        return True
    
    def create_wave(self, wave_type: str = "pick") -> Wave:
        """åˆ›å»ºæ³¢æ¬¡"""
        wave_id = f"WAVE-{datetime.now().strftime('%Y%m%d')}-{uuid.uuid4().hex[:6].upper()}"
        wave = Wave(wave_id=wave_id, wave_type=wave_type, status="pending")
        self.waves[wave_id] = wave
        return wave
    
    def optimize_picking_route(self, wave_id: str) -> List[str]:
        """ä¼˜åŒ–æ‹£è´§è·¯å¾„"""
        wave = self.waves.get(wave_id)
        if not wave:
            return []
        
        # æ”¶é›†æ‰€æœ‰éœ€è¦æ‹£è´§çš„åº“ä½
        locations_to_visit = set()
        for order_id in wave.orders:
            order = self.orders.get(order_id)
            if order:
                for line in order.lines:
                    if line.picked_location:
                        locations_to_visit.add(line.picked_location)
        
        # ç®€åŒ–çš„è·¯å¾„ä¼˜åŒ–ï¼šæŒ‰å··é“æ’åº
        sorted_locations = sorted(locations_to_visit, 
                                 key=lambda loc: (self.locations[loc].aisle if loc in self.locations else "",
                                                 self.locations[loc].section if loc in self.locations else ""))
        
        return sorted_locations
    
    def pick_item(self, order_id: str, line_no: int, qty: int) -> bool:
        """æ‹£è´§"""
        order = self.orders.get(order_id)
        if not order:
            return False
        
        for line in order.lines:
            if line.line_no == line_no:
                location_id = line.picked_location
                if not location_id:
                    return False
                
                key = f"{line.sku_id}@{location_id}"
                if key in self.inventory:
                    self.inventory[key].pick(qty)
                    line.picked_qty += qty
                    
                    # æ›´æ–°åº“ä½
                    if location_id in self.locations:
                        self.locations[location_id].quantity -= qty
                    
                    return True
        
        return False
    
    def get_inventory_report(self) -> Dict:
        """åº“å­˜æŠ¥è¡¨"""
        total_skus = len(set(inv.sku_id for inv in self.inventory.values()))
        total_qty = sum(inv.quantity for inv in self.inventory.values())
        
        return {
            "warehouse_id": self.warehouse_id,
            "report_time": datetime.now().isoformat(),
            "total_locations": len(self.locations),
            "occupied_locations": sum(1 for loc in self.locations.values() if loc.quantity > 0),
            "total_skus": total_skus,
            "total_quantity": total_qty,
            "pending_orders": sum(1 for o in self.orders.values() if o.status == OrderStatus.PENDING),
            "active_waves": sum(1 for w in self.waves.values() if w.status == "picking")
        }


def main():
    """WMSç³»ç»Ÿæ¼”ç¤º"""
    
    print("=" * 60)
    print("æ™ºèƒ½ä»“å‚¨ç®¡ç†ç³»ç»Ÿæ¼”ç¤º")
    print("=" * 60)
    
    wms = WMS("WH-BJ-001")
    
    # 1. åˆ›å»ºåº“ä½
    print("\n[1] åˆ›å»ºåº“ä½")
    for aisle in ["A", "B", "C"]:
        for section in range(1, 4):
            for level in range(1, 4):
                loc_id = f"{aisle}-{section:02d}-{level:02d}"
                loc = Location(
                    location_id=loc_id,
                    zone_id="Z-001",
                    location_type=LocationType.SHELF,
                    aisle=aisle,
                    section=str(section),
                    level=str(level),
                    position="01"
                )
                wms.add_location(loc)
    print(f"å·²åˆ›å»º {len(wms.locations)} ä¸ªåº“ä½")
    
    # 2. åˆ›å»ºSKU
    print("\n[2] åˆ›å»ºSKU")
    skus = [
        ("SKU-001", "æ™ºèƒ½æ‰‹æœº", "electronics", 0.2),
        ("SKU-002", "è“ç‰™è€³æœº", "electronics", 0.05),
        ("SKU-003", "å……ç”µå®", "electronics", 0.3),
    ]
    for sku_id, name, cat, weight in skus:
        wms.add_sku(SKU(sku_id=sku_id, sku_name=name, category=cat, weight=weight, volume=weight*2))
    print(f"å·²åˆ›å»º {len(wms.skus)} ä¸ªSKU")
    
    # 3. å…¥åº“
    print("\n[3] å…¥åº“")
    wms.receive_inventory("SKU-001", "A-01-01-01", 100)
    wms.receive_inventory("SKU-002", "A-01-01-02", 200)
    wms.receive_inventory("SKU-003", "A-01-02-01", 150)
    print("å…¥åº“å®Œæˆ")
    
    # 4. åˆ›å»ºè®¢å•
    print("\n[4] åˆ›å»ºè®¢å•")
    order = wms.create_order("normal", priority=5)
    order.lines = [
        OrderLine(10, "SKU-001", 2),
        OrderLine(20, "SKU-002", 1)
    ]
    print(f"è®¢å•ID: {order.order_id}")
    
    # 5. åº“å­˜åˆ†é…
    print("\n[5] åº“å­˜åˆ†é…")
    if wms.allocate_inventory(order.order_id):
        print("åº“å­˜åˆ†é…æˆåŠŸ")
        for line in order.lines:
            print(f"  {line.sku_id} -> {line.picked_location}")
    
    # 6. åˆ›å»ºæ³¢æ¬¡
    print("\n[6] æ³¢æ¬¡ç®¡ç†")
    wave = wms.create_wave("pick")
    wave.add_order(order.order_id)
    
    # ä¼˜åŒ–æ‹£è´§è·¯å¾„
    route = wms.optimize_picking_route(wave.wave_id)
    print(f"æ‹£è´§è·¯å¾„: {route}")
    
    # 7. åº“å­˜æŠ¥è¡¨
    print("\n[7] åº“å­˜æŠ¥è¡¨")
    report = wms.get_inventory_report()
    print(f"æ€»åº“ä½æ•°: {report['total_locations']}")
    print(f"å ç”¨åº“ä½: {report['occupied_locations']}")
    print(f"æ€»åº“å­˜é‡: {report['total_quantity']}")


if __name__ == "__main__":
    main()
```

### 2.7 æ•ˆæœè¯„ä¼°

| æŒ‡æ ‡ | åŸºçº¿å€¼ | ç›®æ ‡å€¼ | å®é™…å€¼ | è¾¾æˆç‡ |
|------|--------|--------|--------|--------|
| äººå‡æ‹£è´§æ•ˆç‡ | 80å•/å°æ—¶ | 300å•/å°æ—¶ | 320å•/å°æ—¶ | 107% |
| åº“å­˜å‡†ç¡®ç‡ | 95% | 99.99% | 99.995% | 100% |
| é€€è´§å¤„ç†å‘¨æœŸ | 7å¤© | â‰¤24å°æ—¶ | 18å°æ—¶ | 133% |
| è‡ªåŠ¨åŒ–ç‡ | 20% | 80% | 85% | 106% |

**ROIåˆ†æ**ï¼š
- é¡¹ç›®æ€»æŠ•èµ„ï¼š2äº¿å…ƒ
- å¹´åº¦æ€»æ”¶ç›Šï¼š5äº¿å…ƒ
- **æŠ•èµ„å›æ”¶æœŸï¼š4.8ä¸ªæœˆ**
- **3å¹´ROIï¼š650%**

---

## 3. æ¡ˆä¾‹æ€»ç»“

**å…³é”®æˆåŠŸå› ç´ **ï¼š
1. è‡ªåŠ¨åŒ–è®¾å¤‡ä¸WMSæ·±åº¦é›†æˆ
2. å®æ—¶åº“å­˜æ•°æ®æ˜¯æ ¸å¿ƒ
3. ç®—æ³•ä¼˜åŒ–æŒç»­è¿­ä»£

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21  
**æœ€åæ›´æ–°**ï¼š2025-02-15
