# å¹³è¡¡è®¡åˆ†å¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [å¹³è¡¡è®¡åˆ†å¡Schemaå®è·µæ¡ˆä¾‹](#å¹³è¡¡è®¡åˆ†å¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æˆ˜ç•¥ç›®æ ‡è®¾å®šç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æˆ˜ç•¥ç›®æ ‡è®¾å®šç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [4. æ¡ˆä¾‹3ï¼šæŒ‡æ ‡å…³è”ä¸ç›‘æ§](#4-æ¡ˆä¾‹3æŒ‡æ ‡å…³è”ä¸ç›‘æ§)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 å®ç°ä»£ç ](#42-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šè¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œç®¡ç†](#5-æ¡ˆä¾‹4è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œç®¡ç†)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šBSCæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5bscæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å¹³è¡¡è®¡åˆ†å¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–ä¼ä¸šæˆ˜ç•¥ç›®æ ‡è®¾å®šã€æˆ˜ç•¥åœ°å›¾æ„å»ºã€æŒ‡æ ‡å…³è”ä¸ç›‘æ§ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æˆ˜ç•¥ç›®æ ‡è®¾å®šç³»ç»Ÿ**ï¼šå››ä¸ªç»´åº¦ç›®æ ‡è®¾å®š
2. **æˆ˜ç•¥åœ°å›¾æ„å»ºç³»ç»Ÿ**ï¼šæˆ˜ç•¥åœ°å›¾å¯è§†åŒ–
3. **æŒ‡æ ‡å…³è”ä¸ç›‘æ§ç³»ç»Ÿ**ï¼šæŒ‡æ ‡å…³è”å’Œç›‘æ§
4. **è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œç®¡ç†ç³»ç»Ÿ**ï¼šè¡ŒåŠ¨è®¡åˆ’ç®¡ç†
5. **BSCæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šBSCæ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **å¹³è¡¡è®¡åˆ†å¡å®˜æ–¹**ï¼šå¹³è¡¡è®¡åˆ†å¡æœ€ä½³å®è·µ
- **æˆ˜ç•¥åœ°å›¾**ï¼šæˆ˜ç•¥åœ°å›¾è®¾è®¡æŒ‡å—

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æˆ˜ç•¥ç›®æ ‡è®¾å®šç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸåˆ¶é€ ä¼ä¸šéœ€è¦æ„å»ºå¹³è¡¡è®¡åˆ†å¡ç³»ç»Ÿï¼Œè®¾å®šä¼ä¸šæˆ˜ç•¥ç›®æ ‡ï¼ŒåŒ…æ‹¬è´¢åŠ¡ã€å®¢æˆ·ã€å†…éƒ¨æµç¨‹ã€å­¦ä¹ æˆé•¿å››ä¸ªç»´åº¦çš„ç›®æ ‡ï¼Œå®ç°æˆ˜ç•¥ç›®æ ‡çš„æœ‰æ•ˆç®¡ç†ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **æˆ˜ç•¥ç›®æ ‡ä¸æ¸…æ™°**ï¼šæˆ˜ç•¥ç›®æ ‡å®šä¹‰ä¸æ¸…æ™°
2. **ç›®æ ‡å…³è”ç¼ºå¤±**ï¼šç¼ºä¹ç›®æ ‡ä¹‹é—´çš„å…³è”
3. **æ‰§è¡Œç›‘æ§ä¸è¶³**ï¼šæˆ˜ç•¥ç›®æ ‡æ‰§è¡Œç›‘æ§ä¸è¶³
4. **ç»©æ•ˆè¯„ä¼°å›°éš¾**ï¼šéš¾ä»¥è¯„ä¼°æˆ˜ç•¥ç›®æ ‡è¾¾æˆæƒ…å†µ

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- æ¸…æ™°å®šä¹‰æˆ˜ç•¥ç›®æ ‡
- å»ºç«‹ç›®æ ‡å…³è”å…³ç³»
- åŠ å¼ºæ‰§è¡Œç›‘æ§
- æ”¯æŒç»©æ•ˆè¯„ä¼°

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **å››ä¸ªç»´åº¦è®¾è®¡**ï¼šè®¾è®¡è´¢åŠ¡ã€å®¢æˆ·ã€æµç¨‹ã€å­¦ä¹ å››ä¸ªç»´åº¦
2. **ç›®æ ‡å±‚æ¬¡ç»“æ„**ï¼šå»ºç«‹ç›®æ ‡å±‚æ¬¡ç»“æ„
3. **ç›®æ ‡å…³è”**ï¼šå»ºç«‹ç›®æ ‡ä¹‹é—´çš„å…³è”å…³ç³»
4. **ç»©æ•ˆè¯„ä¼°**ï¼šå®ç°ç»©æ•ˆè¯„ä¼°æœºåˆ¶

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰å¹³è¡¡è®¡åˆ†å¡æˆ˜ç•¥ç›®æ ‡è®¾å®šç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**å¹³è¡¡è®¡åˆ†å¡æˆ˜ç•¥ç›®æ ‡Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
å¹³è¡¡è®¡åˆ†å¡Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import date, datetime
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

class ObjectiveDimension(str, Enum):
    """ç›®æ ‡ç»´åº¦"""
    FINANCIAL = "Financial"
    CUSTOMER = "Customer"
    INTERNAL_PROCESS = "Internal_Process"
    LEARNING_GROWTH = "Learning_Growth"

class ObjectivePriority(str, Enum):
    """ç›®æ ‡ä¼˜å…ˆçº§"""
    CRITICAL = "Critical"
    HIGH = "High"
    MEDIUM = "Medium"
    LOW = "Low"

@dataclass
class StrategicObjective:
    """æˆ˜ç•¥ç›®æ ‡"""
    objective_id: str
    objective_name: str
    objective_dimension: ObjectiveDimension
    objective_priority: ObjectivePriority
    owner: str
    target_date: date
    description: Optional[str] = None
    parent_objective_id: Optional[str] = None
    related_objectives: List[str] = field(default_factory=list)
    target_value: Optional[Decimal] = None
    current_value: Optional[Decimal] = None

    def add_related_objective(self, objective_id: str):
        """æ·»åŠ å…³è”ç›®æ ‡"""
        if objective_id not in self.related_objectives:
            self.related_objectives.append(objective_id)

    @property
    def completion_rate(self) -> Decimal:
        """è®¡ç®—å®Œæˆç‡"""
        if self.target_value and self.current_value and self.target_value > 0:
            return (self.current_value / self.target_value) * Decimal('100')
        return Decimal('0')

@dataclass
class BalancedScorecard:
    """å¹³è¡¡è®¡åˆ†å¡"""
    scorecard_id: str
    scorecard_name: str
    period_start: date
    period_end: date
    objectives: Dict[str, StrategicObjective] = field(default_factory=dict)
    created_at: datetime = field(default_factory=datetime.now)

    def add_objective(self, objective: StrategicObjective):
        """æ·»åŠ ç›®æ ‡"""
        self.objectives[objective.objective_id] = objective

    def get_objectives_by_dimension(self, dimension: ObjectiveDimension) -> List[StrategicObjective]:
        """æŒ‰ç»´åº¦è·å–ç›®æ ‡"""
        return [obj for obj in self.objectives.values() if obj.objective_dimension == dimension]

    def get_objective_hierarchy(self) -> Dict:
        """è·å–ç›®æ ‡å±‚æ¬¡ç»“æ„"""
        hierarchy = {
            'root': [],
            'children': {}
        }

        for obj in self.objectives.values():
            if obj.parent_objective_id is None:
                hierarchy['root'].append(obj.objective_id)
            else:
                if obj.parent_objective_id not in hierarchy['children']:
                    hierarchy['children'][obj.parent_objective_id] = []
                hierarchy['children'][obj.parent_objective_id].append(obj.objective_id)

        return hierarchy

    def calculate_dimension_score(self, dimension: ObjectiveDimension) -> Decimal:
        """è®¡ç®—ç»´åº¦å¾—åˆ†"""
        dimension_objectives = self.get_objectives_by_dimension(dimension)
        if not dimension_objectives:
            return Decimal('0')

        total_completion = sum(obj.completion_rate for obj in dimension_objectives)
        return total_completion / len(dimension_objectives)

    def get_scorecard_summary(self) -> Dict:
        """è·å–è®¡åˆ†å¡æ‘˜è¦"""
        return {
            'scorecard_id': self.scorecard_id,
            'scorecard_name': self.scorecard_name,
            'period': {
                'start': self.period_start.isoformat(),
                'end': self.period_end.isoformat()
            },
            'dimension_scores': {
                'financial': float(self.calculate_dimension_score(ObjectiveDimension.FINANCIAL)),
                'customer': float(self.calculate_dimension_score(ObjectiveDimension.CUSTOMER)),
                'internal_process': float(self.calculate_dimension_score(ObjectiveDimension.INTERNAL_PROCESS)),
                'learning_growth': float(self.calculate_dimension_score(ObjectiveDimension.LEARNING_GROWTH))
            },
            'total_objectives': len(self.objectives),
            'objectives_by_dimension': {
                dim.value: len(self.get_objectives_by_dimension(dim))
                for dim in ObjectiveDimension
            }
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºå¹³è¡¡è®¡åˆ†å¡
    bsc = BalancedScorecard(
        scorecard_id="BSC-2025-001",
        scorecard_name="2025å¹´åº¦å¹³è¡¡è®¡åˆ†å¡",
        period_start=date(2025, 1, 1),
        period_end=date(2025, 12, 31)
    )

    # æ·»åŠ è´¢åŠ¡ç»´åº¦ç›®æ ‡
    financial_obj = StrategicObjective(
        objective_id="OBJ-FIN-001",
        objective_name="æå‡ç›ˆåˆ©èƒ½åŠ›",
        objective_dimension=ObjectiveDimension.FINANCIAL,
        objective_priority=ObjectivePriority.CRITICAL,
        owner="è´¢åŠ¡éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('10000000'),
        current_value=Decimal('8500000')
    )
    bsc.add_objective(financial_obj)

    # æ·»åŠ å®¢æˆ·ç»´åº¦ç›®æ ‡
    customer_obj = StrategicObjective(
        objective_id="OBJ-CUS-001",
        objective_name="æå‡å®¢æˆ·æ»¡æ„åº¦",
        objective_dimension=ObjectiveDimension.CUSTOMER,
        objective_priority=ObjectivePriority.HIGH,
        owner="å®¢æˆ·æœåŠ¡éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('90'),
        current_value=Decimal('85')
    )
    bsc.add_objective(customer_obj)

    # è·å–è®¡åˆ†å¡æ‘˜è¦
    summary = bsc.get_scorecard_summary()
    print(f"è®¡åˆ†å¡: {summary['scorecard_name']}")
    print(f"ç»´åº¦å¾—åˆ†: {summary['dimension_scores']}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æˆ˜ç•¥ç›®æ ‡æ¸…æ™°åº¦ | 60% | 100% | 40%æå‡ |
| ç›®æ ‡å…³è”å®Œæ•´æ€§ | 40% | 100% | 60%æå‡ |
| æ‰§è¡Œç›‘æ§èƒ½åŠ› | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| ç»©æ•ˆè¯„ä¼°å‡†ç¡®æ€§ | 70% | 95% | 25%æå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **æˆ˜ç•¥ç›®æ ‡æ¸…æ™°**ï¼šæ¸…æ™°å®šä¹‰æˆ˜ç•¥ç›®æ ‡
2. **ç›®æ ‡å…³è”å»ºç«‹**ï¼šå»ºç«‹ç›®æ ‡å…³è”å…³ç³»
3. **æ‰§è¡Œç›‘æ§åŠ å¼º**ï¼šåŠ å¼ºæˆ˜ç•¥ç›®æ ‡æ‰§è¡Œç›‘æ§
4. **ç»©æ•ˆè¯„ä¼°æ”¯æŒ**ï¼šæ”¯æŒç»©æ•ˆè¯„ä¼°

**ç»éªŒæ•™è®­**ï¼š

1. å››ä¸ªç»´åº¦è®¾è®¡å¾ˆé‡è¦
2. ç›®æ ‡å±‚æ¬¡ç»“æ„éœ€è¦åˆç†
3. ç›®æ ‡å…³è”éœ€è¦æ˜ç¡®
4. ç»©æ•ˆè¯„ä¼°éœ€è¦æ ‡å‡†åŒ–

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [å¹³è¡¡è®¡åˆ†å¡å®˜æ–¹](https://www.balancedscorecard.org/)
- [æˆ˜ç•¥åœ°å›¾æœ€ä½³å®è·µ](https://www.balancedscorecard.org/)
    objective_dimension: Enum @value("Learning_Growth")
    objective_priority: Enum @value("Medium")
    owner: String @value("äººåŠ›èµ„æºéƒ¨")
    target_date: Date @value("2025-12-31")
  }
}

```

---

## 3. æ¡ˆä¾‹2ï¼šæˆ˜ç•¥åœ°å›¾æ„å»º

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æ„å»ºä¼ä¸šæˆ˜ç•¥åœ°å›¾ï¼Œå±•ç¤ºä»å­¦ä¹ æˆé•¿åˆ°è´¢åŠ¡çš„ä»·å€¼åˆ›é€ è·¯å¾„ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒæˆ˜ç•¥åœ°å›¾å¯è§†åŒ–
- æ”¯æŒå› æœå…³ç³»å±•ç¤º
- æ”¯æŒä»·å€¼åˆ›é€ è·¯å¾„åˆ†æ

### 3.2 å®ç°ä»£ç 

```python
def build_strategy_map(bsc_data: BalancedScorecardSchema) -> StrategyMap:
    """æ„å»ºæˆ˜ç•¥åœ°å›¾"""
    strategy_map = StrategyMap()
    strategy_map.map_id = "MAP-001"
    strategy_map.map_name = "ä¼ä¸šæˆ˜ç•¥åœ°å›¾"
    strategy_map.map_version = "1.0"

    # æŒ‰ç»´åº¦ç»„ç»‡ç›®æ ‡
    dimensions_order = ["Learning_Growth", "Internal_Process", "Customer", "Financial"]
    dimension_objectives = {}

    for objective in bsc_data.strategic_objective.strategic_objectives:
        if objective.objective_dimension not in dimension_objectives:
            dimension_objectives[objective.objective_dimension] = []
        dimension_objectives[objective.objective_dimension].append(objective)

    # åˆ›å»ºæˆ˜ç•¥åœ°å›¾ç»´åº¦
    for i, dimension_name in enumerate(dimensions_order):
        map_dimension = MapDimension()
        map_dimension.dimension_name = dimension_name
        map_dimension.dimension_order = i + 1
        map_dimension.objectives = [obj.objective_id for obj in dimension_objectives.get(dimension_name, [])]
        strategy_map.map_dimensions.append(map_dimension)

    # æ„å»ºå› æœå…³ç³»
    for relationship in bsc_data.strategy_map.causal_relationships:
        causal_relationship = CausalRelationship()
        causal_relationship.relationship_id = relationship.relationship_id
        causal_relationship.source_objective_id = relationship.source_objective_id
        causal_relationship.target_objective_id = relationship.target_objective_id
        causal_relationship.relationship_type = relationship.relationship_type
        causal_relationship.relationship_strength = relationship.relationship_strength
        strategy_map.causal_relationships.append(causal_relationship)

    # è®¡ç®—ä»·å€¼åˆ›é€ è·¯å¾„
    value_paths = calculate_value_creation_paths(bsc_data)
    strategy_map.value_creation_paths = value_paths

    return strategy_map

def calculate_value_creation_paths(bsc_data: BalancedScorecardSchema) -> List[ValueCreationPath]:
    """è®¡ç®—ä»·å€¼åˆ›é€ è·¯å¾„"""
    paths = []

    # ä»å­¦ä¹ æˆé•¿ç»´åº¦å¼€å§‹
    learning_objectives = [obj for obj in bsc_data.strategic_objective.strategic_objectives
                          if obj.objective_dimension == "Learning_Growth"]

    # éå†æ¯ä¸ªå­¦ä¹ æˆé•¿ç›®æ ‡
    for learning_obj in learning_objectives:
        # æŸ¥æ‰¾å…³è”çš„å†…éƒ¨æµç¨‹ç›®æ ‡
        process_objectives = find_related_objectives(bsc_data, learning_obj.objective_id, "Internal_Process")

        for process_obj in process_objectives:
            # æŸ¥æ‰¾å…³è”çš„å®¢æˆ·ç›®æ ‡
            customer_objectives = find_related_objectives(bsc_data, process_obj.objective_id, "Customer")

            for customer_obj in customer_objectives:
                # æŸ¥æ‰¾å…³è”çš„è´¢åŠ¡ç›®æ ‡
                financial_objectives = find_related_objectives(bsc_data, customer_obj.objective_id, "Financial")

                for financial_obj in financial_objectives:
                    # åˆ›å»ºä»·å€¼åˆ›é€ è·¯å¾„
                    path = ValueCreationPath()
                    path.path_id = f"PATH-{learning_obj.objective_id}-{financial_obj.objective_id}"
                    path.path_name = f"{learning_obj.objective_name} â†’ {financial_obj.objective_name}"
                    path.path_objectives = [
                        learning_obj.objective_id,
                        process_obj.objective_id,
                        customer_obj.objective_id,
                        financial_obj.objective_id
                    ]
                    path.expected_value = calculate_expected_value(bsc_data, path.path_objectives)
                    path.value_driver = learning_obj.objective_name
                    paths.append(path)

    return paths
```

---

## 4. æ¡ˆä¾‹3ï¼šæŒ‡æ ‡å…³è”ä¸ç›‘æ§

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å…³è”æŒ‡æ ‡ä¸æˆ˜ç•¥ç›®æ ‡ï¼Œç›‘æ§æŒ‡æ ‡æ‰§è¡Œæƒ…å†µã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒæŒ‡æ ‡ä¸ç›®æ ‡å…³è”
- æ”¯æŒæŒ‡æ ‡å€¼ç›‘æ§
- æ”¯æŒæŒ‡æ ‡å®Œæˆç‡è®¡ç®—

### 4.2 å®ç°ä»£ç 

```python
def link_metrics_to_objectives(bsc_data: BalancedScorecardSchema, objective_id: str, metric_ids: List[str]):
    """å…³è”æŒ‡æ ‡ä¸æˆ˜ç•¥ç›®æ ‡"""
    objective = find_objective(bsc_data, objective_id)

    for metric_id in metric_ids:
        metric = find_metric(bsc_data, metric_id)
        if metric:
            metric.objective_id = objective_id

            # åˆ›å»ºæŒ‡æ ‡å…³è”
            linkage = MetricLinkage()
            linkage.linkage_id = f"LINK-{objective_id}-{metric_id}"
            linkage.source_metric_id = metric_id
            linkage.target_metric_id = None  # å¦‚æœæ˜¯æŒ‡æ ‡é—´å…³è”
            linkage.linkage_type = "Causal"
            linkage.linkage_strength = "Strong"
            linkage.linkage_direction = "Positive"
            bsc_data.metric.metric_linkages.append(linkage)

def monitor_metric_performance(bsc_data: BalancedScorecardSchema, metric_id: str) -> MetricPerformance:
    """ç›‘æ§æŒ‡æ ‡ç»©æ•ˆ"""
    metric = find_metric(bsc_data, metric_id)
    metric_values = get_metric_values(bsc_data, metric_id)

    performance = MetricPerformance()
    performance.metric_id = metric_id
    performance.current_value = metric_values[-1].value if metric_values else 0
    performance.target_value = metric.target_value
    performance.completion_rate = (performance.current_value / metric.target_value * 100) if metric.target_value > 0 else 0

    # è®¡ç®—è¶‹åŠ¿
    if len(metric_values) >= 2:
        trend = calculate_trend(metric_values)
        performance.trend_direction = trend.direction
        performance.trend_magnitude = trend.magnitude

    # è¯„ä¼°ç»©æ•ˆ
    if performance.completion_rate >= 100:
        performance.performance_level = "Exceeded"
    elif performance.completion_rate >= 80:
        performance.performance_level = "Met"
    elif performance.completion_rate >= 60:
        performance.performance_level = "Partially_Met"
    else:
        performance.performance_level = "Not_Met"

    return performance
```

---

## 5. æ¡ˆä¾‹4ï¼šè¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œç®¡ç†

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
ç®¡ç†è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œï¼Œè·Ÿè¸ªæ‰§è¡Œè¿›åº¦å’Œç»“æœã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒè¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œè·Ÿè¸ª
- æ”¯æŒé‡Œç¨‹ç¢‘ç®¡ç†
- æ”¯æŒæ‰§è¡Œè¯„ä¼°

### 5.2 å®ç°ä»£ç 

```python
def execute_action_plan(bsc_data: BalancedScorecardSchema, action_id: str, execution_data: dict):
    """æ‰§è¡Œè¡ŒåŠ¨è®¡åˆ’"""
    action = find_action(bsc_data, action_id)

    execution = ActionExecution()
    execution.execution_id = f"EXEC-{action_id}-{datetime.now().strftime('%Y%m%d%H%M%S')}"
    execution.action_id = action_id
    execution.execution_status = "In_Progress"
    execution.execution_start_date = datetime.now().date()
    execution.execution_progress = 0

    # æ›´æ–°æ‰§è¡ŒçŠ¶æ€
    bsc_data.action_plan.action_executions.append(execution)

    return execution

def update_action_progress(bsc_data: BalancedScorecardSchema, execution_id: str, progress: Decimal, milestone_id: Optional[str] = None):
    """æ›´æ–°è¡ŒåŠ¨è®¡åˆ’è¿›åº¦"""
    execution = find_execution(bsc_data, execution_id)

    if execution:
        execution.execution_progress = progress

        # æ›´æ–°é‡Œç¨‹ç¢‘çŠ¶æ€
        if milestone_id:
            milestone = find_milestone(execution, milestone_id)
            if milestone:
                if progress >= calculate_milestone_progress(milestone):
                    milestone.milestone_status = "Completed"

        # æ£€æŸ¥æ˜¯å¦å®Œæˆ
        if progress >= 100:
            execution.execution_status = "Completed"
            execution.execution_end_date = datetime.now().date()

        execution.updated_at = datetime.now()

def evaluate_action_plan(bsc_data: BalancedScorecardSchema, action_id: str) -> ActionEvaluation:
    """è¯„ä¼°è¡ŒåŠ¨è®¡åˆ’"""
    action = find_action(bsc_data, action_id)
    execution = find_execution_by_action(bsc_data, action_id)

    evaluation = ActionEvaluation()
    evaluation.evaluation_id = f"EVAL-{action_id}-{datetime.now().strftime('%Y%m%d')}"
    evaluation.action_id = action_id
    evaluation.evaluation_date = datetime.now().date()

    # è¯„ä¼°æ ‡å‡†
    evaluation.evaluation_criteria = [
        "æ‰§è¡Œè¿›åº¦",
        "é¢„ç®—æ‰§è¡Œ",
        "è´¨é‡æŒ‡æ ‡",
        "æ—¶é—´è¦æ±‚"
    ]

    # è¯„ä¼°ç»“æœ
    if execution:
        progress_score = execution.execution_progress
        budget_score = calculate_budget_score(action, execution)
        quality_score = calculate_quality_score(action, execution)
        time_score = calculate_time_score(action, execution)

        evaluation.evaluation_score = (progress_score + budget_score + quality_score + time_score) / 4

        if evaluation.evaluation_score >= 90:
            evaluation.evaluation_result = "Exceeded"
        elif evaluation.evaluation_score >= 75:
            evaluation.evaluation_result = "Met"
        elif evaluation.evaluation_score >= 60:
            evaluation.evaluation_result = "Partially_Met"
        else:
            evaluation.evaluation_result = "Not_Met"

        # ç”Ÿæˆæ”¹è¿›å»ºè®®
        if evaluation.evaluation_score < 75:
            evaluation.improvement_recommendations = generate_improvement_recommendations(action, execution)

    bsc_data.action_plan.action_evaluations.append(evaluation)

    return evaluation
```

---

## 6. æ¡ˆä¾‹5ï¼šBSCæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
BSCæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒBSCå…ƒæ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒBSCå…ƒæ•°æ®å­˜å‚¨
- æ”¯æŒBSCæ•°æ®æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒBSCæŠ¥å‘Šç”Ÿæˆ

### 6.2 å®ç°ä»£ç 

```python
def store_bsc_data(bsc_data: BalancedScorecardSchema, conn):
    """å­˜å‚¨å¹³è¡¡è®¡åˆ†å¡æ•°æ®åˆ°PostgreSQL"""
    cursor = conn.cursor()

    # å­˜å‚¨æˆ˜ç•¥ç›®æ ‡
    for objective in bsc_data.strategic_objective.strategic_objectives:
        cursor.execute("""
            INSERT INTO strategic_objectives
            (objective_id, objective_name, objective_description, objective_dimension,
             objective_category, objective_priority, objective_level, parent_objective_id,
             owner, target_date, is_active)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (objective_id) DO UPDATE SET
            objective_name = EXCLUDED.objective_name,
            objective_description = EXCLUDED.objective_description,
            objective_priority = EXCLUDED.objective_priority,
            updated_at = CURRENT_TIMESTAMP
        """, (objective.objective_id, objective.objective_name, objective.objective_description,
              objective.objective_dimension, objective.objective_category, objective.objective_priority,
              objective.objective_level, objective.parent_objective_id, objective.owner,
              objective.target_date, objective.is_active))

    # å­˜å‚¨æŒ‡æ ‡å®šä¹‰
    for metric in bsc_data.metric.metric_definitions:
        cursor.execute("""
            INSERT INTO metric_definitions
            (metric_id, metric_name, metric_description, metric_type, objective_id,
             calculation_formula, measurement_unit, target_value, baseline_value, owner)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (metric_id) DO UPDATE SET
            metric_name = EXCLUDED.metric_name,
            calculation_formula = EXCLUDED.calculation_formula,
            target_value = EXCLUDED.target_value
        """, (metric.metric_id, metric.metric_name, metric.metric_description,
              metric.metric_type, metric.objective_id, metric.calculation_formula,
              metric.measurement_unit, metric.target_value, metric.baseline_value, metric.owner))

    # å­˜å‚¨æŒ‡æ ‡å€¼
    for value in bsc_data.metric.metric_values:
        cursor.execute("""
            INSERT INTO metric_values
            (value_id, metric_id, value, measurement_date, completion_rate)
            VALUES (%s, %s, %s, %s, %s)
            ON CONFLICT (value_id) DO UPDATE SET
            value = EXCLUDED.value,
            completion_rate = EXCLUDED.completion_rate
        """, (value.value_id, value.metric_id, value.value,
              value.measurement_date, value.completion_rate))

    # å­˜å‚¨è¡ŒåŠ¨è®¡åˆ’
    for action in bsc_data.action_plan.action_definitions:
        cursor.execute("""
            INSERT INTO action_definitions
            (action_id, action_name, action_description, objective_id, action_type,
             action_priority, owner, start_date, end_date, budget)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (action_id) DO UPDATE SET
            action_name = EXCLUDED.action_name,
            action_description = EXCLUDED.action_description,
            updated_at = CURRENT_TIMESTAMP
        """, (action.action_id, action.action_name, action.action_description,
              action.objective_id, action.action_type, action.action_priority,
              action.owner, action.start_date, action.end_date, action.budget))

    # å­˜å‚¨è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œ
    for execution in bsc_data.action_plan.action_executions:
        cursor.execute("""
            INSERT INTO action_executions
            (execution_id, action_id, execution_status, execution_progress,
             execution_start_date, execution_end_date, actual_cost)
            VALUES (%s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (execution_id) DO UPDATE SET
            execution_status = EXCLUDED.execution_status,
            execution_progress = EXCLUDED.execution_progress,
            updated_at = CURRENT_TIMESTAMP
        """, (execution.execution_id, execution.action_id, execution.execution_status,
              execution.execution_progress, execution.execution_start_date,
              execution.execution_end_date, execution.actual_cost))

    # å­˜å‚¨å› æœå…³ç³»
    for relationship in bsc_data.strategy_map.causal_relationships:
        cursor.execute("""
            INSERT INTO causal_relationships
            (relationship_id, source_objective_id, target_objective_id,
             relationship_type, relationship_strength, relationship_evidence)
            VALUES (%s, %s, %s, %s, %s, %s)
            ON CONFLICT (relationship_id) DO UPDATE SET
            relationship_type = EXCLUDED.relationship_type,
            relationship_strength = EXCLUDED.relationship_strength
        """, (relationship.relationship_id, relationship.source_objective_id,
              relationship.target_objective_id, relationship.relationship_type,
              relationship.relationship_strength, relationship.relationship_evidence))

    conn.commit()

def generate_bsc_report(conn):
    """ç”Ÿæˆå¹³è¡¡è®¡åˆ†å¡æŠ¥è¡¨"""
    cursor = conn.cursor()

    # æŸ¥è¯¢å„ç»´åº¦ç›®æ ‡å®Œæˆæƒ…å†µ
    cursor.execute("""
        SELECT
            so.objective_dimension,
            COUNT(DISTINCT so.objective_id) as objective_count,
            COUNT(DISTINCT md.metric_id) as metric_count,
            AVG(mv.completion_rate) as avg_completion_rate,
            SUM(CASE WHEN mv.completion_rate >= 100 THEN 1 ELSE 0 END) as achieved_count
        FROM strategic_objectives so
        LEFT JOIN metric_definitions md ON so.objective_id = md.objective_id
        LEFT JOIN metric_values mv ON md.metric_id = mv.metric_id
        WHERE so.is_active = TRUE
        GROUP BY so.objective_dimension
        ORDER BY so.objective_dimension
    """)

    dimension_report = cursor.fetchall()

    # æŸ¥è¯¢è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œæƒ…å†µ
    cursor.execute("""
        SELECT
            ad.action_type,
            COUNT(*) as total_actions,
            SUM(CASE WHEN ae.execution_status = 'Completed' THEN 1 ELSE 0 END) as completed_actions,
            AVG(ae.execution_progress) as avg_progress,
            SUM(ad.budget) as total_budget,
            SUM(ae.actual_cost) as total_actual_cost
        FROM action_definitions ad
        LEFT JOIN action_executions ae ON ad.action_id = ae.action_id
        GROUP BY ad.action_type
        ORDER BY total_actions DESC
    """)

    action_report = cursor.fetchall()

    return {
        "dimension_report": dimension_report,
        "action_report": action_report
    }
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
