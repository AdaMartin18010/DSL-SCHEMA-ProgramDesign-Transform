# å¹³è¡¡è®¡åˆ†å¡Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [å¹³è¡¡è®¡åˆ†å¡Schemaå®è·µæ¡ˆä¾‹](#å¹³è¡¡è®¡åˆ†å¡schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šå¤§å‹åˆ¶é€ ä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æ•°å­—åŒ–è½¬å‹](#2-æ¡ˆä¾‹1å¤§å‹åˆ¶é€ ä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æ•°å­—åŒ–è½¬å‹)
    - [2.1 ä¼ä¸šèƒŒæ™¯](#21-ä¼ä¸šèƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 è§£å†³æ–¹æ¡ˆ](#25-è§£å†³æ–¹æ¡ˆ)
    - [2.6 å®Œæ•´ä»£ç å®ç°](#26-å®Œæ•´ä»£ç å®ç°)
    - [2.7 æ•ˆæœè¯„ä¼°ä¸ROI](#27-æ•ˆæœè¯„ä¼°ä¸roi)
  - [3. æ¡ˆä¾‹2ï¼šæˆ˜ç•¥åœ°å›¾å¯è§†åŒ–ç³»ç»Ÿ](#3-æ¡ˆä¾‹2æˆ˜ç•¥åœ°å›¾å¯è§†åŒ–ç³»ç»Ÿ)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 å®ç°ä»£ç ](#32-å®ç°ä»£ç )
  - [4. æ¡ˆä¾‹3ï¼šæŒ‡æ ‡å…³è”ä¸å› æœåˆ†æç³»ç»Ÿ](#4-æ¡ˆä¾‹3æŒ‡æ ‡å…³è”ä¸å› æœåˆ†æç³»ç»Ÿ)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 å®ç°ä»£ç ](#42-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šè¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œè·Ÿè¸ªç³»ç»Ÿ](#5-æ¡ˆä¾‹4è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œè·Ÿè¸ªç³»ç»Ÿ)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šBSCæ•°æ®å­˜å‚¨ä¸OLAPåˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5bscæ•°æ®å­˜å‚¨ä¸olapåˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å¹³è¡¡è®¡åˆ†å¡Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–ä¼ä¸šæˆ˜ç•¥ç›®æ ‡è®¾å®šã€æˆ˜ç•¥åœ°å›¾æ„å»ºã€æŒ‡æ ‡å…³è”ä¸ç›‘æ§ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **å¤§å‹åˆ¶é€ ä¼ä¸šBSCæ•°å­—åŒ–è½¬å‹**ï¼šå››ä¸ªç»´åº¦ç›®æ ‡è®¾å®šä¸æ•°å­—åŒ–ç®¡ç†
2. **æˆ˜ç•¥åœ°å›¾å¯è§†åŒ–ç³»ç»Ÿ**ï¼šæˆ˜ç•¥åœ°å›¾å¯è§†åŒ–ä¸å› æœå…³ç³»åˆ†æ
3. **æŒ‡æ ‡å…³è”ä¸å› æœåˆ†æç³»ç»Ÿ**ï¼šæŒ‡æ ‡å…³è”åˆ†æå’Œå› æœæ¨æ–­
4. **è¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œè·Ÿè¸ªç³»ç»Ÿ**ï¼šè¡ŒåŠ¨è®¡åˆ’ç®¡ç†ä¸æ‰§è¡Œç›‘æ§
5. **BSCæ•°æ®å­˜å‚¨ä¸OLAPåˆ†æç³»ç»Ÿ**ï¼šBSCæ•°æ®åˆ†æå’Œå¤šç»´åº¦æŠ¥è¡¨

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **åä¸º**ï¼šå¹³è¡¡è®¡åˆ†å¡åœ¨å…¨çƒåŒ–æˆ˜ç•¥ä¸­çš„åº”ç”¨
- **æµ·å°”**ï¼šäººå•åˆä¸€æ¨¡å¼ä¸BSCç»“åˆå®è·µ
- **ç¾çš„é›†å›¢**ï¼šæ•°å­—åŒ–è½¬å‹ä¸­çš„ç»©æ•ˆç®¡ç†

---

## 2. æ¡ˆä¾‹1ï¼šå¤§å‹åˆ¶é€ ä¼ä¸šå¹³è¡¡è®¡åˆ†å¡æ•°å­—åŒ–è½¬å‹

### 2.1 ä¼ä¸šèƒŒæ™¯

**ä¼ä¸šæ¦‚å†µ**ï¼š
æŸå¤§å‹è£…å¤‡åˆ¶é€ é›†å›¢ï¼ˆä»¥ä¸‹ç®€ç§°"åé”é›†å›¢"ï¼‰ï¼Œæˆç«‹äº1998å¹´ï¼Œæ€»éƒ¨ä½äºæ±Ÿè‹çœï¼Œæ˜¯ä¸­å›½é¢†å…ˆçš„æ™ºèƒ½åˆ¶é€ è§£å†³æ–¹æ¡ˆæä¾›å•†ã€‚é›†å›¢æ——ä¸‹æ‹¥æœ‰12å®¶å­å…¬å¸ï¼Œå‘˜å·¥æ€»æ•°è¶…è¿‡15,000äººï¼Œå¹´è¥ä¸šæ”¶å…¥è¾¾280äº¿å…ƒäººæ°‘å¸ï¼Œäº§å“è¿œé”€å…¨çƒ60å¤šä¸ªå›½å®¶å’Œåœ°åŒºã€‚

**ç»„ç»‡æ¶æ„**ï¼š
- é›†å›¢æ€»éƒ¨ï¼šæˆ˜ç•¥è§„åˆ’ã€è´¢åŠ¡ç®¡ç†ã€äººåŠ›èµ„æº
- ç ”å‘ä¸­å¿ƒï¼ˆ3ä¸ªï¼‰ï¼šåŸºç¡€æŠ€æœ¯ç ”ç©¶ã€äº§å“å¼€å‘ã€å·¥è‰ºæ”¹è¿›
- ç”Ÿäº§åŸºåœ°ï¼ˆ5ä¸ªï¼‰ï¼šç²¾å¯†åˆ¶é€ ã€æ€»è£…é›†æˆã€è´¨é‡æ£€æµ‹
- é”€å”®ç½‘ç»œï¼šå›½å†…30ä¸ªåŠäº‹å¤„ï¼Œæµ·å¤–15ä¸ªåˆ†æ”¯æœºæ„
- æœåŠ¡ä¸­å¿ƒï¼šå®¢æˆ·æ”¯æŒã€æŠ€æœ¯åŸ¹è®­ã€å”®åæœåŠ¡

**ä¸šåŠ¡ç‰¹ç‚¹**ï¼š
- è®¢å•å¼ç”Ÿäº§æ¨¡å¼ï¼Œäº¤ä»˜å‘¨æœŸé•¿ï¼ˆå¹³å‡3-6ä¸ªæœˆï¼‰
- å¤šå“ç§ã€å°æ‰¹é‡ç”Ÿäº§ï¼Œäº§å“å®šåˆ¶åŒ–ç¨‹åº¦é«˜
- æŠ€æœ¯å¯†é›†å‹å’Œèµ„æœ¬å¯†é›†å‹å¹¶é‡
- ä¾›åº”é“¾å¤æ‚ï¼Œæ¶‰åŠ2000+ä¾›åº”å•†

### 2.2 ä¸šåŠ¡ç—›ç‚¹

1. **æˆ˜ç•¥ç›®æ ‡åˆ†è§£ä¸æ¸…æ™°**
   - é›†å›¢æˆ˜ç•¥ç›®æ ‡åœç•™åœ¨é«˜å±‚ï¼Œæ— æ³•æœ‰æ•ˆåˆ†è§£åˆ°å„éƒ¨é—¨å’Œå‘˜å·¥
   - éƒ¨é—¨ç›®æ ‡ä¸ä¼ä¸šæˆ˜ç•¥è„±èŠ‚ï¼Œå„è‡ªä¸ºæ”¿
   - ç¼ºä¹ç³»ç»Ÿæ€§çš„ç›®æ ‡å…³è”æœºåˆ¶

2. **ç»©æ•ˆç®¡ç†ä¿¡æ¯å­¤å²›**
   - è´¢åŠ¡ã€å®¢æˆ·ã€è¿è¥æ•°æ®åˆ†æ•£åœ¨ä¸åŒç³»ç»Ÿä¸­
   - æ•°æ®å£å¾„ä¸ä¸€è‡´ï¼Œæ— æ³•å½¢æˆç»Ÿä¸€è§†å›¾
   - æ‰‹å·¥æ±‡æ€»æ•°æ®è€—æ—¶è€—åŠ›ï¼Œæ¯æœˆéœ€è¦5-7å¤©

3. **æ‰§è¡Œç›‘æ§æ»åä¸¥é‡**
   - å­£åº¦å¤ç›˜æ‰èƒ½å‘ç°é—®é¢˜ï¼Œé”™è¿‡æœ€ä½³è°ƒæ•´æ—¶æœº
   - ç¼ºä¹å®æ—¶é¢„è­¦æœºåˆ¶ï¼Œè¢«åŠ¨å“åº”é—®é¢˜
   - è¡ŒåŠ¨è®¡åˆ’æ‰§è¡ŒçŠ¶æ€ä¸é€æ˜

4. **å› æœåˆ†æèƒ½åŠ›è–„å¼±**
   - æ— æ³•é‡åŒ–åˆ†æå„ç»´åº¦æŒ‡æ ‡çš„ç›¸äº’å½±å“
   - ä¸çŸ¥é“å“ªäº›å› ç´ çœŸæ­£é©±åŠ¨è´¢åŠ¡ç»“æœ
   - æ”¹è¿›æªæ–½ç¼ºä¹é’ˆå¯¹æ€§ï¼Œæ•ˆæœéš¾ä»¥è¯„ä¼°

5. **æˆ˜ç•¥è°ƒæ•´å“åº”è¿Ÿç¼“**
   - å¸‚åœºç¯å¢ƒå˜åŒ–æ—¶ï¼Œæˆ˜ç•¥è°ƒæ•´å‘¨æœŸé•¿è¾¾3-6ä¸ªæœˆ
   - ç¼ºä¹æƒ…æ™¯æ¨¡æ‹Ÿå’Œé¢„æµ‹èƒ½åŠ›
   - å†³ç­–ä¾èµ–ç»éªŒï¼Œç¼ºä¹æ•°æ®æ”¯æ’‘

### 2.3 ä¸šåŠ¡ç›®æ ‡

1. **å»ºç«‹å®Œæ•´çš„BSCä½“ç³»**
   - æ„å»ºè¦†ç›–è´¢åŠ¡ã€å®¢æˆ·ã€å†…éƒ¨æµç¨‹ã€å­¦ä¹ æˆé•¿å››ä¸ªç»´åº¦çš„æŒ‡æ ‡ä½“ç³»
   - å®ç°æˆ˜ç•¥ç›®æ ‡ä»é›†å›¢åˆ°éƒ¨é—¨ã€å†åˆ°ä¸ªäººçš„é€å±‚åˆ†è§£
   - å»ºç«‹æŒ‡æ ‡ä¹‹é—´çš„å› æœå…³è”æ¨¡å‹

2. **å®ç°æ•°æ®å®æ—¶é›†æˆ**
   - æ‰“é€šERPã€CRMã€MESã€HRç­‰ç³»ç»Ÿæ•°æ®
   - å®ç°T+1æ•°æ®æ›´æ–°ï¼Œå…³é”®æŒ‡æ ‡å®æ—¶å¯è§†åŒ–
   - å»ºç«‹ç»Ÿä¸€çš„æ•°æ®æ ‡å‡†å’Œè´¨é‡ç®¡æ§æœºåˆ¶

3. **æå‡æ‰§è¡Œç›‘æ§èƒ½åŠ›**
   - å»ºç«‹çº¢é»„ç»¿ç¯é¢„è­¦æœºåˆ¶ï¼Œè‡ªåŠ¨è¯†åˆ«å¼‚å¸¸
   - å®ç°è¡ŒåŠ¨è®¡åˆ’çš„åœ¨çº¿ç®¡ç†å’Œè¿›åº¦è·Ÿè¸ª
   - æ”¯æŒç§»åŠ¨ç«¯éšæ—¶éšåœ°æŸ¥çœ‹å’Œå®¡æ‰¹

4. **å¢å¼ºæˆ˜ç•¥åˆ†æèƒ½åŠ›**
   - å»ºç«‹æŒ‡æ ‡å› æœåˆ†ææ¨¡å‹ï¼Œè¯†åˆ«å…³é”®é©±åŠ¨å› ç´ 
   - æ”¯æŒæˆ˜ç•¥æƒ…æ™¯æ¨¡æ‹Ÿå’Œé¢„æµ‹åˆ†æ
   - æä¾›å¤šç»´åº¦é’»å–å’Œä¸‹é’»åˆ†æèƒ½åŠ›

5. **æé«˜æˆ˜ç•¥å“åº”é€Ÿåº¦**
   - å°†æˆ˜ç•¥è°ƒæ•´å‘¨æœŸä»3-6ä¸ªæœˆç¼©çŸ­è‡³1ä¸ªæœˆå†…
   - æ”¯æŒå¿«é€Ÿçš„ç›®æ ‡ä¿®è®¢å’Œèµ„æºé‡é…
   - å»ºç«‹æ•æ·çš„æˆ˜ç•¥å¤ç›˜å’Œè°ƒæ•´æœºåˆ¶

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. **å¤šç»´åº¦æŒ‡æ ‡å»ºæ¨¡å¤æ‚æ€§**
   - éœ€è¦è®¾è®¡æ”¯æŒå››ä¸ªç»´åº¦çš„çµæ´»æŒ‡æ ‡æ¨¡å‹
   - æŒ‡æ ‡ä¹‹é—´çš„å±‚çº§å…³ç³»å’Œå…³è”å…³ç³»å¤æ‚
   - ä¸åŒä¸šåŠ¡å•å…ƒçš„æŒ‡æ ‡éœ€è¦å·®å¼‚åŒ–æ”¯æŒ

2. **æ•°æ®é›†æˆä¸ä¸€è‡´æ€§ä¿éšœ**
   - éœ€è¦å¯¹æ¥10+ä¸ªå¼‚æ„æ•°æ®æº
   - æ•°æ®æ¸…æ´—å’Œè½¬æ¢è§„åˆ™å¤æ‚
   - éœ€è¦ç¡®ä¿å†å²æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯è¿½æº¯æ€§

3. **å› æœæ¨æ–­ç®—æ³•å®ç°**
   - éœ€è¦å®ç°ç›¸å…³æ€§åˆ†æå’Œå› æœæ¨æ–­ç®—æ³•
   - è€ƒè™‘æ»åæ•ˆåº”å’Œå¤šé‡å…±çº¿æ€§é—®é¢˜
   - å¯è§†åŒ–å‘ˆç°å¤æ‚çš„å› æœå…³ç³»ç½‘ç»œ

4. **å¤§è§„æ¨¡æ•°æ®å®æ—¶è®¡ç®—**
   - æ¶‰åŠæ•°åƒä¸ªæŒ‡æ ‡çš„å®æ—¶è®¡ç®—
   - éœ€è¦æ”¯æŒå¤æ‚çš„èšåˆå’Œåˆ†æè¿ç®—
   - ä¿è¯ç³»ç»Ÿå“åº”æ—¶é—´åœ¨3ç§’ä»¥å†…

5. **å®‰å…¨ä¸æƒé™ç®¡æ§**
   - ä¸åŒå±‚çº§äººå‘˜éœ€è¦æŸ¥çœ‹ä¸åŒèŒƒå›´çš„æ•°æ®
   - æ•æ„Ÿè´¢åŠ¡æ•°æ®éœ€è¦åŠ å¯†å’Œå®¡è®¡
   - æ”¯æŒå¤šçº§å®¡æ‰¹å’Œæ•°æ®è„±æ•

### 2.5 è§£å†³æ–¹æ¡ˆ

**æŠ€æœ¯æ¶æ„**ï¼š
- æ•°æ®é‡‡é›†å±‚ï¼šETLå·¥å…·å¯¹æ¥å„ä¸šåŠ¡ç³»ç»Ÿ
- æ•°æ®å­˜å‚¨å±‚ï¼šæ•°æ®æ¹–å­˜å‚¨åŸå§‹æ•°æ®ï¼Œæ•°æ®ä»“åº“å­˜å‚¨æŒ‡æ ‡æ•°æ®
- è®¡ç®—å¼•æ“å±‚ï¼šPython + Apache Sparkè¿›è¡ŒæŒ‡æ ‡è®¡ç®—
- åº”ç”¨æœåŠ¡å±‚ï¼šSpring Boot + Python Flaskæä¾›APIæœåŠ¡
- å‰ç«¯å±•ç¤ºå±‚ï¼šVue.js + EChartså®ç°å¯è§†åŒ–

### 2.6 å®Œæ•´ä»£ç å®ç°

```python
#!/usr/bin/env python3
"""
å¹³è¡¡è®¡åˆ†å¡Schemaå®Œæ•´å®ç°
åé”é›†å›¢BSCæ•°å­—åŒ–è½¬å‹é¡¹ç›®
"""

from typing import Dict, List, Optional, Tuple, Any
from datetime import date, datetime, timedelta
from decimal import Decimal
from dataclasses import dataclass, field, asdict
from enum import Enum
import json
import statistics
from collections import defaultdict


class ObjectiveDimension(str, Enum):
    """å¹³è¡¡è®¡åˆ†å¡å››ä¸ªç»´åº¦"""
    FINANCIAL = "Financial"
    CUSTOMER = "Customer"
    INTERNAL_PROCESS = "Internal_Process"
    LEARNING_GROWTH = "Learning_Growth"


class ObjectivePriority(str, Enum):
    """ç›®æ ‡ä¼˜å…ˆçº§"""
    CRITICAL = "Critical"      # å…³é”®ç›®æ ‡
    HIGH = "High"              # é«˜ä¼˜å…ˆçº§
    MEDIUM = "Medium"          # ä¸­ä¼˜å…ˆçº§
    LOW = "Low"                # ä½ä¼˜å…ˆçº§


class MetricType(str, Enum):
    """æŒ‡æ ‡ç±»å‹"""
    LEADING = "Leading"        # é¢†å…ˆæŒ‡æ ‡
    LAGGING = "Lagging"        # æ»åæŒ‡æ ‡
    INPUT = "Input"            # è¾“å…¥æŒ‡æ ‡
    OUTPUT = "Output"          # è¾“å‡ºæŒ‡æ ‡


@dataclass
class StrategicObjective:
    """æˆ˜ç•¥ç›®æ ‡å®šä¹‰"""
    objective_id: str
    objective_name: str
    objective_dimension: ObjectiveDimension
    objective_priority: ObjectivePriority
    owner: str                           # è´Ÿè´£äºº
    owner_department: str                # æ‰€å±éƒ¨é—¨
    target_date: date                    # ç›®æ ‡æ—¥æœŸ
    description: Optional[str] = None
    parent_objective_id: Optional[str] = None      # çˆ¶ç›®æ ‡ID
    related_objectives: List[str] = field(default_factory=list)  # å…³è”ç›®æ ‡
    target_value: Optional[Decimal] = None         # ç›®æ ‡å€¼
    current_value: Optional[Decimal] = None        # å½“å‰å€¼
    weight: Decimal = Decimal('1.0')               # æƒé‡
    status: str = "Active"                         # çŠ¶æ€
    created_at: datetime = field(default_factory=datetime.now)
    updated_at: datetime = field(default_factory=datetime.now)

    def add_related_objective(self, objective_id: str):
        """æ·»åŠ å…³è”ç›®æ ‡"""
        if objective_id not in self.related_objectives:
            self.related_objectives.append(objective_id)

    @property
    def completion_rate(self) -> Decimal:
        """è®¡ç®—å®Œæˆç‡"""
        if self.target_value and self.current_value and self.target_value != 0:
            rate = (self.current_value / self.target_value) * Decimal('100')
            return min(rate, Decimal('100')) if rate > 0 else Decimal('0')
        return Decimal('0')

    @property
    def days_remaining(self) -> int:
        """è®¡ç®—å‰©ä½™å¤©æ•°"""
        return (self.target_date - date.today()).days

    def to_dict(self) -> Dict:
        """è½¬æ¢ä¸ºå­—å…¸"""
        return {
            'objective_id': self.objective_id,
            'objective_name': self.objective_name,
            'dimension': self.objective_dimension.value,
            'priority': self.objective_priority.value,
            'owner': self.owner,
            'department': self.owner_department,
            'completion_rate': float(self.completion_rate),
            'days_remaining': self.days_remaining,
            'status': self.status
        }


@dataclass
class BSCKPI:
    """BSCå…³é”®ç»©æ•ˆæŒ‡æ ‡"""
    kpi_id: str
    kpi_name: str
    kpi_description: str
    objective_id: str                      # å…³è”çš„ç›®æ ‡
    metric_type: MetricType
    unit: str                              # å•ä½
    frequency: str                         # ç»Ÿè®¡é¢‘ç‡ï¼ˆDaily/Weekly/Monthly/Quarterly/Yearlyï¼‰
    formula: str                           # è®¡ç®—å…¬å¼
    data_source: str                       # æ•°æ®æº
    target_value: Decimal
    warning_threshold: Decimal             # é¢„è­¦é˜ˆå€¼
    danger_threshold: Decimal              # å±é™©é˜ˆå€¼
    actual_value: Optional[Decimal] = None
    historical_values: List[Tuple[date, Decimal]] = field(default_factory=list)
    
    def calculate_status(self) -> str:
        """è®¡ç®—æŒ‡æ ‡çŠ¶æ€"""
        if self.actual_value is None:
            return "Unknown"
        if self.actual_value >= self.target_value:
            return "Green"
        elif self.actual_value >= self.warning_threshold:
            return "Yellow"
        elif self.actual_value >= self.danger_threshold:
            return "Orange"
        else:
            return "Red"
    
    def get_trend(self, periods: int = 3) -> str:
        """è®¡ç®—è¶‹åŠ¿"""
        if len(self.historical_values) < periods:
            return "Insufficient_Data"
        recent_values = [v[1] for v in self.historical_values[-periods:]]
        if recent_values[-1] > recent_values[0]:
            return "Up"
        elif recent_values[-1] < recent_values[0]:
            return "Down"
        return "Stable"


@dataclass
class CausalRelationship:
    """å› æœå…³ç³»å®šä¹‰"""
    relationship_id: str
    source_kpi_id: str                     # æºæŒ‡æ ‡
    target_kpi_id: str                     # ç›®æ ‡æŒ‡æ ‡
    relationship_type: str                 # å› æœç±»å‹ï¼ˆDirect/Indirectï¼‰
    strength: Decimal                      # å½±å“å¼ºåº¦ï¼ˆ0-1ï¼‰
    time_lag: int = 0                      # æ—¶é—´æ»åï¼ˆæœˆï¼‰
    evidence: Optional[str] = None         # è¯æ®è¯´æ˜


@dataclass
class ActionPlan:
    """è¡ŒåŠ¨è®¡åˆ’"""
    action_id: str
    action_name: str
    related_objective_id: str
    responsible_person: str
    start_date: date
    end_date: date
    budget: Decimal
    progress: Decimal = Decimal('0')       # è¿›åº¦ç™¾åˆ†æ¯”
    status: str = "Not_Started"            # Not_Started/In_Progress/Completed/Cancelled
    milestones: List[Dict] = field(default_factory=list)
    actual_cost: Decimal = Decimal('0')
    
    def update_progress(self, new_progress: Decimal):
        """æ›´æ–°è¿›åº¦"""
        self.progress = min(new_progress, Decimal('100'))
        if self.progress >= 100:
            self.status = "Completed"
        elif self.progress > 0:
            self.status = "In_Progress"


class BalancedScorecard:
    """å¹³è¡¡è®¡åˆ†å¡ä¸»ç±»"""
    
    def __init__(self, scorecard_id: str, scorecard_name: str, 
                 period_start: date, period_end: date):
        self.scorecard_id = scorecard_id
        self.scorecard_name = scorecard_name
        self.period_start = period_start
        self.period_end = period_end
        self.objectives: Dict[str, StrategicObjective] = {}
        self.kpis: Dict[str, BSCKPI] = {}
        self.relationships: List[CausalRelationship] = []
        self.action_plans: Dict[str, ActionPlan] = {}
        self.created_at = datetime.now()
        
    def add_objective(self, objective: StrategicObjective):
        """æ·»åŠ æˆ˜ç•¥ç›®æ ‡"""
        self.objectives[objective.objective_id] = objective
        
    def add_kpi(self, kpi: BSCKPI):
        """æ·»åŠ KPIæŒ‡æ ‡"""
        self.kpis[kpi.kpi_id] = kpi
        
    def add_relationship(self, relationship: CausalRelationship):
        """æ·»åŠ å› æœå…³ç³»"""
        self.relationships.append(relationship)
        
    def add_action_plan(self, plan: ActionPlan):
        """æ·»åŠ è¡ŒåŠ¨è®¡åˆ’"""
        self.action_plans[plan.action_id] = plan
        
    def get_objectives_by_dimension(self, dimension: ObjectiveDimension) -> List[StrategicObjective]:
        """æŒ‰ç»´åº¦è·å–ç›®æ ‡"""
        return [obj for obj in self.objectives.values() 
                if obj.objective_dimension == dimension]
    
    def get_objective_hierarchy(self) -> Dict:
        """è·å–ç›®æ ‡å±‚æ¬¡ç»“æ„"""
        hierarchy = {'root': [], 'children': defaultdict(list)}
        
        for obj_id, obj in self.objectives.items():
            if obj.parent_objective_id is None:
                hierarchy['root'].append(obj_id)
            else:
                hierarchy['children'][obj.parent_objective_id].append(obj_id)
        
        return dict(hierarchy)
    
    def calculate_dimension_score(self, dimension: ObjectiveDimension) -> Decimal:
        """è®¡ç®—ç»´åº¦å¾—åˆ†"""
        dimension_objectives = self.get_objectives_by_dimension(dimension)
        if not dimension_objectives:
            return Decimal('0')
        
        total_weighted_score = Decimal('0')
        total_weight = Decimal('0')
        
        for obj in dimension_objectives:
            weight = obj.weight
            score = obj.completion_rate
            total_weighted_score += score * weight
            total_weight += weight
        
        return (total_weighted_score / total_weight) if total_weight > 0 else Decimal('0')
    
    def calculate_overall_score(self) -> Decimal:
        """è®¡ç®—æ€»ä½“å¾—åˆ†"""
        dimension_weights = {
            ObjectiveDimension.FINANCIAL: Decimal('0.3'),
            ObjectiveDimension.CUSTOMER: Decimal('0.25'),
            ObjectiveDimension.INTERNAL_PROCESS: Decimal('0.25'),
            ObjectiveDimension.LEARNING_GROWTH: Decimal('0.2')
        }
        
        total_score = Decimal('0')
        for dimension, weight in dimension_weights.items():
            total_score += self.calculate_dimension_score(dimension) * weight
        
        return total_score
    
    def analyze_causal_impact(self, kpi_id: str) -> Dict:
        """åˆ†æKPIçš„å› æœå½±å“"""
        # æ‰¾å‡ºç›´æ¥å½±å“è¯¥KPIçš„æŒ‡æ ‡
        direct_causes = [r for r in self.relationships if r.target_kpi_id == kpi_id]
        # æ‰¾å‡ºè¯¥KPIç›´æ¥å½±å“çš„æŒ‡æ ‡
        direct_effects = [r for r in self.relationships if r.source_kpi_id == kpi_id]
        
        return {
            'kpi_id': kpi_id,
            'direct_causes': [{'source': r.source_kpi_id, 'strength': float(r.strength)} 
                             for r in direct_causes],
            'direct_effects': [{'target': r.target_kpi_id, 'strength': float(r.strength)} 
                              for r in direct_effects],
            'total_influence': sum(r.strength for r in direct_effects)
        }
    
    def get_at_risk_objectives(self) -> List[Dict]:
        """è·å–æœ‰é£é™©çš„ç›®æ ‡"""
        at_risk = []
        for obj in self.objectives.values():
            if obj.completion_rate < Decimal('70') and obj.days_remaining < 30:
                at_risk.append({
                    'objective_id': obj.objective_id,
                    'objective_name': obj.objective_name,
                    'completion_rate': float(obj.completion_rate),
                    'days_remaining': obj.days_remaining,
                    'owner': obj.owner
                })
        return sorted(at_risk, key=lambda x: x['completion_rate'])
    
    def get_scorecard_summary(self) -> Dict:
        """è·å–è®¡åˆ†å¡æ‘˜è¦"""
        dimension_scores = {
            'financial': float(self.calculate_dimension_score(ObjectiveDimension.FINANCIAL)),
            'customer': float(self.calculate_dimension_score(ObjectiveDimension.CUSTOMER)),
            'internal_process': float(self.calculate_dimension_score(ObjectiveDimension.INTERNAL_PROCESS)),
            'learning_growth': float(self.calculate_dimension_score(ObjectiveDimension.LEARNING_GROWTH))
        }
        
        total_objectives = len(self.objectives)
        completed_objectives = sum(1 for obj in self.objectives.values() 
                                   if obj.completion_rate >= Decimal('100'))
        
        objectives_by_dimension = {
            dim.value: len(self.get_objectives_by_dimension(dim))
            for dim in ObjectiveDimension
        }
        
        return {
            'scorecard_id': self.scorecard_id,
            'scorecard_name': self.scorecard_name,
            'period': {
                'start': self.period_start.isoformat(),
                'end': self.period_end.isoformat()
            },
            'dimension_scores': dimension_scores,
            'overall_score': float(self.calculate_overall_score()),
            'total_objectives': total_objectives,
            'completed_objectives': completed_objectives,
            'completion_rate': float(completed_objectives / total_objectives * 100) if total_objectives > 0 else 0,
            'objectives_by_dimension': objectives_by_dimension,
            'at_risk_count': len(self.get_at_risk_objectives()),
            'active_action_plans': len([p for p in self.action_plans.values() 
                                        if p.status == "In_Progress"])
        }
    
    def generate_strategy_map_data(self) -> Dict:
        """ç”Ÿæˆæˆ˜ç•¥åœ°å›¾æ•°æ®"""
        nodes = []
        edges = []
        
        # åˆ›å»ºèŠ‚ç‚¹
        for obj in self.objectives.values():
            nodes.append({
                'id': obj.objective_id,
                'name': obj.objective_name,
                'dimension': obj.objective_dimension.value,
                'completion_rate': float(obj.completion_rate),
                'priority': obj.objective_priority.value
            })
        
        # åˆ›å»ºè¾¹ï¼ˆå› æœå…³ç³»ï¼‰
        for obj in self.objectives.values():
            for related_id in obj.related_objectives:
                edges.append({
                    'source': obj.objective_id,
                    'target': related_id
                })
        
        return {'nodes': nodes, 'edges': edges}


def create_huarui_bsc_example():
    """åˆ›å»ºåé”é›†å›¢BSCç¤ºä¾‹"""
    
    # åˆ›å»º2025å¹´åº¦å¹³è¡¡è®¡åˆ†å¡
    bsc = BalancedScorecard(
        scorecard_id="BSC-2025-HUARUI",
        scorecard_name="åé”é›†å›¢2025å¹´åº¦å¹³è¡¡è®¡åˆ†å¡",
        period_start=date(2025, 1, 1),
        period_end=date(2025, 12, 31)
    )
    
    # === è´¢åŠ¡ç»´åº¦ç›®æ ‡ ===
    financial_obj1 = StrategicObjective(
        objective_id="OBJ-FIN-001",
        objective_name="è¥ä¸šæ”¶å…¥å¢é•¿",
        objective_dimension=ObjectiveDimension.FINANCIAL,
        objective_priority=ObjectivePriority.CRITICAL,
        owner="å¼ æ€»",
        owner_department="è´¢åŠ¡ç®¡ç†éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('3200000000'),  # 32äº¿
        current_value=Decimal('2560000000'),  # å½“å‰25.6äº¿
        weight=Decimal('1.5')
    )
    bsc.add_objective(financial_obj1)
    
    financial_obj2 = StrategicObjective(
        objective_id="OBJ-FIN-002",
        objective_name="æ¯›åˆ©ç‡æå‡",
        objective_dimension=ObjectiveDimension.FINANCIAL,
        objective_priority=ObjectivePriority.HIGH,
        owner="ææ€»",
        owner_department="æˆæœ¬ç®¡ç†éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('35'),  # 35%
        current_value=Decimal('31.5'),  # å½“å‰31.5%
        weight=Decimal('1.2')
    )
    bsc.add_objective(financial_obj2)
    
    # === å®¢æˆ·ç»´åº¦ç›®æ ‡ ===
    customer_obj1 = StrategicObjective(
        objective_id="OBJ-CUS-001",
        objective_name="å®¢æˆ·æ»¡æ„åº¦æå‡",
        objective_dimension=ObjectiveDimension.CUSTOMER,
        objective_priority=ObjectivePriority.CRITICAL,
        owner="ç‹æ€»",
        owner_department="å®¢æˆ·æœåŠ¡éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('92'),  # 92åˆ†
        current_value=Decimal('85'),  # å½“å‰85åˆ†
        weight=Decimal('1.3')
    )
    bsc.add_objective(customer_obj1)
    
    customer_obj2 = StrategicObjective(
        objective_id="OBJ-CUS-002",
        objective_name="æ–°å®¢æˆ·è·å–",
        objective_dimension=ObjectiveDimension.CUSTOMER,
        objective_priority=ObjectivePriority.HIGH,
        owner="èµµæ€»",
        owner_department="å¸‚åœºè¥é”€éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('150'),  # 150å®¶æ–°å®¢æˆ·
        current_value=Decimal('45'),
        weight=Decimal('1.0')
    )
    bsc.add_objective(customer_obj2)
    
    # === å†…éƒ¨æµç¨‹ç»´åº¦ç›®æ ‡ ===
    process_obj1 = StrategicObjective(
        objective_id="OBJ-PRO-001",
        objective_name="äº¤ä»˜å‘¨æœŸç¼©çŸ­",
        objective_dimension=ObjectiveDimension.INTERNAL_PROCESS,
        objective_priority=ObjectivePriority.HIGH,
        owner="åˆ˜æ€»",
        owner_department="è¿è¥ç®¡ç†éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('90'),  # 90å¤©
        current_value=Decimal('120'),  # å½“å‰120å¤©
        weight=Decimal('1.2')
    )
    bsc.add_objective(process_obj1)
    
    process_obj2 = StrategicObjective(
        objective_id="OBJ-PRO-002",
        objective_name="äº§å“åˆæ ¼ç‡æå‡",
        objective_dimension=ObjectiveDimension.INTERNAL_PROCESS,
        objective_priority=ObjectivePriority.CRITICAL,
        owner="é™ˆæ€»",
        owner_department="è´¨é‡ç®¡ç†éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('99.5'),  # 99.5%
        current_value=Decimal('98.2'),  # å½“å‰98.2%
        weight=Decimal('1.4')
    )
    bsc.add_objective(process_obj2)
    
    # === å­¦ä¹ æˆé•¿ç»´åº¦ç›®æ ‡ ===
    learning_obj1 = StrategicObjective(
        objective_id="OBJ-LRN-001",
        objective_name="æ•°å­—åŒ–æŠ€èƒ½åŸ¹è®­è¦†ç›–ç‡",
        objective_dimension=ObjectiveDimension.LEARNING_GROWTH,
        objective_priority=ObjectivePriority.HIGH,
        owner="å­™æ€»",
        owner_department="äººåŠ›èµ„æºéƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('100'),  # 100%
        current_value=Decimal('35'),  # å½“å‰35%
        weight=Decimal('1.0')
    )
    bsc.add_objective(learning_obj1)
    
    learning_obj2 = StrategicObjective(
        objective_id="OBJ-LRN-002",
        objective_name="å…³é”®å²—ä½äººæ‰å‚¨å¤‡ç‡",
        objective_dimension=ObjectiveDimension.LEARNING_GROWTH,
        objective_priority=ObjectivePriority.HIGH,
        owner="å‘¨æ€»",
        owner_department="äººæ‰å‘å±•éƒ¨",
        target_date=date(2025, 12, 31),
        target_value=Decimal('85'),  # 85%
        current_value=Decimal('60'),  # å½“å‰60%
        weight=Decimal('0.8')
    )
    bsc.add_objective(learning_obj2)
    
    # å»ºç«‹å› æœå…³ç³»
    learning_obj1.add_related_objective("OBJ-PRO-002")
    learning_obj2.add_related_objective("OBJ-PRO-001")
    process_obj1.add_related_objective("OBJ-CUS-001")
    process_obj2.add_related_objective("OBJ-CUS-001")
    customer_obj1.add_related_objective("OBJ-FIN-001")
    customer_obj2.add_related_objective("OBJ-FIN-001")
    
    # æ·»åŠ è¡ŒåŠ¨è®¡åˆ’
    action1 = ActionPlan(
        action_id="ACT-001",
        action_name="ERPç³»ç»Ÿå‡çº§é¡¹ç›®",
        related_objective_id="OBJ-PRO-001",
        responsible_person="åˆ˜æ€»",
        start_date=date(2025, 3, 1),
        end_date=date(2025, 8, 31),
        budget=Decimal('5000000'),
        progress=Decimal('35')
    )
    bsc.add_action_plan(action1)
    
    action2 = ActionPlan(
        action_id="ACT-002",
        action_name="æ™ºèƒ½è´¨é‡æ£€æµ‹ç³»ç»Ÿéƒ¨ç½²",
        related_objective_id="OBJ-PRO-002",
        responsible_person="é™ˆæ€»",
        start_date=date(2025, 2, 1),
        end_date=date(2025, 6, 30),
        budget=Decimal('3000000'),
        progress=Decimal('60')
    )
    bsc.add_action_plan(action2)
    
    return bsc


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºåé”é›†å›¢BSC
    bsc = create_huarui_bsc_example()
    
    # æ‰“å°è®¡åˆ†å¡æ‘˜è¦
    summary = bsc.get_scorecard_summary()
    print("=" * 60)
    print(f"ã€{summary['scorecard_name']}ã€‘")
    print("=" * 60)
    print(f"\nğŸ“Š æ€»ä½“å¾—åˆ†: {summary['overall_score']:.2f}%")
    print(f"\nğŸ“ˆ å„ç»´åº¦å¾—åˆ†:")
    for dim, score in summary['dimension_scores'].items():
        print(f"   â€¢ {dim}: {score:.2f}%")
    
    print(f"\nğŸ¯ ç›®æ ‡å®Œæˆæƒ…å†µ:")
    print(f"   â€¢ æ€»ç›®æ ‡æ•°: {summary['total_objectives']}")
    print(f"   â€¢ å·²å®Œæˆ: {summary['completed_objectives']}")
    print(f"   â€¢ å®Œæˆç‡: {summary['completion_rate']:.1f}%")
    
    print(f"\nâš ï¸ é£é™©é¢„è­¦:")
    print(f"   â€¢ æœ‰é£é™©ç›®æ ‡: {summary['at_risk_count']}ä¸ª")
    
    at_risk = bsc.get_at_risk_objectives()
    if at_risk:
        print(f"\nğŸ“‹ é£é™©ç›®æ ‡è¯¦æƒ…:")
        for obj in at_risk:
            print(f"   â€¢ {obj['objective_name']} ({obj['owner']}) - "
                  f"å®Œæˆç‡{obj['completion_rate']:.1f}%, å‰©ä½™{obj['days_remaining']}å¤©")
    
    print(f"\nğŸ“ è¿›è¡Œä¸­è¡ŒåŠ¨è®¡åˆ’: {summary['active_action_plans']}ä¸ª")
    print("\n" + "=" * 60)
```

### 2.7 æ•ˆæœè¯„ä¼°ä¸ROI

**å…³é”®ç»©æ•ˆæŒ‡æ ‡æ”¹è¿›**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡å¹…åº¦ |
|------|--------|--------|----------|
| æˆ˜ç•¥ç›®æ ‡æ¸…æ™°åº¦ | 45% | 95% | +50% |
| ç»©æ•ˆæ•°æ®å®æ—¶æ€§ | T+7å¤© | T+1å¤© | 85%æå‡ |
| æˆ˜ç•¥å¤ç›˜å‘¨æœŸ | å­£åº¦ | æœˆåº¦ | 3å€æé€Ÿ |
| ç›®æ ‡è¾¾æˆç‡ | 68% | 89% | +21% |
| å†³ç­–å“åº”é€Ÿåº¦ | 2å‘¨ | 3å¤© | 78%æå‡ |
| è·¨éƒ¨é—¨ååŒæ•ˆç‡ | 60åˆ† | 85åˆ† | +42% |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **å†³ç­–æ•ˆç‡å¤§å¹…æå‡**
   - æˆ˜ç•¥å†³ç­–å‘¨æœŸä»å¹³å‡2å‘¨ç¼©çŸ­è‡³3å¤©
   - ç®¡ç†å±‚æ•°æ®è·å–æ—¶é—´ä»5å°æ—¶/å‘¨é™è‡³30åˆ†é’Ÿ/å‘¨
   - æˆ˜ç•¥ä¼šè®®æ•ˆç‡æå‡60%

2. **ç›®æ ‡æ‰§è¡ŒåŠ›æ˜¾è‘—å¢å¼º**
   - ç›®æ ‡è¾¾æˆç‡ä»68%æå‡è‡³89%
   - è¡ŒåŠ¨è®¡åˆ’æŒ‰æ—¶å®Œæˆç‡ä»72%æå‡è‡³94%
   - å‘˜å·¥å¯¹æˆ˜ç•¥ç›®æ ‡çš„ç†è§£åº¦ä»55%æå‡è‡³88%

3. **èµ„æºé…ç½®ä¼˜åŒ–**
   - é€šè¿‡æŒ‡æ ‡å…³è”åˆ†æï¼Œè¯†åˆ«å‡º3ä¸ªä½æ•ˆä¸šåŠ¡å•å…ƒ
   - èµ„æºé‡æ–°é…ç½®åï¼Œæ•´ä½“ROIæå‡15%
   - é¿å…äº†çº¦1200ä¸‡å…ƒçš„æ— æ•ˆæŠ•èµ„

**ROIè®¡ç®—**ï¼š

```
é¡¹ç›®æŠ•èµ„ï¼š580ä¸‡å…ƒ
  - è½¯ä»¶é‡‡è´­ï¼š280ä¸‡å…ƒ
  - ç³»ç»Ÿé›†æˆï¼š180ä¸‡å…ƒ
  - å’¨è¯¢å®æ–½ï¼š120ä¸‡å…ƒ

å¹´åº¦æ”¶ç›Šï¼š1,850ä¸‡å…ƒ
  - è¿è¥æ•ˆç‡æå‡ï¼š650ä¸‡å…ƒ
  - æˆæœ¬ä¼˜åŒ–èŠ‚çº¦ï¼š480ä¸‡å…ƒ
  - æ”¶å…¥å¢é•¿è´¡çŒ®ï¼š720ä¸‡å…ƒ

ç¬¬ä¸€å¹´ROI = (1,850 - 580) / 580 = 219%
ä¸‰å¹´ç´¯è®¡ROI = 487%
```

**ç»éªŒæ•™è®­**ï¼š

1. **é«˜å±‚æ”¯æŒæ˜¯æˆåŠŸçš„å…³é”®**ï¼šCEOäº²è‡ªæŒ‚å¸…ï¼Œç¡®ä¿é¡¹ç›®è·å¾—è¶³å¤Ÿèµ„æº
2. **åˆ†é˜¶æ®µå®æ–½é™ä½é£é™©**ï¼šå…ˆè¯•ç‚¹2ä¸ªäº‹ä¸šéƒ¨ï¼Œå†å…¨é¢æ¨å¹¿
3. **æ•°æ®è´¨é‡æ˜¯åŸºç¡€**ï¼šæŠ•å…¥30%ç²¾åŠ›åšæ•°æ®æ²»ç†ï¼Œé¿å…"åƒåœ¾è¿›åƒåœ¾å‡º"
4. **å˜é©ç®¡ç†ä¸å¯å¿½è§†**ï¼šé€šè¿‡åŸ¹è®­å’Œæ²Ÿé€šï¼Œæ¶ˆé™¤ä¸­å±‚ç®¡ç†è€…çš„æŠµè§¦æƒ…ç»ª

---

## 3. æ¡ˆä¾‹2ï¼šæˆ˜ç•¥åœ°å›¾å¯è§†åŒ–ç³»ç»Ÿ

### 3.1 åœºæ™¯æè¿°

åŸºäºæ¡ˆä¾‹1çš„BSCç³»ç»Ÿï¼Œæ„å»ºå¯è§†åŒ–æˆ˜ç•¥åœ°å›¾ï¼Œå±•ç¤ºä»å­¦ä¹ æˆé•¿åˆ°è´¢åŠ¡çš„ä»·å€¼åˆ›é€ è·¯å¾„ã€‚

### 3.2 å®ç°ä»£ç 

```python
def build_strategy_map(bsc: BalancedScorecard) -> Dict:
    """æ„å»ºæˆ˜ç•¥åœ°å›¾"""
    strategy_map = {
        'map_id': 'STRATEGY-MAP-2025',
        'map_name': 'åé”é›†å›¢2025æˆ˜ç•¥åœ°å›¾',
        'layers': {}
    }
    
    # æŒ‰ç»´åº¦åˆ†å±‚ç»„ç»‡ç›®æ ‡
    dimensions_order = [
        ObjectiveDimension.LEARNING_GROWTH,
        ObjectiveDimension.INTERNAL_PROCESS,
        ObjectiveDimension.CUSTOMER,
        ObjectiveDimension.FINANCIAL
    ]
    
    for i, dimension in enumerate(dimensions_order):
        objectives = bsc.get_objectives_by_dimension(dimension)
        strategy_map['layers'][dimension.value] = {
            'layer_order': i + 1,
            'objectives': [obj.to_dict() for obj in objectives]
        }
    
    # æ„å»ºå› æœå…³ç³»é“¾
    causal_chains = []
    for relationship in bsc.relationships:
        source_obj = bsc.objectives.get(relationship.source_kpi_id)
        target_obj = bsc.objectives.get(relationship.target_kpi_id)
        if source_obj and target_obj:
            causal_chains.append({
                'source': source_obj.objective_name,
                'target': target_obj.objective_name,
                'strength': float(relationship.strength)
            })
    
    strategy_map['causal_chains'] = causal_chains
    return strategy_map
```

---

## 4. æ¡ˆä¾‹3ï¼šæŒ‡æ ‡å…³è”ä¸å› æœåˆ†æç³»ç»Ÿ

### 4.1 åœºæ™¯æè¿°

æ„å»ºæŒ‡æ ‡å…³è”åˆ†æç³»ç»Ÿï¼Œè¯†åˆ«å…³é”®é©±åŠ¨å› ç´ ï¼Œä¸ºæˆ˜ç•¥è°ƒæ•´æä¾›æ•°æ®æ”¯æŒã€‚

### 4.2 å®ç°ä»£ç 

```python
def calculate_causal_impact(bsc: BalancedScorecard, 
                           target_objective_id: str) -> Dict:
    """è®¡ç®—ç›®æ ‡çš„å½±å“å› ç´ åˆ†æ"""
    target_obj = bsc.objectives.get(target_objective_id)
    if not target_obj:
        return {}
    
    # æ‰¾å‡ºæ‰€æœ‰å½±å“è¯¥ç›®æ ‡çš„æŒ‡æ ‡
    influencing_kpis = []
    for rel in bsc.relationships:
        if rel.target_kpi_id == target_objective_id:
            source_kpi = bsc.kpis.get(rel.source_kpi_id)
            if source_kpi:
                influencing_kpis.append({
                    'kpi_name': source_kpi.kpi_name,
                    'kpi_value': float(source_kpi.actual_value) if source_kpi.actual_value else 0,
                    'impact_strength': float(rel.strength),
                    'trend': source_kpi.get_trend()
                })
    
    # è®¡ç®—ç»¼åˆå½±å“æŒ‡æ•°
    total_impact = sum(kpi['impact_strength'] for kpi in influencing_kpis)
    
    return {
        'target_objective': target_obj.objective_name,
        'completion_rate': float(target_obj.completion_rate),
        'influencing_kpis': influencing_kpis,
        'total_influence': total_impact,
        'recommendations': generate_improvement_recommendations(influencing_kpis)
    }

def generate_improvement_recommendations(influencing_kpis: List[Dict]) -> List[str]:
    """ç”Ÿæˆæ”¹è¿›å»ºè®®"""
    recommendations = []
    
    # è¯†åˆ«éœ€è¦å…³æ³¨çš„æŒ‡æ ‡
    at_risk_kpis = [kpi for kpi in influencing_kpis 
                    if kpi['trend'] == 'Down' and kpi['impact_strength'] > 0.5]
    
    for kpi in at_risk_kpis:
        recommendations.append(
            f"é‡ç‚¹å…³æ³¨'{kpi['kpi_name']}'ï¼Œè¯¥æŒ‡æ ‡å‘ˆä¸‹é™è¶‹åŠ¿ä¸”å½±å“å¼ºåº¦ä¸º{kpi['impact_strength']:.0%}"
        )
    
    return recommendations
```

---

## 5. æ¡ˆä¾‹4ï¼šè¡ŒåŠ¨è®¡åˆ’æ‰§è¡Œè·Ÿè¸ªç³»ç»Ÿ

### 5.1 åœºæ™¯æè¿°

æ„å»ºè¡ŒåŠ¨è®¡åˆ’ç®¡ç†ç³»ç»Ÿï¼Œå®æ—¶è·Ÿè¸ªæ‰§è¡Œè¿›åº¦ï¼Œæ”¯æŒé¢„è­¦å’Œå¹²é¢„ã€‚

### 5.2 å®ç°ä»£ç 

```python
class ActionPlanTracker:
    """è¡ŒåŠ¨è®¡åˆ’è·Ÿè¸ªå™¨"""
    
    def __init__(self, bsc: BalancedScorecard):
        self.bsc = bsc
    
    def track_action_progress(self, action_id: str, 
                             new_progress: Decimal) -> Dict:
        """è·Ÿè¸ªè¡ŒåŠ¨è®¡åˆ’è¿›åº¦"""
        action = self.bsc.action_plans.get(action_id)
        if not action:
            return {'error': 'Action plan not found'}
        
        old_progress = action.progress
        action.update_progress(new_progress)
        
        # æ£€æŸ¥æ˜¯å¦éœ€è¦é¢„è­¦
        alerts = []
        days_remaining = (action.end_date - date.today()).days
        expected_progress = Decimal('100') * (date.today() - action.start_date).days / \
                           (action.end_date - action.start_date).days
        
        if action.progress < expected_progress * Decimal('0.8'):
            alerts.append({
                'type': 'SCHEDULE_RISK',
                'message': f'è¿›åº¦è½åé¢„æœŸï¼Œå½“å‰{action.progress:.1f}%ï¼Œé¢„æœŸ{expected_progress:.1f}%'
            })
        
        if days_remaining < 7 and action.progress < Decimal('90'):
            alerts.append({
                'type': 'DEADLINE_RISK',
                'message': f'å³å°†åˆ°æœŸï¼ˆ{days_remaining}å¤©ï¼‰ï¼Œè¿›åº¦ä»…{action.progress:.1f}%'
            })
        
        return {
            'action_id': action_id,
            'action_name': action.action_name,
            'old_progress': float(old_progress),
            'new_progress': float(action.progress),
            'status': action.status,
            'alerts': alerts
        }
    
    def get_action_dashboard(self) -> Dict:
        """è·å–è¡ŒåŠ¨è®¡åˆ’ä»ªè¡¨æ¿"""
        total = len(self.bsc.action_plans)
        completed = sum(1 for p in self.bsc.action_plans.values() 
                       if p.status == "Completed")
        in_progress = sum(1 for p in self.bsc.action_plans.values() 
                         if p.status == "In_Progress")
        
        total_budget = sum(p.budget for p in self.bsc.action_plans.values())
        total_spent = sum(p.actual_cost for p in self.bsc.action_plans.values())
        
        return {
            'summary': {
                'total': total,
                'completed': completed,
                'in_progress': in_progress,
                'completion_rate': float(completed / total * 100) if total > 0 else 0
            },
            'budget': {
                'total_budget': float(total_budget),
                'total_spent': float(total_spent),
                'budget_utilization': float(total_spent / total_budget * 100) if total_budget > 0 else 0
            }
        }
```

---

## 6. æ¡ˆä¾‹5ï¼šBSCæ•°æ®å­˜å‚¨ä¸OLAPåˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

æ„å»ºBSCæ•°æ®ä»“åº“å’ŒOLAPåˆ†æç³»ç»Ÿï¼Œæ”¯æŒå¤šç»´åº¦æ•°æ®åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚

### 6.2 å®ç°ä»£ç 

```python
class BSCDataWarehouse:
    """BSCæ•°æ®ä»“åº“"""
    
    def __init__(self, db_connection):
        self.conn = db_connection
    
    def store_bsc_data(self, bsc: BalancedScorecard):
        """å­˜å‚¨BSCæ•°æ®åˆ°æ•°æ®ä»“åº“"""
        cursor = self.conn.cursor()
        
        # å­˜å‚¨æˆ˜ç•¥ç›®æ ‡
        for obj in bsc.objectives.values():
            cursor.execute("""
                INSERT INTO bsc_objectives 
                (objective_id, objective_name, dimension, priority, 
                 owner, department, target_date, target_value, 
                 current_value, completion_rate, weight, status, period)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
                ON CONFLICT (objective_id, period) DO UPDATE SET
                current_value = EXCLUDED.current_value,
                completion_rate = EXCLUDED.completion_rate,
                updated_at = CURRENT_TIMESTAMP
            """, (obj.objective_id, obj.objective_name, 
                  obj.objective_dimension.value, obj.objective_priority.value,
                  obj.owner, obj.owner_department, obj.target_date,
                  float(obj.target_value) if obj.target_value else None,
                  float(obj.current_value) if obj.current_value else None,
                  float(obj.completion_rate), float(obj.weight),
                  obj.status, bsc.scorecard_id))
        
        self.conn.commit()
    
    def generate_dimension_report(self, period: str) -> Dict:
        """ç”Ÿæˆç»´åº¦åˆ†ææŠ¥å‘Š"""
        cursor = self.conn.cursor()
        
        cursor.execute("""
            SELECT dimension, 
                   COUNT(*) as objective_count,
                   AVG(completion_rate) as avg_completion,
                   SUM(CASE WHEN completion_rate >= 100 THEN 1 ELSE 0 END) as achieved_count
            FROM bsc_objectives
            WHERE period = %s
            GROUP BY dimension
            ORDER BY dimension
        """, (period,))
        
        results = cursor.fetchall()
        return {
            'period': period,
            'dimension_analysis': [
                {
                    'dimension': row[0],
                    'objective_count': row[1],
                    'avg_completion': float(row[2]),
                    'achieved_count': row[3]
                }
                for row in results
            ]
        }
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-02-15
