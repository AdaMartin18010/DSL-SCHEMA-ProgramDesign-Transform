# KPIç®¡ç†Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [KPIç®¡ç†Schemaå®è·µæ¡ˆä¾‹](#kpiç®¡ç†schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šé”€å”®KPIç®¡ç†ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šé”€å”®kpiç®¡ç†ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)
  - [4. æ¡ˆä¾‹3ï¼šKPIé¢„è­¦ç³»ç»Ÿ](#4-æ¡ˆä¾‹3kpié¢„è­¦ç³»ç»Ÿ)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 å®ç°ä»£ç ](#42-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šKPIæ ¹å› åˆ†æç³»ç»Ÿ](#5-æ¡ˆä¾‹4kpiæ ¹å› åˆ†æç³»ç»Ÿ)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 å®ç°ä»£ç ](#52-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šKPIæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ](#6-æ¡ˆä¾‹5kpiæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 å®ç°ä»£ç ](#62-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›KPIç®¡ç†Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–é”€å”®KPIç®¡ç†ã€KPIé¢„è­¦ã€æ ¹å› åˆ†æç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ä¼ä¸šé”€å”®KPIç®¡ç†ç³»ç»Ÿ**ï¼šé”€å”®KPIå®šä¹‰ã€ç›‘æ§ã€åˆ†æ
2. **KPIåˆ°OLAP Cubeè½¬æ¢å·¥å…·**ï¼šKPIæ•°æ®åˆ°OLAPè½¬æ¢
3. **KPIé¢„è­¦ç³»ç»Ÿ**ï¼šKPIé¢„è­¦å’Œé€šçŸ¥
4. **KPIæ ¹å› åˆ†æç³»ç»Ÿ**ï¼šKPIæ ¹å› åˆ†æ
5. **KPIæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šKPIæ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **å¹³è¡¡è®¡åˆ†å¡**ï¼šKPIç®¡ç†æœ€ä½³å®è·µ
- **ç»©æ•ˆç®¡ç†æ¡†æ¶**ï¼šç»©æ•ˆç®¡ç†æ ‡å‡†

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šé”€å”®KPIç®¡ç†ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸé›¶å”®å…¬å¸éœ€è¦æ„å»ºé”€å”®KPIç®¡ç†ç³»ç»Ÿï¼Œå®æ—¶ç›‘æ§é”€å”®KPIï¼Œæ”¯æŒKPIåˆ†æå’ŒæŠ¥å‘Šï¼Œä¸ºä¸šåŠ¡å†³ç­–æä¾›æ•°æ®æ”¯æŒã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **KPIå®šä¹‰ä¸ç»Ÿä¸€**ï¼šä¸åŒéƒ¨é—¨KPIå®šä¹‰ä¸ä¸€è‡´
2. **ç›‘æ§ä¸åŠæ—¶**ï¼šKPIç›‘æ§ä¸åŠæ—¶
3. **åˆ†æèƒ½åŠ›ä¸è¶³**ï¼šç¼ºä¹KPIåˆ†æèƒ½åŠ›
4. **æŠ¥å‘Šæ•ˆç‡ä½**ï¼šKPIæŠ¥å‘Šç”Ÿæˆæ•ˆç‡ä½

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- ç»Ÿä¸€KPIå®šä¹‰
- å®æ—¶KPIç›‘æ§
- å¢å¼ºKPIåˆ†æèƒ½åŠ›
- æé«˜æŠ¥å‘Šæ•ˆç‡

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **KPIå®šä¹‰**ï¼šç»Ÿä¸€KPIå®šä¹‰æ ‡å‡†
2. **å®æ—¶ç›‘æ§**ï¼šå®ç°KPIå®æ—¶ç›‘æ§
3. **è®¡ç®—å¼•æ“**ï¼šæ„å»ºKPIè®¡ç®—å¼•æ“
4. **é¢„è­¦æœºåˆ¶**ï¼šå®ç°KPIé¢„è­¦æœºåˆ¶

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨Schemaå®šä¹‰é”€å”®KPIç®¡ç†ç³»ç»Ÿ**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**é”€å”®KPIç®¡ç†Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
KPIç®¡ç†Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import date, datetime
from decimal import Decimal
from dataclasses import dataclass, field
from enum import Enum

class KPIType(str, Enum):
    """KPIç±»å‹"""
    FINANCIAL = "Financial"
    OPERATIONAL = "Operational"
    CUSTOMER = "Customer"
    PROCESS = "Process"

class CalculationFrequency(str, Enum):
    """è®¡ç®—é¢‘ç‡"""
    REAL_TIME = "RealTime"
    HOURLY = "Hourly"
    DAILY = "Daily"
    WEEKLY = "Weekly"
    MONTHLY = "Monthly"
    QUARTERLY = "Quarterly"
    YEARLY = "Yearly"

class TargetType(str, Enum):
    """ç›®æ ‡ç±»å‹"""
    ABSOLUTE = "Absolute"
    PERCENTAGE = "Percentage"
    GROWTH = "Growth"

@dataclass
class DateRange:
    """æ—¥æœŸèŒƒå›´"""
    start_date: date
    end_date: date

@dataclass
class KPIDefinition:
    """KPIå®šä¹‰"""
    kpi_id: str
    kpi_name: str
    kpi_type: KPIType
    kpi_category: str
    calculation_formula: str
    data_source: str
    measurement_unit: str
    calculation_frequency: CalculationFrequency
    owner: str
    description: Optional[str] = None
    enabled: bool = True

    def calculate(self, data: Dict) -> Decimal:
        """è®¡ç®—KPIå€¼"""
        # è¿™é‡Œåº”è¯¥æ ¹æ®calculation_formulaè®¡ç®—KPIå€¼
        # ç®€åŒ–ç¤ºä¾‹
        if "SUM" in self.calculation_formula:
            field = self.calculation_formula.split("(")[1].split(")")[0]
            return Decimal(str(sum(data.get(field, []))))
        return Decimal('0')

@dataclass
class KPITarget:
    """KPIç›®æ ‡"""
    target_id: str
    kpi_id: str
    target_type: TargetType
    target_value: Decimal
    target_period: DateRange
    target_owner: str
    created_at: datetime = field(default_factory=datetime.now)

    def is_achieved(self, actual_value: Decimal) -> bool:
        """æ£€æŸ¥ç›®æ ‡æ˜¯å¦è¾¾æˆ"""
        if self.target_type == TargetType.ABSOLUTE:
            return actual_value >= self.target_value
        elif self.target_type == TargetType.PERCENTAGE:
            return actual_value >= self.target_value
        return False

@dataclass
class KPIValue:
    """KPIå€¼"""
    value_id: str
    kpi_id: str
    value: Decimal
    measurement_date: date
    completion_rate: Decimal = Decimal('0')
    status: str = "Normal"  # Normal, Warning, Critical
    created_at: datetime = field(default_factory=datetime.now)

    def calculate_completion_rate(self, target: KPITarget) -> Decimal:
        """è®¡ç®—å®Œæˆç‡"""
        if target.target_value > 0:
            self.completion_rate = (self.value / target.target_value) * Decimal('100')
        return self.completion_rate

    def determine_status(self, target: KPITarget) -> str:
        """ç¡®å®šçŠ¶æ€"""
        completion_rate = self.calculate_completion_rate(target)
        if completion_rate >= Decimal('100'):
            self.status = "Normal"
        elif completion_rate >= Decimal('80'):
            self.status = "Warning"
        else:
            self.status = "Critical"
        return self.status

@dataclass
class SalesKPIManagement:
    """é”€å”®KPIç®¡ç†"""
    kpi_definitions: Dict[str, KPIDefinition] = field(default_factory=dict)
    kpi_targets: Dict[str, KPITarget] = field(default_factory=dict)
    kpi_values: List[KPIValue] = field(default_factory=list)

    def add_kpi_definition(self, kpi_def: KPIDefinition):
        """æ·»åŠ KPIå®šä¹‰"""
        self.kpi_definitions[kpi_def.kpi_id] = kpi_def

    def add_kpi_target(self, target: KPITarget):
        """æ·»åŠ KPIç›®æ ‡"""
        self.kpi_targets[target.kpi_id] = target

    def record_kpi_value(self, kpi_value: KPIValue):
        """è®°å½•KPIå€¼"""
        # è®¡ç®—å®Œæˆç‡å’ŒçŠ¶æ€
        if kpi_value.kpi_id in self.kpi_targets:
            target = self.kpi_targets[kpi_value.kpi_id]
            kpi_value.calculate_completion_rate(target)
            kpi_value.determine_status(target)

        self.kpi_values.append(kpi_value)

    def get_kpi_status(self, kpi_id: str) -> Optional[Dict]:
        """è·å–KPIçŠ¶æ€"""
        if kpi_id not in self.kpi_definitions:
            return None

        kpi_def = self.kpi_definitions[kpi_id]
        target = self.kpi_targets.get(kpi_id)

        # è·å–æœ€æ–°å€¼
        latest_value = None
        for value in reversed(self.kpi_values):
            if value.kpi_id == kpi_id:
                latest_value = value
                break

        return {
            'kpi_id': kpi_id,
            'kpi_name': kpi_def.kpi_name,
            'current_value': float(latest_value.value) if latest_value else 0,
            'target_value': float(target.target_value) if target else 0,
            'completion_rate': float(latest_value.completion_rate) if latest_value else 0,
            'status': latest_value.status if latest_value else "Unknown"
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºé”€å”®KPIç®¡ç†ç³»ç»Ÿ
    kpi_mgmt = SalesKPIManagement()

    # å®šä¹‰KPI
    sales_kpi = KPIDefinition(
        kpi_id="KPI-SALES-001",
        kpi_name="æœˆåº¦é”€å”®é¢",
        kpi_type=KPIType.FINANCIAL,
        kpi_category="é”€å”®",
        calculation_formula="SUM(sales_amount)",
        data_source="sales_transactions",
        measurement_unit="å…ƒ",
        calculation_frequency=CalculationFrequency.MONTHLY,
        owner="é”€å”®éƒ¨"
    )
    kpi_mgmt.add_kpi_definition(sales_kpi)

    # è®¾ç½®KPIç›®æ ‡
    sales_target = KPITarget(
        target_id="TGT-SALES-001",
        kpi_id="KPI-SALES-001",
        target_type=TargetType.ABSOLUTE,
        target_value=Decimal('1000000'),
        target_period=DateRange(
            start_date=date(2025, 1, 1),
            end_date=date(2025, 12, 31)
        ),
        target_owner="é”€å”®éƒ¨"
    )
    kpi_mgmt.add_kpi_target(sales_target)

    # è®°å½•KPIå€¼
    sales_value = KPIValue(
        value_id="VAL-SALES-001",
        kpi_id="KPI-SALES-001",
        value=Decimal('950000'),
        measurement_date=date(2025, 1, 31)
    )
    kpi_mgmt.record_kpi_value(sales_value)

    # è·å–KPIçŠ¶æ€
    status = kpi_mgmt.get_kpi_status("KPI-SALES-001")
    print(f"KPIçŠ¶æ€: {status}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| KPIå®šä¹‰ç»Ÿä¸€æ€§ | 60% | 100% | 40%æå‡ |
| ç›‘æ§åŠæ—¶æ€§ | å»¶è¿Ÿ1å¤© | å®æ—¶ | æ˜¾è‘—æå‡ |
| åˆ†æèƒ½åŠ› | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| æŠ¥å‘Šæ•ˆç‡ | ä½ | é«˜ | æ˜¾è‘—æå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **KPIå®šä¹‰ç»Ÿä¸€**ï¼šç»Ÿä¸€KPIå®šä¹‰æ ‡å‡†
2. **å®æ—¶ç›‘æ§**ï¼šå®ç°KPIå®æ—¶ç›‘æ§
3. **åˆ†æèƒ½åŠ›å¢å¼º**ï¼šå¢å¼ºKPIåˆ†æèƒ½åŠ›
4. **æŠ¥å‘Šæ•ˆç‡æé«˜**ï¼šæé«˜æŠ¥å‘Šæ•ˆç‡

**ç»éªŒæ•™è®­**ï¼š

1. KPIå®šä¹‰éœ€è¦æ ‡å‡†åŒ–
2. å®æ—¶ç›‘æ§éœ€è¦ä¼˜åŒ–æ€§èƒ½
3. é¢„è­¦æœºåˆ¶éœ€è¦å®Œå–„
4. æŠ¥å‘Šç”Ÿæˆéœ€è¦è‡ªåŠ¨åŒ–

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [KPIç®¡ç†æœ€ä½³å®è·µ](https://www.balancedscorecard.org/)
- [ç»©æ•ˆç®¡ç†æ¡†æ¶](https://www.ap-institute.com/)
  }
}

```

---

## 3. æ¡ˆä¾‹2ï¼šKPIåˆ°OLAP Cubeè½¬æ¢

### 3.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
å°†KPIç®¡ç†Schemaè½¬æ¢ä¸ºOLAP Cubeæ ¼å¼ï¼Œç”¨äºå¤šç»´åˆ†æã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒKPIå¤šç»´åˆ†æ
- æ”¯æŒKPIé’»å–åˆ†æ
- æ”¯æŒKPIåˆ‡ç‰‡åˆ‡å—

### 3.2 å®ç°ä»£ç 

```python
def convert_kpi_to_olap_cube_complete(kpi_data: KPIManagementSchema) -> OLAPCube:
    """å®Œæ•´è½¬æ¢KPIç®¡ç†Schemaåˆ°OLAP Cube"""
    cube = OLAPCube()
    cube.name = "KPI_Cube"

    # åˆ›å»ºæ—¶é—´ç»´åº¦
    time_dimension = Dimension()
    time_dimension.name = "Time"
    time_dimension.hierarchies = [{
        "name": "Calendar",
        "levels": ["Year", "Quarter", "Month", "Week", "Day"]
    }]
    cube.dimensions.append(time_dimension)

    # åˆ›å»ºKPIåˆ†ç±»ç»´åº¦
    category_dimension = Dimension()
    category_dimension.name = "KPI_Category"
    category_dimension.attributes = ["Category", "Type", "Owner", "Department"]
    cube.dimensions.append(category_dimension)

    # åˆ›å»ºç»„ç»‡ç»´åº¦
    org_dimension = Dimension()
    org_dimension.name = "Organization"
    org_dimension.hierarchies = [{
        "name": "Org_Hierarchy",
        "levels": ["Company", "Division", "Department", "Team"]
    }]
    cube.dimensions.append(org_dimension)

    # è½¬æ¢KPIå®šä¹‰ä¸ºåº¦é‡
    for kpi in kpi_data.kpi_definition.kpi_definitions:
        measure = Measure()
        measure.name = kpi.kpi_name
        measure.aggregation_function = determine_aggregation_function(kpi.kpi_type)
        measure.data_type = map_kpi_type_to_measure_type(kpi.kpi_type)
        measure.format_string = f"#,##0.00 {kpi.measurement_unit}"
        cube.measures.append(measure)

        # æ·»åŠ å®Œæˆç‡åº¦é‡
        completion_measure = Measure()
        completion_measure.name = f"{kpi.kpi_name}_Completion_Rate"
        completion_measure.aggregation_function = "AVG"
        completion_measure.data_type = "Percentage"
        completion_measure.format_string = "#,##0.00%"
        cube.measures.append(completion_measure)

    # è½¬æ¢KPIå€¼ä¸ºäº‹å®æ•°æ®
    for value in kpi_data.kpi_monitoring.kpi_values:
        kpi = find_kpi_definition(kpi_data, value.kpi_id)

        fact = Fact()
        fact.dimensions = {
            "Time": {
                "Year": value.measurement_date.year,
                "Quarter": get_quarter(value.measurement_date),
                "Month": value.measurement_date.month,
                "Day": value.measurement_date.day
            },
            "KPI_Category": {
                "Category": kpi.kpi_category,
                "Type": kpi.kpi_type,
                "Owner": kpi.owner
            },
            "Organization": {
                "Department": extract_department(kpi.owner)
            }
        }
        fact.measures = {
            kpi.kpi_name: value.value,
            f"{kpi.kpi_name}_Completion_Rate": value.completion_rate or 0
        }
        cube.facts.append(fact)

    return cube
```

---

## 4. æ¡ˆä¾‹3ï¼šKPIé¢„è­¦ç³»ç»Ÿ

### 4.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æ„å»ºKPIé¢„è­¦ç³»ç»Ÿï¼Œå½“KPIå€¼è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘é¢„è­¦ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒé¢„è­¦è§„åˆ™é…ç½®
- æ”¯æŒå¤šçº§é¢„è­¦
- æ”¯æŒé¢„è­¦é€šçŸ¥

### 4.2 å®ç°ä»£ç 

```python
def check_kpi_alerts(kpi_data: KPIManagementSchema, kpi_id: str, current_value: Decimal) -> List[KPIAlert]:
    """æ£€æŸ¥KPIé¢„è­¦"""
    alerts = []

    # è·å–KPIå®šä¹‰
    kpi = find_kpi_definition(kpi_data, kpi_id)

    # è·å–KPIç›®æ ‡
    target = find_active_target(kpi_data, kpi_id)
    if not target:
        return alerts

    # è·å–KPIé˜ˆå€¼
    thresholds = find_kpi_thresholds(kpi_data, kpi_id)

    # è®¡ç®—å®Œæˆç‡
    completion_rate = (current_value / target.target_value) * 100 if target.target_value > 0 else 0

    # æ£€æŸ¥é¢„è­¦è§„åˆ™
    for alert_rule in kpi_data.kpi_monitoring.kpi_alerts:
        if alert_rule.kpi_id == kpi_id and alert_rule.is_enabled:
            should_alert = False
            alert_level = "Info"

            if alert_rule.alert_condition == "Below":
                if current_value < alert_rule.alert_threshold:
                    should_alert = True
                    alert_level = alert_rule.alert_level
            elif alert_rule.alert_condition == "Above":
                if current_value > alert_rule.alert_threshold:
                    should_alert = True
                    alert_level = alert_rule.alert_level
            elif alert_rule.alert_condition == "Change_Rate":
                # è·å–å†å²å€¼
                historical_value = get_historical_value(kpi_data, kpi_id, days=30)
                if historical_value:
                    change_rate = abs((current_value - historical_value) / historical_value) * 100
                    if change_rate > alert_rule.alert_threshold:
                        should_alert = True
                        alert_level = alert_rule.alert_level

            if should_alert:
                alert = KPIAlert()
                alert.alert_id = f"ALERT-{kpi_id}-{datetime.now().strftime('%Y%m%d%H%M%S')}"
                alert.kpi_id = kpi_id
                alert.alert_level = alert_level
                alert.current_value = current_value
                alert.target_value = target.target_value
                alert.completion_rate = completion_rate
                alert.alert_message = generate_alert_message(kpi, alert_rule, current_value, target.target_value)
                alert.alert_time = datetime.now()

                # å‘é€é€šçŸ¥
                send_alert_notifications(alert, alert_rule.notification_channels)

                alerts.append(alert)

    return alerts
```

---

## 5. æ¡ˆä¾‹4ï¼šKPIæ ¹å› åˆ†æç³»ç»Ÿ

### 5.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
æ„å»ºKPIæ ¹å› åˆ†æç³»ç»Ÿï¼Œè¯†åˆ«KPIå¼‚å¸¸çš„æ ¹æœ¬åŸå› ã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒæ ¹å› è¯†åˆ«
- æ”¯æŒæ ¹å› éªŒè¯
- æ”¯æŒè§£å†³æ–¹æ¡ˆç”Ÿæˆ

### 5.2 å®ç°ä»£ç 

```python
def analyze_kpi_root_cause(kpi_data: KPIManagementSchema, kpi_id: str, analysis_period: DateRange) -> KPIRootCause:
    """åˆ†æKPIæ ¹å› """
    root_cause = KPIRootCause()
    root_cause.root_cause_id = f"RCA-{kpi_id}-{datetime.now().strftime('%Y%m%d')}"
    root_cause.kpi_id = kpi_id
    root_cause.root_cause_analysis_date = datetime.now().date()

    # è·å–KPIå€¼
    kpi_values = get_kpi_values_in_period(kpi_data, kpi_id, analysis_period)

    # è¯†åˆ«å¼‚å¸¸
    anomalies = detect_anomalies(kpi_values)

    # åˆ†ææ ¹å› 
    identified_causes = []

    # 1. æ•°æ®è´¨é‡æ£€æŸ¥
    data_quality_issues = check_data_quality(kpi_data, kpi_id)
    if data_quality_issues:
        cause = RootCause()
        cause.cause_id = "CAUSE-DATA-QUALITY"
        cause.cause_description = "æ•°æ®è´¨é‡é—®é¢˜"
        cause.cause_category = "Technology"
        cause.cause_impact = "High"
        cause.cause_details = data_quality_issues
        identified_causes.append(cause)

    # 2. æµç¨‹é—®é¢˜æ£€æŸ¥
    process_issues = check_process_issues(kpi_data, kpi_id, analysis_period)
    if process_issues:
        cause = RootCause()
        cause.cause_id = "CAUSE-PROCESS"
        cause.cause_description = "æµç¨‹é—®é¢˜"
        cause.cause_category = "Process"
        cause.cause_impact = "Medium"
        cause.cause_details = process_issues
        identified_causes.append(cause)

    # 3. å¤–éƒ¨å› ç´ æ£€æŸ¥
    external_factors = check_external_factors(kpi_data, kpi_id, analysis_period)
    if external_factors:
        cause = RootCause()
        cause.cause_id = "CAUSE-EXTERNAL"
        cause.cause_description = "å¤–éƒ¨å› ç´ å½±å“"
        cause.cause_category = "External"
        cause.cause_impact = "Medium"
        cause.cause_details = external_factors
        identified_causes.append(cause)

    root_cause.identified_causes = identified_causes

    # ç”Ÿæˆè§£å†³æ–¹æ¡ˆ
    solutions = []
    for cause in identified_causes:
        solution = Solution()
        solution.solution_id = f"SOL-{cause.cause_id}"
        solution.solution_description = generate_solution_description(cause)
        solution.solution_owner = determine_solution_owner(cause)
        solution.solution_status = "Proposed"
        solutions.append(solution)

    root_cause.solutions = solutions

    return root_cause
```

---

## 6. æ¡ˆä¾‹5ï¼šKPIæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ

### 6.1 åœºæ™¯æè¿°

**åº”ç”¨åœºæ™¯**ï¼š
KPIæ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿï¼Œæ”¯æŒKPIå…ƒæ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æã€‚

**ä¸šåŠ¡éœ€æ±‚**ï¼š

- æ”¯æŒKPIå…ƒæ•°æ®å­˜å‚¨
- æ”¯æŒKPIæ•°æ®æŸ¥è¯¢å’Œåˆ†æ
- æ”¯æŒKPIæŠ¥å‘Šç”Ÿæˆ

### 6.2 å®ç°ä»£ç 

```python
def store_kpi_data(kpi_data: KPIManagementSchema, conn):
    """å­˜å‚¨KPIæ•°æ®åˆ°PostgreSQL"""
    cursor = conn.cursor()

    # å­˜å‚¨KPIå®šä¹‰
    for kpi in kpi_data.kpi_definition.kpi_definitions:
        cursor.execute("""
            INSERT INTO kpi_definitions
            (kpi_id, kpi_name, kpi_description, kpi_type, kpi_category, calculation_formula,
             data_source, measurement_unit, calculation_frequency, owner, is_active)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (kpi_id) DO UPDATE SET
            kpi_name = EXCLUDED.kpi_name,
            kpi_description = EXCLUDED.kpi_description,
            calculation_formula = EXCLUDED.calculation_formula,
            updated_at = CURRENT_TIMESTAMP
        """, (kpi.kpi_id, kpi.kpi_name, kpi.kpi_description, kpi.kpi_type,
              kpi.kpi_category, kpi.calculation_formula, kpi.data_source,
              kpi.measurement_unit, kpi.calculation_frequency, kpi.owner, kpi.is_active))

    # å­˜å‚¨KPIç›®æ ‡
    for target in kpi_data.kpi_definition.kpi_targets:
        cursor.execute("""
            INSERT INTO kpi_targets
            (target_id, kpi_id, target_type, target_value, target_start_date, target_end_date,
             target_owner, target_status)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (target_id) DO UPDATE SET
            target_value = EXCLUDED.target_value,
            target_status = EXCLUDED.target_status
        """, (target.target_id, target.kpi_id, target.target_type, target.target_value,
              target.target_period.start_date, target.target_period.end_date,
              target.target_owner, target.target_status))

    # å­˜å‚¨KPIå€¼
    for value in kpi_data.kpi_monitoring.kpi_values:
        cursor.execute("""
            INSERT INTO kpi_values
            (value_id, kpi_id, value, measurement_date, measurement_time, data_source,
             is_actual, completion_rate)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (value_id) DO UPDATE SET
            value = EXCLUDED.value,
            completion_rate = EXCLUDED.completion_rate
        """, (value.value_id, value.kpi_id, value.value, value.measurement_date,
              value.measurement_time, value.data_source, value.is_actual, value.completion_rate))

    # å­˜å‚¨KPIè¶‹åŠ¿
    for trend in kpi_data.kpi_monitoring.kpi_trends:
        cursor.execute("""
            INSERT INTO kpi_trends
            (trend_id, kpi_id, trend_start_date, trend_end_date, trend_direction,
             trend_magnitude, trend_confidence)
            VALUES (%s, %s, %s, %s, %s, %s, %s)
            ON CONFLICT (trend_id) DO UPDATE SET
            trend_direction = EXCLUDED.trend_direction,
            trend_magnitude = EXCLUDED.trend_magnitude
        """, (trend.trend_id, trend.kpi_id, trend.trend_period.start_date,
              trend.trend_period.end_date, trend.trend_direction,
              trend.trend_magnitude, trend.trend_confidence))

    conn.commit()

def generate_kpi_report(conn, report_period: DateRange):
    """ç”ŸæˆKPIæŠ¥è¡¨"""
    cursor = conn.cursor()

    # æŸ¥è¯¢KPIå®Œæˆæƒ…å†µæ±‡æ€»
    cursor.execute("""
        SELECT
            kd.kpi_name,
            kd.kpi_type,
            kt.target_value,
            AVG(kv.value) as avg_value,
            AVG(kv.completion_rate) as avg_completion_rate,
            COUNT(kv.value_id) as measurement_count,
            SUM(CASE WHEN kv.completion_rate >= 100 THEN 1 ELSE 0 END) as achieved_count
        FROM kpi_definitions kd
        LEFT JOIN kpi_targets kt ON kd.kpi_id = kt.kpi_id AND kt.target_status = 'Active'
        LEFT JOIN kpi_values kv ON kd.kpi_id = kv.kpi_id
        WHERE kv.measurement_date BETWEEN %s AND %s
        GROUP BY kd.kpi_id, kd.kpi_name, kd.kpi_type, kt.target_value
        ORDER BY avg_completion_rate DESC
    """, (report_period.start_date, report_period.end_date))

    kpi_summary = cursor.fetchall()

    # æŸ¥è¯¢KPIè¶‹åŠ¿åˆ†æ
    cursor.execute("""
        SELECT
            kd.kpi_name,
            kt.trend_direction,
            kt.trend_magnitude,
            kt.trend_confidence,
            kt.trend_end_date
        FROM kpi_definitions kd
        JOIN kpi_trends kt ON kd.kpi_id = kt.kpi_id
        WHERE kt.trend_end_date >= %s
        ORDER BY kt.trend_end_date DESC, kd.kpi_name
    """, (report_period.start_date,))

    kpi_trends = cursor.fetchall()

    return {
        "kpi_summary": kpi_summary,
        "kpi_trends": kpi_trends,
        "report_period": report_period
    }
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
