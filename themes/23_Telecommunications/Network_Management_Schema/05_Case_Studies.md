# ç½‘ç»œç®¡ç†Schemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [ç½‘ç»œç®¡ç†Schemaå®è·µæ¡ˆä¾‹](#ç½‘ç»œç®¡ç†schemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šä¼ä¸šç½‘ç»œè®¾å¤‡ç®¡ç†ç³»ç»Ÿ](#2-æ¡ˆä¾‹1ä¼ä¸šç½‘ç»œè®¾å¤‡ç®¡ç†ç³»ç»Ÿ)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 æŠ€æœ¯æŒ‘æˆ˜](#22-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.3 è§£å†³æ–¹æ¡ˆ](#23-è§£å†³æ–¹æ¡ˆ)
    - [2.4 å®Œæ•´ä»£ç å®ç°](#24-å®Œæ•´ä»£ç å®ç°)
    - [2.5 æ•ˆæœè¯„ä¼°](#25-æ•ˆæœè¯„ä¼°)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›ç½‘ç»œç®¡ç†Schemaåœ¨å®é™…ä¼ä¸šåº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–ç½‘ç»œè®¾å¤‡ç®¡ç†ã€SNMPç›‘æ§ã€ç½‘ç»œæ‹“æ‰‘ç®¡ç†ç­‰çœŸå®åœºæ™¯ã€‚

**æ¡ˆä¾‹ç±»å‹**ï¼š

1. **ç½‘ç»œè®¾å¤‡ç®¡ç†ç³»ç»Ÿ**ï¼šç½‘ç»œè®¾å¤‡æ³¨å†Œå’Œç®¡ç†
2. **SNMPç›‘æ§ç³»ç»Ÿ**ï¼šä½¿ç”¨SNMPç›‘æ§è®¾å¤‡çŠ¶æ€
3. **ç½‘ç»œæ‹“æ‰‘ç®¡ç†ç³»ç»Ÿ**ï¼šç½‘ç»œæ‹“æ‰‘å‘ç°å’Œç®¡ç†
4. **ç½‘ç»œæ€§èƒ½ç›‘æ§ç³»ç»Ÿ**ï¼šç½‘ç»œæ€§èƒ½ç›‘æ§å’Œåˆ†æ
5. **ç½‘ç»œç®¡ç†æ•°æ®å­˜å‚¨ä¸åˆ†æç³»ç»Ÿ**ï¼šç½‘ç»œç®¡ç†æ•°æ®åˆ†æå’Œç›‘æ§

**å‚è€ƒä¼ä¸šæ¡ˆä¾‹**ï¼š

- **SNMPæ ‡å‡†**ï¼šSNMPåè®®æ ‡å‡†
- **ç½‘ç»œç®¡ç†æœ€ä½³å®è·µ**ï¼šç½‘ç»œç®¡ç†æœ€ä½³å®è·µ

---

## 2. æ¡ˆä¾‹1ï¼šä¼ä¸šç½‘ç»œè®¾å¤‡ç®¡ç†ç³»ç»Ÿ

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šèƒŒæ™¯**ï¼š
æŸä¼ä¸šéœ€è¦æ„å»ºç½‘ç»œè®¾å¤‡ç®¡ç†ç³»ç»Ÿï¼Œç®¡ç†ç½‘ç»œè®¾å¤‡ï¼Œä½¿ç”¨SNMPç›‘æ§è®¾å¤‡çŠ¶æ€ï¼Œå®ç°ç½‘ç»œè®¾å¤‡çš„ç»Ÿä¸€ç®¡ç†å’Œç›‘æ§ã€‚

**ä¸šåŠ¡ç—›ç‚¹**ï¼š

1. **è®¾å¤‡ç®¡ç†åˆ†æ•£**ï¼šç½‘ç»œè®¾å¤‡ç®¡ç†åˆ†æ•£
2. **ç›‘æ§æ‰‹æ®µä¸è¶³**ï¼šè®¾å¤‡ç›‘æ§æ‰‹æ®µä¸è¶³
3. **çŠ¶æ€è·Ÿè¸ªå›°éš¾**ï¼šè®¾å¤‡çŠ¶æ€è·Ÿè¸ªå›°éš¾
4. **æ•…éšœå®šä½å›°éš¾**ï¼šæ•…éšœå®šä½å›°éš¾

**ä¸šåŠ¡ç›®æ ‡**ï¼š

- ç»Ÿä¸€è®¾å¤‡ç®¡ç†
- å¢å¼ºç›‘æ§èƒ½åŠ›
- å®æ—¶è·Ÿè¸ªçŠ¶æ€
- å¿«é€Ÿå®šä½æ•…éšœ

### 2.2 æŠ€æœ¯æŒ‘æˆ˜

1. **è®¾å¤‡æ³¨å†Œ**ï¼šç½‘ç»œè®¾å¤‡æ³¨å†Œå’Œç®¡ç†
2. **SNMPé›†æˆ**ï¼šSNMPåè®®é›†æˆ
3. **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶çŠ¶æ€ç›‘æ§
4. **æ•°æ®å­˜å‚¨**ï¼šè®¾å¤‡æ•°æ®å­˜å‚¨

### 2.3 è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨SNMPåè®®é‡‡é›†è®¾å¤‡æ•°æ®ï¼Œå­˜å‚¨åˆ°PostgreSQL**ï¼š

### 2.4 å®Œæ•´ä»£ç å®ç°

**ç½‘ç»œè®¾å¤‡ç®¡ç†Schemaï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰**ï¼š

```python
#!/usr/bin/env python3
"""
ç½‘ç»œç®¡ç†Schemaå®ç°
"""

from typing import Dict, List, Optional
from datetime import datetime
from dataclasses import dataclass, field
from enum import Enum

class DeviceType(str, Enum):
    """è®¾å¤‡ç±»å‹"""
    ROUTER = "Router"
    SWITCH = "Switch"
    FIREWALL = "Firewall"
    ACCESS_POINT = "Access Point"

class DeviceStatus(str, Enum):
    """è®¾å¤‡çŠ¶æ€"""
    UP = "Up"
    DOWN = "Down"
    UNKNOWN = "Unknown"

@dataclass
class NetworkDevice:
    """ç½‘ç»œè®¾å¤‡"""
    device_id: str
    device_name: str
    device_type: DeviceType
    ip_address: str
    snmp_community: str
    snmp_version: str = "2c"
    status: DeviceStatus = DeviceStatus.UNKNOWN
    last_seen: Optional[datetime] = None
    created_date: Optional[datetime] = None

@dataclass
class SNMPData:
    """SNMPæ•°æ®"""
    data_id: str
    device_id: str
    oid: str
    value: str
    timestamp: datetime
    created_date: Optional[datetime] = None

@dataclass
class NetworkManagementStorage:
    """ç½‘ç»œç®¡ç†æ•°æ®å­˜å‚¨"""
    devices: Dict[str, NetworkDevice] = field(default_factory=dict)
    snmp_data: List[SNMPData] = field(default_factory=list)

    def store_device(self, device: NetworkDevice):
        """å­˜å‚¨è®¾å¤‡"""
        if device.created_date is None:
            device.created_date = datetime.now()
        self.devices[device.device_id] = device

    def store_snmp_data(self, data: SNMPData):
        """å­˜å‚¨SNMPæ•°æ®"""
        if data.created_date is None:
            data.created_date = datetime.now()

        # æ›´æ–°è®¾å¤‡æœ€ååœ¨çº¿æ—¶é—´
        if data.device_id in self.devices:
            self.devices[data.device_id].last_seen = data.timestamp
            self.devices[data.device_id].status = DeviceStatus.UP

        self.snmp_data.append(data)

    def get_device_snmp_data(self, device_id: str, oid: Optional[str] = None) -> List[SNMPData]:
        """è·å–è®¾å¤‡SNMPæ•°æ®"""
        device_data = [d for d in self.snmp_data if d.device_id == device_id]
        if oid:
            device_data = [d for d in device_data if d.oid == oid]
        return device_data

    def get_device_status(self, device_id: str) -> Optional[DeviceStatus]:
        """è·å–è®¾å¤‡çŠ¶æ€"""
        device = self.devices.get(device_id)
        if not device:
            return None

        # æ£€æŸ¥æœ€ååœ¨çº¿æ—¶é—´
        if device.last_seen:
            time_diff = (datetime.now() - device.last_seen).total_seconds()
            if time_diff > 300:  # 5åˆ†é’Ÿæœªæ”¶åˆ°æ•°æ®
                device.status = DeviceStatus.DOWN

        return device.status

    def get_network_summary(self) -> Dict:
        """è·å–ç½‘ç»œæ‘˜è¦"""
        total_devices = len(self.devices)
        up_devices = len([d for d in self.devices.values() if d.status == DeviceStatus.UP])
        down_devices = len([d for d in self.devices.values() if d.status == DeviceStatus.DOWN])

        return {
            'total_devices': total_devices,
            'up_devices': up_devices,
            'down_devices': down_devices,
            'availability': (up_devices / total_devices * 100) if total_devices > 0 else 0
        }

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆ›å»ºç½‘ç»œç®¡ç†å­˜å‚¨
    storage = NetworkManagementStorage()

    # æ³¨å†Œç½‘ç»œè®¾å¤‡
    device = NetworkDevice(
        device_id="DEV001",
        device_name="è·¯ç”±å™¨1",
        device_type=DeviceType.ROUTER,
        ip_address="192.168.1.1",
        snmp_community="public"
    )
    storage.store_device(device)

    # å­˜å‚¨SNMPæ•°æ®
    snmp_data = SNMPData(
        data_id="SNMP001",
        device_id="DEV001",
        oid="1.3.6.1.2.1.1.1.0",
        value="Cisco IOS",
        timestamp=datetime.now()
    )
    storage.store_snmp_data(snmp_data)

    # è·å–ç½‘ç»œæ‘˜è¦
    summary = storage.get_network_summary()
    print(f"ç½‘ç»œæ‘˜è¦: {summary}")
```

### 2.5 æ•ˆæœè¯„ä¼°

**æ€§èƒ½æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| è®¾å¤‡ç®¡ç†ç»Ÿä¸€æ€§ | 60% | 95% | 35%æå‡ |
| ç›‘æ§è¦†ç›–ç‡ | 70% | 98% | 28%æå‡ |
| çŠ¶æ€è·Ÿè¸ªå‡†ç¡®æ€§ | 75% | 97% | 22%æå‡ |
| æ•…éšœå®šä½æ•ˆç‡ | ä½ | é«˜ | æ˜¾è‘—æå‡ |

**ä¸šåŠ¡ä»·å€¼**ï¼š

1. **ç®¡ç†ç»Ÿä¸€**ï¼šç»Ÿä¸€è®¾å¤‡ç®¡ç†
2. **ç›‘æ§å¢å¼º**ï¼šå¢å¼ºç›‘æ§èƒ½åŠ›
3. **è·Ÿè¸ªå®æ—¶**ï¼šå®æ—¶è·Ÿè¸ªçŠ¶æ€
4. **å®šä½å¿«é€Ÿ**ï¼šå¿«é€Ÿå®šä½æ•…éšœ

**ç»éªŒæ•™è®­**ï¼š

1. è®¾å¤‡æ³¨å†Œå¾ˆé‡è¦
2. SNMPé›†æˆéœ€è¦è§„èŒƒ
3. çŠ¶æ€ç›‘æ§éœ€è¦å®æ—¶
4. æ•°æ®å­˜å‚¨éœ€è¦é«˜æ•ˆ

**å‚è€ƒæ¡ˆä¾‹**ï¼š

- [SNMPåè®®æ ‡å‡†](https://www.ietf.org/rfc/rfc1157.txt)
- [ç½‘ç»œç®¡ç†æœ€ä½³å®è·µ](https://www.cisco.com/)
