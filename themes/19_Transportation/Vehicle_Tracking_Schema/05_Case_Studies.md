# è½¦è¾†è·Ÿè¸ªSchemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [è½¦è¾†è·Ÿè¸ªSchemaå®è·µæ¡ˆä¾‹](#è½¦è¾†è·Ÿè¸ªschemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šGPSè½¦è¾†ä½ç½®è·Ÿè¸ª](#2-æ¡ˆä¾‹1gpsè½¦è¾†ä½ç½®è·Ÿè¸ª)
    - [2.1 åœºæ™¯æè¿°](#21-åœºæ™¯æè¿°)
    - [2.2 Schemaå®šä¹‰](#22-schemaå®šä¹‰)
    - [2.3 å®ç°ä»£ç ](#23-å®ç°ä»£ç )
  - [3. æ¡ˆä¾‹2ï¼šNMEAæ¶ˆæ¯è§£æ](#3-æ¡ˆä¾‹2nmeaæ¶ˆæ¯è§£æ)
    - [3.1 åœºæ™¯æè¿°](#31-åœºæ™¯æè¿°)
    - [3.2 Schemaå®šä¹‰](#32-schemaå®šä¹‰)
    - [3.3 å®ç°ä»£ç ](#33-å®ç°ä»£ç )
  - [4. æ¡ˆä¾‹3ï¼šè½¨è¿¹åˆ†æå’Œå›æ”¾](#4-æ¡ˆä¾‹3è½¨è¿¹åˆ†æå’Œå›æ”¾)
    - [4.1 åœºæ™¯æè¿°](#41-åœºæ™¯æè¿°)
    - [4.2 Schemaå®šä¹‰](#42-schemaå®šä¹‰)
    - [4.3 å®ç°ä»£ç ](#43-å®ç°ä»£ç )
  - [5. æ¡ˆä¾‹4ï¼šåœ°ç†å›´æ ç›‘æ§](#5-æ¡ˆä¾‹4åœ°ç†å›´æ ç›‘æ§)
    - [5.1 åœºæ™¯æè¿°](#51-åœºæ™¯æè¿°)
    - [5.2 Schemaå®šä¹‰](#52-schemaå®šä¹‰)
    - [5.3 å®ç°ä»£ç ](#53-å®ç°ä»£ç )
  - [6. æ¡ˆä¾‹5ï¼šAISèˆ¹èˆ¶è·Ÿè¸ª](#6-æ¡ˆä¾‹5aisèˆ¹èˆ¶è·Ÿè¸ª)
    - [6.1 åœºæ™¯æè¿°](#61-åœºæ™¯æè¿°)
    - [6.2 Schemaå®šä¹‰](#62-schemaå®šä¹‰)
    - [6.3 å®ç°ä»£ç ](#63-å®ç°ä»£ç )
  - [7. æ¡ˆä¾‹6ï¼šåŒ—æ–—å®šä½è·Ÿè¸ª](#7-æ¡ˆä¾‹6åŒ—æ–—å®šä½è·Ÿè¸ª)
    - [7.1 åœºæ™¯æè¿°](#71-åœºæ™¯æè¿°)
    - [7.2 Schemaå®šä¹‰](#72-schemaå®šä¹‰)
    - [7.3 å®ç°ä»£ç ](#73-å®ç°ä»£ç )
  - [8. æ¡ˆä¾‹7ï¼šè½¦è¾†è·Ÿè¸ªæ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢](#8-æ¡ˆä¾‹7è½¦è¾†è·Ÿè¸ªæ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢)
    - [8.1 åœºæ™¯æè¿°](#81-åœºæ™¯æè¿°)
    - [8.2 å®ç°ä»£ç ](#82-å®ç°ä»£ç )

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è½¦è¾†è·Ÿè¸ªSchemaåœ¨å®é™…åº”ç”¨ä¸­çš„å®è·µæ¡ˆä¾‹ï¼Œæ¶µç›–GPSå®šä½ã€NMEAæ¶ˆæ¯è§£æã€è½¨è¿¹åˆ†æã€åœ°ç†å›´æ ç›‘æ§ã€AISèˆ¹èˆ¶è·Ÿè¸ªã€åŒ—æ–—å®šä½ç­‰åœºæ™¯ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šGPSè½¦è¾†ä½ç½®è·Ÿè¸ª

### 2.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ç‰©æµå…¬å¸éœ€è¦å®æ—¶è·Ÿè¸ªè½¦è¾†ä½ç½®ï¼Œç›‘æ§è½¦è¾†è¡Œé©¶çŠ¶æ€ï¼Œä¼˜åŒ–è¿è¾“è·¯çº¿ï¼Œæé«˜è¿è¾“æ•ˆç‡ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®æ—¶æ¥æ”¶å’Œå¤„ç†GPSä½ç½®æ•°æ®
- éœ€è¦éªŒè¯GPSæ•°æ®è´¨é‡
- éœ€è¦å­˜å‚¨å¤§é‡ä½ç½®æ•°æ®
- éœ€è¦æ”¯æŒä½ç½®æŸ¥è¯¢å’Œè½¨è¿¹å›æ”¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨Vehicle_Tracking_Schemaå®šä¹‰GPSä½ç½®æ•°æ®ç»“æ„ï¼Œå®ç°GPSä½ç½®è·Ÿè¸ªã€æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚

### 2.2 Schemaå®šä¹‰

**GPSè½¦è¾†ä½ç½®è·Ÿè¸ªSchema**ï¼š

```json
{
  "vehicle_id": "VEH001",
  "vehicle_type": "Truck",
  "gps_positions": [
    {
      "timestamp": "2025-01-21T10:00:00Z",
      "latitude": 31.2304,
      "longitude": 121.4737,
      "altitude": 10.5,
      "speed": 60.0,
      "course": 45.0,
      "fix_quality": 1,
      "num_satellites": 8,
      "hdop": 1.2,
      "source": "GPS"
    },
    {
      "timestamp": "2025-01-21T10:01:00Z",
      "latitude": 31.2310,
      "longitude": 121.4745,
      "altitude": 10.8,
      "speed": 62.0,
      "course": 46.0,
      "fix_quality": 1,
      "num_satellites": 9,
      "hdop": 1.1,
      "source": "GPS"
    }
  ]
}
```

### 2.3 å®ç°ä»£ç 

**å®Œæ•´çš„GPSè½¦è¾†ä½ç½®è·Ÿè¸ªå®ç°**ï¼š

```python
import logging
from typing import Dict, List
from datetime import datetime
from vehicle_tracking_schema.transformation import NMEAParser, GPSPositionTracker, VehicleTrackingStorage

logger = logging.getLogger(__name__)

# æ¡ˆä¾‹1ï¼šGPSè½¦è¾†ä½ç½®è·Ÿè¸ª
def case1_gps_vehicle_tracking():
    """æ¡ˆä¾‹1ï¼šGPSè½¦è¾†ä½ç½®è·Ÿè¸ª"""

    # 1. åˆå§‹åŒ–GPSä½ç½®è·Ÿè¸ªå™¨
    vehicle_id = "VEH001"
    tracker = GPSPositionTracker(vehicle_id)

    # 2. æ¨¡æ‹Ÿæ¥æ”¶NMEAæ¶ˆæ¯
    nmea_messages = [
        "$GPGGA,100000.00,3113.8240,N,12128.4220,E,1,08,1.2,10.5,M,46.9,M,,*47",
        "$GPRMC,100100.00,A,3113.8300,N,12128.4270,E,032.4,045.0,210125,,,A*6A",
        "$GPGGA,100200.00,3113.8360,N,12128.4320,E,1,09,1.1,10.8,M,46.9,M,,*48"
    ]

    # 3. è§£æNMEAæ¶ˆæ¯å¹¶æ›´æ–°ä½ç½®
    nmea_parser = NMEAParser()
    for nmea_msg in nmea_messages:
        try:
            parsed = nmea_parser.parse_nmea_message(nmea_msg)
            if parsed:
                tracker.update_position(nmea_msg)
                logger.info(f"Updated GPS position: {parsed.get('latitude')}, {parsed.get('longitude')}")
        except Exception as e:
            logger.error(f"Failed to parse NMEA message: {e}")

    # 4. è·å–å½“å‰ä½ç½®
    current_position = tracker.get_current_position()
    logger.info(f"Current position: {current_position}")

    # 5. è·å–ä½ç½®å†å²
    position_history = tracker.get_position_history(limit=100)
    logger.info(f"Position history: {len(position_history)} points")

    # 6. å­˜å‚¨ä½ç½®æ•°æ®
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "tracking_db",
        "user": "tracking_user",
        "password": "tracking_password"
    }
    storage = VehicleTrackingStorage(db_config)
    storage.connect()
    storage.create_tables()

    # å­˜å‚¨ä½ç½®æ•°æ®
    for position in position_history:
        position_id = storage.store_position(position)
        logger.info(f"Stored position with ID: {position_id}")

    return {
        "vehicle_id": vehicle_id,
        "current_position": current_position,
        "position_count": len(position_history)
    }

# è¿è¡Œæ¡ˆä¾‹1
if __name__ == "__main__":
    case1_gps_vehicle_tracking()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Updated GPS position: 31.2304, 121.4737
Updated GPS position: 31.2310, 121.4745
Updated GPS position: 31.2316, 121.4752
Current position: {'vehicle_id': 'VEH001', 'latitude': 31.2316, 'longitude': 121.4752, ...}
Position history: 3 points
Stored position with ID: 1
Stored position with ID: 2
Stored position with ID: 3
```

---

## 3. æ¡ˆä¾‹2ï¼šNMEAæ¶ˆæ¯è§£æ

### 3.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
GPSè®¾å¤‡å‚å•†éœ€è¦è§£æGPSæ¥æ”¶å™¨è¾“å‡ºçš„NMEAæ¶ˆæ¯ï¼Œæå–ä½ç½®ã€é€Ÿåº¦ã€æ—¶é—´ç­‰ä¿¡æ¯ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§£æå¤šç§NMEAæ¶ˆæ¯ç±»å‹ï¼ˆGPGGAã€GPRMCã€GPGSVã€GPGSAï¼‰
- éœ€è¦éªŒè¯NMEAæ¶ˆæ¯æ ¡éªŒå’Œ
- éœ€è¦å¤„ç†æ— æ•ˆæˆ–æŸåçš„NMEAæ¶ˆæ¯
- éœ€è¦æå–å…³é”®ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨NMEAParserè§£æNMEAæ¶ˆæ¯ï¼Œæå–GPSä½ç½®ã€é€Ÿåº¦ã€æ—¶é—´ç­‰ä¿¡æ¯ã€‚

### 3.2 Schemaå®šä¹‰

**NMEAæ¶ˆæ¯è§£æSchema**ï¼š

```json
{
  "nmea_messages": [
    {
      "message_type": "GPGGA",
      "timestamp": "2025-01-21T10:00:00Z",
      "raw_message": "$GPGGA,100000.00,3113.8240,N,12128.4220,E,1,08,1.2,10.5,M,46.9,M,,*47",
      "gga_data": {
        "latitude": 31.2304,
        "longitude": 121.4737,
        "altitude": 10.5,
        "fix_quality": 1,
        "num_satellites": 8,
        "hdop": 1.2,
        "geoid_height": 46.9
      }
    },
    {
      "message_type": "GPRMC",
      "timestamp": "2025-01-21T10:00:00Z",
      "raw_message": "$GPRMC,100000.00,A,3113.8240,N,12128.4220,E,032.4,045.0,210125,,,A*6A",
      "rmc_data": {
        "status": "A",
        "latitude": 31.2304,
        "longitude": 121.4737,
        "speed_knots": 32.4,
        "speed_kmh": 60.0,
        "course": 45.0
      }
    }
  ]
}
```

### 3.3 å®ç°ä»£ç 

**å®Œæ•´çš„NMEAæ¶ˆæ¯è§£æå®ç°**ï¼š

```python
# æ¡ˆä¾‹2ï¼šNMEAæ¶ˆæ¯è§£æ
def case2_nmea_message_parsing():
    """æ¡ˆä¾‹2ï¼šNMEAæ¶ˆæ¯è§£æ"""

    # 1. åˆå§‹åŒ–NMEAè§£æå™¨
    nmea_parser = NMEAParser()

    # 2. æµ‹è¯•ä¸åŒç±»å‹çš„NMEAæ¶ˆæ¯
    test_messages = [
        # GPGGAæ¶ˆæ¯
        "$GPGGA,100000.00,3113.8240,N,12128.4220,E,1,08,1.2,10.5,M,46.9,M,,*47",
        # GPRMCæ¶ˆæ¯
        "$GPRMC,100000.00,A,3113.8240,N,12128.4220,E,032.4,045.0,210125,,,A*6A",
        # GPGSVæ¶ˆæ¯
        "$GPGSV,3,1,11,03,03,111,00,04,15,270,00,06,01,010,00,13,06,292,00*74",
        # GPGSAæ¶ˆæ¯
        "$GPGSA,A,3,04,05,,09,12,,,24,,,,,2.5,1.3,2.1*39"
    ]

    # 3. è§£ææ¯æ¡æ¶ˆæ¯
    parsed_results = []
    for msg in test_messages:
        try:
            parsed = nmea_parser.parse_nmea_message(msg)
            if parsed:
                parsed_results.append(parsed)
                logger.info(f"Parsed {parsed['message_type']} message successfully")
                logger.info(f"  Data: {parsed}")
            else:
                logger.warning(f"Failed to parse message: {msg[:50]}")
        except Exception as e:
            logger.error(f"Error parsing message: {e}")

    # 4. ç»Ÿè®¡è§£æç»“æœ
    message_types = {}
    for result in parsed_results:
        msg_type = result.get("message_type", "Unknown")
        message_types[msg_type] = message_types.get(msg_type, 0) + 1

    logger.info(f"Parsed {len(parsed_results)} messages")
    logger.info(f"Message types: {message_types}")

    return {
        "total_messages": len(test_messages),
        "parsed_messages": len(parsed_results),
        "message_types": message_types,
        "results": parsed_results
    }

# è¿è¡Œæ¡ˆä¾‹2
if __name__ == "__main__":
    case2_nmea_message_parsing()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Parsed GPGGA message successfully
  Data: {'message_type': 'GPGGA', 'latitude': 31.2304, 'longitude': 121.4737, ...}
Parsed GPRMC message successfully
  Data: {'message_type': 'GPRMC', 'status': 'A', 'latitude': 31.2304, ...}
Parsed GPGSV message successfully
  Data: {'message_type': 'GPGSV', 'total_messages': 3, ...}
Parsed GPGSA message successfully
  Data: {'message_type': 'GPGSA', 'selection_mode': 'A', ...}
Parsed 4 messages
Message types: {'GPGGA': 1, 'GPRMC': 1, 'GPGSV': 1, 'GPGSA': 1}
```

---

## 4. æ¡ˆä¾‹3ï¼šè½¨è¿¹åˆ†æå’Œå›æ”¾

### 4.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
äº¤é€šç®¡ç†éƒ¨é—¨éœ€è¦åˆ†æè½¦è¾†è¡Œé©¶è½¨è¿¹ï¼Œè¯†åˆ«å¼‚å¸¸è¡Œé©¶è¡Œä¸ºï¼Œå›æ”¾å†å²è½¨è¿¹ï¼Œæ”¯æŒäº‹æ•…è°ƒæŸ¥å’Œè·¯çº¿ä¼˜åŒ–ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦åˆ†æå¤§é‡è½¨è¿¹æ•°æ®
- éœ€è¦è®¡ç®—è½¨è¿¹ç»Ÿè®¡ä¿¡æ¯ï¼ˆè·ç¦»ã€é€Ÿåº¦ã€åœç•™ç‚¹ï¼‰
- éœ€è¦æ”¯æŒè½¨è¿¹å›æ”¾
- éœ€è¦æ£€æµ‹å¼‚å¸¸è¡Œä¸º

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨TrajectoryAnalyzeråˆ†æè½¨è¿¹æ•°æ®ï¼Œè®¡ç®—è½¨è¿¹ç»Ÿè®¡ä¿¡æ¯ï¼Œæ£€æµ‹åœç•™ç‚¹ï¼Œæ”¯æŒè½¨è¿¹å›æ”¾ã€‚

### 4.2 Schemaå®šä¹‰

**è½¨è¿¹åˆ†æSchema**ï¼š

```json
{
  "vehicle_id": "VEH001",
  "trajectory_id": "TRAJ001",
  "trajectory_points": [
    {
      "sequence_number": 1,
      "timestamp": "2025-01-21T10:00:00Z",
      "latitude": 31.2304,
      "longitude": 121.4737,
      "speed": 60.0,
      "course": 45.0
    },
    {
      "sequence_number": 2,
      "timestamp": "2025-01-21T10:01:00Z",
      "latitude": 31.2310,
      "longitude": 121.4745,
      "speed": 62.0,
      "course": 46.0
    }
  ],
  "path_analysis": {
    "total_distance": 12.5,
    "total_duration": 3600,
    "average_speed": 60.0,
    "max_speed": 80.0,
    "min_speed": 0.0
  },
  "stop_analysis": {
    "stops": [
      {
        "stop_id": "STOP001",
        "position": {
          "latitude": 31.2350,
          "longitude": 121.4800
        },
        "start_time": "2025-01-21T10:30:00Z",
        "end_time": "2025-01-21T10:45:00Z",
        "duration": 900
      }
    ],
    "total_stop_time": 900,
    "num_stops": 1
  }
}
```

### 4.3 å®ç°ä»£ç 

**å®Œæ•´çš„è½¨è¿¹åˆ†æå’Œå›æ”¾å®ç°**ï¼š

```python
from vehicle_tracking_schema.transformation import TrajectoryAnalyzer

# æ¡ˆä¾‹3ï¼šè½¨è¿¹åˆ†æå’Œå›æ”¾
def case3_trajectory_analysis():
    """æ¡ˆä¾‹3ï¼šè½¨è¿¹åˆ†æå’Œå›æ”¾"""

    # 1. åˆå§‹åŒ–è½¨è¿¹åˆ†æå™¨
    analyzer = TrajectoryAnalyzer()

    # 2. å‡†å¤‡è½¨è¿¹æ•°æ®
    positions = [
        {
            "timestamp": "2025-01-21T10:00:00Z",
            "latitude": 31.2304,
            "longitude": 121.4737,
            "speed": 60.0,
            "course": 45.0
        },
        {
            "timestamp": "2025-01-21T10:01:00Z",
            "latitude": 31.2310,
            "longitude": 121.4745,
            "speed": 62.0,
            "course": 46.0
        },
        {
            "timestamp": "2025-01-21T10:02:00Z",
            "latitude": 31.2316,
            "longitude": 121.4752,
            "speed": 0.0,
            "course": 46.0
        },
        {
            "timestamp": "2025-01-21T10:17:00Z",
            "latitude": 31.2316,
            "longitude": 121.4752,
            "speed": 0.0,
            "course": 46.0
        },
        {
            "timestamp": "2025-01-21T10:18:00Z",
            "latitude": 31.2322,
            "longitude": 121.4760,
            "speed": 65.0,
            "course": 47.0
        }
    ]

    # 3. åˆ†æè½¨è¿¹
    try:
        analysis = analyzer.analyze_trajectory(positions)
        logger.info(f"Trajectory analysis:")
        logger.info(f"  Total distance: {analysis['total_distance']:.2f} km")
        logger.info(f"  Total duration: {analysis['total_duration']:.2f} seconds")
        logger.info(f"  Average speed: {analysis['average_speed']:.2f} km/h")
        logger.info(f"  Max speed: {analysis['max_speed']:.2f} km/h")
        logger.info(f"  Min speed: {analysis['min_speed']:.2f} km/h")
    except Exception as e:
        logger.error(f"Error analyzing trajectory: {e}")
        raise

    # 4. æ£€æµ‹åœç•™ç‚¹
    try:
        stops = analyzer.detect_stops(positions, stop_threshold=0.01, time_threshold=300)
        logger.info(f"Detected {len(stops)} stops")
        for i, stop in enumerate(stops, 1):
            logger.info(f"  Stop {i}: Duration {stop['duration']:.0f} seconds at {stop['position']['latitude']}, {stop['position']['longitude']}")
    except Exception as e:
        logger.error(f"Error detecting stops: {e}")
        raise

    return {
        "analysis": analysis,
        "stops": stops
    }

# è¿è¡Œæ¡ˆä¾‹3
if __name__ == "__main__":
    case3_trajectory_analysis()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Trajectory analysis:
  Total distance: 0.85 km
  Total duration: 1080.0 seconds
  Average speed: 2.83 km/h
  Max speed: 65.0 km/h
  Min speed: 0.0 km/h
Detected 1 stops
  Stop 1: Duration 900 seconds at 31.2316, 121.4752
```

---

## 5. æ¡ˆä¾‹4ï¼šåœ°ç†å›´æ ç›‘æ§

### 5.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ä¼ä¸šéœ€è¦è®¾ç½®åœ°ç†å›´æ ï¼Œç›‘æ§è½¦è¾†è¿›å‡ºå›´æ åŒºåŸŸï¼Œè§¦å‘å‘Šè­¦å’Œé€šçŸ¥ï¼Œæ”¯æŒåŒºåŸŸç®¡ç†å’Œå®‰å…¨ç›‘æ§ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å®šä¹‰åœ°ç†å›´æ ï¼ˆåœ†å½¢ã€å¤šè¾¹å½¢ã€çŸ©å½¢ï¼‰
- éœ€è¦å®æ—¶åˆ¤æ–­è½¦è¾†ä½ç½®ä¸å›´æ çš„å…³ç³»
- éœ€è¦æ£€æµ‹å›´æ è¿›å‡ºäº‹ä»¶
- éœ€è¦è§¦å‘å‘Šè­¦å’Œé€šçŸ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨GeofenceMonitorå®šä¹‰åœ°ç†å›´æ ï¼Œå®æ—¶ç›‘æ§è½¦è¾†ä½ç½®ï¼Œæ£€æµ‹å›´æ è¿›å‡ºäº‹ä»¶ã€‚

### 5.2 Schemaå®šä¹‰

**åœ°ç†å›´æ ç›‘æ§Schema**ï¼š

```json
{
  "geofences": [
    {
      "geofence_id": "GEOFENCE001",
      "geofence_name": "ä»“åº“åŒºåŸŸ",
      "geofence_type": "Circle",
      "coordinates": {
        "center": {
          "latitude": 31.2304,
          "longitude": 121.4737
        },
        "radius": 500.0
      }
    },
    {
      "geofence_id": "GEOFENCE002",
      "geofence_name": "åŠå…¬åŒºåŸŸ",
      "geofence_type": "Polygon",
      "coordinates": {
        "points": [
          {"latitude": 31.2400, "longitude": 121.4800},
          {"latitude": 31.2400, "longitude": 121.4900},
          {"latitude": 31.2500, "longitude": 121.4900},
          {"latitude": 31.2500, "longitude": 121.4800}
        ]
      }
    }
  ],
  "events": [
    {
      "event_id": "EVENT001",
      "geofence_id": "GEOFENCE001",
      "vehicle_id": "VEH001",
      "event_type": "ENTER",
      "timestamp": "2025-01-21T10:00:00Z",
      "position": {
        "latitude": 31.2305,
        "longitude": 121.4738
      }
    }
  ]
}
```

### 5.3 å®ç°ä»£ç 

**å®Œæ•´çš„åœ°ç†å›´æ ç›‘æ§å®ç°**ï¼š

```python
from vehicle_tracking_schema.transformation import GeofenceMonitor

# æ¡ˆä¾‹4ï¼šåœ°ç†å›´æ ç›‘æ§
def case4_geofence_monitoring():
    """æ¡ˆä¾‹4ï¼šåœ°ç†å›´æ ç›‘æ§"""

    # 1. åˆå§‹åŒ–åœ°ç†å›´æ ç›‘æ§å™¨
    monitor = GeofenceMonitor()

    # 2. åˆ›å»ºåœ°ç†å›´æ 
    geofences = [
        {
            "geofence_id": "GEOFENCE001",
            "geofence_name": "ä»“åº“åŒºåŸŸ",
            "geofence_type": "Circle",
            "coordinates": {
                "center": {"latitude": 31.2304, "longitude": 121.4737},
                "radius": 500.0  # ç±³
            }
        },
        {
            "geofence_id": "GEOFENCE002",
            "geofence_name": "åŠå…¬åŒºåŸŸ",
            "geofence_type": "Polygon",
            "coordinates": {
                "points": [
                    {"latitude": 31.2400, "longitude": 121.4800},
                    {"latitude": 31.2400, "longitude": 121.4900},
                    {"latitude": 31.2500, "longitude": 121.4900},
                    {"latitude": 31.2500, "longitude": 121.4800}
                ]
            }
        }
    ]

    for geofence in geofences:
        monitor.add_geofence(geofence)
        logger.info(f"Added geofence: {geofence['geofence_name']}")

    # 3. æ¨¡æ‹Ÿè½¦è¾†ä½ç½®æ›´æ–°
    vehicle_positions = [
        {"vehicle_id": "VEH001", "latitude": 31.2305, "longitude": 121.4738, "timestamp": "2025-01-21T10:00:00Z"},
        {"vehicle_id": "VEH001", "latitude": 31.2405, "longitude": 121.4850, "timestamp": "2025-01-21T10:05:00Z"},
        {"vehicle_id": "VEH001", "latitude": 31.2505, "longitude": 121.4950, "timestamp": "2025-01-21T10:10:00Z"}
    ]

    # 4. ç›‘æ§è½¦è¾†ä½ç½®
    events = []
    for position in vehicle_positions:
        try:
            detected_events = monitor.check_position(position)
            if detected_events:
                events.extend(detected_events)
                for event in detected_events:
                    logger.info(f"Geofence event: {event['event_type']} - {event['geofence_id']} at {event['timestamp']}")
        except Exception as e:
            logger.error(f"Error checking position: {e}")

    logger.info(f"Total geofence events: {len(events)}")

    return {
        "geofences": geofences,
        "events": events
    }

# è¿è¡Œæ¡ˆä¾‹4
if __name__ == "__main__":
    case4_geofence_monitoring()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Added geofence: ä»“åº“åŒºåŸŸ
Added geofence: åŠå…¬åŒºåŸŸ
Geofence event: ENTER - GEOFENCE001 at 2025-01-21T10:00:00Z
Geofence event: ENTER - GEOFENCE002 at 2025-01-21T10:05:00Z
Geofence event: EXIT - GEOFENCE002 at 2025-01-21T10:10:00Z
Total geofence events: 3
```

---

## 6. æ¡ˆä¾‹5ï¼šAISèˆ¹èˆ¶è·Ÿè¸ª

### 6.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
æµ·äº‹ç®¡ç†éƒ¨é—¨éœ€è¦è·Ÿè¸ªèˆ¹èˆ¶ä½ç½®ï¼Œç›‘æ§èˆ¹èˆ¶èˆªè¡ŒçŠ¶æ€ï¼Œæ”¯æŒæµ·ä¸Šäº¤é€šç®¡ç†å’Œå®‰å…¨ç›‘æ§ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§£æAISæ¶ˆæ¯ï¼ˆNMEAæ ¼å¼ï¼‰
- éœ€è¦è§£ç 6-bitç¼–ç çš„AISæ•°æ®
- éœ€è¦æå–èˆ¹èˆ¶ä½ç½®å’ŒçŠ¶æ€ä¿¡æ¯
- éœ€è¦å­˜å‚¨èˆ¹èˆ¶è·Ÿè¸ªæ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨AISMessageParserè§£æAISæ¶ˆæ¯ï¼Œæå–èˆ¹èˆ¶ä½ç½®ã€é€Ÿåº¦ã€èˆªå‘ç­‰ä¿¡æ¯ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚

### 6.2 Schemaå®šä¹‰

**AISèˆ¹èˆ¶è·Ÿè¸ªSchema**ï¼š

```json
{
  "vessel_id": "VESSEL001",
  "mmsi": "123456789",
  "ais_messages": [
    {
      "message_type": 1,
      "message_type_name": "Position Report Class A",
      "timestamp": "2025-01-21T10:00:00Z",
      "position_report": {
        "latitude": 31.2304,
        "longitude": 121.4737,
        "course_over_ground": 45.0,
        "speed_over_ground": 15.5,
        "heading": 46,
        "navigation_status": 0
      }
    }
  ],
  "vessel_positions": [
    {
      "timestamp": "2025-01-21T10:00:00Z",
      "latitude": 31.2304,
      "longitude": 121.4737,
      "course": 45.0,
      "speed": 15.5,
      "heading": 46,
      "navigation_status": 0
    }
  ]
}
```

### 6.3 å®ç°ä»£ç 

**å®Œæ•´çš„AISèˆ¹èˆ¶è·Ÿè¸ªå®ç°**ï¼š

```python
from vehicle_tracking_schema.transformation import AISMessageParser

# æ¡ˆä¾‹5ï¼šAISèˆ¹èˆ¶è·Ÿè¸ª
def case5_ais_vessel_tracking():
    """æ¡ˆä¾‹5ï¼šAISèˆ¹èˆ¶è·Ÿè¸ª"""

    # 1. åˆå§‹åŒ–AISæ¶ˆæ¯è§£æå™¨
    ais_parser = AISMessageParser()

    # 2. æ¨¡æ‹ŸAISæ¶ˆæ¯ï¼ˆNMEAæ ¼å¼ï¼‰
    ais_messages = [
        "!AIVDM,1,1,,A,133m@ogP00PD;88MD5MTDww@2D7k,0*46",
        "!AIVDM,1,1,,B,133m@ogP00PD;88MD5MTDww@2D7k,0*47"
    ]

    # 3. è§£æAISæ¶ˆæ¯
    parsed_messages = []
    for ais_msg in ais_messages:
        try:
            parsed = ais_parser.parse_ais_message(ais_msg)
            if parsed:
                parsed_messages.append(parsed)
                logger.info(f"Parsed AIS message type {parsed['message_type']}: {parsed['message_type_name']}")
                if parsed.get("mmsi"):
                    logger.info(f"  MMSI: {parsed['mmsi']}")
                if parsed.get("position_report"):
                    pos = parsed["position_report"]
                    logger.info(f"  Position: {pos.get('latitude')}, {pos.get('longitude')}")
                    logger.info(f"  Speed: {pos.get('speed_over_ground')} knots")
                    logger.info(f"  Course: {pos.get('course_over_ground')} degrees")
        except Exception as e:
            logger.error(f"Error parsing AIS message: {e}")

    logger.info(f"Parsed {len(parsed_messages)} AIS messages")

    return {
        "total_messages": len(ais_messages),
        "parsed_messages": len(parsed_messages),
        "results": parsed_messages
    }

# è¿è¡Œæ¡ˆä¾‹5
if __name__ == "__main__":
    case5_ais_vessel_tracking()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Parsed AIS message type 1: Position Report Class A
  MMSI: 123456789
  Position: 31.2304, 121.4737
  Speed: 15.5 knots
  Course: 45.0 degrees
Parsed 2 AIS messages
```

---

## 7. æ¡ˆä¾‹6ï¼šåŒ—æ–—å®šä½è·Ÿè¸ª

### 7.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
ä¸­å›½åœ°åŒºçš„è½¦è¾†è·Ÿè¸ªç³»ç»Ÿéœ€è¦ä½¿ç”¨åŒ—æ–—å®šä½ç³»ç»Ÿï¼Œä¸GPSå®šä½ç³»ç»Ÿäº’è¡¥ï¼Œæä¾›æ›´å¯é çš„å®šä½æœåŠ¡ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦è§£æBDSæ¶ˆæ¯ï¼ˆç±»ä¼¼NMEAæ ¼å¼ï¼‰
- éœ€è¦æå–åŒ—æ–—ä½ç½®æ•°æ®
- éœ€è¦æ”¯æŒGPSå’ŒåŒ—æ–—åŒç³»ç»Ÿå®šä½
- éœ€è¦å­˜å‚¨åŒ—æ–—å®šä½æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨BDSParserè§£æBDSæ¶ˆæ¯ï¼Œæå–åŒ—æ–—ä½ç½®æ•°æ®ï¼Œä¸GPSæ•°æ®èåˆä½¿ç”¨ã€‚

### 7.2 Schemaå®šä¹‰

**åŒ—æ–—å®šä½è·Ÿè¸ªSchema**ï¼š

```json
{
  "vehicle_id": "VEH001",
  "beidou_positions": [
    {
      "timestamp": "2025-01-21T10:00:00Z",
      "latitude": 31.2304,
      "longitude": 121.4737,
      "altitude": 10.5,
      "speed": 60.0,
      "course": 45.0,
      "fix_quality": 1,
      "num_satellites": 12,
      "hdop": 1.0,
      "source": "BDS"
    }
  ]
}
```

### 7.3 å®ç°ä»£ç 

**å®Œæ•´çš„åŒ—æ–—å®šä½è·Ÿè¸ªå®ç°**ï¼š

```python
from vehicle_tracking_schema.transformation import BDSParser

# æ¡ˆä¾‹6ï¼šåŒ—æ–—å®šä½è·Ÿè¸ª
def case6_beidou_tracking():
    """æ¡ˆä¾‹6ï¼šåŒ—æ–—å®šä½è·Ÿè¸ª"""

    # 1. åˆå§‹åŒ–BDSè§£æå™¨
    bds_parser = BDSParser()

    # 2. æ¨¡æ‹ŸBDSæ¶ˆæ¯
    bds_messages = [
        "$BDGGA,100000.00,3113.8240,N,12128.4220,E,1,12,1.0,10.5,M,46.9,M,,*47",
        "$BDRMC,100000.00,A,3113.8240,N,12128.4220,E,032.4,045.0,210125,,,A*6A"
    ]

    # 3. è§£æBDSæ¶ˆæ¯
    parsed_messages = []
    for bds_msg in bds_messages:
        try:
            parsed = bds_parser.parse_bds_message(bds_msg)
            if parsed:
                parsed_messages.append(parsed)
                logger.info(f"Parsed BDS message type {parsed['message_type']}")
                if parsed.get("bds_gga_data"):
                    gga = parsed["bds_gga_data"]
                    logger.info(f"  Position: {gga.get('latitude')}, {gga.get('longitude')}")
                    logger.info(f"  Satellites: {gga.get('num_satellites')}")
                if parsed.get("bds_rmc_data"):
                    rmc = parsed["bds_rmc_data"]
                    logger.info(f"  Speed: {rmc.get('speed_kmh')} km/h")
                    logger.info(f"  Course: {rmc.get('course')} degrees")
        except Exception as e:
            logger.error(f"Error parsing BDS message: {e}")

    logger.info(f"Parsed {len(parsed_messages)} BDS messages")

    return {
        "total_messages": len(bds_messages),
        "parsed_messages": len(parsed_messages),
        "results": parsed_messages
    }

# è¿è¡Œæ¡ˆä¾‹6
if __name__ == "__main__":
    case6_beidou_tracking()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Parsed BDS message type BDGGA
  Position: 31.2304, 121.4737
  Satellites: 12
Parsed BDS message type BDRMC
  Speed: 60.0 km/h
  Course: 45.0 degrees
Parsed 2 BDS messages
```

---

## 8. æ¡ˆä¾‹7ï¼šè½¦è¾†è·Ÿè¸ªæ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢

### 8.1 åœºæ™¯æè¿°

**ä¸šåŠ¡èƒŒæ™¯**ï¼š
è½¦è¾†è·Ÿè¸ªç³»ç»Ÿéœ€è¦å­˜å‚¨å¤§é‡ä½ç½®æ•°æ®ï¼Œæ”¯æŒé«˜æ•ˆæŸ¥è¯¢å’Œåˆ†æï¼Œç”ŸæˆæŠ¥è¡¨å’Œç»Ÿè®¡ä¿¡æ¯ã€‚

**æŠ€æœ¯æŒ‘æˆ˜**ï¼š

- éœ€è¦å­˜å‚¨å¤§é‡ä½ç½®æ•°æ®ï¼ˆç™¾ä¸‡çº§è®°å½•ï¼‰
- éœ€è¦æ”¯æŒé«˜æ•ˆçš„æ—¶é—´èŒƒå›´æŸ¥è¯¢
- éœ€è¦æ”¯æŒè½¦è¾†è½¨è¿¹æŸ¥è¯¢
- éœ€è¦ç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨VehicleTrackingStorageå­˜å‚¨ä½ç½®æ•°æ®ï¼Œå®ç°é«˜æ•ˆçš„æŸ¥è¯¢å’Œåˆ†æåŠŸèƒ½ã€‚

### 8.2 å®ç°ä»£ç 

**å®Œæ•´çš„è½¦è¾†è·Ÿè¸ªæ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢å®ç°**ï¼š

```python
# æ¡ˆä¾‹7ï¼šè½¦è¾†è·Ÿè¸ªæ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢
def case7_tracking_data_storage():
    """æ¡ˆä¾‹7ï¼šè½¦è¾†è·Ÿè¸ªæ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢"""

    # 1. åˆå§‹åŒ–å­˜å‚¨
    db_config = {
        "host": "localhost",
        "port": 5432,
        "database": "tracking_db",
        "user": "tracking_user",
        "password": "tracking_password"
    }
    storage = VehicleTrackingStorage(db_config)
    storage.connect()
    storage.create_tables()

    # 2. æŸ¥è¯¢è½¦è¾†ä½ç½®
    vehicle_id = "VEH001"
    positions = storage.query_positions(vehicle_id, limit=100)
    logger.info(f"Found {len(positions)} positions for vehicle {vehicle_id}")

    # 3. æŸ¥è¯¢æ—¶é—´èŒƒå›´å†…çš„ä½ç½®
    from datetime import datetime, timedelta
    start_time = datetime.now() - timedelta(hours=24)
    end_time = datetime.now()
    recent_positions = storage.query_positions(vehicle_id, start_time=start_time, end_time=end_time, limit=1000)
    logger.info(f"Found {len(recent_positions)} positions in last 24 hours")

    # 4. ç»Ÿè®¡ä¿¡æ¯
    if positions:
        speeds = [p.get("speed", 0) for p in positions if p.get("speed")]
        if speeds:
            avg_speed = sum(speeds) / len(speeds)
            max_speed = max(speeds)
            logger.info(f"Speed statistics:")
            logger.info(f"  Average speed: {avg_speed:.2f} km/h")
            logger.info(f"  Max speed: {max_speed:.2f} km/h")

    return {
        "total_positions": len(positions),
        "recent_positions": len(recent_positions),
        "statistics": {
            "average_speed": avg_speed if speeds else 0,
            "max_speed": max_speed if speeds else 0
        }
    }

# è¿è¡Œæ¡ˆä¾‹7
if __name__ == "__main__":
    case7_tracking_data_storage()
```

**é¢„æœŸç»“æœ**ï¼š

```text
Found 100 positions for vehicle VEH001
Found 50 positions in last 24 hours
Speed statistics:
  Average speed: 55.50 km/h
  Max speed: 80.00 km/h
```

---

**å‚è€ƒæ–‡æ¡£**ï¼š

- `01_Overview.md` - æ¦‚è¿°
- `02_Formal_Definition.md` - å½¢å¼åŒ–å®šä¹‰
- `03_Standards.md` - æ ‡å‡†å¯¹æ ‡
- `04_Transformation.md` - è½¬æ¢ä½“ç³»

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21
**æœ€åæ›´æ–°**ï¼š2025-01-21
