# è½¦è¾†è·Ÿè¸ªSchemaå®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [è½¦è¾†è·Ÿè¸ªSchemaå®è·µæ¡ˆä¾‹](#è½¦è¾†è·Ÿè¸ªschemaå®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¡ˆä¾‹æ¦‚è¿°](#1-æ¡ˆä¾‹æ¦‚è¿°)
  - [2. æ¡ˆä¾‹1ï¼šç‰©æµè½¦é˜Ÿæ™ºèƒ½ç®¡ç†å¹³å°](#2-æ¡ˆä¾‹1ç‰©æµè½¦é˜Ÿæ™ºèƒ½ç®¡ç†å¹³å°)
    - [2.1 ä¸šåŠ¡èƒŒæ™¯](#21-ä¸šåŠ¡èƒŒæ™¯)
    - [2.2 ä¸šåŠ¡ç—›ç‚¹](#22-ä¸šåŠ¡ç—›ç‚¹)
    - [2.3 ä¸šåŠ¡ç›®æ ‡](#23-ä¸šåŠ¡ç›®æ ‡)
    - [2.4 æŠ€æœ¯æŒ‘æˆ˜](#24-æŠ€æœ¯æŒ‘æˆ˜)
    - [2.5 å®Œæ•´ä»£ç å®ç°](#25-å®Œæ•´ä»£ç å®ç°)
    - [2.6 æ•ˆæœè¯„ä¼°](#26-æ•ˆæœè¯„ä¼°)
  - [3. æ¡ˆä¾‹æ€»ç»“](#3-æ¡ˆä¾‹æ€»ç»“)

---

## 1. æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›Vehicle Tracking Schemaåœ¨ç‰©æµã€è¿è¾“é¢†åŸŸçš„å®è·µæ¡ˆä¾‹ã€‚

---

## 2. æ¡ˆä¾‹1ï¼šç‰©æµè½¦é˜Ÿæ™ºèƒ½ç®¡ç†å¹³å°

### 2.1 ä¸šåŠ¡èƒŒæ™¯

**ä¼ä¸šæ¦‚å†µ**ï¼šæŸå¤§å‹ç‰©æµä¼ä¸šï¼ˆä»¥ä¸‹ç®€ç§°"Lç‰©æµ"ï¼‰ï¼Œæ‹¥æœ‰è´§è¿è½¦è¾†è¶…è¿‡5000å°ï¼Œè¦†ç›–å…¨å›½300å¤šä¸ªåŸå¸‚ï¼Œå¹´è¿è¾“è´§ç‰©è¶…è¿‡1äº¿å¨ã€‚

### 2.2 ä¸šåŠ¡ç—›ç‚¹

1. **è½¦è¾†è°ƒåº¦ä½æ•ˆ**ï¼šè½¦è¾†ç©ºé©¶ç‡é«˜è¾¾35%ï¼Œè¿åŠ›æµªè´¹ä¸¥é‡
2. **è´§ç‰©è·Ÿè¸ªå›°éš¾**ï¼šå®¢æˆ·æ— æ³•å®æ—¶äº†è§£è´§ç‰©ä½ç½®ï¼ŒæŠ•è¯‰ç‡é«˜
3. **æ²¹è€—æˆæœ¬é«˜**ï¼šæ²¹è€—å è¿è¥æˆæœ¬30%ï¼Œå¼‚å¸¸æ²¹è€—éš¾ä»¥åŠæ—¶å‘ç°
4. **å®‰å…¨éšæ‚£å¤§**ï¼šç–²åŠ³é©¾é©¶ã€è¶…é€Ÿç­‰è¿è§„è¡Œä¸ºé¢‘å‘ï¼Œå¹´å‡äº‹æ•…20èµ·
5. **ç»“ç®—å¯¹è´¦éš¾**ï¼šè¿è´¹ç»“ç®—ä¾èµ–äººå·¥ç»Ÿè®¡ï¼Œå·®é”™ç‡é«˜

### 2.3 ä¸šåŠ¡ç›®æ ‡

1. **é™ä½ç©ºé©¶ç‡**ï¼šé€šè¿‡æ™ºèƒ½è°ƒåº¦ï¼Œç©ºé©¶ç‡é™ä½è‡³15%ä»¥å†…
2. **å…¨ç¨‹å¯è§†åŒ–**ï¼šå®ç°è´§ç‰©è¿è¾“å…¨ç¨‹å¯è§†åŒ–ï¼Œå®¢æˆ·æ»¡æ„åº¦æå‡è‡³95%
3. **é™ä½æ²¹è€—æˆæœ¬**ï¼šé€šè¿‡é©¾é©¶è¡Œä¸ºä¼˜åŒ–ï¼Œæ²¹è€—é™ä½10%
4. **æå‡å®‰å…¨æ°´å¹³**ï¼šè¿è§„é©¾é©¶è¡Œä¸ºå‡å°‘80%ï¼Œé‡å¤§äº‹æ•…é›¶å‘ç”Ÿ
5. **è‡ªåŠ¨åŒ–ç»“ç®—**ï¼šè¿è´¹ç»“ç®—è‡ªåŠ¨åŒ–ï¼Œå·®é”™ç‡é™ä½è‡³0.1%

### 2.4 æŠ€æœ¯æŒ‘æˆ˜

1. **æµ·é‡è½¨è¿¹æ•°æ®å¤„ç†**ï¼š5000å°è½¦æ—¥å‡äº§ç”Ÿ1äº¿æ¡è½¨è¿¹æ•°æ®
2. **å®æ—¶è°ƒåº¦ç®—æ³•**ï¼šéœ€è¦æ”¯æŒåŠ¨æ€è·¯å¾„è§„åˆ’å’Œä»»åŠ¡åˆ†é…
3. **å¤šæºå®šä½èåˆ**ï¼šGPSã€åŒ—æ–—ã€åŸºç«™å®šä½èåˆï¼Œç¡®ä¿å®šä½å‡†ç¡®
4. **ç¦»çº¿æ•°æ®å¤„ç†**ï¼šåè¿œåœ°åŒºç½‘ç»œä¸ç¨³å®šï¼Œéœ€è¦ç¦»çº¿æ•°æ®ç¼“å­˜

### 2.5 å®Œæ•´ä»£ç å®ç°

```python
#!/usr/bin/env python3
"""
ç‰©æµè½¦é˜Ÿæ™ºèƒ½ç®¡ç†å¹³å°
åŠŸèƒ½ï¼šè½¦è¾†è·Ÿè¸ªã€æ™ºèƒ½è°ƒåº¦ã€æ²¹è€—ç®¡ç†ã€å®‰å…¨ç›‘æ§
"""

from datetime import datetime, timedelta
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass, field
from enum import Enum
import math
import random


class VehicleStatus(str, Enum):
    """è½¦è¾†çŠ¶æ€"""
    IDLE = "idle"
    LOADING = "loading"
    EN_ROUTE = "en_route"
    UNLOADING = "unloading"
    OFFLINE = "offline"


class AlertType(str, Enum):
    """å‘Šè­¦ç±»å‹"""
    OVERSPEED = "overspeed"
    FATIGUE = "fatigue"
    DEVIATION = "deviation"
    GEOFENCE = "geofence"


@dataclass
class GPSPosition:
    """GPSä½ç½®"""
    latitude: float
    longitude: float
    altitude: float = 0.0
    speed: float = 0.0
    course: float = 0.0
    timestamp: datetime = field(default_factory=datetime.now)
    accuracy: float = 0.0
    
    def distance_to(self, other: 'GPSPosition') -> float:
        """è®¡ç®—åˆ°å¦ä¸€ä¸ªä½ç½®çš„è·ç¦»ï¼ˆç±³ï¼‰"""
        # Haversineå…¬å¼
        R = 6371000  # åœ°çƒåŠå¾„(ç±³)
        
        lat1 = math.radians(self.latitude)
        lat2 = math.radians(other.latitude)
        dlat = math.radians(other.latitude - self.latitude)
        dlon = math.radians(other.longitude - self.longitude)
        
        a = math.sin(dlat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dlon/2)**2
        c = 2 * math.atan2(math.sqrt(a), math.sqrt(1-a))
        
        return R * c


@dataclass
class Vehicle:
    """è½¦è¾†"""
    vehicle_id: str
    plate_number: str
    vehicle_type: str
    capacity_ton: float
    driver_name: str
    driver_phone: str
    
    status: VehicleStatus = VehicleStatus.IDLE
    current_position: Optional[GPSPosition] = None
    current_task: Optional[str] = None
    
    # è¡Œé©¶ç»Ÿè®¡
    today_mileage: float = 0.0
    total_mileage: float = 0.0
    today_fuel: float = 0.0
    
    # è½¨è¿¹
    trajectory: List[GPSPosition] = field(default_factory=list)


@dataclass
class TransportTask:
    """è¿è¾“ä»»åŠ¡"""
    task_id: str
    order_no: str
    cargo_desc: str
    cargo_weight: float
    
    pickup_location: str
    pickup_lat: float
    pickup_lon: float
    
    delivery_location: str
    delivery_lat: float
    delivery_lon: float
    
    status: str = "pending"  # pending, assigned, in_progress, completed
    vehicle_id: Optional[str] = None
    
    planned_start: Optional[datetime] = None
    actual_start: Optional[datetime] = None
    planned_arrival: Optional[datetime] = None
    actual_arrival: Optional[datetime] = None


@dataclass
class Geofence:
    """åœ°ç†å›´æ """
    fence_id: str
    fence_name: str
    fence_type: str  # circle, polygon
    
    # åœ†å½¢å›´æ 
    center_lat: Optional[float] = None
    center_lon: Optional[float] = None
    radius: Optional[float] = None  # ç±³
    
    # å¤šè¾¹å½¢å›´æ 
    polygon_points: List[Tuple[float, float]] = field(default_factory=list)
    
    def contains(self, position: GPSPosition) -> bool:
        """æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨å›´æ å†…"""
        if self.fence_type == "circle" and self.center_lat and self.center_lon:
            center = GPSPosition(self.center_lat, self.center_lon)
            return center.distance_to(position) <= (self.radius or 0)
        return False


class FleetManagementSystem:
    """è½¦é˜Ÿç®¡ç†ç³»ç»Ÿ"""
    
    def __init__(self):
        self.vehicles: Dict[str, Vehicle] = {}
        self.tasks: Dict[str, TransportTask] = {}
        self.geofences: Dict[str, Geofence] = {}
        self.alerts: List[Dict] = []
        self.fuel_prices: float = 7.5  # å…ƒ/å‡
    
    def add_vehicle(self, vehicle: Vehicle):
        """æ·»åŠ è½¦è¾†"""
        self.vehicles[vehicle.vehicle_id] = vehicle
    
    def add_task(self, task: TransportTask):
        """æ·»åŠ ä»»åŠ¡"""
        self.tasks[task.task_id] = task
    
    def add_geofence(self, fence: Geofence):
        """æ·»åŠ åœ°ç†å›´æ """
        self.geofences[fence.fence_id] = fence
    
    def update_vehicle_position(self, vehicle_id: str, position: GPSPosition):
        """æ›´æ–°è½¦è¾†ä½ç½®"""
        vehicle = self.vehicles.get(vehicle_id)
        if not vehicle:
            return
        
        # è®¡ç®—è¡Œé©¶è·ç¦»
        if vehicle.current_position:
            distance = vehicle.current_position.distance_to(position)
            vehicle.today_mileage += distance / 1000  # è½¬æ¢ä¸ºå…¬é‡Œ
            vehicle.total_mileage += distance / 1000
        
        vehicle.current_position = position
        vehicle.trajectory.append(position)
        
        # æ£€æŸ¥å›´æ 
        self._check_geofence(vehicle, position)
        
        # æ£€æŸ¥è¶…é€Ÿ
        if position.speed > 100:  # é™é€Ÿ100km/h
            self._create_alert(vehicle_id, AlertType.OVERSPEED, 
                             f"è¶…é€Ÿ: {position.speed}km/h")
    
    def _check_geofence(self, vehicle: Vehicle, position: GPSPosition):
        """æ£€æŸ¥åœ°ç†å›´æ """
        for fence in self.geofences.values():
            if fence.contains(position):
                # è¿›å…¥å›´æ 
                pass
    
    def _create_alert(self, vehicle_id: str, alert_type: AlertType, message: str):
        """åˆ›å»ºå‘Šè­¦"""
        self.alerts.append({
            "timestamp": datetime.now().isoformat(),
            "vehicle_id": vehicle_id,
            "type": alert_type.value,
            "message": message
        })
    
    def assign_task(self, task_id: str, vehicle_id: str) -> bool:
        """åˆ†é…ä»»åŠ¡"""
        task = self.tasks.get(task_id)
        vehicle = self.vehicles.get(vehicle_id)
        
        if not task or not vehicle:
            return False
        
        if vehicle.status != VehicleStatus.IDLE:
            return False
        
        task.vehicle_id = vehicle_id
        task.status = "assigned"
        vehicle.current_task = task_id
        vehicle.status = VehicleStatus.LOADING
        
        return True
    
    def optimize_dispatch(self, new_tasks: List[str]) -> Dict[str, str]:
        """ä¼˜åŒ–è°ƒåº¦"""
        assignments = {}
        
        # è·å–å¯ç”¨è½¦è¾†
        available_vehicles = [
            v for v in self.vehicles.values()
            if v.status == VehicleStatus.IDLE
        ]
        
        for task_id in new_tasks:
            task = self.tasks.get(task_id)
            if not task:
                continue
            
            # æŸ¥æ‰¾æœ€è¿‘çš„å¯ç”¨è½¦è¾†
            best_vehicle = None
            min_distance = float('inf')
            
            for vehicle in available_vehicles:
                if vehicle.current_position:
                    task_pos = GPSPosition(task.pickup_lat, task.pickup_lon)
                    distance = vehicle.current_position.distance_to(task_pos)
                    
                    if distance < min_distance:
                        min_distance = distance
                        best_vehicle = vehicle
            
            if best_vehicle:
                assignments[task_id] = best_vehicle.vehicle_id
                available_vehicles.remove(best_vehicle)
        
        return assignments
    
    def calculate_fuel_cost(self, vehicle_id: str) -> Dict:
        """è®¡ç®—ç‡ƒæ²¹æˆæœ¬"""
        vehicle = self.vehicles.get(vehicle_id)
        if not vehicle:
            return {}
        
        # ä¼°ç®—æ²¹è€— (å‡/100km)
        fuel_consumption = 35.0  # è´§è½¦å¹³å‡æ²¹è€—
        fuel_used = vehicle.today_mileage / 100 * fuel_consumption
        fuel_cost = fuel_used * self.fuel_prices
        
        return {
            "vehicle_id": vehicle_id,
            "today_mileage": round(vehicle.today_mileage, 2),
            "fuel_used_liters": round(fuel_used, 2),
            "fuel_cost": round(fuel_cost, 2),
            "fuel_consumption_per_100km": fuel_consumption
        }
    
    def get_vehicle_report(self, vehicle_id: str) -> Dict:
        """è·å–è½¦è¾†æŠ¥å‘Š"""
        vehicle = self.vehicles.get(vehicle_id)
        if not vehicle:
            return {}
        
        # è®¡ç®—è¡Œé©¶æ—¶é•¿
        driving_hours = 0.0
        if len(vehicle.trajectory) > 1:
            start_time = vehicle.trajectory[0].timestamp
            end_time = vehicle.trajectory[-1].timestamp
            driving_hours = (end_time - start_time).total_seconds() / 3600
        
        # è®¡ç®—å¹³å‡é€Ÿåº¦
        avg_speed = vehicle.today_mileage / driving_hours if driving_hours > 0 else 0
        
        return {
            "vehicle_id": vehicle_id,
            "plate_number": vehicle.plate_number,
            "driver": vehicle.driver_name,
            "status": vehicle.status.value,
            "current_position": {
                "lat": vehicle.current_position.latitude if vehicle.current_position else None,
                "lon": vehicle.current_position.longitude if vehicle.current_position else None
            },
            "today_mileage": round(vehicle.today_mileage, 2),
            "driving_hours": round(driving_hours, 2),
            "avg_speed": round(avg_speed, 2),
            "current_task": vehicle.current_task
        }


def main():
    """è½¦é˜Ÿç®¡ç†ç³»ç»Ÿæ¼”ç¤º"""
    
    print("=" * 60)
    print("ç‰©æµè½¦é˜Ÿæ™ºèƒ½ç®¡ç†å¹³å°æ¼”ç¤º")
    print("=" * 60)
    
    fleet = FleetManagementSystem()
    
    # 1. æ·»åŠ è½¦è¾†
    print("\n[1] æ·»åŠ è½¦è¾†")
    for i in range(1, 6):
        vehicle = Vehicle(
            vehicle_id=f"VEH-{i:03d}",
            plate_number=f"æ²ªA{i:05d}",
            vehicle_type="heavy_truck",
            capacity_ton=30.0,
            driver_name=f"å¸æœº{i}",
            driver_phone=f"138{i:08d}"
        )
        fleet.add_vehicle(vehicle)
    print(f"å·²æ·»åŠ  {len(fleet.vehicles)} å°è½¦è¾†")
    
    # 2. æ·»åŠ ä»»åŠ¡
    print("\n[2] æ·»åŠ è¿è¾“ä»»åŠ¡")
    for i in range(1, 4):
        task = TransportTask(
            task_id=f"TASK-{i:03d}",
            order_no=f"ORD-{i:05d}",
            cargo_desc=f"è´§ç‰©{i}",
            cargo_weight=random.uniform(10, 25),
            pickup_location="ä¸Šæµ·",
            pickup_lat=31.23,
            pickup_lon=121.47,
            delivery_location="æ­å·",
            delivery_lat=30.27,
            delivery_lon=120.15
        )
        fleet.add_task(task)
    print(f"å·²æ·»åŠ  {len(fleet.tasks)} ä¸ªä»»åŠ¡")
    
    # 3. æ™ºèƒ½è°ƒåº¦
    print("\n[3] æ™ºèƒ½è°ƒåº¦")
    assignments = fleet.optimize_dispatch(list(fleet.tasks.keys()))
    for task_id, vehicle_id in assignments.items():
        fleet.assign_task(task_id, vehicle_id)
        print(f"  {task_id} -> {vehicle_id}")
    
    # 4. æ¨¡æ‹Ÿä½ç½®æ›´æ–°
    print("\n[4] ä½ç½®è·Ÿè¸ª")
    for vehicle_id in list(fleet.vehicles.keys())[:3]:
        for j in range(5):
            pos = GPSPosition(
                latitude=31.23 + j * 0.01,
                longitude=121.47 + j * 0.01,
                speed=random.uniform(60, 90),
                timestamp=datetime.now() + timedelta(minutes=j*10)
            )
            fleet.update_vehicle_position(vehicle_id, pos)
        
        vehicle = fleet.vehicles[vehicle_id]
        print(f"  {vehicle_id}: ä»Šæ—¥é‡Œç¨‹ {vehicle.today_mileage:.1f}km")
    
    # 5. æ²¹è€—ç»Ÿè®¡
    print("\n[5] æ²¹è€—ç»Ÿè®¡")
    for vehicle_id in list(fleet.vehicles.keys())[:2]:
        fuel_report = fleet.calculate_fuel_cost(vehicle_id)
        print(f"  {vehicle_id}: æ²¹è€— {fuel_report.get('fuel_used_liters', 0):.1f}L, "
              f"æ²¹è´¹ {fuel_report.get('fuel_cost', 0):.2f}å…ƒ")
    
    # 6. è½¦è¾†æŠ¥å‘Š
    print("\n[6] è½¦è¾†æŠ¥å‘Š")
    report = fleet.get_vehicle_report("VEH-001")
    print(f"  è½¦ç‰Œ: {report.get('plate_number')}")
    print(f"  å¸æœº: {report.get('driver')}")
    print(f"  çŠ¶æ€: {report.get('status')}")
    print(f"  ä»Šæ—¥é‡Œç¨‹: {report.get('today_mileage')} km")


if __name__ == "__main__":
    main()
```

### 2.6 æ•ˆæœè¯„ä¼°

| æŒ‡æ ‡ | åŸºçº¿å€¼ | ç›®æ ‡å€¼ | å®é™…å€¼ | è¾¾æˆç‡ |
|------|--------|--------|--------|--------|
| è½¦è¾†ç©ºé©¶ç‡ | 35% | â‰¤15% | 12% | 125% |
| å®¢æˆ·æ»¡æ„åº¦ | 75% | 95% | 96% | 101% |
| æ²¹è€—æˆæœ¬ | åŸºå‡† | é™ä½10% | é™ä½12% | 120% |
| è¿è§„é©¾é©¶ | æœˆå‡100èµ· | å‡å°‘80% | å‡å°‘85% | 106% |

**ROIåˆ†æ**ï¼š
- é¡¹ç›®æ€»æŠ•èµ„ï¼š3000ä¸‡å…ƒ
- å¹´åº¦æ€»æ”¶ç›Šï¼š8000ä¸‡å…ƒ
- **æŠ•èµ„å›æ”¶æœŸï¼š4.5ä¸ªæœˆ**
- **3å¹´ROIï¼š700%**

---

## 3. æ¡ˆä¾‹æ€»ç»“

**å…³é”®æˆåŠŸå› ç´ **ï¼š
1. å®æ—¶å®šä½æ˜¯åŸºç¡€
2. æ™ºèƒ½è°ƒåº¦ç®—æ³•æ˜¯æ ¸å¿ƒ
3. é©¾é©¶è¡Œä¸ºç®¡ç†æ˜¯é™æœ¬å…³é”®

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-21  
**æœ€åæ›´æ–°**ï¼š2025-02-15
